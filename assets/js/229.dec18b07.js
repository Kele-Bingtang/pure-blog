(window.webpackJsonp=window.webpackJsonp||[]).push([[229],{550:function(s,n,t){"use strict";t.r(n);var e=t(3),a=Object(e.a)({},(function(){var s=this,n=s._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("div",{staticClass:"custom-block note"},[n("p",{staticClass:"custom-block-title"},[s._v("笔记")]),s._v(" "),n("p",[s._v("虽然 DockerHub 已经有了 Nginx 或 OpenResty，但是不够「灵活」，我们无法安装第三方模块。本内容讲解如何利用 Dockerfile 构建属于自己的 Nginx 或 OpenResty 镜像。")]),s._v(" "),n("div",{staticClass:"custom-block right"},[n("p",[s._v("2021-11-14 @Young Kbt")])])]),s._v(" "),n("p"),n("div",{staticClass:"table-of-contents"},[n("ul",[n("li",[n("a",{attrs:{href:"#前言"}},[s._v("前言")])]),n("li",[n("a",{attrs:{href:"#构建过程"}},[s._v("构建过程")])]),n("li",[n("a",{attrs:{href:"#配置文件模板"}},[s._v("配置文件模板")])])])]),n("p"),s._v(" "),n("h2",{attrs:{id:"前言"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[s._v("#")]),s._v(" 前言")]),s._v(" "),n("p",[s._v("之前我一直使用的是从 DockerHub 拉取下载的镜像，但是该镜像已经固定了模块，我在使用的过程时，尝试了 Nginx 自带的下载站点，但是界面比较简洁、普通，而且字体很「拥挤」，于是我踏上寻找优化下载站点页面的道路，然后我发现了第三方模块 "),n("code",[s._v("ngx-fancyindex")]),s._v("，该模块优化了下载站点的页面，看起来更加舒服，于是我打算使用它。")]),s._v(" "),n("p",[s._v("但是我发现了一个问题，我的 Nginx 是从 DockerHub 拉取的，说明供应商已经设计好所需的模块，但是并没有我想要的 "),n("code",[s._v("ngx-fancyindex")]),s._v(" 模块，供应商只提供了基础的 Nginx 镜像。于是我就无法针对这个 Nginx 镜像添加第三方模块，特别是后期，如果我需要添加多个第三方模块，那面对拉取的 Nginx 镜像无能为力。")]),s._v(" "),n("p",[s._v("于是，我就打算自己构建一个 Nginx 镜像，在构建的过程，添加第三方模块。")]),s._v(" "),n("p",[s._v("我的下载站点地址："),n("a",{attrs:{href:"https://www.youngkbt.cn/download/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://www.youngkbt.cn/download/"),n("OutboundLink")],1)]),s._v(" "),n("p",[s._v("下面的内容有很多代码，如果不喜欢复制这些代码，这里提供源码文件的下载地址："),n("a",{attrs:{href:"https://www.youngkbt.cn/download/OpenResty%E6%9E%84%E5%BB%BA/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://www.youngkbt.cn/download/OpenResty构建/"),n("OutboundLink")],1)]),s._v(" "),n("p",[s._v("需要全部的源码，下载 "),n("code",[s._v("openresty-resource.tar.gz")]),s._v(" 压缩包。需要单个文件，就点击单个文件。")]),s._v(" "),n("p",[s._v("如果想要了解如何构建我的下载站点，"),n("RouterLink",{attrs:{to:"/about/index/download/"}},[s._v("点击跳转")])],1),s._v(" "),n("h2",{attrs:{id:"构建过程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#构建过程"}},[s._v("#")]),s._v(" 构建过程")]),s._v(" "),n("p",[s._v("最后的结果不繁琐，仅仅一个 Dockerfile 文件就解决，但是过程耗费了我半天，这里先提供 Dockerfile 文件内容：")]),s._v(" "),n("div",{staticClass:"language-dockerfile line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[n("code",[n("span",{pre:!0,attrs:{class:"token instruction"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" centos:7.9")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# openrestry 版本")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token instruction"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ARG")]),s._v(" OPENRESTY_VERSION="),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1.19.9.1"')])]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 第三方模块版本，我安装 ngx-fancyindex 模块")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#ARG FANCYINDEX_VERSION="0.5.2"')]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 镜像信息")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token instruction"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LABEL")]),s._v(" AUTHOR=YoungKbt")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果事先下载第三模块的压缩包，则放入 Dockerfile 所在的目录下，取消注释")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ADD ngx-fancyindex-${FANCYINDEX_VERSION}.tar.xz /tmp")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装 Nginx 环境库，下载第三方模块和 Nginx 或 Openresty，并解压编译安装")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token instruction"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" yum install -y "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n     gcc pcre pcre-devel zlib zlib-devel openssl openssl-devel --nogpgcheck "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n     curl wget perl make vim tar "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n    && cd /tmp \\ ")]),s._v("\n    && wget https://openresty.org/download/openresty-${OPENRESTY_VERSION}.tar.gz \\\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果不喜欢先下载第三方模块然后 ADD，则这里填写第三方模块的下载地址，然后取消下面两行注释")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# && wget https://github.com/aperezdc/ngx-fancyindex/releases/download/v${FANCYINDEX_VERSION}/ngx-fancyindex-${FANCYINDEX_VERSION}.tar.xz \\")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# && tar xvf ngx-fancyindex-${FANCYINDEX_VERSION}.tar.xz \\")]),s._v("\n    && tar zxvf openresty-${OPENRESTY_VERSION}.tar.gz \\\n    && cd openresty-${OPENRESTY_VERSION} \\\n    && ./configure \\\n        --prefix=/usr/local/openresty \\\n        --with-cc-opt='-O2 -DNGX_LUA_ABORT_AT_PANIC -I/usr/local/openresty/zlib/include -I/usr/local/openresty/pcre/include -I/usr/local/openresty/openssl111/include' \\\n        --with-ld-opt='-Wl,-rpath,/usr/local/openresty/luajit/lib -L/usr/local/openresty/zlib/lib -L/usr/local/openresty/pcre/lib -L/usr/local/openresty/openssl111/lib -Wl,-rpath,/usr/local/openresty/zlib/lib:/usr/local/openresty/pcre/lib:/usr/local/openresty/openssl111/lib' \\\n        --with-pcre-jit \\\n        --with-stream \\\n        --with-stream_ssl_module \\\n        --with-stream_ssl_preread_module \\\n        --with-http_v2_module \\\n        --without-mail_pop3_module \\\n        --without-mail_imap_module \\\n        --without-mail_smtp_module \\\n        --with-http_stub_status_module \\\n        --with-http_realip_module \\\n        --with-http_addition_module \\\n        --with-http_auth_request_module \\\n        --with-http_secure_link_module \\\n        --with-http_random_index_module \\\n        --with-http_gzip_static_module \\\n        --with-http_sub_module \\\n        --with-http_dav_module \\\n        --with-http_flv_module \\\n        --with-http_mp4_module \\\n        --with-http_gunzip_module \\\n        --with-threads --with-stream \\\n        --with-http_ssl_module \\\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --add-module=../ngx-fancyindex-${FANCYINDEX_VERSION} \\")]),s._v("\n    && make build \\\n    && make install \\\n    && cd /tmp \\\n    && rm -rf ngx-fancyindex-${FANCYINDEX_VERSION}.tar.xz \\\n    && rm -rf openresty-${OPENRESTY_VERSION}.tar.gz \\\n    && yum clean all \\\n    && mkdir -p /etc/nginx/conf.d \\\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 必须创建一个目录，如果这个目录不存在，则无法启动镜像")]),s._v("\n    && mkdir -p /var/run/openresty\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将 nginx 命令添加至全局变量，这里演示常用的三个")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token instruction"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" PATH="),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PATH")]),s._v(":/usr/local/openresty/luajit/bin:/usr/local/openresty/nginx/sbin:/usr/local/openresty/bin")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token instruction"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" LUA_PATH="),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/local/openresty/site/lualib/?.ljbc;/usr/local/openresty/site/lualib/?/init.ljbc;/usr/local/openresty/lualib/?.ljbc;/usr/local/openresty/lualib/?/init.ljbc;/usr/local/openresty/site/lualib/?.lua;/usr/local/openresty/site/lualib/?/init.lua;/usr/local/openresty/lualib/?.lua;/usr/local/openresty/lualib/?/init.lua;./?.lua;/usr/local/openresty/luajit/share/luajit-2.1.0-beta3/?.lua;/usr/local/share/lua/5.1/?.lua;/usr/local/share/lua/5.1/?/init.lua;/usr/local/openresty/luajit/share/lua/5.1/?.lua;/usr/local/openresty/luajit/share/lua/5.1/?/init.lua"')])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token instruction"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" LUA_CPATH="),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/local/openresty/site/lualib/?.so;/usr/local/openresty/lualib/?.so;./?.so;/usr/local/lib/lua/5.1/?.so;/usr/local/openresty/luajit/lib/lua/5.1/?.so;/usr/local/lib/lua/5.1/loadall.so;/usr/local/openresty/luajit/lib/lua/5.1/?.so"')])]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将 nginx 配置文件，覆盖 Nginx 自带的配置文件")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token instruction"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" nginx.conf /usr/local/openresty/nginx/conf/nginx.conf")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将 default.conf 配置文件，添加到指定目录下")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token instruction"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" nginx.vh.default.conf /etc/nginx/conf.d/default.conf")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动容器时，执行该命令，如果不执行，则容器启动后会自动停止运行")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token instruction"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" ["),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/local/openresty/nginx/sbin/nginx"')]),s._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-g"')]),s._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"daemon off;"')]),s._v("]")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Use SIGQUIT instead of default SIGTERM to cleanly drain requests")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# See https://github.com/openresty/docker-openresty/blob/master/README.md#tips--pitfalls")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token instruction"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("STOPSIGNAL")]),s._v(" SIGQUIT")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br")])]),n("p",[s._v("代码虽然多，但是并不复杂，容我慢慢解释：")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("首先注意你的基础镜像，我是基于 Centos:7.9 系统，你可以是 Ubuntu 或者其他的系统，FROM 指令会先去本地找镜像，没有找到则去 DockerHub 下载到本地，再使用")])]),s._v(" "),n("li",[n("p",[s._v("我这里使用的是 OpenRestry，这个平台集成了 Nginx 和 Lua 语言，总体而言就是拥有更多功能的 Nginx。")])]),s._v(" "),n("li",[n("p",[s._v("4、7 行请填写 OpenRestry 或者 Nginx 的版本，以及第三方模块的版本号，我使用一个变量存储版本号，你也可以直接在下载的时候，写版本号")])]),s._v(" "),n("li",[n("p",[s._v("10 行的镜像信息 "),n("code",[s._v("LABEL")]),s._v(" 可以不写，一般是镜像的关键词、作者信息等")])]),s._v(" "),n("li",[n("p",[s._v("13 行的 ADD 可以不写，因为我的第三方模块地址在 GitHub，而通过 "),n("code",[s._v("wget")]),s._v(" 下载经常连接超时、下载失败，所以我就先下载到 Windows，然后传输到服务器里。注意，"),n("strong",[s._v("如果采用这种方式，请将第三方模块放到 Dockerfile 所在的目录里")])])]),s._v(" "),n("li",[n("p",[s._v("17 - 18 行 是下载安装 Nginx 所需的运行环境，以及一些常用的命令，可以根据需求自行添加命令")])]),s._v(" "),n("li",[n("p",[s._v("20 行下载 OpenResty，可以更换为 Nginx 的下载地址，后面 "),n("code",[s._v("${}")]),s._v(" 就是存储版本号的变量")])]),s._v(" "),n("li",[n("p",[s._v("21 行表示在 "),n("code",[s._v("/tmp")]),s._v(" 目录下执行安装操作，构建完成后，可以去该目录下查看源码")])]),s._v(" "),n("li",[n("p",[s._v("22 - 23 行下载第三方模块并解压，如果采用第 13 行的 ADD 方式，就注释掉或者删除掉")])]),s._v(" "),n("li",[n("p",[s._v("26 - 54 行是编译并安装。"),n("strong",[s._v("第三方模块请添加在第 51 行代码后")]),s._v("，第 52 行代码就是我添加的第三方模块，该路径与 OpenResty 同级，所以 "),n("code",[s._v("../")]),s._v(" 就是返回上一级目录，找到第三模块的根目录名。")]),s._v(" "),n("p",[s._v("52 行之前都是常用的自带模块，建议不要删除，日后可能用到。")])]),s._v(" "),n("li",[n("p",[s._v("55 - 57 行是删除下载的压缩包，但是并没有删除解压之后的目录，你可以根据需求决定要不要删除")])]),s._v(" "),n("li",[n("p",[s._v("58 行是清除之前 yum 安装的环境以及命令的缓存，注意："),n("strong",[s._v("只是清除安装过程的缓存，不会卸载安装的库和命令")]),s._v("。因为 yum 下载后成功后，将一份存在缓存，为了不占用空间，所以清除掉")])]),s._v(" "),n("li",[n("p",[s._v("59 行是为了适应官方的镜像配置处理。一般而言，我们不能直接操作 Nginx 的「核心」配置文件 "),n("code",[s._v("nginx.conf")]),s._v("，而是操作「子」配置文件 "),n("code",[s._v("xxx.conf")]),s._v("。因为「核心」配置文件通过 "),n("code",[s._v("include")]),s._v(" 指令将「子」配置文件进行引入，所以我们只需在 "),n("code",[s._v("nginx.conf")]),s._v(" 加入 "),n("code",[s._v("include /etc/nginx/conf.d;")]),s._v("，即可把 conf.d 目录下的所有「子」配置文件引入其中。这样做是为了安全考虑，直接操作核心配置文件，容易引起安全问题。")]),s._v(" "),n("p",[s._v("下面我会提供 nginx.conf 的模板，该模板已经使用了 "),n("code",[s._v("include /etc/nginx/conf.d;")]),s._v("，不需要自己写。")])]),s._v(" "),n("li",[n("p",[s._v("61 行是因为我在启动镜像的时候，报错："),n("code",[s._v("/var/run/openresty")]),s._v(" 不存在，所以构建时候需要创建，如果你的报错不是这个目录，而修改即可")])]),s._v(" "),n("li",[n("p",[s._v("64 - 66 行添加 nginx 命令到全局变量，如果是 OpenRestry 不需要修改，如果是 Nginx，你需要删除第一个和第三个路径，只留下第二个")])]),s._v(" "),n("li",[n("p",[s._v("69 行将宿主机的 "),n("code",[s._v("nginx.conf")]),s._v(" 覆盖原来的 nginx.conf，因为原来的 nginx.conf 没有 "),n("code",[s._v("include /etc/nginx/conf.d;")]),s._v("，下面会有宿主机的 "),n("code",[s._v("nginx.conf")]),s._v(" 模板")])]),s._v(" "),n("li",[n("p",[s._v("72 行给 "),n("code",[s._v("/etc/nginx/conf.d")]),s._v(" 目录下添加一个 .conf 配置文件，以后我们只需要在这个配置文件添加 server 模块，下方有模板提供")])]),s._v(" "),n("li",[n("p",[s._v("75 行是必须的，它是启动容器后不希望容器停止的命令")])]),s._v(" "),n("li",[n("p",[s._v("79 行是优化命令，可以不加")])])]),s._v(" "),n("p",[s._v("说了那么多，大家可能没有耐心看完，我想说，如果你想了解 OpenResty 或 Nginx 镜像的构建过程，请了解它。我这里也说明下简单的上手：")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("第 1 行可以修改")])]),s._v(" "),n("li",[n("p",[s._v("第 4、7 行可以修改版本，版本目前是最新的")])]),s._v(" "),n("li",[n("p",[s._v("第 10 行可以修改")])]),s._v(" "),n("li",[n("p",[s._v("第 22、23 行修改自己的第三方模块地址，如果下载失败，则看上方的第 5 个解释（黑点）")])]),s._v(" "),n("li",[n("p",[s._v("第 52 行以及后面的是第三模块路径（容器内的路径，并不是宿主机的路径）")])]),s._v(" "),n("li",[n("p",[s._v("第 65、66 行如果是 Nginx，请删除掉，并且 64 行删除掉第一个和第三个路径")])]),s._v(" "),n("li",[n("p",[s._v("第 75 行如果是 Nginx，请填写 nginx 可执行文件的路径")])])]),s._v(" "),n("h2",{attrs:{id:"配置文件模板"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置文件模板"}},[s._v("#")]),s._v(" 配置文件模板")]),s._v(" "),n("p",[s._v("下面提供 nginx.conf 的模板：")]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nginx.conf  --  docker-openresty")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# This file is installed to:")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   `/usr/local/openresty/nginx/conf/nginx.conf`")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# and is the file loaded by nginx at startup,")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# unless the user specifies otherwise.")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# It tracks the upstream OpenResty's `nginx.conf`, but removes the `server`")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# section and adds this directive:")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     `include /etc/nginx/conf.d/*.conf;`")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The `docker-openresty` file `nginx.vh.default.conf` is copied to")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# `/etc/nginx/conf.d/default.conf`.  It contains the `server section")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# of the upstream `nginx.conf`.")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# See https://github.com/openresty/docker-openresty/blob/master/README.md#nginx-config-files")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v("  nobody")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#worker_processes 1;")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Enables the use of JIT for regular expressions to speed-up their processing.")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("pcre_jit")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("on")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#error_log  logs/error.log;")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#error_log  logs/error.log  notice;")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#error_log  logs/error.log  info;")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#pid        logs/nginx.pid;")]),s._v("\n\n\n"),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("events")])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("worker_connections")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\n"),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("include")]),s._v("       mime.types")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default_type")]),s._v("  application/octet-stream")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Enables or disables the use of underscores in client request header fields.")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# When the use of underscores is disabled, request header fields whose names contain underscores are marked as invalid and become subject to the ignore_invalid_headers directive.")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# underscores_in_headers off;")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#log_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#                  '$status $body_bytes_sent \"$http_referer\" '")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#                  \'"$http_user_agent" "$http_x_forwarded_for"\';')]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#access_log  logs/access.log  main;")]),s._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Log in JSON Format")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# log_format nginxlog_json escape=json \'{ "timestamp": "$time_iso8601", \'')]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# \'"remote_addr": "$remote_addr", \'')]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  '\"body_bytes_sent\": $body_bytes_sent, '")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  '\"request_time\": $request_time, '")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  '\"response_status\": $status, '")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#  \'"request": "$request", \'')]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#  \'"request_method": "$request_method", \'')]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#  \'"host": "$host",\'')]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#  \'"upstream_addr": "$upstream_addr",\'')]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#  \'"http_x_forwarded_for": "$http_x_forwarded_for",\'')]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#  \'"http_referrer": "$http_referer", \'')]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#  \'"http_user_agent": "$http_user_agent", \'')]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#  \'"http_version": "$server_protocol", \'')]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  '\"nginx_access\": true }';")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# access_log /dev/stdout nginxlog_json;")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# See Move default writable paths to a dedicated directory (#119)")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# https://github.com/openresty/docker-openresty/issues/119")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("client_body_temp_path")]),s._v(" /var/run/openresty/nginx-client-body")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_temp_path")]),s._v("       /var/run/openresty/nginx-proxy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fastcgi_temp_path")]),s._v("     /var/run/openresty/nginx-fastcgi")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("uwsgi_temp_path")]),s._v("       /var/run/openresty/nginx-uwsgi")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("scgi_temp_path")]),s._v("        /var/run/openresty/nginx-scgi")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sendfile")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("on")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#tcp_nopush     on;")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#keepalive_timeout  0;")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("keepalive_timeout")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("65")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#gzip  on;")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("include")]),s._v(" /etc/nginx/conf.d/*.conf")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Don't reveal OpenResty version to clients.")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# server_tokens off;")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br"),n("span",{staticClass:"line-number"},[s._v("88")]),n("br"),n("span",{staticClass:"line-number"},[s._v("89")]),n("br"),n("span",{staticClass:"line-number"},[s._v("90")]),n("br")])]),n("p",[s._v("nginx.vh.default.conf 模板内容：")]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nginx.vh.default.conf  --  docker-openresty")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# This file is installed to:")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   `/etc/nginx/conf.d/default.conf`")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# It tracks the `server` section of the upstream OpenResty's `nginx.conf`.")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# This config (and any other configs in `etc/nginx/conf.d/`) is loaded by")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# default by the `include` directive in `/usr/local/openresty/nginx/conf/nginx.conf`.")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# See https://github.com/openresty/docker-openresty/blob/master/README.md#nginx-config-files")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n\n\n"),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v("       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v("  localhost")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#charset koi8-r;")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#access_log  /var/log/nginx/host.access.log  main;")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v("   /usr/local/openresty/nginx/html")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v("  index.html index.htm")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#error_page  404              /404.html;")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# redirect server error pages to the static page /50x.html")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("error_page")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("502")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("504")]),s._v("  /50x.html")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" = /50x.html")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token directive"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v("   /usr/local/openresty/nginx/html")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# proxy the PHP scripts to Apache listening on 127.0.0.1:80")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#location ~ \\.php$ {")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    proxy_pass   http://127.0.0.1;")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#}")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#location ~ \\.php$ {")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    root           /usr/local/openresty/nginx/html;")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    fastcgi_pass   127.0.0.1:9000;")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    fastcgi_index  index.php;")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    include        fastcgi_params;")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#}")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# deny access to .htaccess files, if Apache's document root")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# concurs with nginx's one")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#location ~ /\\.ht {")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    deny  all;")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br")])]),n("p",[s._v("这里给出我的 Dockfile 所在的目录下所有内容：")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Nginx/20211214191527.png",alt:"image-20211214191438954"}})]),s._v(" "),n("p",[s._v("可以看出，我并非 ADD "),n("code",[s._v("nginx.conf")]),s._v("，而是 ADD "),n("code",[s._v("mynginx.conf")]),s._v("，这是我修改后的 "),n("code",[s._v("nginx.conf")]),s._v("，比如开启压缩、优化访问速度等指令，压缩包是我的第三方模块，因为 "),n("code",[s._v("wget")]),s._v(" 下载的地址是 GitHub，太慢了。")])])}),[],!1,null,null,null);n.default=a.exports}}]);