(window.webpackJsonp=window.webpackJsonp||[]).push([[305],{628:function(s,a,t){"use strict";t.r(a);var e=t(3),n=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p"),a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#什么是dockerfile"}},[s._v("什么是Dockerfile")])]),a("li",[a("a",{attrs:{href:"#解析过程"}},[s._v("解析过程")]),a("ul",[a("li",[a("a",{attrs:{href:"#基本知识"}},[s._v("基本知识")])]),a("li",[a("a",{attrs:{href:"#大致流程"}},[s._v("大致流程")])]),a("li",[a("a",{attrs:{href:"#dockerfile、镜像、容器的理解"}},[s._v("Dockerfile、镜像、容器的理解")])])])]),a("li",[a("a",{attrs:{href:"#指令表"}},[s._v("指令表")])]),a("li",[a("a",{attrs:{href:"#环境变量"}},[s._v("环境变量")])]),a("li",[a("a",{attrs:{href:"#指令使用"}},[s._v("指令使用")]),a("ul",[a("li",[a("a",{attrs:{href:"#build指令"}},[s._v("build指令")])]),a("li",[a("a",{attrs:{href:"#from指令"}},[s._v("FROM指令")])]),a("li",[a("a",{attrs:{href:"#maintainer指令"}},[s._v("MAINTAINER指令")])]),a("li",[a("a",{attrs:{href:"#run指令"}},[s._v("RUN指令")])]),a("li",[a("a",{attrs:{href:"#expose指令"}},[s._v("EXPOSE指令")])]),a("li",[a("a",{attrs:{href:"#workdir指令"}},[s._v("WORKDIR指令")])]),a("li",[a("a",{attrs:{href:"#env指令"}},[s._v("ENV指令")])]),a("li",[a("a",{attrs:{href:"#add指令"}},[s._v("ADD指令")])]),a("li",[a("a",{attrs:{href:"#copy指令"}},[s._v("COPY指令")])]),a("li",[a("a",{attrs:{href:"#volume指令"}},[s._v("VOLUME指令")])]),a("li",[a("a",{attrs:{href:"#entrypoint和cmd指令"}},[s._v("ENTRYPOINT和CMD指令")])]),a("li",[a("a",{attrs:{href:"#arg指令"}},[s._v("ARG指令")])])])]),a("li",[a("a",{attrs:{href:"#dockerignore文件"}},[s._v(".dockerignore文件")])]),a("li",[a("a",{attrs:{href:"#指令实战"}},[s._v("指令实战")]),a("ul",[a("li",[a("a",{attrs:{href:"#centos安装指令"}},[s._v("CentOS安装指令")])]),a("li",[a("a",{attrs:{href:"#centos安装tomcat"}},[s._v("CentOS安装Tomcat")])]),a("li",[a("a",{attrs:{href:"#spingboot"}},[s._v("SpingBoot")])])])])])]),a("p"),s._v(" "),a("h2",{attrs:{id:"什么是dockerfile"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是dockerfile"}},[s._v("#")]),s._v(" 什么是Dockerfile")]),s._v(" "),a("p",[s._v("Dockerfile 可以认为是 Docker 镜像的描述文件，是由一系列命令和参数构成的脚本。主要作用是用来构建 docker 镜像的构建文件。")]),s._v(" "),a("p",[s._v("更直接的理解：Dockerfile 就是一个文件的名字，如 Java 文件叫 xxx.java；Dockerfile 文件就叫 Dockerfile")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Docker/20211121224322.png",alt:"image-20211121221858094"}})]),s._v(" "),a("h2",{attrs:{id:"解析过程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解析过程"}},[s._v("#")]),s._v(" 解析过程")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Docker/20211121225617.png",alt:"image-20211121225615709"}})]),s._v(" "),a("h3",{attrs:{id:"基本知识"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基本知识"}},[s._v("#")]),s._v(" 基本知识")]),s._v(" "),a("ul",[a("li",[s._v("每条保留字指令都必须为大写字母且后面要跟随至少一个参数")]),s._v(" "),a("li",[s._v("指令按照从上到下，顺序执行")]),s._v(" "),a("li",[s._v("# 表示注释")]),s._v(" "),a("li",[s._v("每条指令都会创建一个新的镜像层，并对镜像进行提交")])]),s._v(" "),a("h3",{attrs:{id:"大致流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#大致流程"}},[s._v("#")]),s._v(" 大致流程")]),s._v(" "),a("p",[s._v("Dockerfile 是用来构建 docker 容器的，它是由一系列的指令和参数构成，通过 build dockerfile 可以得到镜像。Dockerfile 的每一个保留字指令 "),a("strong",[s._v("必须大写")]),s._v("，后面至少跟一个参数，它的解析过程：首先拉取基础镜像，当执行一条指令的时候，基于基础镜像运行容器，对容器进行修改，然后 commit 新的镜像层；当再次执行指令的时候，基于新镜像运行容器，对容器进行修改 commit 新的镜像层，这样反复产生镜像（「不完整镜像」），最终只会获得一个完整的镜像。而原先产生的「不完整镜像」存入 Cache（缓存）里，如果再次构建镜像，则不需要从头开始，直接从缓存里找到需要的「不完整镜像」。")]),s._v(" "),a("h3",{attrs:{id:"dockerfile、镜像、容器的理解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile、镜像、容器的理解"}},[s._v("#")]),s._v(" Dockerfile、镜像、容器的理解")]),s._v(" "),a("p",[s._v("从应用软件的角度来看，Dockerfile、Docker 镜像、Docker 容器分别代表着三个不同的阶段：")]),s._v(" "),a("ul",[a("li",[s._v("Dockerfile 是软件的基本代码")]),s._v(" "),a("li",[s._v("Docker 镜像是软件的交付品")]),s._v(" "),a("li",[s._v("Docker 容器可以认为是软件的运行态")]),s._v(" "),a("li",[s._v("Dockerfile 面向开发，Docker 镜像成为交付标准，Docker 容器负责运维和部署，三者缺一不可")])]),s._v(" "),a("h2",{attrs:{id:"指令表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#指令表"}},[s._v("#")]),s._v(" 指令表")]),s._v(" "),a("p",[s._v("官方文档："),a("a",{attrs:{href:"https://docs.docker.com/engine/reference/builder/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://docs.docker.com/engine/reference/builder/"),a("OutboundLink")],1)]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("关键字")]),s._v(" "),a("th",[s._v("说明")]),s._v(" "),a("th",[s._v("小写")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("FROM")]),s._v(" "),a("td",[s._v("基础镜像，当前新镜像是基于哪个镜像的。"),a("strong",[s._v("第一个指令必须是 FROM")])]),s._v(" "),a("td",[s._v("from")])]),s._v(" "),a("tr",[a("td",[s._v("MAINTAINER")]),s._v(" "),a("td",[s._v("镜像维护者的姓名和邮箱地址（废弃）")]),s._v(" "),a("td",[s._v("maintainer")])]),s._v(" "),a("tr",[a("td",[s._v("RUN")]),s._v(" "),a("td",[s._v("构建容器时需要运行的命令")]),s._v(" "),a("td",[s._v("run")])]),s._v(" "),a("tr",[a("td",[s._v("EXPOSE")]),s._v(" "),a("td",[s._v("当前容器对外暴露出的端口")]),s._v(" "),a("td",[s._v("expose")])]),s._v(" "),a("tr",[a("td",[s._v("WORKDIR")]),s._v(" "),a("td",[s._v("指定在创建容器后，终端默认登录的进来工作目录，一个落脚点")]),s._v(" "),a("td",[s._v("workdir")])]),s._v(" "),a("tr",[a("td",[s._v("ENV")]),s._v(" "),a("td",[s._v("用来在构建镜像过程中设置环境变量")]),s._v(" "),a("td",[s._v("env")])]),s._v(" "),a("tr",[a("td",[s._v("ADD")]),s._v(" "),a("td",[s._v("将宿主机目录下的文件拷贝进镜像且 ADD 命令会自动处理 URL 和解压 tar 压缩包")]),s._v(" "),a("td",[s._v("add")])]),s._v(" "),a("tr",[a("td",[s._v("COPY")]),s._v(" "),a("td",[s._v("类似 ADD，拷贝文件和目录到镜像中"),a("br"),s._v("将从构建上下文目录中<原路径>的文件/目录复制到新的一层的镜像内的<目标路径>位置")]),s._v(" "),a("td",[s._v("copy")])]),s._v(" "),a("tr",[a("td",[s._v("VOLUME")]),s._v(" "),a("td",[s._v("容器数据卷，用于数据保存和持久化工作")]),s._v(" "),a("td",[s._v("volume")])]),s._v(" "),a("tr",[a("td",[s._v("CMD")]),s._v(" "),a("td",[s._v("指定一个容器启动时要运行的命令"),a("br"),s._v("Dockerfile 中可以有多个 CMD 指令，但只有最后一个生效，CMD 会被 docker run 之后的参数替换")]),s._v(" "),a("td",[s._v("cmd")])]),s._v(" "),a("tr",[a("td",[s._v("ENTRYPOINT")]),s._v(" "),a("td",[s._v("指定一个容器启动时要运行的命令"),a("br"),s._v("ENTRYPOINT 的目的和 CMD 一样，都是在指定容器启动程序及其参数")]),s._v(" "),a("td",[s._v("entrypoint")])]),s._v(" "),a("tr",[a("td",[s._v("ONBUILD")]),s._v(" "),a("td",[s._v("当构建一个被继承的 DockerFile 时运行命令，父镜像在被子镜像继承后，父镜像的 ONBUILD 被触发")]),s._v(" "),a("td",[s._v("onbuild")])])])]),s._v(" "),a("h2",{attrs:{id:"环境变量"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#环境变量"}},[s._v("#")]),s._v(" 环境变量")]),s._v(" "),a("p",[s._v("在 Dockerfile 中，环境变量是以 "),a("code",[s._v("$variable_name")]),s._v(" 或 "),a("code",[s._v("${variable_name}")]),s._v(" 表示，它们被同等对待，并且大括号通常用于解决没有空格的变量名称的问题。")]),s._v(" "),a("p",[s._v("该 "),a("code",[s._v("${variable_name}")]),s._v(" 语法还支持 "),a("code",[s._v("bash")]),s._v(" 以下指定的一些标准修饰符：")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("${variable:-word}")]),s._v(" 表示如果 "),a("code",[s._v("variable")]),s._v(" 设置，则结果将是该值。如果 "),a("code",[s._v("variable")]),s._v(" 未设置，"),a("code",[s._v("word")]),s._v(" 则将是结果。")]),s._v(" "),a("li",[a("code",[s._v("${variable:+word}")]),s._v(" 表示如果 "),a("code",[s._v("variable")]),s._v(" 设置则为 "),a("code",[s._v("word")]),s._v(" 结果，否则为空字符串。")])]),s._v(" "),a("p",[s._v("在所有情况下，"),a("code",[s._v("word")]),s._v(" 可以是任何字符串，包括额外的环境变量。")]),s._v(" "),a("p",[s._v("如果只是单纯使用 "),a("code",[s._v("$")]),s._v(" 而不是作为变量使用，请加上 "),a("code",[s._v("\\")]),s._v(" 进行转义。例如："),a("code",[s._v("\\$foo")]),s._v(" 和 "),a("code",[s._v("\\${foo}")]),s._v("，将分别转换为 "),a("code",[s._v("$foo")]),s._v(" 和 "),a("code",[s._v("${foo}")]),s._v(" 文字。")]),s._v(" "),a("h2",{attrs:{id:"指令使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#指令使用"}},[s._v("#")]),s._v(" 指令使用")]),s._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[s._v("笔记")]),s._v(" "),a("p",[s._v("本内容使用 centos 7 版本的镜像进行测试。")]),s._v(" "),a("p",[s._v("顺便一提的是，上下文指的是 Dockerfile 文件所在的目录（根目录），请把指令操作的根目录当作上下文的源。")]),s._v(" "),a("div",{staticClass:"custom-block right"},[a("p",[s._v("2021-11-22 @Young Kbt")])])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("br")]),a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 拉取centos 7 的镜像命令")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull centos:centos7\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" images\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 返回结果")]),s._v("\nREPOSITORY    TAG       IMAGE ID       CREATED        SIZE\ntomcat        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.5")]),s._v(".73    7ec084df520c   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" days ago     249MB\nmysql         latest    b05128b000dd   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" days ago     516MB\nhello-world   latest    feb5d9fea6a5   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" weeks ago    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(".3kB\ncentos        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("         eeb6ee3f44bd   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" months ago   204MB\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("h3",{attrs:{id:"build指令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#build指令"}},[s._v("#")]),s._v(" build指令")]),s._v(" "),a("p",[s._v("这是 docker 的指令，并非是 Dockerfile 的指令，但是和 Dockerfile 关系很大。")]),s._v(" "),a("p",[s._v("这是将 Dockerfile 打包成镜像的指令。")]),s._v(" "),a("p",[s._v("语法：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 语法格式")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("options"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("自定义镜像名"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(":tag"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Dockerfile 路径"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 先指定 tag 版本，再指定 Dockerfile 所在路径")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("自定义镜像名:tag"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Dockerfile 路径"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 先指定 Dockerfile 所在路径，再指定 tag 版本")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Dockerfile 的路径"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("自定义镜像名:tag"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("常用的是第 5 行的打包方式。")]),s._v(" "),a("blockquote",[a("p",[a("strong",[s._v("例子 1：直接打包在 /opt 下的 Dockerfile 文件，版本为 1.0，名字叫 kele")])])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" kele:1.0 /opt\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("不需要写到 Dockerfile 文件名，它默认会找到这个文件")]),s._v(" "),a("blockquote",[a("p",[a("strong",[s._v("例子 2：利用 "),a("code",[s._v("-f")]),s._v(" 打包在 /opt 下的 Dockerfile 文件，版本为 1.0，名字叫 kele")])])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" /opt/Dockerfile "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" kele:1.0 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"from指令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#from指令"}},[s._v("#")]),s._v(" FROM指令")]),s._v(" "),a("p",[s._v("基于那个镜像进行构建新的镜像，在构建时会自动从 docker hub 拉取 base 镜像或者本地拉去镜像（优先本地）。必须作为 Dockerfile 的第一个指令出现，该指令可以出现多次，但是仍以最后一条 FROM 为准。")]),s._v(" "),a("p",[s._v("语法：")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" <image> [AS <name>]    # 默认版本是 latest")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" <image>[:<tag>] [AS <name>]    # 当版本不写 latest 时，请填写其他版本")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" <image>[@<digest>] [AS <name>]  # 使用摘要")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("blockquote",[a("p",[a("strong",[s._v("例子 1：创建 Dockerfile 文件，引用 centos 7")])])]),s._v(" "),a("ul",[a("li",[a("p",[s._v("首先在 /opt 下创建 docker-file 目录，专门来做测试")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /opt\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" docker-file\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" docker-file\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("创建 Dockerfile 文件，并给文件添加 FROM 指令")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[s._v("vim Dockerfile\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 此时已经进入 Dockerfile 文件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加内容")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" centos:7")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("执行 build 指令，查看结果")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("br")]),a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行打包命令")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" mycentos7:1.0 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看 centos 镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" images mycentos7\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 返回结果")]),s._v("\nREPOSITORY    TAG       IMAGE ID       CREATED        SIZE\nmycentos7     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v("       eeb6ee3f44bd   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" months ago   204MB\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[a("code",[s._v(".")]),s._v(" 代表当前目录。")])])]),s._v(" "),a("h3",{attrs:{id:"maintainer指令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#maintainer指令"}},[s._v("#")]),s._v(" MAINTAINER指令")]),s._v(" "),a("p",[s._v("镜像维护者的姓名和邮箱地址（废弃）")]),s._v(" "),a("p",[s._v("语法：")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("MAINTAINER")]),s._v(" <name>")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"run指令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#run指令"}},[s._v("#")]),s._v(" RUN指令")]),s._v(" "),a("p",[s._v("RUN 指令将在当前映像之上的新层中执行任何命令并提交结果。生成的提交映像将用于 Dockerfile 中的下一步。")]),s._v(" "),a("p",[s._v("语法：（两种形式）")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# shell 形式，命令在 shell 中运行，默认 /bin/sh -c 在 Linux 或cmd /S /CWindows 上")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" <command>")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如：")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" echo hello")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行形式")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" ["),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"参数1"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"参数2"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"参数3"')]),s._v("， .....]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" ["),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"executable"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"param1"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"param2 "')]),s._v("]")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 例子：")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" /bin/bash -c echo hello")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 等价于")]),s._v('\nRUN["/bin/bash", "-c", "echo hello"]\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("p",[s._v("在 shell 形式中，您可以使用 "),a("code",[s._v("\\")]),s._v("（反斜杠）将单个 RUN 指令延续到下一行。例如，考虑以下两行：")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" /bin/bash -c "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'source $HOME/.bashrc; \\\necho $HOME'")])]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("它们一起相当于这一行：")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" /bin/bash -c "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'source $HOME/.bashrc; echo $HOME'")])]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("要使用除 /bin/sh 之外的不同 shell，请使用传入所需 shell 的 exec 形式。例如：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('RUN["/bin/bash", "-c", "echo hello"]\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("重复 "),a("code",[s._v("RUN")]),s._v(" 的指令会进入缓存里，下次再 "),a("code",[s._v("RUN")]),s._v(" 该指令，直接去缓存获取结果。可以使用 "),a("code",[s._v("--no-cache")]),s._v(" 标志使指令缓存无效，例如")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[s._v("docker build --no-cach <指令>\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("blockquote",[a("p",[a("strong",[s._v("例子 1：给 centos 安装 vim 指令")])])]),s._v(" "),a("ul",[a("li",[a("p",[s._v("官方的 CentOS 并没有安装 vim 指令，进入官方的 CentOS 容器，执行 vim 指令，会报错")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动 centos 7")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" centos:7\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用 vim 指令")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@438f1c67afb1 /"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim aa.txt")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 没有安装")]),s._v("\nbash: vim: "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" not found\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("我们在打包成镜像的时候，让其自动安装，在 Dockerfile 文件添加 "),a("code",[s._v("RUN")]),s._v(" 指令")]),s._v(" "),a("p",[s._v("有两种形式，我们使用任意一个即可（"),a("strong",[s._v("这是 Dockerfile 文件")]),s._v("）")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("br"),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("br")]),a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" centos:7")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" yum install -y vim")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 另一种格式")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# RUN ["yum","install","-y","vim"]')]),s._v("\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("打包镜像并验证结果")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 打包成镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" mycentos7:1.0 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 验证结果")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" mycentos7:1.0\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用 vim 指令")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@438f1c67afb1 /"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim aa.txt")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 直接创建 aa.txt 文件并进入")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("build 后的镜像如果在本地已经有了，则会覆盖本地的镜像")])])]),s._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[s._v("笔记")]),s._v(" "),a("p",[s._v("第一次执行 RUN 指令，会很慢，但是下一次重复执行该指令，就很快了，因为有缓存。")]),s._v(" "),a("p",[s._v("什么时候又变慢呢？RUN 指令发生了修改，那么缓存里旧的指令就被删除，存入新的指令。")]),s._v(" "),a("div",{staticClass:"custom-block right"},[a("p",[s._v("2021-11-22 @Young Kbt")])])]),s._v(" "),a("h3",{attrs:{id:"expose指令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#expose指令"}},[s._v("#")]),s._v(" EXPOSE指令")]),s._v(" "),a("p",[s._v("用来指定构建的镜像在运行为容器时 "),a("strong",[s._v("对外暴露端口")]),s._v("。")]),s._v(" "),a("p",[s._v("语法：")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPOSE")]),s._v(" 端口号/类型   # 如果没有指定类型，则默认暴露都是 tcp")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("该 "),a("code",[s._v("EXPOSE")]),s._v(" 指令 "),a("strong",[s._v("实际上并未发布端口")]),s._v("。它充当构建镜像的人和运行容器的人之间的一种文档，关于打算发布哪些端口。要在运行容器时实际发布端口，请使用 "),a("code",[s._v("-p")]),s._v(" 指令在 "),a("code",[s._v("docker run")]),s._v(" 时来发布和映射一个或多个端口，或者使用 "),a("code",[s._v("-P")]),s._v(" 指令来发布所有暴露的端口并将它们映射到高阶端口。")]),s._v(" "),a("p",[s._v("默认情况下，"),a("code",[s._v("EXPOSE")]),s._v(" 指定 TCP。您还可以指定 UDP。")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPOSE")]),s._v(" 80/tcp")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPOSE")]),s._v(" 80/udp")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("在这种情况下，如果您使用 "),a("code",[s._v("-P")]),s._v("，则端口将为 TCP 公开一次，为 UDP 公开一次。请记住，"),a("code",[s._v("-P")]),s._v(" 在主机上使用临时高阶主机端口，因此 TCP 和 UDP 的端口将不同。")]),s._v(" "),a("p",[s._v("无论 "),a("code",[s._v("EXPOSE")]),s._v(" 设置如何，您都可以在运行时使用 "),a("code",[s._v("-p")]),s._v(" 标志覆盖它们。例如：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(":80/tcp "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(":80/udp "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("blockquote",[a("p",[a("strong",[s._v("例子 1：暴露 8080 和 9090 端口")])])]),s._v(" "),a("ul",[a("li",[a("p",[s._v("在 Dockerfile 文件添加内容")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" centos:7")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPOSE")]),s._v(" 8080")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPOSE")]),s._v(" 9090/tcp")]),s._v("\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])])])]),s._v(" "),a("h3",{attrs:{id:"workdir指令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#workdir指令"}},[s._v("#")]),s._v(" WORKDIR指令")]),s._v(" "),a("p",[s._v("用来为 Dockerfle 中的任何 RUN、CMD、ENTPYPOINT、COPY 和 ADO 指令设置工作目录。如果 WORKDIR 不存在，即使它没有在任何后续 Docerile 指令中使用，它也将被创建。一旦创建了 WORKDIR 目录，启动容器并进入容器时，默认处于该目录下。")]),s._v(" "),a("p",[s._v("语法：")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" <绝对路径> | <相对路径>")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("注意：WORKDIR 指令可以在 Dockerfile 中多次使用。如果提供了相对路径，它将相对于前一条 "),a("code",[s._v("WORKDIR")]),s._v(" 指令的路径。例如：")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" /a")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" b")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" c")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" pwd")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("最终 "),a("code",[s._v("pwd")]),s._v(" 命令的输出 "),a("code",[s._v("Dockerfile")]),s._v(" 将是 "),a("code",[s._v("/a/b/c")]),s._v("。")]),s._v(" "),a("p",[s._v("该 "),a("code",[s._v("WORKDIR")]),s._v(" 指令可以解析先前使用 "),a("code",[s._v("ENV")]),s._v("。你只能使用在 "),a("code",[s._v("Dockerfile")]),s._v("。例如：")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" DIRPATH=/path")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$DIRPATH")]),s._v("/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$DIRNAME")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" pwd")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("最终 "),a("code",[s._v("pwd")]),s._v(" 命令的输出 "),a("code",[s._v("Dockerfile")]),s._v(" 将是 "),a("code",[s._v("/path/$DIRNAME")]),s._v("。")]),s._v(" "),a("blockquote",[a("p",[a("strong",[s._v("例子 1：添加工作目录 /data/kele")])])]),s._v(" "),a("ul",[a("li",[a("p",[s._v("Dockerfile 文件添加内容")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" centos:7")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" /data")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" kele")]),s._v("\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("WORKDIR 指定的目录，就是进入容器后所处的目录")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 打包成镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" mycentos7:1.0 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动镜像并进入")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" mycentos7:1.0\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看当前的工作目录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@8da133bb7ac4 kele"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pwd")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 返回结果")]),s._v("\n/data/kele\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])])])]),s._v(" "),a("h3",{attrs:{id:"env指令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#env指令"}},[s._v("#")]),s._v(" ENV指令")]),s._v(" "),a("p",[s._v("用来为构建镜像设置环境变量。这个值将出现在构建阶段中所有后续指令的环境中。")]),s._v(" "),a("p",[s._v("语法：")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" <key> <value>")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 或者")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" <key>=<value")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 例子：")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" BASH_PATH /data/kele")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用 BASH_PATH 就是使用 /data/kele 目录")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("这个指令类似于 Java 的数据类型。")]),s._v(" "),a("p",[s._v("什么时候用呢？当 Dockerfile 文件里某一字符串出现率太高，可以将字符串赋值给一个变量，引用该变量即可（引用变量使用 "),a("code",[s._v("$")]),s._v(" 作为前缀）。")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("该 "),a("code",[s._v("ENV")]),s._v(" 指令 "),a("strong",[s._v("允许")]),s._v(" "),a("code",[s._v("<key>=<value> ...")]),s._v(" 一次设置多个变量，例如：")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" MY_NAME="),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"John Doe"')])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" MY_DOG=Rex\\ The\\ Dog")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" MY_CAT=fluffy")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("可以写成：")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" MY_NAME="),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"John Doe"')]),s._v(" MY_DOG=Rex\\ The\\ Dog "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("\\")]),s._v("\n    MY_CAT=fluffy")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("code",[s._v("ENV")]),s._v(" 当容器从生成的映像运行时，使用设置的环境变量将持续存在。您可以使用来查看值 "),a("code",[s._v("docker inspect")]),s._v("，并使用 更改它们 "),a("code",[s._v("docker run --env <key>=<value>")]),s._v("。")])]),s._v(" "),a("li",[a("p",[s._v("该 "),a("code",[s._v("ENV")]),s._v(" 指令 "),a("strong",[s._v("不允许")]),s._v(" "),a("code",[s._v("<key> <value> ...")]),s._v("一次设置多个变量，例如：")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" ONE TWO= THREE=world")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])])]),s._v(" "),a("blockquote",[a("p",[a("strong",[s._v("例子 1：创建一个变量，代表 /data/kele 目录")])])]),s._v(" "),a("ul",[a("li",[a("p",[s._v("Dockerfile 文件添加内容")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" centos:7")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" BASH_PATH /data/kele")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$BASH_PATH")])]),s._v("\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("验证结果：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("br")]),a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 打包成镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" mycentos7:1.0 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动镜像并进入")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" mycentos7:1.0\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看当前的工作目录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@8da133bb7ac4 kele"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pwd")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 返回结果")]),s._v("\n/data/kele\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])])])]),s._v(" "),a("h3",{attrs:{id:"add指令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#add指令"}},[s._v("#")]),s._v(" ADD指令")]),s._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[s._v("笔记")]),s._v(" "),a("p",[s._v("使用该指令前，要明白，该指令只针对 Dockerfile 文件所在的目录下，也称为 "),a("strong",[s._v("上下文的源目录")]),s._v("。")]),s._v(" "),a("div",{staticClass:"custom-block right"},[a("p",[s._v("2021-11-22 @Young Kbt")])])]),s._v(" "),a("p",[s._v("用来从 context 上下文复制新文件、目录或远程文件 url，并将它们添加到位于指定路径的映像文件系统中。")]),s._v(" "),a("p",[s._v("两种形式：")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Linux 下可选择用户和组")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" [--chown=<user>:<group>] <src>... <dest>")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" [--chown=<user>:<group>] ["),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"<src>"')]),s._v(",... "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"<dest>"')]),s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("包含空格的路径需要后一种形式。")]),s._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[s._v("笔记")]),s._v(" "),a("p",[s._v("该 "),a("code",[s._v("--chown")]),s._v(" 功能仅在用于构建 Linux 容器的 Dockerfile 上受支持，不适用于 Windows 容器。")]),s._v(" "),a("div",{staticClass:"custom-block right"},[a("p",[s._v("2021-11-22 @Young Kbt")])])]),s._v(" "),a("p",[a("code",[s._v("<src>")]),s._v(" 可以指定多个资源，但如果它们是文件或目录，则它们的路径被解释为相对于构建上下文的源（即 Dockerfile 所在的目录下）。")]),s._v(" "),a("p",[s._v("每个都 "),a("code",[s._v("<src>")]),s._v(" 可能包含通配符，匹配将使用 Go 的 "),a("a",{attrs:{href:"https://golang.org/pkg/path/filepath#Match",target:"_blank",rel:"noopener noreferrer"}},[s._v("filepath.Match"),a("OutboundLink")],1),s._v(" 规则完成。也有很多规则。例如：")]),s._v(" "),a("ul",[a("li",[a("p",[s._v('添加所有以 "hom" 开头的文件')]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" home* /mydir/  # 通配符添加多个文件")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("?")]),s._v(" 可以被替换为任何单个字符")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" hom?.txt /mydir/  # 通配符添加")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("<dest>")]),s._v(" 是一个绝对路径，或相对于一个路径 "),a("code",[s._v("WORKDIR")]),s._v("，到其中的源将在目标容器内进行复制。")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" test.txt relativeDir/  # 可以指定相对路径")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v('使用绝对路径，并将 "test.txt" 添加到 '),a("code",[s._v("/absoluteDir/")])]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" test.txt /absolutionDir/  # 可以指定绝对路径")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("复制文件的时候，"),a("code",[s._v("<dest>")]),s._v("没有出现一个以上的 "),a("code",[s._v("/")]),s._v("，则是对该文件重命名")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" demo-0.0.1-SNAPSHOT.jar app.jar")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("添加包含特殊字符（如"),a("code",[s._v("[")]),s._v(" 和"),a("code",[s._v("]")]),s._v("）的文件或目录时，您需要按照 Golang 规则对这些路径进行转义，以防止它们被视为匹配模式。例如，要添加名为 的文件"),a("code",[s._v("arr[0].txt")]),s._v("，请使用以下命令:")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" arr[[]0].txt /mydir/")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("如果 "),a("code",[s._v("<src>")]),s._v(" 是 URL 并且 "),a("code",[s._v("<dest>")]),s._v(" 不以斜杠结尾，则从 URL 下载文件并将其复制到 "),a("code",[s._v("<dest>")])]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" url <dest>  # 远程文件 url 拉取")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("如果 "),a("code",[s._v("<src>")]),s._v(" 是 URL 并且 "),a("code",[s._v("<dest>")]),s._v(" 确实以斜杠结尾，则从 URL 推断文件名并将文件下载到 "),a("code",[s._v("<dest>/<filename>")]),s._v(". 例如，"),a("code",[s._v("ADD http://example.com/foobar/")]),s._v(" 将创建文件 "),a("code",[s._v("/foobar")]),s._v("。URL 必须有一个重要的路径，以便在这种情况下可以发现适当的文件名（"),a("code",[s._v("http://example.com")]),s._v(" 将不起作用）。")])]),s._v(" "),a("li",[a("p",[s._v("如果 "),a("code",[s._v("<src>")]),s._v(" 是采用可识别压缩格式（identity、gzip、bzip2 或 xz）的本地 tar 存档，则将其解压缩为目录。来自远程 URL 的资源 "),a("strong",[s._v("不会被")]),s._v(" 解压缩")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" xxx.tar <dest>")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("文件是否被识别为可识别的压缩格式完全取决于文件的内容，而不是文件的名称。例如，如果一个空文件恰好以 "),a("code",[s._v(".tar.gz")]),s._v(" 结尾，则不会将其识别为压缩文件，"),a("strong",[s._v("也不会")]),s._v(" 生成任何类型的解压缩错误消息，而只会将该文件复制到目的地。")])]),s._v(" "),a("li",[a("p",[s._v("如果 "),a("code",[s._v("<src>")]),s._v(" 是目录，则复制目录的全部内容，包括文件系统元数据，但是不会复制目录本身。")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" /opt /mydir/")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])])]),s._v(" "),a("p",[s._v("其他规则：")]),s._v(" "),a("ul",[a("li",[s._v("如果 "),a("code",[s._v("<src>")]),s._v(" 是任何其他类型的文件，则将其与其元数据一起单独复制。在这种情况下，如果 "),a("code",[s._v("<dest>")]),s._v(" 以斜杠结尾"),a("code",[s._v("/")]),s._v("，它将被视为一个目录，其内容 "),a("code",[s._v("<src>")]),s._v(" 将被写入 "),a("code",[s._v("<dest>/base(<src>)")]),s._v("。")]),s._v(" "),a("li",[s._v("如果 "),a("code",[s._v("<src>")]),s._v(" 直接指定了多个资源，或者由于使用了通配符，则 "),a("code",[s._v("<dest>")]),s._v(" 必须是目录，并且必须以斜杠结尾 "),a("code",[s._v("/")]),s._v("。")]),s._v(" "),a("li",[s._v("如果 "),a("code",[s._v("<dest>")]),s._v(" 不以斜杠结尾，则将其视为常规文件，并将其内容 "),a("code",[s._v("<src>")]),s._v(" 写入 "),a("code",[s._v("<dest>")]),s._v(".")]),s._v(" "),a("li",[s._v("如果 "),a("code",[s._v("<dest>")]),s._v(" 不存在，则创建它及其路径中所有丢失的目录。")])]),s._v(" "),a("p",[s._v("只能在 Dockerfile 所处的目录内进行复制，也就是说 "),a("code",[s._v("ADD /opt/test.txt /data/kiele")]),s._v(" 的 test.txt 文件在 Dockerfile 所处路径的 opt 目录里，并不是相对于操作系统的目录而言。")]),s._v(" "),a("blockquote",[a("p",[a("strong",[s._v("例子 1：添加一个文件到容器里的 /data/kele 目录下")])])]),s._v(" "),a("ul",[a("li",[a("p",[s._v("首先在 Dockerfile 目录里创建一个文件 aa.txt")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入 Dockerfile 目录里")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /opt/docker-file\n \n "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加 aa.txt 文件")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v(" aa.txt\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("Dockerfile 文件添加内容")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" centos:7")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" BASH_PATH /data/kele")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$BASH_PATH")])]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" aa.txt /data/kele")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 或者")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# RUN mv a.txt /data/kele")]),s._v("\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("验证结果")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("br")]),a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 打包成镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" mycentos7:1.0 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动镜像并进入")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" mycentos7:1.0\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看当前的工作目录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@8da133bb7ac4 kele"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 返回结果")]),s._v("\naa.txt\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])])])]),s._v(" "),a("blockquote",[a("p",[a("strong",[s._v("例子 2：添加一个压缩包到容器里的 /data/kele 目录下")])])]),s._v(" "),a("ul",[a("li",[a("p",[s._v("首先创建一个压缩包")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("br")]),a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入 Dockerfile 目录里")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /opt/docker-file\n \n "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加 aa.txt 文件")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v(" bb.txt\n \n "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建压缩包")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" cvf bb.txt.tar bb.txt\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("Dockerfile 文件添加内容")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" centos:7")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" BASH_PATH /data/kele")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$BASH_PATH")])]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" bb.txt.tar /datakele")]),s._v("\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("验证结果：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("br")]),a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 打包成镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" mycentos7:1.0 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动镜像并进入")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" mycentos7:1.0\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看当前的工作目录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@8da133bb7ac4 kele"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 返回结果")]),s._v("\nbb.txt\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])])])]),s._v(" "),a("h3",{attrs:{id:"copy指令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#copy指令"}},[s._v("#")]),s._v(" COPY指令")]),s._v(" "),a("p",[s._v("用来将 context 目录中指定文件复制到镜像的指定目录中。")]),s._v(" "),a("p",[s._v("有两种形式：")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Linux 下选择用户和组")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" [--chown=<user>:<group>] <src>... <dest>")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" [--chown=<user>:<group>] ["),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"<src>"')]),s._v(",... "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"<dest>"')]),s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[s._v("笔记")]),s._v(" "),a("p",[s._v("该 "),a("code",[s._v("--chown")]),s._v(" 功能仅在用于构建 Linux 容器的 Dockerfile 上受支持，不适用于 Windows 容器。")]),s._v(" "),a("div",{staticClass:"custom-block right"},[a("p",[s._v("2021-11-22 @Young Kbt")])])]),s._v(" "),a("p",[a("strong",[s._v("它是 ADD 的缩小版，功能不那么冗余，有一个区别就是：不支持解压")]),s._v("。")]),s._v(" "),a("blockquote",[a("p",[a("strong",[s._v("例子 1：添加一个压缩包到容器里的 /data/kele 目录下")])])]),s._v(" "),a("ul",[a("li",[a("p",[s._v("Dockerfile 文件添加内容")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" centos:7")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" BASH_PATH /data/kele")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$BASH_PATH")])]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" aa.txt /data/kele")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" bb.txt.tar /data/kele")]),s._v("\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("验证结果")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("br")]),a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 打包成镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" mycentos7:1.0 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动镜像并进入")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" mycentos7:1.0\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看当前的工作目录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@8da133bb7ac4 kele"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 返回结果")]),s._v("\naa.txt bb.txt.tar\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("说明复制的压缩包不会自动解压。")])])]),s._v(" "),a("h3",{attrs:{id:"volume指令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#volume指令"}},[s._v("#")]),s._v(" VOLUME指令")]),s._v(" "),a("p",[s._v("该 "),a("code",[s._v("VOLUME")]),s._v(" 指令创建一个具有指定名称的挂载点，并将其标记为保存来自本机主机或其他容器的外部挂载卷。该值可以是 JSON 数组、"),a("code",[s._v('VOLUME ["/var/log/"]')]),s._v(" 或带有多个参数的纯字符串，例如 "),a("code",[s._v("VOLUME /var/log")]),s._v(" 或 "),a("code",[s._v("VOLUME /var/log /var/db")]),s._v("。")]),s._v(" "),a("p",[s._v("语法：")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VOLUME")]),s._v(" <容器内>")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 例子：")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VOLUME")]),s._v(" /myvol/greeting")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 或者")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VOLUME")]),s._v(" ["),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"myvol"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"greeting"')]),s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("缺点：主机目录（挂载点）本质上是依赖于主机的。这是为了保持图像的可移植性，因为不能保证给定的主机目录在所有主机上都可用。因此，"),a("strong",[s._v("您无法从 Dockerfile 中挂载主机目录")]),s._v("。该 "),a("code",[s._v("VOLUME")]),s._v(" 指令不支持指定 "),a("code",[s._v("host-dir")]),s._v(" 参数。您必须在创建或运行容器时指定挂载点。")]),s._v(" "),a("p",[s._v("也就是说，"),a("code",[s._v("VOLUME")]),s._v(" 指令使用的是匿名目录挂载，只能指定容器挂载目录，而在宿主机的挂载目录名是一大长串 ID。")]),s._v(" "),a("blockquote",[a("p",[a("strong",[s._v("例子 1：挂载 /myvol 目录")])])]),s._v(" "),a("ul",[a("li",[a("p",[s._v("Dockerfile 文件添加内容：")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" centos:7")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" BASH_PATH /data/kele")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$BASH_PATH")]),s._v("/myvol")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" echo "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello docker"')]),s._v(" > "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$BASH_PATH")]),s._v("/myvol/greeting")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VOLUME")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$BASH_PATH")]),s._v("/myvol")]),s._v("\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("验证结果：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("br")]),a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 打包成镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" mycentos7:1.0 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动镜像并进入")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" mycentos7:1.0\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看当前的工作目录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@8da133bb7ac4 myvol"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 返回结果")]),s._v("\ngreeting\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看文件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" greeting\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 返回结果")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello docker"')]),s._v("\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("p",[s._v("查看宿主机的挂载目录在哪里？")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("br")]),a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),s._v(" / "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-name")]),s._v(" greeting\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 返回结果")]),s._v("\nvar/lib/docker/volumes/a9ab2b428361cbdc60beafadb585fb7312bec2fbcb9971c1806a7f0a60ef4de3/_data/greeting\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])])])]),s._v(" "),a("h3",{attrs:{id:"entrypoint和cmd指令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#entrypoint和cmd指令"}},[s._v("#")]),s._v(" ENTRYPOINT和CMD指令")]),s._v(" "),a("p",[s._v("两个命令都是指定一个容器启动时要运行的命令。")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("ENTRYPOINT 指令，往往用于设置容器启动后的 "),a("strong",[s._v("第一个命令")]),s._v("，这对一个容器来说往往是固定的")]),s._v(" "),a("p",[s._v("docker run 的参数会被当做参数传递给 ENTRYPOINT，形成新的命令组合。")])]),s._v(" "),a("li",[a("p",[s._v("CMD 指令，往往用于设置容器启动的第一个命令的 "),a("strong",[s._v("默认参数")]),s._v("，这对一个容器来说可以是变化的")]),s._v(" "),a("p",[s._v("可以有多个 CMD 指令，但只有最后一个生效。")])])]),s._v(" "),a("p",[s._v("ENTRYPOINT 和 CMD 的两种形式：")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("JSON 数组形式，命令组合时必须用的形式：")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENTRYPOINT")]),s._v(" ["),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"executable"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"param1"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"param2"')]),s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" ["),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"executable"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"param1"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"param2"')]),s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("标准格式：")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENTRYPOINT")]),s._v(" command param1 param2")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" command param1 param2")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])])])]),s._v(" "),a("p",[a("strong",[s._v("ENTRYPOINT 的最大价值是和 CMD 组合使用，实现传参效果，下面我们开始举三个例子，第一、二例子分别使用两个指令，第三个例子是指令组合使用。")])]),s._v(" "),a("blockquote",[a("p",[a("strong",[s._v("例子 1：使用 CMD 命令")])])]),s._v(" "),a("ul",[a("li",[a("p",[s._v("Dockerfile 文件添加内容：")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("br")]),a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" centos:7")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" BASH_PATH /data/kele")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$BASH_PATH")]),s._v("/myvol")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" echo "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello docker"')]),s._v(" > "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$BASH_PATH")]),s._v("/myvol/greeting")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VOLUME")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$BASH_PATH")]),s._v("/myvol")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" ls /data/kele")]),s._v("\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("验证结果：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("br")]),a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 打包成镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" mycentos7:1.0 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" mycentos7:1.0\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 返回结果")]),s._v("\naa.txt\tbb.txt\tmyvol\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])])])]),s._v(" "),a("p",[a("strong",[s._v("相比较 ENTRYPOINT，CMD 有一个很大的区别：可以在 "),a("code",[s._v("docker run")]),s._v(" 的后面使用参数覆盖掉 CMD 指令")])]),s._v(" "),a("ul",[a("li",[a("p",[s._v("Dockerfile 文件添加内容：")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" centos:7")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" BASH_PATH /data/kele")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$BASH_PATH")]),s._v("/myvol")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" echo "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello docker"')]),s._v(" > "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$BASH_PATH")]),s._v("/myvol/greeting")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VOLUME")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$BASH_PATH")]),s._v("/myvol")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" ls /data/kele")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("验证结果：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("br"),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 打包成镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" mycentos7:1.0 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" mycentos7:1.0 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" /data\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 返回结果")]),s._v("\nkele\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("第 5 行代码，在启动的时候使用 "),a("code",[s._v("ls /data")]),s._v(" 覆盖了 Dockerfile 文件的 "),a("code",[s._v("ls /data/kele")]),s._v(" 命令，如果启动的时候使用 "),a("code",[s._v("pwd")]),s._v(" 也会覆盖掉 "),a("code",[s._v("ls /data/kele")])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("br"),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动镜像并进入")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" mycentos7:1.0 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("pwd")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 返回结果")]),s._v("\n/data/kele/myvol\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("证明了 CMD 是可以被外界命令覆盖的。")])])]),s._v(" "),a("blockquote",[a("p",[a("strong",[s._v("例子 2：使用 ENTRYPOINT 命令")])])]),s._v(" "),a("ul",[a("li",[a("p",[s._v("Dockerfile 文件添加内容：")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("br")]),a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" centos:7")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" BASH_PATH /data/kele")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$BASH_PATH")]),s._v("/myvol")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" echo "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello docker"')]),s._v(" > "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$BASH_PATH")]),s._v("/myvol/greeting")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VOLUME")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$BASH_PATH")]),s._v("/myvol")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENTRYPOINT")]),s._v(" ls /data/kele")]),s._v("\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("验证结果：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("br")]),a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 打包成镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" mycentos7:1.0 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" mycentos7:1.0\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 返回结果")]),s._v("\naa.txt\tbb.txt\tmyvol\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])])])]),s._v(" "),a("p",[a("strong",[s._v("ENTRYPOINT 指令可以被覆盖吗？")])]),s._v(" "),a("p",[s._v("是可以的。它和 CMD 的区别就在于不能被 "),a("strong",[s._v("直接覆盖")]),s._v("，但是在 "),a("code",[s._v("docker run")]),s._v(" 后使用 "),a("code",[s._v("--entrypoint")]),s._v(" 就可以实现覆盖。")]),s._v(" "),a("p",[s._v("使用 "),a("code",[s._v("pwd")]),s._v(" 覆盖 Dockerfile 文件的指令：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("br"),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# # 启动镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--entrypoint")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("pwd")]),s._v(" mycentos7:1.0\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 返回结果")]),s._v("\n/data/kele/myvol\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("但是 "),a("code",[s._v("--entrypoint")]),s._v(" 放在镜像名后面是不行的：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("br"),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# # 启动镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" mycentos7:1.0 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--entrypoint")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("pwd")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 返回结果")]),s._v("\naa.txt\tbb.txt\tmyvol\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("blockquote",[a("p",[a("strong",[s._v("例子 3：组合指令使用")])])]),s._v(" "),a("p",[s._v("ENTRYPOINT 的指令无法被直接覆盖，可以作为 "),a("strong",[s._v("默认指令")]),s._v("，CMD 的指令可以被直接覆盖，可以作为 "),a("strong",[s._v("默认参数")]),s._v("。")]),s._v(" "),a("p",[s._v("组合指令需要用到的的形式必须是 JSON 数组形式：")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENTRYPOINT")]),s._v(" ["),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"executable"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"param1"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"param2"')]),s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" ["),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"executable"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"param1"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"param2"')]),s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("ul",[a("li",[a("p",[s._v("Dockerfile 文件添加内容：")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("br")]),a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" centos:7")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" BASH_PATH /data/kele")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$BASH_PATH")]),s._v("/myvol")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" echo "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello docker"')]),s._v(" > "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$BASH_PATH")]),s._v("/myvol/greeting")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VOLUME")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$BASH_PATH")]),s._v("/myvol")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENTRYPOINT")]),s._v(" ["),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ls"')]),s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" ["),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/data/kele"')]),s._v("]")]),s._v("\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("打包镜像")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 打包成镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" mycentos7:1.0 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("不传参启动")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("br")]),a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" mycentos7:1.0\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 返回结果")]),s._v("\naa.txt\tbb.txt\tmyvol\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("传参启动")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("br"),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 带参数启动")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" mycentos7:1.0 /data\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 返回结果")]),s._v("\nkele\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("说明 "),a("code",[s._v("/data")]),s._v(" 已经覆盖了 CMD 的默认值 "),a("code",[s._v("/data/kele")]),s._v("，"),a("strong",[s._v("实现了传参功能。")])]),s._v(" "),a("p",[s._v("但是因为默认指令是 "),a("code",[s._v("ls")]),s._v("，如果想要其他指令，要么使用 "),a("code",[s._v("--entrypoint")]),s._v(" 进行覆盖，要么修改 Dockerfile 文件的 "),a("code",[s._v("ENTRYPOINT")]),s._v(" 指令。")])])]),s._v(" "),a("p",[s._v("启动 Java 的 jar 包可以写出这样：")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" centos:7")]),s._v("\n\n......\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENTRYPOINT")]),s._v(" ["),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"java"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-jar"')]),s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" ["),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"默认 jar 包"')]),s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("先指定一个默认 jar 包。如果后期修改了 jar 包，直接在 "),a("code",[s._v("docker run")]),s._v(" 后面加入新的 jar 包名即可。")]),s._v(" "),a("h3",{attrs:{id:"arg指令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#arg指令"}},[s._v("#")]),s._v(" ARG指令")]),s._v(" "),a("p",[s._v("ENTRYPOINT 和 CMD 组合指令只能在 "),a("code",[s._v("docker run")]),s._v(" 的时候传参。那有没有想过，想在 "),a("code",[s._v("docker build")]),s._v(" 的时候进行传参，把参数传入到 Dockerfile 的某个变量里，这样打包出来的镜像塑造性高。")]),s._v(" "),a("p",[a("code",[s._v("ARG")]),s._v(" 指令可以实现这个功能。")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ARG")]),s._v(" <name>[=<default value>]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("该 "),a("code",[s._v("ARG")]),s._v(" 指令定义了一个变量，用户可以在构建时 "),a("code",[s._v("docker build")]),s._v(" 通过使用 "),a("code",[s._v("--build-arg <varname>=<value>")]),s._v("  标志的命令将其传递给构建器。如果用户指定了未在 Dockerfile 中定义的构建参数，则构建会输出警告。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输出警告")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Warning"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" One Or "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("more")]),s._v(" build-args "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("foo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" were not consumed\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("一个 Dockerfile 可能包含一个或多个 "),a("code",[s._v("ARG")]),s._v(" 指令。例如，以下是一个有效的 Dockerfile：")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" centos:7")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ARG")]),s._v(" user1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ARG")]),s._v(" buildno")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ......")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("div",{staticClass:"custom-block danger"},[a("p",{staticClass:"custom-block-title"},[s._v("警告")]),s._v(" "),a("p",[s._v("不建议使用构建时变量来传递秘密，如 github 密钥、用户凭据等信息，因为可以通过 "),a("code",[s._v("docker history")]),s._v(" 等查看历史记录。")]),s._v(" "),a("div",{staticClass:"custom-block right"},[a("p",[s._v("2021-11-22 @Young Kbt")])])]),s._v(" "),a("h4",{attrs:{id:"默认值"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#默认值"}},[s._v("#")]),s._v(" 默认值")]),s._v(" "),a("p",[s._v("一条 "),a("code",[s._v("ARG")]),s._v(" 指令可以选择包含一个默认值：")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" centos:7")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ARG")]),s._v(" user1=someuser")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ARG")]),s._v(" buildno=1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ......")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[a("code",[s._v("ARG")]),s._v(" 变量定义从 Dockerfile 中定义它的行开始生效，而不是从命令行或其他地方使用参数开始生效。例如，考虑这个 Dockerfile：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("FROM centos:7\nWORKDIR "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${path"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("data}")]),s._v("\nARG path\nWORKDIR "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$path")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ......")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("通过调用构建此文件传参：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build --build-arg "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("path")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/data/kele ./\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("第 2 行的工作目录使用了 path 变量，并指定初始值为 "),a("code",[s._v("/data")]),s._v("，但是该变量在随后的第 3 行中才开始定义。所以第 4 行的 path 不是 "),a("code",[s._v("/data")]),s._v("，而是构建时传进来的 "),a("code",[s._v("/data/kele")]),s._v("。在ARG指令定义变量之前，任何变量的使用都会导致空字符串。")]),s._v(" "),a("p",[a("code",[s._v("ARG")]),s._v(" 指令在构建阶段（build）结束后失效。要在多个阶段中使用 arg，每个阶段必须包含 arg 指令。")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" centos:7")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ARG")]),s._v(" SETTINGS")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" ./run/setup "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SETTINGS")])]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 必须重新定义 SETTINGS")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" busybox")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ARG")]),s._v(" SETTINGS")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" ./run/other "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SETTINGS")])]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h4",{attrs:{id:"使用arg变量"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用arg变量"}},[s._v("#")]),s._v(" 使用ARG变量")]),s._v(" "),a("p",[s._v("其实看到这，很多人都会想到 "),a("code",[s._v("ARG")]),s._v(" 不就是 "),a("code",[s._v("ENV")]),s._v(" 吗，都是定义一个变量，然而官方不可能这么做，肯定有所区别，那么接下来请仔细阅读下面内容。")]),s._v(" "),a("p",[s._v("使用 "),a("code",[s._v("ENV")]),s._v(" 指令定义的环境变量 总是覆盖 "),a("code",[s._v("ARG")]),s._v(" 同名指令")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" centos:7")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ARG")]),s._v(" CONT_IMG_VER")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" CONT_IMG_VER=v1.0.0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" echo "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CONT_IMG_VER")])]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("在构建时，传入参数：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build --build-arg "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CONT_IMG_VER")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("v2.0.1 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("在这种情况下，"),a("code",[s._v("RUN")]),s._v(" 指令使用 "),a("code",[s._v("v1.0.0")]),s._v(" 而不是 "),a("code",[s._v("ARG")]),s._v(" 传递的参数："),a("code",[s._v("v2.0.1")]),s._v("，此行为类似于 shell 脚本，"),a("strong",[s._v("本地范围的变量覆盖参数传递或环境继承的变量。")])]),s._v(" "),a("p",[s._v("如果定义了 "),a("code",[s._v("ARG")]),s._v(" 变量，但是又不想在构建阶段传参，可以使用 "),a("code",[s._v("ENV")]),s._v(" 进行配合：")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" centos:7")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ARG")]),s._v(" CONT_IMG_VER")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" CONT_IMG_VER="),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${CONT_IMG_VER:-v1.0.0}")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" echo "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CONT_IMG_VER")])]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("与 "),a("code",[s._v("ARG")]),s._v(" 指令不同，"),a("code",[s._v("ENV")]),s._v(" 值始终保留在构建的映像中，所以 "),a("code",[s._v("CONT_IMG_VER")]),s._v(" 仍保留在映像中，"),a("code",[s._v("CONT_IMG_VER")]),s._v(" 的默认值是 v1.0.0，哪怕构建阶段不传参数，也不会报错。")]),s._v(" "),a("h4",{attrs:{id:"预定义的arg"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#预定义的arg"}},[s._v("#")]),s._v(" 预定义的ARG")]),s._v(" "),a("p",[s._v("Docker 有一组预定义的 "),a("code",[s._v("ARG")]),s._v(" 变量，您可以 "),a("code",[s._v("ARG")]),s._v(" 在 Dockerfile 中没有相应指令的情况下使用这些变量。")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("HTTP_PROXY")])]),s._v(" "),a("li",[a("code",[s._v("http_proxy")])]),s._v(" "),a("li",[a("code",[s._v("HTTPS_PROXY")])]),s._v(" "),a("li",[a("code",[s._v("https_proxy")])]),s._v(" "),a("li",[a("code",[s._v("FTP_PROXY")])]),s._v(" "),a("li",[a("code",[s._v("ftp_proxy")])]),s._v(" "),a("li",[a("code",[s._v("NO_PROXY")])]),s._v(" "),a("li",[a("code",[s._v("no_proxy")])])]),s._v(" "),a("p",[s._v("要使用这些，请使用 "),a("code",[s._v("--build-arg")]),s._v(" 标志在命令行上传递它们，例如：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build --build-arg "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("HTTPS_PROXY")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https://my-proxy.example.com "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("默认情况下，这些预定义变量的值存入 "),a("code",[s._v("docker history")]),s._v(". 所以尽量不要使用这些变量存入敏感的身份验证信息等。")]),s._v(" "),a("p",[s._v("例如，考虑使用以下 Dockerfile 构建 "),a("code",[s._v("--build-arg HTTP_PROXY=http://user:pass@proxy.lon.example.com")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('FROM centos:7\nRUN echo "Hello World"\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("在这种情况下，因为文件里没有 "),a("code",[s._v("HTTP_PROXY")]),s._v(" 变量，所以 "),a("code",[s._v("docker history")]),s._v(" 不会缓存该变量的信息。")]),s._v(" "),a("h4",{attrs:{id:"arg和env区别"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#arg和env区别"}},[s._v("#")]),s._v(" ARG和ENV区别")]),s._v(" "),a("ul",[a("li",[s._v("在 Dockerfile 中使用，仅在 build docker image 的过程中（包括 CMD 和 ENTRYPOINT）有效，在 image 被创建和 container 启动之后，无效。如果你在 Dockerfile 中使用了 ARG 但并未给定初始值，则在运行 docker build（编译）的时候未指定该 ARG 变量，则会失败。虽然其在 container 启动后不再生效，但是使用 docker history 可以查看到。所以，敏感数据不建议使用 ARG.")])]),s._v(" "),a("h2",{attrs:{id:"dockerignore文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dockerignore文件"}},[s._v("#")]),s._v(" .dockerignore文件")]),s._v(" "),a("p",[s._v("在 docker CLI 将上下文发送到 docker 守护进程之前，它会在上下文的根目录中查找名为 "),a("code",[s._v(".dockerginore")]),s._v(" 的文件。如果此文件存在，CLI 将修改上下文以排除与其中模式匹配的文件和目录。"),a("strong",[s._v("这有助于避免不必要地将大型或敏感文件和目录发送到守护进程")]),s._v("，并可能使用 "),a("code",[s._v("ADD")]),s._v(" 或 "),a("code",[s._v("COPY")]),s._v(" 将它们添加到图像中。")]),s._v(" "),a("p",[s._v("CLI 将 "),a("code",[s._v(".dockerignore")]),s._v(" 文件解释为以换行符分隔的模式列表，类似于 Unix shell 的文件 glob。出于匹配的目的，上下文的根被认为是工作目录和根目录。例如，模式 "),a("code",[s._v("/foo/bar")]),s._v(" 和 "),a("code",[s._v("foo/bar")]),s._v(" 都排除 PATH 的 foo 子目录或位于 URL 的 git 存储库根目录中名为 bar 的文件或目录。两者都不排除任何其他因素。")]),s._v(" "),a("p",[s._v("如果 "),a("code",[s._v(".dockerignore")]),s._v(" 文件中的一行在第 1 列中以 # 开头，则该行被视为注释，并在被 CLI 解析之前被忽略。")]),s._v(" "),a("p",[s._v("这是一个示例 "),a("code",[s._v(".dockerignore")]),s._v(" 文件：")]),s._v(" "),a("div",{staticClass:"language-gitignore line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-gitignore"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# comment")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token entry string"}},[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("/")]),s._v("temp"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token entry string"}},[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("/")]),s._v("temp"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token entry string"}},[s._v("temp"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")])]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("此文件会导致以下构建行为：")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[s._v("规则")]),s._v(" "),a("th",{staticStyle:{"text-align":"left"}},[s._v("行为")])])]),s._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[s._v("# comment")])]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("忽略。")])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[s._v("*/temp*")])]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("排除根目录的任何子目录中名称以 "),a("code",[s._v("temp")]),s._v(" 开头的文件和目录。例如，纯文件 "),a("code",[s._v("/somedir/temporary.txt")]),s._v(" 被排除在外，目录 "),a("code",[s._v("/somedir/temp")]),s._v(" 也被排除在外")])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[s._v("*/*/temp*")])]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("从根目录下两级的任何子目录中排除以 "),a("code",[s._v("temp")]),s._v(" 开头的文件和目录。例如，不包括 "),a("code",[s._v("/somedir/subdir/temporary.txt")]),s._v("。")])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[s._v("temp?")])]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("排除根目录中名称为 "),a("code",[s._v("temp")]),s._v(" 的单字符扩展名的文件和目录。例如，不包括"),a("code",[s._v("/tempa")]),s._v(" 和 "),a("code",[s._v("/tempb")]),s._v("。")])])])]),s._v(" "),a("p",[s._v("使用 Go 的 filepath.Match 规则完成匹配。预处理步骤将删除前导和尾随空格并消除。预处理后为空的行将被忽略。")]),s._v(" "),a("p",[s._v("除了 Go 的 filepath.Match 规则之外，Docker 还支持一个特殊的通配符字符串 "),a("code",[s._v("**")]),s._v(" 来匹配任意数量的目录（包括零）。例如，"),a("code",[s._v("**/*.go")]),s._v(" 将排除（包括生成上下文的根目录）中以 "),a("code",[s._v(".go")]),s._v(" 结尾的所有文件")]),s._v(" "),a("p",[s._v("以"),a("code",[s._v("!")]),s._v("(感叹号)开头的行可用于排除例外。以下是 "),a("code",[s._v(".dockerignore")]),s._v(" 使用此机制的示例文件：")]),s._v(" "),a("div",{staticClass:"language-gitignore line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-gitignore"}},[a("code",[a("span",{pre:!0,attrs:{class:"token entry string"}},[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(".md")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token entry string"}},[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("README.md")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("除 README.md 之外的所有标记文件都从上下文中排除")]),s._v(" "),a("p",[a("code",[s._v("!")]),s._v("异常规则的位置会影响行为："),a("code",[s._v(".dockerignore")]),s._v(" 匹配特定文件的最后一行决定是包含还是排除它。考虑以下示例：")]),s._v(" "),a("div",{staticClass:"language-gitignore line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-gitignore"}},[a("code",[a("span",{pre:!0,attrs:{class:"token entry string"}},[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(".md")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token entry string"}},[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("README"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(".md")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token entry string"}},[s._v("README-secret.md")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("除了 README 文件之外，上下文中不包含任何文件 "),a("code",[s._v("README-secret.md")]),s._v("。")]),s._v(" "),a("p",[s._v("现在考虑这个例子：")]),s._v(" "),a("div",{staticClass:"language-gitignore line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-gitignore"}},[a("code",[a("span",{pre:!0,attrs:{class:"token entry string"}},[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(".md")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token entry string"}},[s._v("README-secret.md")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token entry string"}},[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("README"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(".md")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("包含所有 README 文件。中间的线没有效果，因为 "),a("code",[s._v("!README*.md")]),s._v(" 与 "),a("code",[s._v("README-secret.md")]),s._v(" 匹配，并且排在最后。")]),s._v(" "),a("p",[s._v("您甚至可以使用该 "),a("code",[s._v(".dockerignore")]),s._v(" 文件来排除 "),a("code",[s._v("Dockerfile")]),s._v(" 和 "),a("code",[s._v(".dockerignore")]),s._v(" 文件。这些文件仍然被发送到守护进程，因为它需要它们来完成它的工作。但是 "),a("code",[s._v("ADD")]),s._v(" 和 "),a("code",[s._v("COPY")]),s._v(" 不会将它们复制到镜像中。")]),s._v(" "),a("p",[s._v("最后，您可能希望指定要在上下文中包含哪些文件，而不是要排除哪些文件。为此，请指定 "),a("code",[s._v("*")]),s._v(" 为第一个模式，然后是一个或多个 "),a("code",[s._v("!")]),s._v(" 异常模式。")]),s._v(" "),a("h2",{attrs:{id:"指令实战"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#指令实战"}},[s._v("#")]),s._v(" 指令实战")]),s._v(" "),a("h3",{attrs:{id:"centos安装指令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#centos安装指令"}},[s._v("#")]),s._v(" CentOS安装指令")]),s._v(" "),a("p",[s._v("官方默认的 CentOS 的情况不支持 "),a("code",[s._v("vim")]),s._v(" 和 "),a("code",[s._v("ifconfig")]),s._v(" 指令")]),s._v(" "),a("p",[s._v("我们自己构建一个支持这些指令的镜像")]),s._v(" "),a("p",[a("strong",[s._v("1、编写文件")])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("FROM centos:7\n\nENV "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")]),s._v(" /usr/local\nWORKDIR "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$MYPATH")]),s._v("\n\nRUN yum "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v("\nRUN yum "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" net-tools\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[a("strong",[s._v("2、构建镜像")])]),s._v(" "),a("p",[s._v("命令最后有一个 "),a("code",[s._v(".")]),s._v(" 表示当前目录")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" mycentos7:1.0 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("strong",[s._v("3、运行镜像")])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" mycentos7:1.0\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("strong",[s._v("4、进入容器使用指令")])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用 vim 指令")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@438f1c67afb1 /"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim aa.txt")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 直接创建 aa.txt 文件并进入")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用 ifconfig")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ifconfig")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("测试后，可以看到，我们自己的新镜像已经支持 vim 和 ifconfig的命令了。")]),s._v(" "),a("p",[s._v("列出镜像的变更历史指令："),a("code",[s._v("docker history <镜像名 | 镜像id>")])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("history")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("镜像名 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" 镜像id"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"centos安装tomcat"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#centos安装tomcat"}},[s._v("#")]),s._v(" CentOS安装Tomcat")]),s._v(" "),a("p",[s._v("先准备好 jdk 和 Tomcat，这里是 "),a("code",[s._v("jdk-8u11")]),s._v(" 和 "),a("code",[s._v("apache-tomcat-9.0.46")])]),s._v(" "),a("p",[a("strong",[s._v("1、编写文件")])]),s._v(" "),a("p",[s._v("Dockerfile 文件内容：")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" centos:7")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 把 java 与 tomcat 添加到容器中")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" jdk-8u11-linux-x64.tar.gz /usr/local/")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" apache-tomcat-9.0.46.tar.gz /usr/local/")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装 vim 编辑器")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" yum -y install vim")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 变量")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" BASE_PATH /usr/local")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置工作目录，即进入容器后默认所在目录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$BASE_PATH")])]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置 Java 与 tomcat 的环境变量")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" JAVA_HOME /usr/local/jdk1.8.0_11")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" CLASSPATH "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$JAVA_HOME")]),s._v("/lib/dt.jar:"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$JAVA_HOME")]),s._v("/lib/tools.jar")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" CATALINA_HOME /usr/local/apache-tomcat-9.0.46")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" CATALINA_BASE /usr/local/apache-tomcat-9.0.46")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" PATH "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PATH")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$JAVA_HOME")]),s._v("/bin:"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CATALINA_HOME")]),s._v("/lib:"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CATALINA_HOME")]),s._v("/bin")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 容器运行时监听的端口")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPOSE")]),s._v(" 8080")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动时运行 tomcat")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# ENTRYPOINT ["/usr/local/apache-tomcat-9.0.46/bin/startup.sh" ]')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# CMD ["/usr/local/apache-tomcat-9.0.46/bin/catalina.sh","run"]')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 或者")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" /usr/local/apache-tomcat-9.0.46/bin/startup.sh && tail -F /usr/local/apache-tomcat-9.0.46/bin/logs/catalina.out")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br")])]),a("p",[a("strong",[s._v("2、构建镜像")])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" mytomcat:1.0 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("strong",[s._v("3、运行镜像")])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(":8080 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" mytomcat "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" tomcat_test:/usr/local/apache-tomcat-9.0.46/webapps/test "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" tomcat_logs:/usr/local/apache-tomcat-9.0.46/logs "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--privileged")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true mytomcat:1.0\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("如果出现：cannot open directory Permission denied")]),s._v(" "),a("p",[s._v("在挂载目录后面加上 "),a("code",[s._v("--privileged=true")]),s._v(" 参数即可。")]),s._v(" "),a("p",[a("strong",[s._v("4、测试")])]),s._v(" "),a("p",[s._v("直接在宿主机的 tomcat_test 目录新建一个 test.jsp 文件")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /var/lib/docker/volumes/tomcat_test/_data\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" test.jsp\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("随便加入内容：")]),s._v(" "),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[s._v('<%@ page language="java" contentType="text/html; charset=UTF-8"\n    pageEncoding="UTF-8"%>\n'),a("span",{pre:!0,attrs:{class:"token doctype"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<!")]),a("span",{pre:!0,attrs:{class:"token doctype-tag"}},[s._v("DOCTYPE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token name"}},[s._v("html")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token name"}},[s._v("PUBLIC")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-//W3C//DTD HTML 4.01 Transitional//EN"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://www.w3.org/TR/html4/loose.dtd"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("head")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("meta")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("http-equiv")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("Content-Type"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("content")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("text/html; charset=UTF-8"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("title")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("Insert title here"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("title")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("head")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("body")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("h2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("Hello Docker！"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("h2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("body")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("打开浏览器访问："),a("code",[s._v("http://192.168.199.27:8080/test/test.jsp")])]),s._v(" "),a("p",[s._v("IP 地址根据自己的情况填写。")]),s._v(" "),a("h3",{attrs:{id:"spingboot"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#spingboot"}},[s._v("#")]),s._v(" SpingBoot")]),s._v(" "),a("p",[a("strong",[s._v("1、使用 IDEA 构建一个 SpringBoot 项目")])]),s._v(" "),a("p",[a("strong",[s._v("2、编写 Controller")])]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@RestController")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HelloController")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@GetMapping")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/hello"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("hello")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Hello Docker"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("利用 Maven 打成 jar 包。")]),s._v(" "),a("p",[a("strong",[s._v("3、编写文件")])]),s._v(" "),a("p",[s._v("将打包好的 jar 包拷贝到 Dockerfile 同级目录，然后开始编写 Dockerfile 文件")]),s._v(" "),a("div",{staticClass:"language-dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" java:8")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 拷贝 jar 包到镜像里，并改名为 app.jar")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" *.jar /app.jar")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动镜像执行的命令")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" ["),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--server.port=8080"')]),s._v("]")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定容器内要暴露的端口")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPOSE")]),s._v(" 8080")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动镜像后，启动 jar 包")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENTRYPOINT")]),s._v(" ["),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"java"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-jar"')]),s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" ["),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/app.jar"')]),s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("p",[a("strong",[s._v("4、构建镜像")])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 构建镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" test-jar:1.0 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 运行")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-P")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" test-jar test-jar:1.0\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[a("strong",[s._v("5、测试")])]),s._v(" "),a("p",[s._v("打开浏览器访问："),a("code",[s._v("http://192.168.199.27:8080/hello")])]),s._v(" "),a("p",[s._v("IP 地址根据自己的情况填写。")])])}),[],!1,null,null,null);a.default=n.exports}}]);