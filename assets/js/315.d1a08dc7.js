(window.webpackJsonp=window.webpackJsonp||[]).push([[315],{641:function(s,t,a){"use strict";a.r(t);var e=a(3),n=Object(e.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p"),t("div",{staticClass:"table-of-contents"},[t("ul",[t("li",[t("a",{attrs:{href:"#搭建方案"}},[s._v("搭建方案")]),t("ul",[t("li",[t("a",{attrs:{href:"#minikube"}},[s._v("minikube")])]),t("li",[t("a",{attrs:{href:"#kubeadm"}},[s._v("kubeadm")])]),t("li",[t("a",{attrs:{href:"#二进制安装"}},[s._v("二进制安装")])])])]),t("li",[t("a",{attrs:{href:"#命令行工具-kubectl"}},[s._v("命令行工具 kubectl")]),t("ul",[t("li",[t("a",{attrs:{href:"#资源操作"}},[s._v("资源操作")])]),t("li",[t("a",{attrs:{href:"#pod-与集群"}},[s._v("Pod 与集群")])]),t("li",[t("a",{attrs:{href:"#资源类型与别名"}},[s._v("资源类型与别名")])]),t("li",[t("a",{attrs:{href:"#格式化输出"}},[s._v("格式化输出")])])])]),t("li",[t("a",{attrs:{href:"#api-概述"}},[s._v("API 概述")]),t("ul",[t("li",[t("a",{attrs:{href:"#类型"}},[s._v("类型")])]),t("li",[t("a",{attrs:{href:"#访问控制"}},[s._v("访问控制")])]),t("li",[t("a",{attrs:{href:"#废弃-api-说明"}},[s._v("废弃 API 说明")])])])])])]),t("p"),s._v(" "),t("h2",{attrs:{id:"搭建方案"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#搭建方案"}},[s._v("#")]),s._v(" 搭建方案")]),s._v(" "),t("h3",{attrs:{id:"minikube"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#minikube"}},[s._v("#")]),s._v(" minikube")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://minikube.sigs.k8s.io/",target:"_blank",rel:"noopener noreferrer"}},[s._v("minikube"),t("OutboundLink")],1),s._v(" 是一个工具， 能让你在本地运行 Kubernetes。 minikube 在你的个人计算机（包括 Windows、macOS 和 Linux PC）上运行一个一体化（all-in-one）或多节点的本地 Kubernetes 集群，以便你来尝试 Kubernetes 或者开展每天的开发工作。")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://minikube.sigs.k8s.io/docs/start/",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方安装文档"),t("OutboundLink")],1)]),s._v(" "),t("h3",{attrs:{id:"kubeadm"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#kubeadm"}},[s._v("#")]),s._v(" kubeadm")]),s._v(" "),t("h4",{attrs:{id:"服务器要求"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#服务器要求"}},[s._v("#")]),s._v(" 服务器要求")]),s._v(" "),t("p",[s._v("3 台服务器（虚拟机）：")]),s._v(" "),t("ul",[t("li",[s._v("k8s-master：192.168.199.28")]),s._v(" "),t("li",[s._v("k8s-node1：192.168.199.29")]),s._v(" "),t("li",[s._v("k8s-node2：192.168.199.30")])]),s._v(" "),t("p",[s._v("最低配置：2核、2G内存、20G 硬盘。")]),s._v(" "),t("p",[s._v("最好能联网，不能联网的话需要有提供对应镜像的私有仓库。")]),s._v(" "),t("h4",{attrs:{id:"软件环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#软件环境"}},[s._v("#")]),s._v(" 软件环境")]),s._v(" "),t("ul",[t("li",[s._v("操作系统：CentOS 7")]),s._v(" "),t("li",[s._v("Docker：20+ 版本")]),s._v(" "),t("li",[s._v("k8s：1.23.6 版本（1.24 后 k8s 不再默认使用 docker）")])]),s._v(" "),t("h4",{attrs:{id:"安装步骤"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装步骤"}},[s._v("#")]),s._v(" 安装步骤")]),s._v(" "),t("blockquote",[t("p",[s._v("初始操作")])]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭防火墙")]),s._v("\nsystemctl stop firewalld\nsystemctl disable firewalld\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭selinux")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/enforcing/disabled/'")]),s._v(" /etc/selinux/config  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 永久")]),s._v("\nsetenforce "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 临时")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭swap")]),s._v("\nswapoff "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 临时")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-ri")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/.*swap.*/#&/'")]),s._v(" /etc/fstab    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 永久")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭完 swap 后，一定要重启一下虚拟机！！！")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 根据规划设置主机名 \t")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在master添加hosts")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /etc/hosts "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF\n192.168.199.28 k8s-master\n192.168.199.29 k8s-node1\n192.168.199.30 k8s-node2\nEOF")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将桥接的 IPv4 流量传递到 iptables 的链")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/sysctl.d/k8s.conf "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.bridge.bridge-nf-call-iptables = 1\nEOF")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sysctl")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--system")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 生效")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 时间同步")]),s._v("\nyum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" ntpdate "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v("\nntpdate time.windows.com\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br")])]),t("blockquote",[t("p",[s._v("安装基础软件（所有节点）")])]),s._v(" "),t("ol",[t("li",[t("p",[s._v("安装 Docker，安装步骤在 "),t("RouterLink",{attrs:{to:"/docker/install/"}},[s._v("Docker 知识体系 - 安装")])],1)]),s._v(" "),t("li",[t("p",[s._v("添加阿里云 yum 源：")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/yum.repos.d/kubernetes.repo "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF\n[kubernetes]\nname=Kubernetes\nbaseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64\nenabled=1\ngpgcheck=0\nrepo_gpgcheck=0\n\ngpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg\nEOF")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("安装 kubeadm、kubelet、kubectl")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("yum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" kubelet-1.23.6 kubeadm-1.23.6 kubectl-1.23.6\n\nsystemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" kubelet\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置关闭 Docker 的 cgroups，修改 ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/docker/daemon.json\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 加入以下内容")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"exec-opts"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"native.cgroupdriver=systemd"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启 docker")]),s._v("\nsystemctl daemon-reload\nsystemctl restart "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])])])]),s._v(" "),t("blockquote",[t("p",[s._v("部署 Kubernetes Master")])]),s._v(" "),t("p",[s._v("注意下面的 "),t("code",[s._v("apiserver-advertise-address")]),s._v(" 换成自己的服务器 Master 的 IP，其他可默认。")]),s._v(" "),t("p",[s._v("在 Master 节点执行：")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在 Master 节点下执行")]),s._v("\nkubeadm init "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n      --apiserver-advertise-address"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".199.28 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n      --image-repository registry.aliyuncs.com/google_containers "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n      --kubernetes-version v1.23.6 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n      --service-cidr"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".0.0/12 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n      --pod-network-cidr"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".0.0/16\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装成功后，复制如下配置并执行")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" /etc/kubernetes/admin.conf "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube/config\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-g")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube/config\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看 nodes 节点")]),s._v("\nkubectl get nodes\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("blockquote",[t("p",[s._v("加入 Kubernetes Node")])]),s._v(" "),t("p",[s._v("分别在 k8s-node1 和 k8s-node2 执行：")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下方命令可以在 k8s master 控制台初始化成功后复制 join 命令")]),s._v("\nkubeadm "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".199.28:6443 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--token")]),s._v(" ai642z.vzu9q6f7hj6hqg6w --discovery-token-ca-cert-hash sha256:74d6352a0007852272655fbf936452d05fa81185b7f9463100f6a09a318a3453\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果初始化的 token 不小心清空了，可以通过如下命令获取或者重新申请")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果 token 已经过期，就重新申请")]),s._v("\nkubeadm token create --print-join-command\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# token 没有过期可以通过如下命令获取")]),s._v("\nkubeadm token list\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 永不失效的 token")]),s._v("\nkubeadm token create "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--ttl")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取 --discovery-token-ca-cert-hash 值，得到值后需要在前面拼接上 sha256:")]),s._v("\nopenssl x509 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-pubkey")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-in")]),s._v(" /etc/kubernetes/pki/ca.crt "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" openssl rsa "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-pubin")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-outform")]),s._v(" der "),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),s._v("/dev/null "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\nopenssl dgst "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-sha256")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-hex")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/^.* //'")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("blockquote",[t("p",[s._v("部署 CNI 网络插件")])]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# master 和 node 确保不存在自定义的 network，如果存在，则删除")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" network "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" network "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" xxx\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在 master 节点上执行")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下载 calico 配置文件，可能会网络超时")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 访问 https://docs.projectcalico.org/v3.22/manifests/calico.yaml 复制全部内容到本地 calico.yaml（新建）")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改 calico.yaml 文件中的 CALICO_IPV4POOL_CIDR 配置，修改为与初始化的 cidr 相同")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改 IP_AUTODETECTION_METHOD 下的网卡名称")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除镜像 docker.io/ 前缀，避免下载过慢导致失败")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s#docker.io/##g'")]),s._v(" calico.yaml\n\nkubectl apply "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" calico.yaml\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("blockquote",[t("p",[s._v("测试 kubernetes 集群")])]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看 nodes")]),s._v("\nkubectl get nodes\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看系统镜像")]),s._v("\nkubectl get pods "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" kube-system\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看具体镜像内容")]),s._v("\nkube describe pod xxx "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" kube-system\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建部署")]),s._v("\nkubectl create deployment nginx "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--image")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 暴露端口")]),s._v("\nkubectl expose deployment nginx "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--port")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--type")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("NodePort\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看 pod 以及服务信息")]),s._v("\nkubectl get pod,svc\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 访问服务器的 ip + nginx 的端口")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br")])]),t("h3",{attrs:{id:"二进制安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#二进制安装"}},[s._v("#")]),s._v(" 二进制安装")]),s._v(" "),t("p",[s._v("利用 k8s 官方 github 仓库下载二进制包安装，安装过程较复杂，但相对较为稳定，推荐生产环境使用。")]),s._v(" "),t("h2",{attrs:{id:"命令行工具-kubectl"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#命令行工具-kubectl"}},[s._v("#")]),s._v(" 命令行工具 kubectl")]),s._v(" "),t("p",[s._v("在任意节点使用 kubectl")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1. 将 master 节点中 /etc/kubernetes/admin.conf 拷贝到需要运行的服务器的 /etc/kubernetes 目录中")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" /etc/kubernetes/admin.conf root@k8s-node1:/etc/kubernetes\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2. 在对应的 node 服务器上配置环境变量")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"export KUBECONFIG=/etc/kubernetes/admin.conf"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" ~/.bash_profile\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" ~/.bash_profile\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h3",{attrs:{id:"资源操作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#资源操作"}},[s._v("#")]),s._v(" 资源操作")]),s._v(" "),t("blockquote",[t("p",[s._v("创建对象")])]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("$ kubectl create "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" ./my-manifest.yaml           "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建资源")]),s._v("\n$ kubectl create "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" ./my1.yaml "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" ./my2.yaml     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用多个文件创建资源")]),s._v("\n$ kubectl create "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" ./dir                        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用目录下的所有清单文件来创建资源")]),s._v("\n$ kubectl create "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" https://git.io/vPieo         "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用 url 来创建资源")]),s._v("\n$ kubectl run nginx "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--image")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动一个 nginx 实例")]),s._v("\n$ kubectl explain pods,svc                       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取 pod 和 svc 的文档")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从 stdin 输入中创建多个 YAML 对象")]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF"),t("span",{pre:!0,attrs:{class:"token bash punctuation"}},[s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" kubectl create "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" -")]),s._v('\napiVersion: v1\nkind: Pod\nmetadata:\n  name: busybox-sleep\nspec:\n  containers:\n  - name: busybox\n    image: busybox\n    args:\n    - sleep\n    - "1000000"\n---\napiVersion: v1\nkind: Pod\nmetadata:\n  name: busybox-sleep-less\nspec:\n  containers:\n  - name: busybox\n    image: busybox\n    args:\n    - sleep\n    - "1000"\nEOF')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建包含几个 key 的 Secret")]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF"),t("span",{pre:!0,attrs:{class:"token bash punctuation"}},[s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" kubectl create "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" -")]),s._v("\napiVersion: v1\nkind: Secret\nmetadata:\n  name: mysecret\ntype: Opaque\ndata:\n  password: "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"s33msi4"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" base64"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n  username: "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"jane"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" base64"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\nEOF")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br")])]),t("blockquote",[t("p",[s._v("显示和查找资源")])]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Get commands with basic output")]),s._v("\n$ kubectl get services                          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 列出所有 namespace 中的所有 service")]),s._v("\n$ kubectl get pods --all-namespaces             "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 列出所有 namespace 中的所有 pod")]),s._v("\n$ kubectl get pods "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" wide                      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 列出所有 pod 并显示详细信息")]),s._v("\n$ kubectl get deployment my-dep                 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 列出指定 deployment")]),s._v("\n$ kubectl get pods --include-uninitialized      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 列出该 namespace 中的所有 pod 包括未初始化的")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用详细输出来描述命令")]),s._v("\n$ kubectl describe nodes my-node\n$ kubectl describe pods my-pod\n\n$ kubectl get services --sort-by"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(".metadata.name "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# List Services Sorted by Name")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 根据重启次数排序列出 pod")]),s._v("\n$ kubectl get pods --sort-by"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'.status.containerStatuses[0].restartCount'")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取所有具有 app=cassandra 的 pod 中的 version 标签")]),s._v("\n$ kubectl get pods "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--selector")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("app"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("cassandra rc "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("jsonpath")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{.items[*].metadata.labels.version}'")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取所有节点的 ExternalIP")]),s._v("\n$ kubectl get nodes "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("jsonpath")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{.items[*].status.addresses[?(@.type==\"ExternalIP\")].address}'")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 列出属于某个 PC 的 Pod 的名字")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 「jq」命令用于转换复杂的 jsonpath，参考 https://stedolan.github.io/jq/")]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("sel")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${$(kubectl get rc my-rc --output=json | jq -j '.spec.selector | to_entries | ."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(' | "\\(.key)=\\(.value)'),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(",")]),s._v("\"')"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v("?}")]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("kubectl get pods "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--selector")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("$sel "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--output")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("jsonpath"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(".items"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("metadata.name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看哪些节点已就绪")]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JSONPATH")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{range .items[*]}{@.metadata.name}:{range @.status.conditions[*]}{@.type}={@.status};{end}{end}'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" kubectl get nodes "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("jsonpath")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$JSONPATH")]),s._v('"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Ready=True"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 列出当前 Pod 中使用的 Secret")]),s._v("\n$ kubectl get pods "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" json "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" jq "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'.items[].spec.containers[].env[]?.valueFrom.secretKeyRef.name'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" null "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sort")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("uniq")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br")])]),t("blockquote",[t("p",[s._v("更新资源")])]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("$ kubectl rolling-update frontend-v1 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" frontend-v2.json           "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 滚动更新 pod frontend-v1")]),s._v("\n$ kubectl rolling-update frontend-v1 frontend-v2 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--image")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("image:v2  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 更新资源名称并更新镜像")]),s._v("\n$ kubectl rolling-update frontend "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--image")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("image:v2                 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 更新 frontend pod 中的镜像")]),s._v("\n$ kubectl rolling-update frontend-v1 frontend-v2 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--rollback")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 退出已存在的进行中的滚动更新")]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" pod.json "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" kubectl replace "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" -                              "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 基于 stdin 输入的 JSON 替换 pod")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 强制替换，删除后重新创建资源。会导致服务中断。")]),s._v("\n$ kubectl replace "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--force")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" ./pod.json\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 为 nginx RC 创建服务，启用本地 80 端口连接到容器上的 8000 端口")]),s._v("\n$ kubectl expose rc nginx "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--port")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" --target-port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 更新单容器 pod 的镜像版本（tag）到 v4")]),s._v("\n$ kubectl get pod mypod "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" yaml "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/\\(image: myimage\\):.*$/\\1:v4/'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" kubectl replace "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" -\n\n$ kubectl label pods my-pod new-label"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("awesome                      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加标签")]),s._v("\n$ kubectl annotate pods my-pod icon-url"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://goo.gl/XXBTWq       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加注解")]),s._v("\n$ kubectl autoscale deployment foo "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--min")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--max")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 自动扩展 deployment 「foo」")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br")])]),t("blockquote",[t("p",[s._v("修补资源")])]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("$ kubectl patch "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v(" k8s-node-1 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'{"spec":{"unschedulable":true}}\'')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 部分更新节点")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 更新容器镜像； spec.containers[*].name 是必须的，因为这是合并的关键字")]),s._v("\n$ kubectl patch pod valid-pod "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'{"spec":{"containers":[{"name":"kubernetes-serve-hostname","image":"new image"}]}}\'')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用具有位置数组的 json 补丁更新容器镜像")]),s._v("\n$ kubectl patch pod valid-pod "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--type")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'json'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'[{"op": "replace", "path": "/spec/containers/0/image", "value":"new image"}]\'')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用具有位置数组的 json 补丁禁用 deployment 的 livenessProbe")]),s._v("\n$ kubectl patch deployment valid-deployment  "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--type")]),s._v(" json   "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'[{"op": "remove", "path": "/spec/template/spec/containers/0/livenessProbe"}]\'')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("blockquote",[t("p",[s._v("编辑资源")])]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("$ kubectl edit svc/docker-registry                      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编辑名为 docker-registry 的 service")]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KUBE_EDITOR")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nano"')]),s._v(" kubectl edit svc/docker-registry   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用其它编辑器")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("blockquote",[t("p",[s._v("scale 资源")])]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("$ kubectl scale "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--replicas")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" rs/foo                                 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Scale a replicaset named 'foo' to 3")]),s._v("\n$ kubectl scale "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--replicas")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" foo.yaml                            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# Scale a resource specified in "foo.yaml" to 3')]),s._v("\n$ kubectl scale --current-replicas"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--replicas")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" deployment/mysql  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# If the deployment named mysql's current size is 2, scale mysql to 3")]),s._v("\n$ kubectl scale "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--replicas")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" rc/foo rc/bar rc/baz \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("blockquote",[t("p",[s._v("删除资源")])]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("$ kubectl delete "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" ./pod.json                                              "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除 pod.json 文件中定义的类型和名称的 pod")]),s._v("\n$ kubectl delete pod,service baz foo                                        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除名为「baz」的 pod 和名为「foo」的 service")]),s._v("\n$ kubectl delete pods,services "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("myLabel                              "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除具有 name=myLabel 标签的 pod 和 serivce")]),s._v("\n$ kubectl delete pods,services "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("myLabel --include-uninitialized      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除具有 name=myLabel 标签的 pod 和 service，包括尚未初始化的")]),s._v("\n$ kubectl "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" my-ns delete po,svc "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--all")]),s._v("   \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h3",{attrs:{id:"pod-与集群"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#pod-与集群"}},[s._v("#")]),s._v(" Pod 与集群")]),s._v(" "),t("blockquote",[t("p",[s._v("与运行的 Pod 交互")])]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("$ kubectl logs my-pod                                 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# dump 输出 pod 的日志（stdout）")]),s._v("\n$ kubectl logs my-pod "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" my-container                 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# dump 输出 pod 中容器的日志（stdout，pod 中有多个容器的情况下使用）")]),s._v("\n$ kubectl logs "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" my-pod                              "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 流式输出 pod 的日志（stdout）")]),s._v("\n$ kubectl logs "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" my-pod "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" my-container              "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 流式输出 pod 中容器的日志（stdout，pod 中有多个容器的情况下使用）")]),s._v("\n$ kubectl run "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--tty")]),s._v(" busybox "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--image")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("busybox -- "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 交互式 shell 的方式运行 pod")]),s._v("\n$ kubectl attach my-pod "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v("                            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 连接到运行中的容器")]),s._v("\n$ kubectl port-forward my-pod "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v(":6000               "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 转发 pod 中的 6000 端口到本地的 5000 端口")]),s._v("\n$ kubectl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" my-pod -- "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" /                         "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在已存在的容器中执行命令（只有一个容器的情况下）")]),s._v("\n$ kubectl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" my-pod "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" my-container -- "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" /         "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在已存在的容器中执行命令（pod 中有多个容器的情况下）")]),s._v("\n$ kubectl "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v(" pod POD_NAME "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--containers")]),s._v("               "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示指定 pod 和容器的指标度量")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("blockquote",[t("p",[s._v("与节点和集群交互")])]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("$ kubectl cordon my-node                                                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 标记 my-node 不可调度")]),s._v("\n$ kubectl drain my-node                                                 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 清空 my-node 以待维护")]),s._v("\n$ kubectl uncordon my-node                                              "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 标记 my-node 可调度")]),s._v("\n$ kubectl "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v(" my-node                                              "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示 my-node 的指标度量")]),s._v("\n$ kubectl cluster-info                                                  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示 master 和服务的地址")]),s._v("\n$ kubectl cluster-info dump                                             "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将当前集群状态输出到 stdout                                    ")]),s._v("\n$ kubectl cluster-info dump --output-directory"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/path/to/cluster-state   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将当前集群状态输出到 /path/to/cluster-state")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果该键和影响的污点（taint）已存在，则使用指定的值替换")]),s._v("\n$ kubectl taint nodes foo "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dedicated")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("special-user:NoSchedule\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("h3",{attrs:{id:"资源类型与别名"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#资源类型与别名"}},[s._v("#")]),s._v(" 资源类型与别名")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",{staticStyle:{"text-align":"left"}},[s._v("资源类型")]),s._v(" "),t("th",{staticStyle:{"text-align":"left"}},[s._v("缩写别名")])])]),s._v(" "),t("tbody",[t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("clusters")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}})]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("componentstatuses")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("cs")])])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("configmaps")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("cm")])])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("daemonsets")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("ds")])])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("deployments")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("deploy")])])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("endpoints")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("ep")])])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("event")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("ev")])])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("horizontalpodautoscalers")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("hpa")])])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("ingresses")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("ing")])])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("jobs")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}})]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("limitranges")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("limits")])])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("namespaces")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("ns")])])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("networkpolicies")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}})]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("nodes")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("no")])])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("statefulsets")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}})]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("persistentvolumeclaims")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("pvc")])])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("persistentvolumes")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("pv")])])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("pods")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("po")])])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("podsecuritypolicies")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("psp")])])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("podtemplates")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}})]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("replicasets")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("rs")])])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("replicationcontrollers")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("rc")])])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("resourcequotas")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("quota")])])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("cronjob")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}})]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("secrets")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}})]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("serviceaccount")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("sa")])])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("services")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("svc")])])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("storageclasses")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}})]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[t("code",[s._v("thirdpartyresources")])]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}})])])]),s._v(" "),t("h3",{attrs:{id:"格式化输出"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#格式化输出"}},[s._v("#")]),s._v(" 格式化输出")]),s._v(" "),t("p",[s._v("查看 pods 的命令")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("kubectl get po\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("可以通过下面的额外命令查看更多信息。")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("描述")]),s._v(" "),t("th",[s._v("语法")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("输出 json 格式")]),s._v(" "),t("td",[s._v("-o json")])]),s._v(" "),t("tr",[t("td",[s._v("仅打印资源名称")]),s._v(" "),t("td",[s._v("-o name")])]),s._v(" "),t("tr",[t("td",[s._v("以纯文本格式输出所有信息")]),s._v(" "),t("td",[s._v("-o wide")])]),s._v(" "),t("tr",[t("td",[s._v("输出 yaml 格式")]),s._v(" "),t("td",[s._v("-o yaml")])])])]),s._v(" "),t("p",[s._v("如：")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("kubectl get po "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" json\nkubectl get po "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" name\nkubectl get po "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" wide\nkubectl get po "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" yaml\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h2",{attrs:{id:"api-概述"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#api-概述"}},[s._v("#")]),s._v(" API 概述")]),s._v(" "),t("h3",{attrs:{id:"类型"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#类型"}},[s._v("#")]),s._v(" 类型")]),s._v(" "),t("p",[s._v("Alpha：")]),s._v(" "),t("ul",[t("li",[s._v("包含 alpha 名称的版本（例如v1alpha1）")]),s._v(" "),t("li",[s._v("该软件可能包含错误。启用一个功能可能会导致 bug。默认情况下，功能可能会被禁用")]),s._v(" "),t("li",[s._v("随时可能会丢弃对该功能的支持，恕不另行通知")]),s._v(" "),t("li",[s._v("API 可能在以后的软件版本中以不兼容的方式更改，恕不另行通知")]),s._v(" "),t("li",[s._v("该软件建议仅在短期测试集群中使用，因为错误的风险增加和缺乏长期支持")])]),s._v(" "),t("p",[s._v("Beta：")]),s._v(" "),t("ul",[t("li",[s._v("包含 "),t("strong",[s._v("beta")]),s._v(" 名称的版本（例如 "),t("strong",[s._v("v2beta3")]),s._v("）")]),s._v(" "),t("li",[s._v("该软件经过很好的测试。启用功能被认为是安全的。默认情况下功能是开启的")]),s._v(" "),t("li",[s._v("细节可能会改变，但功能在后续版本不会被删除")]),s._v(" "),t("li",[s._v("对象的模式或语义在随后的 beta 版本或 Stable 版本中可能以不兼容的方式发生变化。如果这种情况发生时，官方会提供迁移操作指南。这可能需要删除、编辑和重新创建API对象")]),s._v(" "),t("li",[s._v("该版本在后续可能会更改一些不兼容地方，所以建议用于非关键业务，如果你有多个可以独立升级的集群，你也可以放宽此限制")]),s._v(" "),t("li",[t("strong",[s._v("大家使用过的 Beta 版本后，可以多给社区反馈，如果此版本在后续更新后将不会有太大变化")])])]),s._v(" "),t("p",[s._v("Stable：")]),s._v(" "),t("ul",[t("li",[s._v("该版本名称命名方式："),t("strong",[s._v("vX")]),s._v(" 这里 "),t("strong",[s._v("X")]),s._v(" 是一个整数")]),s._v(" "),t("li",[s._v("Stable 版本的功能特性，将出现在后续发布的软件版本中")])]),s._v(" "),t("h3",{attrs:{id:"访问控制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#访问控制"}},[s._v("#")]),s._v(" 访问控制")]),s._v(" "),t("ul",[t("li",[s._v("认证")]),s._v(" "),t("li",[s._v("授权")])]),s._v(" "),t("h3",{attrs:{id:"废弃-api-说明"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#废弃-api-说明"}},[s._v("#")]),s._v(" 废弃 API 说明")]),s._v(" "),t("p",[s._v("通过链接查看废弃的 API："),t("code",[s._v("https://kubernetes.io/zh-cn/docs/reference/using-api/deprecation-guide/")]),s._v("。")])])}),[],!1,null,null,null);t.default=n.exports}}]);