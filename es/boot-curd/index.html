<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ElasticSearch - 多框架集成 | Young Kbt blog</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_3114978_qe0b39no76.css">
    <script>var _hmt = _hmt || [];
          (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?14366b81d7983944862ae088864b209e"; 
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
          })();
          </script>
    <meta name="description" content="Young Kbt个人博客, VuePress搭建, 使用了 Vdoing 主题, 学习Java, Web, 框架, 微服务, 工具, 前端等相关知识, 记录生活和技术路程, 同时分享编程技巧。">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <meta name="keywords" content="Young Kbt个人博客, VuePress搭建, 学习Java、Web、框架、微服务、工具、前端等相关知识, 记录生活和技术路程。">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.b07bbc3a.css" as="style"><link rel="preload" href="/assets/js/app.7d9f7e76.js" as="script"><link rel="preload" href="/assets/js/2.7b39a60a.js" as="script"><link rel="preload" href="/assets/js/170.85b5600d.js" as="script"><link rel="preload" href="/assets/js/7.e563704e.js" as="script"><link rel="preload" href="/assets/js/4.e30b0885.js" as="script"><link rel="prefetch" href="/assets/js/10.b6825257.js"><link rel="prefetch" href="/assets/js/100.d103d95b.js"><link rel="prefetch" href="/assets/js/101.ae6e3c8f.js"><link rel="prefetch" href="/assets/js/102.526b5644.js"><link rel="prefetch" href="/assets/js/103.68abd23e.js"><link rel="prefetch" href="/assets/js/104.bd57d04b.js"><link rel="prefetch" href="/assets/js/105.0642aac9.js"><link rel="prefetch" href="/assets/js/106.6b8f9f08.js"><link rel="prefetch" href="/assets/js/107.cc7e19b8.js"><link rel="prefetch" href="/assets/js/108.c4525208.js"><link rel="prefetch" href="/assets/js/109.0b1c7898.js"><link rel="prefetch" href="/assets/js/11.b5afe39f.js"><link rel="prefetch" href="/assets/js/110.8afa0063.js"><link rel="prefetch" href="/assets/js/111.28d673dc.js"><link rel="prefetch" href="/assets/js/112.66d9bd11.js"><link rel="prefetch" href="/assets/js/113.433669e6.js"><link rel="prefetch" href="/assets/js/114.e1cc4ff7.js"><link rel="prefetch" href="/assets/js/115.debd1417.js"><link rel="prefetch" href="/assets/js/116.f8015493.js"><link rel="prefetch" href="/assets/js/117.0ca04914.js"><link rel="prefetch" href="/assets/js/118.92cef09d.js"><link rel="prefetch" href="/assets/js/119.58db364e.js"><link rel="prefetch" href="/assets/js/12.0dcf3b8d.js"><link rel="prefetch" href="/assets/js/120.2fca89dd.js"><link rel="prefetch" href="/assets/js/121.682beb68.js"><link rel="prefetch" href="/assets/js/122.16c4338c.js"><link rel="prefetch" href="/assets/js/123.4bcb5658.js"><link rel="prefetch" href="/assets/js/124.f0812337.js"><link rel="prefetch" href="/assets/js/125.9547ffac.js"><link rel="prefetch" href="/assets/js/126.260b028e.js"><link rel="prefetch" href="/assets/js/127.35c305f1.js"><link rel="prefetch" href="/assets/js/128.51518491.js"><link rel="prefetch" href="/assets/js/129.4abce5b6.js"><link rel="prefetch" href="/assets/js/13.1917ed59.js"><link rel="prefetch" href="/assets/js/130.30b94ef1.js"><link rel="prefetch" href="/assets/js/131.043ebb9a.js"><link rel="prefetch" href="/assets/js/132.600a69b3.js"><link rel="prefetch" href="/assets/js/133.93f00f2b.js"><link rel="prefetch" href="/assets/js/134.6e0b6076.js"><link rel="prefetch" href="/assets/js/135.b48e1b10.js"><link rel="prefetch" href="/assets/js/136.a4467daa.js"><link rel="prefetch" href="/assets/js/137.defb23b7.js"><link rel="prefetch" href="/assets/js/138.a26227ea.js"><link rel="prefetch" href="/assets/js/139.5961a7f4.js"><link rel="prefetch" href="/assets/js/14.ce95fd70.js"><link rel="prefetch" href="/assets/js/140.5903e789.js"><link rel="prefetch" href="/assets/js/141.d255f04e.js"><link rel="prefetch" href="/assets/js/142.465e7162.js"><link rel="prefetch" href="/assets/js/143.50d0f8f7.js"><link rel="prefetch" href="/assets/js/144.340337d2.js"><link rel="prefetch" href="/assets/js/145.36c59bff.js"><link rel="prefetch" href="/assets/js/146.73100c57.js"><link rel="prefetch" href="/assets/js/147.e331cefd.js"><link rel="prefetch" href="/assets/js/148.87ae373b.js"><link rel="prefetch" href="/assets/js/149.f22b1782.js"><link rel="prefetch" href="/assets/js/15.9e02ccda.js"><link rel="prefetch" href="/assets/js/150.b4592a09.js"><link rel="prefetch" href="/assets/js/151.4f3d1dda.js"><link rel="prefetch" href="/assets/js/152.d8b4915b.js"><link rel="prefetch" href="/assets/js/153.2924288b.js"><link rel="prefetch" href="/assets/js/154.581cf5cf.js"><link rel="prefetch" href="/assets/js/155.6005dd53.js"><link rel="prefetch" href="/assets/js/156.4a9ed2cb.js"><link rel="prefetch" href="/assets/js/157.602dddd3.js"><link rel="prefetch" href="/assets/js/158.708e482f.js"><link rel="prefetch" href="/assets/js/159.425755c1.js"><link rel="prefetch" href="/assets/js/16.df720a5d.js"><link rel="prefetch" href="/assets/js/160.be1c227e.js"><link rel="prefetch" href="/assets/js/161.1f895b84.js"><link rel="prefetch" href="/assets/js/162.9ef108c5.js"><link rel="prefetch" href="/assets/js/163.dc1dd396.js"><link rel="prefetch" href="/assets/js/164.0df8355a.js"><link rel="prefetch" href="/assets/js/165.050ac25b.js"><link rel="prefetch" href="/assets/js/166.f7587509.js"><link rel="prefetch" href="/assets/js/167.8c7cfc7b.js"><link rel="prefetch" href="/assets/js/168.b50375d4.js"><link rel="prefetch" href="/assets/js/169.2d4bb241.js"><link rel="prefetch" href="/assets/js/17.1fd9e299.js"><link rel="prefetch" href="/assets/js/171.f138cd88.js"><link rel="prefetch" href="/assets/js/172.0ad47eee.js"><link rel="prefetch" href="/assets/js/173.2a5faa99.js"><link rel="prefetch" href="/assets/js/174.3324ae57.js"><link rel="prefetch" href="/assets/js/175.61bf147f.js"><link rel="prefetch" href="/assets/js/176.80292c8b.js"><link rel="prefetch" href="/assets/js/177.7999417a.js"><link rel="prefetch" href="/assets/js/178.e32debc3.js"><link rel="prefetch" href="/assets/js/179.f9463959.js"><link rel="prefetch" href="/assets/js/18.c42f17a3.js"><link rel="prefetch" href="/assets/js/180.09ef873d.js"><link rel="prefetch" href="/assets/js/181.d610926e.js"><link rel="prefetch" href="/assets/js/182.2e3e68ec.js"><link rel="prefetch" href="/assets/js/183.0e9b7309.js"><link rel="prefetch" href="/assets/js/184.ac5346d7.js"><link rel="prefetch" href="/assets/js/185.d21bcd1b.js"><link rel="prefetch" href="/assets/js/186.28ccb3ee.js"><link rel="prefetch" href="/assets/js/187.bcbcd0f4.js"><link rel="prefetch" href="/assets/js/188.de487e32.js"><link rel="prefetch" href="/assets/js/189.169cf767.js"><link rel="prefetch" href="/assets/js/19.3582dff6.js"><link rel="prefetch" href="/assets/js/190.7e6bf93c.js"><link rel="prefetch" href="/assets/js/191.0f5e1658.js"><link rel="prefetch" href="/assets/js/192.a32dbf35.js"><link rel="prefetch" href="/assets/js/193.a593fe1d.js"><link rel="prefetch" href="/assets/js/194.719cc463.js"><link rel="prefetch" href="/assets/js/195.1259e47a.js"><link rel="prefetch" href="/assets/js/196.a99da1c7.js"><link rel="prefetch" href="/assets/js/197.b0b21515.js"><link rel="prefetch" href="/assets/js/198.aa1ba0d6.js"><link rel="prefetch" href="/assets/js/199.6ed1691e.js"><link rel="prefetch" href="/assets/js/20.6c0cb91f.js"><link rel="prefetch" href="/assets/js/200.ba92f02f.js"><link rel="prefetch" href="/assets/js/201.11f54a16.js"><link rel="prefetch" href="/assets/js/202.58cd694b.js"><link rel="prefetch" href="/assets/js/203.2211b234.js"><link rel="prefetch" href="/assets/js/204.c547f4fe.js"><link rel="prefetch" href="/assets/js/205.50ab5161.js"><link rel="prefetch" href="/assets/js/206.1ce5b3a2.js"><link rel="prefetch" href="/assets/js/207.179f9bd4.js"><link rel="prefetch" href="/assets/js/208.aff15d57.js"><link rel="prefetch" href="/assets/js/209.7aacec3f.js"><link rel="prefetch" href="/assets/js/21.778fd061.js"><link rel="prefetch" href="/assets/js/210.b0da74e3.js"><link rel="prefetch" href="/assets/js/211.e34a57d1.js"><link rel="prefetch" href="/assets/js/212.1c389f99.js"><link rel="prefetch" href="/assets/js/213.4968ec40.js"><link rel="prefetch" href="/assets/js/214.96cd7dc1.js"><link rel="prefetch" href="/assets/js/215.2294f023.js"><link rel="prefetch" href="/assets/js/216.94b79bd7.js"><link rel="prefetch" href="/assets/js/217.66873941.js"><link rel="prefetch" href="/assets/js/218.46127ee9.js"><link rel="prefetch" href="/assets/js/219.8d56ef2a.js"><link rel="prefetch" href="/assets/js/22.089d9f58.js"><link rel="prefetch" href="/assets/js/220.88c5d45c.js"><link rel="prefetch" href="/assets/js/221.00faba44.js"><link rel="prefetch" href="/assets/js/222.eeb2a5f0.js"><link rel="prefetch" href="/assets/js/223.b9fc4f54.js"><link rel="prefetch" href="/assets/js/224.ac5a667f.js"><link rel="prefetch" href="/assets/js/225.4cc60a26.js"><link rel="prefetch" href="/assets/js/226.dffd6bb9.js"><link rel="prefetch" href="/assets/js/227.2a359dae.js"><link rel="prefetch" href="/assets/js/228.bf1438fd.js"><link rel="prefetch" href="/assets/js/229.dec18b07.js"><link rel="prefetch" href="/assets/js/23.93a4e46a.js"><link rel="prefetch" href="/assets/js/230.548f31e7.js"><link rel="prefetch" href="/assets/js/231.1c78b57d.js"><link rel="prefetch" href="/assets/js/232.3b857fb1.js"><link rel="prefetch" href="/assets/js/233.911b81f2.js"><link rel="prefetch" href="/assets/js/234.be86b8fe.js"><link rel="prefetch" href="/assets/js/235.cc8ea54a.js"><link rel="prefetch" href="/assets/js/236.b7bb40cd.js"><link rel="prefetch" href="/assets/js/237.2642218d.js"><link rel="prefetch" href="/assets/js/238.cfaf71b5.js"><link rel="prefetch" href="/assets/js/239.1034bf3d.js"><link rel="prefetch" href="/assets/js/24.c4395ec9.js"><link rel="prefetch" href="/assets/js/240.955ca6a3.js"><link rel="prefetch" href="/assets/js/241.6564b15e.js"><link rel="prefetch" href="/assets/js/242.1d1a8251.js"><link rel="prefetch" href="/assets/js/243.4765c501.js"><link rel="prefetch" href="/assets/js/244.c6274062.js"><link rel="prefetch" href="/assets/js/245.21362c48.js"><link rel="prefetch" href="/assets/js/246.462c1742.js"><link rel="prefetch" href="/assets/js/247.7ae3a9d0.js"><link rel="prefetch" href="/assets/js/248.d73ad74c.js"><link rel="prefetch" href="/assets/js/249.c2456396.js"><link rel="prefetch" href="/assets/js/25.5096818d.js"><link rel="prefetch" href="/assets/js/250.e8f1dc24.js"><link rel="prefetch" href="/assets/js/251.a33207d0.js"><link rel="prefetch" href="/assets/js/252.2f3c133d.js"><link rel="prefetch" href="/assets/js/253.2d6c1fb3.js"><link rel="prefetch" href="/assets/js/254.c4dde29b.js"><link rel="prefetch" href="/assets/js/255.9adfbab0.js"><link rel="prefetch" href="/assets/js/256.91139fda.js"><link rel="prefetch" href="/assets/js/257.b86b15e3.js"><link rel="prefetch" href="/assets/js/258.56cffe32.js"><link rel="prefetch" href="/assets/js/259.4dd27ce8.js"><link rel="prefetch" href="/assets/js/26.8043e201.js"><link rel="prefetch" href="/assets/js/260.37db56f7.js"><link rel="prefetch" href="/assets/js/261.26e412ed.js"><link rel="prefetch" href="/assets/js/262.64f081b2.js"><link rel="prefetch" href="/assets/js/263.d9fa3de2.js"><link rel="prefetch" href="/assets/js/264.2b7fb8fc.js"><link rel="prefetch" href="/assets/js/265.be87c3e1.js"><link rel="prefetch" href="/assets/js/266.17216d4f.js"><link rel="prefetch" href="/assets/js/267.3f13de5d.js"><link rel="prefetch" href="/assets/js/268.2ecc1c61.js"><link rel="prefetch" href="/assets/js/269.b2313ca5.js"><link rel="prefetch" href="/assets/js/27.7722643a.js"><link rel="prefetch" href="/assets/js/270.21277a28.js"><link rel="prefetch" href="/assets/js/271.3fb4b191.js"><link rel="prefetch" href="/assets/js/272.f8308978.js"><link rel="prefetch" href="/assets/js/273.de07e8f8.js"><link rel="prefetch" href="/assets/js/274.efadd2d2.js"><link rel="prefetch" href="/assets/js/275.a67b32c1.js"><link rel="prefetch" href="/assets/js/276.01c2f99a.js"><link rel="prefetch" href="/assets/js/277.a1e4c17a.js"><link rel="prefetch" href="/assets/js/278.3597dad7.js"><link rel="prefetch" href="/assets/js/279.39eb5fe6.js"><link rel="prefetch" href="/assets/js/28.950fd757.js"><link rel="prefetch" href="/assets/js/280.6ff96471.js"><link rel="prefetch" href="/assets/js/281.103fe69f.js"><link rel="prefetch" href="/assets/js/282.be71da36.js"><link rel="prefetch" href="/assets/js/283.de64f17d.js"><link rel="prefetch" href="/assets/js/284.9eb0b8fc.js"><link rel="prefetch" href="/assets/js/285.761859fc.js"><link rel="prefetch" href="/assets/js/286.346ccdc2.js"><link rel="prefetch" href="/assets/js/287.22ddf0f9.js"><link rel="prefetch" href="/assets/js/288.69b02cc4.js"><link rel="prefetch" href="/assets/js/289.1fc91664.js"><link rel="prefetch" href="/assets/js/29.e3efef75.js"><link rel="prefetch" href="/assets/js/290.09b43cdf.js"><link rel="prefetch" href="/assets/js/291.670c597a.js"><link rel="prefetch" href="/assets/js/292.3c8be194.js"><link rel="prefetch" href="/assets/js/293.ce187eca.js"><link rel="prefetch" href="/assets/js/294.a91e3d30.js"><link rel="prefetch" href="/assets/js/295.08100fa2.js"><link rel="prefetch" href="/assets/js/296.160bc832.js"><link rel="prefetch" href="/assets/js/297.4274595e.js"><link rel="prefetch" href="/assets/js/298.2f39a31a.js"><link rel="prefetch" href="/assets/js/299.5762f2da.js"><link rel="prefetch" href="/assets/js/3.78b8ad1e.js"><link rel="prefetch" href="/assets/js/30.b7735995.js"><link rel="prefetch" href="/assets/js/300.f39b59cc.js"><link rel="prefetch" href="/assets/js/301.9174b188.js"><link rel="prefetch" href="/assets/js/302.c0199c18.js"><link rel="prefetch" href="/assets/js/303.36446fe4.js"><link rel="prefetch" href="/assets/js/304.28526293.js"><link rel="prefetch" href="/assets/js/305.8c961411.js"><link rel="prefetch" href="/assets/js/306.35e14e4d.js"><link rel="prefetch" href="/assets/js/307.90595fb1.js"><link rel="prefetch" href="/assets/js/308.07ba8434.js"><link rel="prefetch" href="/assets/js/309.f1118e35.js"><link rel="prefetch" href="/assets/js/31.9e4bb835.js"><link rel="prefetch" href="/assets/js/310.8f818ee1.js"><link rel="prefetch" href="/assets/js/311.daf5fc45.js"><link rel="prefetch" href="/assets/js/312.6f5b159a.js"><link rel="prefetch" href="/assets/js/313.2d5139a9.js"><link rel="prefetch" href="/assets/js/314.b3df01a2.js"><link rel="prefetch" href="/assets/js/315.d1a08dc7.js"><link rel="prefetch" href="/assets/js/316.43c3f8bc.js"><link rel="prefetch" href="/assets/js/317.30abc7e4.js"><link rel="prefetch" href="/assets/js/318.52698790.js"><link rel="prefetch" href="/assets/js/319.b646604d.js"><link rel="prefetch" href="/assets/js/32.803ad8dc.js"><link rel="prefetch" href="/assets/js/320.cef634e4.js"><link rel="prefetch" href="/assets/js/321.ab001cc2.js"><link rel="prefetch" href="/assets/js/322.afe55670.js"><link rel="prefetch" href="/assets/js/323.c663a8ec.js"><link rel="prefetch" href="/assets/js/324.3f8d5693.js"><link rel="prefetch" href="/assets/js/325.6ed9477b.js"><link rel="prefetch" href="/assets/js/326.60c465cd.js"><link rel="prefetch" href="/assets/js/327.bec7ea7a.js"><link rel="prefetch" href="/assets/js/328.3ef962e2.js"><link rel="prefetch" href="/assets/js/329.d6ccccab.js"><link rel="prefetch" href="/assets/js/33.0b3cff33.js"><link rel="prefetch" href="/assets/js/330.a1076e53.js"><link rel="prefetch" href="/assets/js/331.76598413.js"><link rel="prefetch" href="/assets/js/332.9e7f848a.js"><link rel="prefetch" href="/assets/js/333.6a6d7f3d.js"><link rel="prefetch" href="/assets/js/334.eff8c014.js"><link rel="prefetch" href="/assets/js/335.c8e1c83e.js"><link rel="prefetch" href="/assets/js/336.930669ce.js"><link rel="prefetch" href="/assets/js/337.b1feba3b.js"><link rel="prefetch" href="/assets/js/338.7dfa3e68.js"><link rel="prefetch" href="/assets/js/339.ae11034f.js"><link rel="prefetch" href="/assets/js/34.d0ee60c4.js"><link rel="prefetch" href="/assets/js/340.e2dfab8c.js"><link rel="prefetch" href="/assets/js/341.859b1112.js"><link rel="prefetch" href="/assets/js/342.a585d93c.js"><link rel="prefetch" href="/assets/js/343.f1d73e84.js"><link rel="prefetch" href="/assets/js/344.f875fd3c.js"><link rel="prefetch" href="/assets/js/345.9e174120.js"><link rel="prefetch" href="/assets/js/346.0248797e.js"><link rel="prefetch" href="/assets/js/347.6e2b880e.js"><link rel="prefetch" href="/assets/js/348.60468a87.js"><link rel="prefetch" href="/assets/js/349.88f9db3f.js"><link rel="prefetch" href="/assets/js/35.d885736b.js"><link rel="prefetch" href="/assets/js/350.c630111b.js"><link rel="prefetch" href="/assets/js/351.64adf51f.js"><link rel="prefetch" href="/assets/js/352.09555b5f.js"><link rel="prefetch" href="/assets/js/353.b912a2d5.js"><link rel="prefetch" href="/assets/js/354.fa20079b.js"><link rel="prefetch" href="/assets/js/355.926705f1.js"><link rel="prefetch" href="/assets/js/356.fad4ff0b.js"><link rel="prefetch" href="/assets/js/357.7cc580d8.js"><link rel="prefetch" href="/assets/js/358.f9719f2b.js"><link rel="prefetch" href="/assets/js/359.b69f7a3a.js"><link rel="prefetch" href="/assets/js/36.d32e0c7d.js"><link rel="prefetch" href="/assets/js/360.801d8b40.js"><link rel="prefetch" href="/assets/js/361.90d6e346.js"><link rel="prefetch" href="/assets/js/362.1e7346ac.js"><link rel="prefetch" href="/assets/js/363.f22c9fca.js"><link rel="prefetch" href="/assets/js/364.76d34c40.js"><link rel="prefetch" href="/assets/js/365.b65d2767.js"><link rel="prefetch" href="/assets/js/366.cf03d70a.js"><link rel="prefetch" href="/assets/js/367.b4bbe0db.js"><link rel="prefetch" href="/assets/js/368.914d5412.js"><link rel="prefetch" href="/assets/js/369.9b099efe.js"><link rel="prefetch" href="/assets/js/37.371090d1.js"><link rel="prefetch" href="/assets/js/370.c672552d.js"><link rel="prefetch" href="/assets/js/371.87f1821b.js"><link rel="prefetch" href="/assets/js/372.82e4be2e.js"><link rel="prefetch" href="/assets/js/373.96de1573.js"><link rel="prefetch" href="/assets/js/374.4117ae1c.js"><link rel="prefetch" href="/assets/js/375.0f48d5fe.js"><link rel="prefetch" href="/assets/js/376.11ea841a.js"><link rel="prefetch" href="/assets/js/377.e57737a0.js"><link rel="prefetch" href="/assets/js/378.4f1aa4e6.js"><link rel="prefetch" href="/assets/js/379.27799a36.js"><link rel="prefetch" href="/assets/js/38.27e886c4.js"><link rel="prefetch" href="/assets/js/380.c282bf16.js"><link rel="prefetch" href="/assets/js/381.b251870b.js"><link rel="prefetch" href="/assets/js/382.9b8d594e.js"><link rel="prefetch" href="/assets/js/383.edba6d00.js"><link rel="prefetch" href="/assets/js/384.38792a61.js"><link rel="prefetch" href="/assets/js/385.4f858cda.js"><link rel="prefetch" href="/assets/js/386.43b3e7f0.js"><link rel="prefetch" href="/assets/js/387.1e8b1bca.js"><link rel="prefetch" href="/assets/js/388.ad777b0c.js"><link rel="prefetch" href="/assets/js/389.d2778c85.js"><link rel="prefetch" href="/assets/js/39.2bea46e1.js"><link rel="prefetch" href="/assets/js/390.0b41b23f.js"><link rel="prefetch" href="/assets/js/391.e2aa3c31.js"><link rel="prefetch" href="/assets/js/392.08d66674.js"><link rel="prefetch" href="/assets/js/393.236c62b4.js"><link rel="prefetch" href="/assets/js/394.b3bbe6f3.js"><link rel="prefetch" href="/assets/js/395.99c2faf4.js"><link rel="prefetch" href="/assets/js/396.1f04605f.js"><link rel="prefetch" href="/assets/js/397.d3efe3ae.js"><link rel="prefetch" href="/assets/js/398.8a8f0f35.js"><link rel="prefetch" href="/assets/js/399.0c6be981.js"><link rel="prefetch" href="/assets/js/40.5069f7b9.js"><link rel="prefetch" href="/assets/js/400.48318902.js"><link rel="prefetch" href="/assets/js/401.4f281702.js"><link rel="prefetch" href="/assets/js/402.34991da3.js"><link rel="prefetch" href="/assets/js/403.25ec58aa.js"><link rel="prefetch" href="/assets/js/404.aa65a935.js"><link rel="prefetch" href="/assets/js/405.e7310d84.js"><link rel="prefetch" href="/assets/js/406.bc12db33.js"><link rel="prefetch" href="/assets/js/407.510a85fa.js"><link rel="prefetch" href="/assets/js/408.6a2d37f6.js"><link rel="prefetch" href="/assets/js/409.5b6a91ab.js"><link rel="prefetch" href="/assets/js/41.7acd4c1f.js"><link rel="prefetch" href="/assets/js/410.77f74daa.js"><link rel="prefetch" href="/assets/js/411.54eee144.js"><link rel="prefetch" href="/assets/js/412.6bac9eec.js"><link rel="prefetch" href="/assets/js/413.b0e33d0a.js"><link rel="prefetch" href="/assets/js/414.f977b5a9.js"><link rel="prefetch" href="/assets/js/415.b659834b.js"><link rel="prefetch" href="/assets/js/416.813b3fb9.js"><link rel="prefetch" href="/assets/js/417.ffea8a95.js"><link rel="prefetch" href="/assets/js/418.2e6c92d6.js"><link rel="prefetch" href="/assets/js/419.5633feac.js"><link rel="prefetch" href="/assets/js/42.74167a2e.js"><link rel="prefetch" href="/assets/js/420.198a4653.js"><link rel="prefetch" href="/assets/js/421.725b1d3a.js"><link rel="prefetch" href="/assets/js/422.f2bec49d.js"><link rel="prefetch" href="/assets/js/423.bd79c37c.js"><link rel="prefetch" href="/assets/js/424.d2b68f60.js"><link rel="prefetch" href="/assets/js/425.175fcc17.js"><link rel="prefetch" href="/assets/js/426.2f105da2.js"><link rel="prefetch" href="/assets/js/427.944e11a1.js"><link rel="prefetch" href="/assets/js/428.b0022fe6.js"><link rel="prefetch" href="/assets/js/429.5aaba160.js"><link rel="prefetch" href="/assets/js/43.a08f2844.js"><link rel="prefetch" href="/assets/js/430.2c115268.js"><link rel="prefetch" href="/assets/js/431.a13146d3.js"><link rel="prefetch" href="/assets/js/432.61e43e71.js"><link rel="prefetch" href="/assets/js/433.6fa7a555.js"><link rel="prefetch" href="/assets/js/434.b41278cd.js"><link rel="prefetch" href="/assets/js/435.aece757b.js"><link rel="prefetch" href="/assets/js/436.bb18daae.js"><link rel="prefetch" href="/assets/js/437.2f6a7e4e.js"><link rel="prefetch" href="/assets/js/438.509027e7.js"><link rel="prefetch" href="/assets/js/439.aef490af.js"><link rel="prefetch" href="/assets/js/44.fcbaa8b5.js"><link rel="prefetch" href="/assets/js/440.c3de28dd.js"><link rel="prefetch" href="/assets/js/441.c17b32f0.js"><link rel="prefetch" href="/assets/js/442.618ac531.js"><link rel="prefetch" href="/assets/js/443.3e6e6a25.js"><link rel="prefetch" href="/assets/js/444.0345d904.js"><link rel="prefetch" href="/assets/js/445.745909d0.js"><link rel="prefetch" href="/assets/js/446.3bb6d732.js"><link rel="prefetch" href="/assets/js/447.8a754244.js"><link rel="prefetch" href="/assets/js/448.d5bf5584.js"><link rel="prefetch" href="/assets/js/449.86eb5144.js"><link rel="prefetch" href="/assets/js/45.5446ff28.js"><link rel="prefetch" href="/assets/js/450.45dc7bae.js"><link rel="prefetch" href="/assets/js/451.2476df07.js"><link rel="prefetch" href="/assets/js/452.12b20843.js"><link rel="prefetch" href="/assets/js/453.b1f7c6ad.js"><link rel="prefetch" href="/assets/js/454.d0c69556.js"><link rel="prefetch" href="/assets/js/455.ec29b2df.js"><link rel="prefetch" href="/assets/js/456.dc86754b.js"><link rel="prefetch" href="/assets/js/457.d0f6a91b.js"><link rel="prefetch" href="/assets/js/458.b8336337.js"><link rel="prefetch" href="/assets/js/459.fb6637be.js"><link rel="prefetch" href="/assets/js/46.943c0d34.js"><link rel="prefetch" href="/assets/js/460.f3944a29.js"><link rel="prefetch" href="/assets/js/461.3d55326f.js"><link rel="prefetch" href="/assets/js/462.e6d87054.js"><link rel="prefetch" href="/assets/js/463.50afd2e7.js"><link rel="prefetch" href="/assets/js/464.d5c3c482.js"><link rel="prefetch" href="/assets/js/465.3c3c48dc.js"><link rel="prefetch" href="/assets/js/466.6a20609e.js"><link rel="prefetch" href="/assets/js/467.63d72787.js"><link rel="prefetch" href="/assets/js/468.8febc3fb.js"><link rel="prefetch" href="/assets/js/469.82fb6804.js"><link rel="prefetch" href="/assets/js/47.76ace16f.js"><link rel="prefetch" href="/assets/js/470.b83e6f93.js"><link rel="prefetch" href="/assets/js/471.c8611e3c.js"><link rel="prefetch" href="/assets/js/472.daa5a5b3.js"><link rel="prefetch" href="/assets/js/473.5f330161.js"><link rel="prefetch" href="/assets/js/474.0f55f5ff.js"><link rel="prefetch" href="/assets/js/475.8a436343.js"><link rel="prefetch" href="/assets/js/476.d43a0802.js"><link rel="prefetch" href="/assets/js/477.b5eb95e6.js"><link rel="prefetch" href="/assets/js/478.6bc64bc5.js"><link rel="prefetch" href="/assets/js/479.64d16a91.js"><link rel="prefetch" href="/assets/js/48.739263d5.js"><link rel="prefetch" href="/assets/js/480.4599cdd7.js"><link rel="prefetch" href="/assets/js/49.65437a65.js"><link rel="prefetch" href="/assets/js/5.f15c72b7.js"><link rel="prefetch" href="/assets/js/50.d2ee3f55.js"><link rel="prefetch" href="/assets/js/51.311d5ade.js"><link rel="prefetch" href="/assets/js/52.bfdc8e9f.js"><link rel="prefetch" href="/assets/js/53.5359ac8b.js"><link rel="prefetch" href="/assets/js/54.f8010d21.js"><link rel="prefetch" href="/assets/js/55.fe595a55.js"><link rel="prefetch" href="/assets/js/56.c0f0c3a8.js"><link rel="prefetch" href="/assets/js/57.136294b7.js"><link rel="prefetch" href="/assets/js/58.7f208b82.js"><link rel="prefetch" href="/assets/js/59.fdbd0d41.js"><link rel="prefetch" href="/assets/js/6.f2722aef.js"><link rel="prefetch" href="/assets/js/60.8c0d65fe.js"><link rel="prefetch" href="/assets/js/61.7d48bcd3.js"><link rel="prefetch" href="/assets/js/62.d724e4aa.js"><link rel="prefetch" href="/assets/js/63.c2559e67.js"><link rel="prefetch" href="/assets/js/64.649291bd.js"><link rel="prefetch" href="/assets/js/65.0f6c617f.js"><link rel="prefetch" href="/assets/js/66.672f4c77.js"><link rel="prefetch" href="/assets/js/67.f3a71885.js"><link rel="prefetch" href="/assets/js/68.e3d4937d.js"><link rel="prefetch" href="/assets/js/69.6fb7bc4d.js"><link rel="prefetch" href="/assets/js/70.dd124372.js"><link rel="prefetch" href="/assets/js/71.4a756005.js"><link rel="prefetch" href="/assets/js/72.c2b6894c.js"><link rel="prefetch" href="/assets/js/73.5a1916b7.js"><link rel="prefetch" href="/assets/js/74.8eb238c0.js"><link rel="prefetch" href="/assets/js/75.9aaf8408.js"><link rel="prefetch" href="/assets/js/76.80203376.js"><link rel="prefetch" href="/assets/js/77.f3f8794f.js"><link rel="prefetch" href="/assets/js/78.0090e20b.js"><link rel="prefetch" href="/assets/js/79.e6f4b2b0.js"><link rel="prefetch" href="/assets/js/8.49e45d52.js"><link rel="prefetch" href="/assets/js/80.aa562b5f.js"><link rel="prefetch" href="/assets/js/81.de8f199b.js"><link rel="prefetch" href="/assets/js/82.b78e5955.js"><link rel="prefetch" href="/assets/js/83.d7c0e01e.js"><link rel="prefetch" href="/assets/js/84.1ddbe7a4.js"><link rel="prefetch" href="/assets/js/85.9fe8d47e.js"><link rel="prefetch" href="/assets/js/86.f795b7ab.js"><link rel="prefetch" href="/assets/js/87.effa924a.js"><link rel="prefetch" href="/assets/js/88.d9854d1e.js"><link rel="prefetch" href="/assets/js/89.b7d54d15.js"><link rel="prefetch" href="/assets/js/9.9578969c.js"><link rel="prefetch" href="/assets/js/90.b17ee25c.js"><link rel="prefetch" href="/assets/js/91.c5c7c6e3.js"><link rel="prefetch" href="/assets/js/92.72d4d2ea.js"><link rel="prefetch" href="/assets/js/93.fadf96ec.js"><link rel="prefetch" href="/assets/js/94.53efcdf4.js"><link rel="prefetch" href="/assets/js/95.2928f167.js"><link rel="prefetch" href="/assets/js/96.62918d30.js"><link rel="prefetch" href="/assets/js/97.3bb50446.js"><link rel="prefetch" href="/assets/js/98.12e7a055.js"><link rel="prefetch" href="/assets/js/99.3daa2010.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b07bbc3a.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/index/logo.png" alt="Young Kbt blog" class="logo"> <span class="site-name can-hide">Young Kbt blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><a href="/java/" class="link-title">Java</a> <span class="title" style="display:none;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>java基础</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java/se/" class="nav-link">Java基础</a></li><li class="dropdown-subitem"><a href="/java/collection/" class="nav-link">Java集合</a></li><li class="dropdown-subitem"><a href="/java/se/reflect/" class="nav-link">Java反射</a></li><li class="dropdown-subitem"><a href="/java/juc/" class="nav-link">JavaJUC</a></li><li class="dropdown-subitem"><a href="/java/jvm/" class="nav-link">JavaJVM</a></li></ul></li><li class="dropdown-item"><h4>Java容器</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/javaweb/concept/" class="nav-link">JavaWeb</a></li></ul></li><li class="dropdown-item"><h4>Java版本新特性</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java/new-features/" class="nav-link">Java新特性</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><a href="/database/" class="link-title">数据库</a> <span class="title" style="display:none;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>SQL 数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/mysql/" class="nav-link">MySQL</a></li><li class="dropdown-subitem"><a href="/oracle/" class="nav-link">Oracle</a></li></ul></li><li class="dropdown-item"><h4>NoSQL 数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/redis/" class="nav-link">Redis</a></li><li class="dropdown-subitem"><a href="/es/" class="nav-link router-link-active">ElasticSearch</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><a href="/frames/" class="link-title">框架</a> <span class="title" style="display:none;">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/mybatis/" class="nav-link">MyBatis</a></li><li class="dropdown-subitem"><a href="/mybatis-plus/" class="nav-link">MyBatis-Plus</a></li></ul></li><li class="dropdown-item"><h4>消息中间件</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/activemq/" class="nav-link">ActiveMQ</a></li><li class="dropdown-subitem"><a href="/rabbitmq/" class="nav-link">RabbitMQ</a></li><li class="dropdown-subitem"><a href="/rocketmq/" class="nav-link">RocketMQ</a></li><li class="dropdown-subitem"><a href="/kafka/" class="nav-link">Kafka</a></li></ul></li><li class="dropdown-item"><h4>进阶服务</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/nginx/" class="nav-link">Nginx</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Spring生态" class="dropdown-title"><a href="/spring-ecology/" class="link-title">Spring生态</a> <span class="title" style="display:none;">Spring生态</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/spring/" class="nav-link">Spring</a></li><li class="dropdown-item"><!----> <a href="/spring-boot/" class="nav-link">Spring Boot</a></li><li class="dropdown-item"><!----> <a href="/spring-security/" class="nav-link">Spring Security</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发" class="dropdown-title"><a href="/dev-guide/" class="link-title">开发</a> <span class="title" style="display:none;">开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/design-pattern/" class="nav-link">设计模式</a></li><li class="dropdown-item"><!----> <a href="/algorithm/" class="nav-link">算法</a></li><li class="dropdown-item"><!----> <a href="/knowledge/" class="nav-link">知识</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><a href="/tool/" class="link-title">工具</a> <span class="title" style="display:none;">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>管理</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/maven/" class="nav-link">Maven</a></li><li class="dropdown-subitem"><a href="/git/" class="nav-link">Git</a></li></ul></li><li class="dropdown-item"><h4>部署</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/linux/" class="nav-link">Linux</a></li><li class="dropdown-subitem"><a href="/docker/" class="nav-link">Docker</a></li><li class="dropdown-subitem"><a href="/jenkins/" class="nav-link">Jenkins</a></li><li class="dropdown-subitem"><a href="/kubernetes/" class="nav-link">Kubernetes</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/front/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>进阶</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/typescript/" class="nav-link">TypeScript</a></li></ul></li><li class="dropdown-item"><h4>框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/react/" class="nav-link">React</a></li><li class="dropdown-subitem"><a href="/vue2/" class="nav-link">Vue2</a></li><li class="dropdown-subitem"><a href="/vue3/" class="nav-link">Vue3</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><!----> <span class="title" style="display:;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/whells-use/" class="nav-link">轮子工具</a></li><li class="dropdown-item"><!----> <a href="/projects/" class="nav-link">项目工程</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>本站</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-subitem"><a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-subitem"><a href="/archives/" class="nav-link">归档</a></li></ul></li><li class="dropdown-item"><h4>我的</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/whell/web/" class="nav-link">收藏</a></li><li class="dropdown-subitem"><a href="/about/website/introduce/" class="nav-link">关于</a></li><li class="dropdown-subitem"><a href="https://vue2-admin.youngkbt.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Vue2-Admin
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://vue3-admin.youngkbt.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Vue3-Admin（完善）
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div> <a href="https://github.com/Kele-Bingtang/pure-blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/user/avatar2.png"> <div class="blogger-info"><h3>Shp Liu</h3> <span>朝圣的使徒，正在走向编程的至高殿堂！</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><a href="/java/" class="link-title">Java</a> <span class="title" style="display:none;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>java基础</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java/se/" class="nav-link">Java基础</a></li><li class="dropdown-subitem"><a href="/java/collection/" class="nav-link">Java集合</a></li><li class="dropdown-subitem"><a href="/java/se/reflect/" class="nav-link">Java反射</a></li><li class="dropdown-subitem"><a href="/java/juc/" class="nav-link">JavaJUC</a></li><li class="dropdown-subitem"><a href="/java/jvm/" class="nav-link">JavaJVM</a></li></ul></li><li class="dropdown-item"><h4>Java容器</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/javaweb/concept/" class="nav-link">JavaWeb</a></li></ul></li><li class="dropdown-item"><h4>Java版本新特性</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java/new-features/" class="nav-link">Java新特性</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><a href="/database/" class="link-title">数据库</a> <span class="title" style="display:none;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>SQL 数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/mysql/" class="nav-link">MySQL</a></li><li class="dropdown-subitem"><a href="/oracle/" class="nav-link">Oracle</a></li></ul></li><li class="dropdown-item"><h4>NoSQL 数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/redis/" class="nav-link">Redis</a></li><li class="dropdown-subitem"><a href="/es/" class="nav-link router-link-active">ElasticSearch</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><a href="/frames/" class="link-title">框架</a> <span class="title" style="display:none;">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/mybatis/" class="nav-link">MyBatis</a></li><li class="dropdown-subitem"><a href="/mybatis-plus/" class="nav-link">MyBatis-Plus</a></li></ul></li><li class="dropdown-item"><h4>消息中间件</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/activemq/" class="nav-link">ActiveMQ</a></li><li class="dropdown-subitem"><a href="/rabbitmq/" class="nav-link">RabbitMQ</a></li><li class="dropdown-subitem"><a href="/rocketmq/" class="nav-link">RocketMQ</a></li><li class="dropdown-subitem"><a href="/kafka/" class="nav-link">Kafka</a></li></ul></li><li class="dropdown-item"><h4>进阶服务</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/nginx/" class="nav-link">Nginx</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Spring生态" class="dropdown-title"><a href="/spring-ecology/" class="link-title">Spring生态</a> <span class="title" style="display:none;">Spring生态</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/spring/" class="nav-link">Spring</a></li><li class="dropdown-item"><!----> <a href="/spring-boot/" class="nav-link">Spring Boot</a></li><li class="dropdown-item"><!----> <a href="/spring-security/" class="nav-link">Spring Security</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发" class="dropdown-title"><a href="/dev-guide/" class="link-title">开发</a> <span class="title" style="display:none;">开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/design-pattern/" class="nav-link">设计模式</a></li><li class="dropdown-item"><!----> <a href="/algorithm/" class="nav-link">算法</a></li><li class="dropdown-item"><!----> <a href="/knowledge/" class="nav-link">知识</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><a href="/tool/" class="link-title">工具</a> <span class="title" style="display:none;">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>管理</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/maven/" class="nav-link">Maven</a></li><li class="dropdown-subitem"><a href="/git/" class="nav-link">Git</a></li></ul></li><li class="dropdown-item"><h4>部署</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/linux/" class="nav-link">Linux</a></li><li class="dropdown-subitem"><a href="/docker/" class="nav-link">Docker</a></li><li class="dropdown-subitem"><a href="/jenkins/" class="nav-link">Jenkins</a></li><li class="dropdown-subitem"><a href="/kubernetes/" class="nav-link">Kubernetes</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/front/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>进阶</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/typescript/" class="nav-link">TypeScript</a></li></ul></li><li class="dropdown-item"><h4>框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/react/" class="nav-link">React</a></li><li class="dropdown-subitem"><a href="/vue2/" class="nav-link">Vue2</a></li><li class="dropdown-subitem"><a href="/vue3/" class="nav-link">Vue3</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><!----> <span class="title" style="display:;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/whells-use/" class="nav-link">轮子工具</a></li><li class="dropdown-item"><!----> <a href="/projects/" class="nav-link">项目工程</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>本站</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-subitem"><a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-subitem"><a href="/archives/" class="nav-link">归档</a></li></ul></li><li class="dropdown-item"><h4>我的</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/whell/web/" class="nav-link">收藏</a></li><li class="dropdown-subitem"><a href="/about/website/introduce/" class="nav-link">关于</a></li><li class="dropdown-subitem"><a href="https://vue2-admin.youngkbt.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Vue2-Admin
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://vue3-admin.youngkbt.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Vue3-Admin（完善）
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div> <a href="https://github.com/Kele-Bingtang/pure-blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>关系数据库 - MySQL</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>关系数据库 - Oracle</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>缓存数据库 - Redis</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>搜索数据库 - ElasticSearch</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/es/introduce/" class="sidebar-link">ElasticSearch - 基础概念</a></li><li><a href="/es/install/" class="sidebar-link">ElasticSearch - 安装</a></li><li><a href="/es/simple-curd/" class="sidebar-link">ElasticSearch - 基本操作</a></li><li><a href="/es/hight-curd/" class="sidebar-link">ElasticSearch - 高级操作</a></li><li><a href="/es/java-curd/" class="sidebar-link">ElasticSearch - Java操作</a></li><li><a href="/es/boot-curd/" aria-current="page" class="active sidebar-link">ElasticSearch - 多框架集成</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/es/boot-curd/#spring-data框架集成" class="sidebar-link">Spring Data框架集成</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/es/boot-curd/#spring-data-elasticsearch介绍" class="sidebar-link">Spring Data Elasticsearch介绍</a></li><li class="sidebar-sub-header level3"><a href="/es/boot-curd/#spring-data-elasticsearch版本对比" class="sidebar-link">Spring Data Elasticsearch版本对比</a></li><li class="sidebar-sub-header level3"><a href="/es/boot-curd/#框架搭建" class="sidebar-link">框架搭建</a></li><li class="sidebar-sub-header level3"><a href="/es/boot-curd/#封装类测试" class="sidebar-link">封装类测试</a></li><li class="sidebar-sub-header level3"><a href="/es/boot-curd/#repository类原生测试" class="sidebar-link">Repository类原生测试</a></li><li class="sidebar-sub-header level3"><a href="/es/boot-curd/#repository类自定义测试" class="sidebar-link">Repository类自定义测试</a></li><li class="sidebar-sub-header level3"><a href="/es/boot-curd/#总结" class="sidebar-link">总结</a></li><li class="sidebar-sub-header level3"><a href="/es/boot-curd/#案例分析" class="sidebar-link">案例分析</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/es/boot-curd/#spring-boot框架集成" class="sidebar-link">Spring Boot框架集成</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/es/boot-curd/#spring-boot介绍" class="sidebar-link">Spring Boot介绍</a></li><li class="sidebar-sub-header level3"><a href="/es/boot-curd/#springboot的特点" class="sidebar-link">SpringBoot的特点</a></li><li class="sidebar-sub-header level3"><a href="/es/boot-curd/#data框架和boot框架集成区别" class="sidebar-link">Data框架和Boot框架集成区别</a></li><li class="sidebar-sub-header level3"><a href="/es/boot-curd/#框架搭建-2" class="sidebar-link">框架搭建</a></li><li class="sidebar-sub-header level3"><a href="/es/boot-curd/#连接测试" class="sidebar-link">连接测试</a></li><li class="sidebar-sub-header level3"><a href="/es/boot-curd/#索引测试" class="sidebar-link">索引测试</a></li><li class="sidebar-sub-header level3"><a href="/es/boot-curd/#文档测试" class="sidebar-link">文档测试</a></li><li class="sidebar-sub-header level3"><a href="/es/boot-curd/#高级查询测试" class="sidebar-link">高级查询测试</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/es/boot-curd/#spark-streaming框架集成" class="sidebar-link">Spark Streaming框架集成</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/es/boot-curd/#spark-streaming框架介绍" class="sidebar-link">Spark Streaming框架介绍</a></li><li class="sidebar-sub-header level3"><a href="/es/boot-curd/#框架搭建-3" class="sidebar-link">框架搭建</a></li><li class="sidebar-sub-header level3"><a href="/es/boot-curd/#功能实现" class="sidebar-link">功能实现</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/es/boot-curd/#flink框架集成" class="sidebar-link">Flink框架集成</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/es/boot-curd/#flink框架介绍" class="sidebar-link">Flink框架介绍</a></li><li class="sidebar-sub-header level3"><a href="/es/boot-curd/#框架搭建-4" class="sidebar-link">框架搭建</a></li><li class="sidebar-sub-header level3"><a href="/es/boot-curd/#功能实现-2" class="sidebar-link">功能实现</a></li></ul></li></ul></li><li><a href="/es/cluster/" class="sidebar-link">ElasticSearch - 搭建集群</a></li><li><a href="/es/high-concept/" class="sidebar-link">ElasticSearch - 进阶概念</a></li><li><a href="/es/distributed/" class="sidebar-link">ElasticSearch - 分布式集群和路由计算</a></li><li><a href="/es/shards-control/" class="sidebar-link">ElasticSearch - 分片控制流程</a></li><li><a href="/es/shards-principle/" class="sidebar-link">ElasticSearch - 分片操作原理</a></li><li><a href="/es/analysis/" class="sidebar-link">ElasticSearch - 多种分析器</a></li><li><a href="/es/handle/" class="sidebar-link">ElasticSearch - 冲突问题处理</a></li><li><a href="/es/optimization/" class="sidebar-link">ElasticSearch - 进阶优化</a></li><li><a href="/es/face-questions/" class="sidebar-link">ElasticSearch - 面试题</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>分布式数据库 - MongoDB</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/categories/?category=%E6%95%B0%E6%8D%AE%E5%BA%93" title="分类" data-v-06225672>数据库</a></li><li data-v-06225672><a href="/categories/?category=%E6%90%9C%E7%B4%A2%E6%95%B0%E6%8D%AE%E5%BA%93%20-%20ElasticSearch" title="分类" data-v-06225672>搜索数据库 - ElasticSearch</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://www.youngkbt.cn" target="_blank" title="作者" class="beLink" data-v-06225672>Young Kbt </a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2021-11-17</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">ElasticSearch - 多框架集成<!----></h1> <!----> <div class="theme-vdoing-content content__default"><p></p><div class="table-of-contents"><ul><li><a href="#spring-data框架集成">Spring Data框架集成</a><ul><li><a href="#spring-data-elasticsearch介绍">Spring Data Elasticsearch介绍</a></li><li><a href="#spring-data-elasticsearch版本对比">Spring Data Elasticsearch版本对比</a></li><li><a href="#框架搭建">框架搭建</a></li><li><a href="#封装类测试">封装类测试</a></li><li><a href="#repository类原生测试">Repository类原生测试</a></li><li><a href="#repository类自定义测试">Repository类自定义测试</a></li><li><a href="#总结">总结</a></li><li><a href="#案例分析">案例分析</a></li></ul></li><li><a href="#spring-boot框架集成">Spring Boot框架集成</a><ul><li><a href="#spring-boot介绍">Spring Boot介绍</a></li><li><a href="#springboot的特点">SpringBoot的特点</a></li><li><a href="#data框架和boot框架集成区别">Data框架和Boot框架集成区别</a></li><li><a href="#框架搭建">框架搭建</a></li><li><a href="#连接测试">连接测试</a></li><li><a href="#索引测试">索引测试</a></li><li><a href="#文档测试">文档测试</a></li><li><a href="#高级查询测试">高级查询测试</a></li></ul></li><li><a href="#spark-streaming框架集成">Spark Streaming框架集成</a><ul><li><a href="#spark-streaming框架介绍">Spark Streaming框架介绍</a></li><li><a href="#框架搭建">框架搭建</a></li><li><a href="#功能实现">功能实现</a></li></ul></li><li><a href="#flink框架集成">Flink框架集成</a><ul><li><a href="#flink框架介绍">Flink框架介绍</a></li><li><a href="#框架搭建">框架搭建</a></li><li><a href="#功能实现">功能实现</a></li></ul></li></ul></div><p></p> <h2 id="spring-data框架集成"><a href="#spring-data框架集成" class="header-anchor">#</a> Spring Data框架集成</h2> <p>Spring Data 是一个用于简化数据库、非关系型数据库、索引库访问，并支持云服务的开源框架。其主要目标是使得对数据的访问变得方便快捷，并支持 map-reduce 框架和云计 算数据服务。Spring Data 可以极大的简化 JPA（Elasticsearch ......）的写法，可以在几乎不用写实现的情况下，实现对数据的访问和操作。除了 CRUD 外，还包括如分页、排序等一些常用的功能。</p> <p>Spring Data 的官网：<a href="https://spring.io/projects/spring-data" target="_blank" rel="noopener noreferrer">https://spring.io/projects/spring-data<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/ElasticSearch/20211117215542.png" alt="image-20211117215043708"></p> <p>Spring Data 常用的功能模块如下：</p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/ElasticSearch/20211117215239.png" alt="image-20211117215238730"></p> <h3 id="spring-data-elasticsearch介绍"><a href="#spring-data-elasticsearch介绍" class="header-anchor">#</a> Spring Data Elasticsearch介绍</h3> <p>Spring Data Elasticsearch 基于 spring data API 简化 Elasticsearch 操作，将原始操作 Elasticsearch 的客户端 API 进行封装。Spring Data 为 Elasticsearch 项目提供集成搜索引擎。Spring Data Elasticsearch POJO 的关键功能区域为中心的模型与 Elastichsearch 交互文档和轻松地编写一个存储索引库数据访问层。</p> <p>官方网站: <a href="https://spring.io/projects/spring-data-elasticsearch" target="_blank" rel="noopener noreferrer">https://spring.io/projects/spring-data-elasticsearch<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/ElasticSearch/20211117215504.png" alt="image-20211117215503729"></p> <h3 id="spring-data-elasticsearch版本对比"><a href="#spring-data-elasticsearch版本对比" class="header-anchor">#</a> Spring Data Elasticsearch版本对比</h3> <p>选择兼容的版本非常重要，我经常因为版本冲突而花费了大量时间调试。</p> <p>版本对比以官网为主，查看地址：<a href="https://docs.spring.io/spring-data/elasticsearch/docs/4.3.0/reference/html/#preface.requirements" target="_blank" rel="noopener noreferrer">https://docs.spring.io/spring-data/elasticsearch/docs/4.3.0/reference/html/#preface.requirements<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/ElasticSearch/20211117215809.png" alt="image-20211117215743063"></p> <p>我的 Elasticsearch 版本是 7.15.2，所以所有版本选择如下：</p> <p><img src="https://img.shields.io/badge/Elasticsearch-7.15.2-green" alt=""></p> <p><img src="https://img.shields.io/badge/Spring%20Data%20ES-4.3.0-red" alt=""></p> <p><img src="https://img.shields.io/badge/Spring%20Boot-2.5.5-blue" alt=""></p> <h3 id="框架搭建"><a href="#框架搭建" class="header-anchor">#</a> 框架搭建</h3> <ul><li><p>创建一个 Maven 项目</p></li> <li><p>修改 pom.xml 文件，添加依赖</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code> <span class="token comment">&lt;!-- Spring Boot --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.5.5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>relativePath</span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- Spring data ES 依赖 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-elasticsearch<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>因为利用 Test 进行测试，所以不需要加入 Web 等依赖，请根据需求自行添加。</p></li> <li><p>添加配置文件，在 resources 目录中增加 application.yml 文件</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>spring:
  application:
    name: es-service
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="custom-block note"><p class="custom-block-title">注意</p> <p>新版的 ip 地址和端口号可以在「配置类」里进行配置，无需在配置文件进行配置</p> <div class="custom-block right"><p>2021-11-17 @Young Kbt</p></div></div> <p>旧版的配置文件：</p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> es<span class="token punctuation">-</span>service
  <span class="token key atrule">data</span><span class="token punctuation">:</span>
    <span class="token key atrule">elasticsearch</span><span class="token punctuation">:</span>
      <span class="token key atrule">cluster-nodes</span><span class="token punctuation">:</span> 127.0.0.1<span class="token punctuation">:</span><span class="token number">9200</span>  <span class="token comment"># ES 服务器位置</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p>Spring Boot 启动类</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kbt</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author Young Kbt
 * @date 2021/11/17 17:24
 * @description 启动类
 */</span>
<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EsApplication</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">EsApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div></li> <li><p>添加 ES 配置类，进行地址和端口的配置</p> <div class="theme-code-group" data-v-2f5f1757><div class="theme-code-group__nav" data-v-2f5f1757><ul class="theme-code-group__ul" data-v-2f5f1757></ul></div> <div class="theme-code-block theme-code-block__active" data-v-4f1e9d0c><div class="language-java line-numbers-mode" data-v-4f1e9d0c><pre class="language-java" data-v-4f1e9d0c><code data-v-4f1e9d0c><span class="token keyword" data-v-4f1e9d0c>package</span> <span class="token namespace" data-v-4f1e9d0c>com<span class="token punctuation" data-v-4f1e9d0c>.</span>kbt<span class="token punctuation" data-v-4f1e9d0c>.</span>config</span><span class="token punctuation" data-v-4f1e9d0c>;</span>

<span class="token keyword" data-v-4f1e9d0c>import</span> <span class="token import" data-v-4f1e9d0c><span class="token namespace" data-v-4f1e9d0c>org<span class="token punctuation" data-v-4f1e9d0c>.</span>apache<span class="token punctuation" data-v-4f1e9d0c>.</span>http<span class="token punctuation" data-v-4f1e9d0c>.</span></span><span class="token class-name" data-v-4f1e9d0c>HttpHost</span></span><span class="token punctuation" data-v-4f1e9d0c>;</span>
<span class="token keyword" data-v-4f1e9d0c>import</span> <span class="token import" data-v-4f1e9d0c><span class="token namespace" data-v-4f1e9d0c>org<span class="token punctuation" data-v-4f1e9d0c>.</span>elasticsearch<span class="token punctuation" data-v-4f1e9d0c>.</span>client<span class="token punctuation" data-v-4f1e9d0c>.</span></span><span class="token class-name" data-v-4f1e9d0c>RestClient</span></span><span class="token punctuation" data-v-4f1e9d0c>;</span>
<span class="token keyword" data-v-4f1e9d0c>import</span> <span class="token import" data-v-4f1e9d0c><span class="token namespace" data-v-4f1e9d0c>org<span class="token punctuation" data-v-4f1e9d0c>.</span>elasticsearch<span class="token punctuation" data-v-4f1e9d0c>.</span>client<span class="token punctuation" data-v-4f1e9d0c>.</span></span><span class="token class-name" data-v-4f1e9d0c>RestClientBuilder</span></span><span class="token punctuation" data-v-4f1e9d0c>;</span>
<span class="token keyword" data-v-4f1e9d0c>import</span> <span class="token import" data-v-4f1e9d0c><span class="token namespace" data-v-4f1e9d0c>org<span class="token punctuation" data-v-4f1e9d0c>.</span>elasticsearch<span class="token punctuation" data-v-4f1e9d0c>.</span>client<span class="token punctuation" data-v-4f1e9d0c>.</span></span><span class="token class-name" data-v-4f1e9d0c>RestHighLevelClient</span></span><span class="token punctuation" data-v-4f1e9d0c>;</span>
<span class="token keyword" data-v-4f1e9d0c>import</span> <span class="token import" data-v-4f1e9d0c><span class="token namespace" data-v-4f1e9d0c>org<span class="token punctuation" data-v-4f1e9d0c>.</span>springframework<span class="token punctuation" data-v-4f1e9d0c>.</span>context<span class="token punctuation" data-v-4f1e9d0c>.</span>annotation<span class="token punctuation" data-v-4f1e9d0c>.</span></span><span class="token class-name" data-v-4f1e9d0c>Bean</span></span><span class="token punctuation" data-v-4f1e9d0c>;</span>
<span class="token keyword" data-v-4f1e9d0c>import</span> <span class="token import" data-v-4f1e9d0c><span class="token namespace" data-v-4f1e9d0c>org<span class="token punctuation" data-v-4f1e9d0c>.</span>springframework<span class="token punctuation" data-v-4f1e9d0c>.</span>context<span class="token punctuation" data-v-4f1e9d0c>.</span>annotation<span class="token punctuation" data-v-4f1e9d0c>.</span></span><span class="token class-name" data-v-4f1e9d0c>Configuration</span></span><span class="token punctuation" data-v-4f1e9d0c>;</span>
<span class="token keyword" data-v-4f1e9d0c>import</span> <span class="token import" data-v-4f1e9d0c><span class="token namespace" data-v-4f1e9d0c>org<span class="token punctuation" data-v-4f1e9d0c>.</span>springframework<span class="token punctuation" data-v-4f1e9d0c>.</span>data<span class="token punctuation" data-v-4f1e9d0c>.</span>elasticsearch<span class="token punctuation" data-v-4f1e9d0c>.</span>config<span class="token punctuation" data-v-4f1e9d0c>.</span></span><span class="token class-name" data-v-4f1e9d0c>AbstractElasticsearchConfiguration</span></span><span class="token punctuation" data-v-4f1e9d0c>;</span>

<span class="token comment" data-v-4f1e9d0c>/**
   * @author Young Kbt
   * @date 2021/11/17 17:25
   * @description ElasticSearch 配置类
   */</span>
<span class="token annotation punctuation" data-v-4f1e9d0c>@Configuration</span>
<span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>class</span> <span class="token class-name" data-v-4f1e9d0c>ElasticSearchConfig</span> <span class="token keyword" data-v-4f1e9d0c>extends</span> <span class="token class-name" data-v-4f1e9d0c>AbstractElasticsearchConfiguration</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>

    <span class="token annotation punctuation" data-v-4f1e9d0c>@Override</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Bean</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token class-name" data-v-4f1e9d0c>RestHighLevelClient</span> <span class="token function" data-v-4f1e9d0c>elasticsearchClient</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>

        <span class="token class-name" data-v-4f1e9d0c>RestClientBuilder</span> builder <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token class-name" data-v-4f1e9d0c>RestClient</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>builder</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>HttpHost</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;127.0.0.1&quot;</span><span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token number" data-v-4f1e9d0c>9200</span><span class="token punctuation" data-v-4f1e9d0c>,</span><span class="token string" data-v-4f1e9d0c>&quot;http&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token keyword" data-v-4f1e9d0c>return</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>RestHighLevelClient</span><span class="token punctuation" data-v-4f1e9d0c>(</span>builder<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>

        <span class="token comment" data-v-4f1e9d0c>// 如果集群有多个地址</span>
        <span class="token comment" data-v-4f1e9d0c>// HttpHost[] httpHosts = new HttpHost[]{</span>
        <span class="token comment" data-v-4f1e9d0c>//        new HttpHost(&quot;127.2.0.1&quot;, 9200,&quot;http&quot;),</span>
        <span class="token comment" data-v-4f1e9d0c>//        new HttpHost(&quot;127.2.0.2&quot;, 9200,&quot;http&quot;),</span>
        <span class="token comment" data-v-4f1e9d0c>//        new HttpHost(&quot;127.2.0.3&quot;, 9200,&quot;http&quot;)};</span>
        <span class="token comment" data-v-4f1e9d0c>// RestClientBuilder builder = RestClient.builder(httpHosts);</span>
        <span class="token comment" data-v-4f1e9d0c>// return new RestHighLevelClient(builder);</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
<span class="token punctuation" data-v-4f1e9d0c>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>1</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>2</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>3</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>4</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>5</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>6</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>7</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>8</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>9</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>10</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>11</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>12</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>13</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>14</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>15</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>16</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>17</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>18</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>19</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>20</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>21</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>22</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>23</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>24</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>25</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>26</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>27</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>28</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>29</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>30</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>31</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>32</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>33</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>34</span><br data-v-4f1e9d0c></div></div></div> <div class="theme-code-block" data-v-4f1e9d0c><div class="language-java line-numbers-mode" data-v-4f1e9d0c><pre class="language-java" data-v-4f1e9d0c><code data-v-4f1e9d0c><span class="token keyword" data-v-4f1e9d0c>package</span> <span class="token namespace" data-v-4f1e9d0c>com<span class="token punctuation" data-v-4f1e9d0c>.</span>kbt<span class="token punctuation" data-v-4f1e9d0c>.</span>config</span><span class="token punctuation" data-v-4f1e9d0c>;</span>

<span class="token keyword" data-v-4f1e9d0c>import</span> <span class="token import" data-v-4f1e9d0c><span class="token namespace" data-v-4f1e9d0c>org<span class="token punctuation" data-v-4f1e9d0c>.</span>apache<span class="token punctuation" data-v-4f1e9d0c>.</span>http<span class="token punctuation" data-v-4f1e9d0c>.</span></span><span class="token class-name" data-v-4f1e9d0c>HttpHost</span></span><span class="token punctuation" data-v-4f1e9d0c>;</span>
<span class="token keyword" data-v-4f1e9d0c>import</span> <span class="token import" data-v-4f1e9d0c><span class="token namespace" data-v-4f1e9d0c>org<span class="token punctuation" data-v-4f1e9d0c>.</span>elasticsearch<span class="token punctuation" data-v-4f1e9d0c>.</span>client<span class="token punctuation" data-v-4f1e9d0c>.</span></span><span class="token class-name" data-v-4f1e9d0c>RestClient</span></span><span class="token punctuation" data-v-4f1e9d0c>;</span>
<span class="token keyword" data-v-4f1e9d0c>import</span> <span class="token import" data-v-4f1e9d0c><span class="token namespace" data-v-4f1e9d0c>org<span class="token punctuation" data-v-4f1e9d0c>.</span>elasticsearch<span class="token punctuation" data-v-4f1e9d0c>.</span>client<span class="token punctuation" data-v-4f1e9d0c>.</span></span><span class="token class-name" data-v-4f1e9d0c>RestClientBuilder</span></span><span class="token punctuation" data-v-4f1e9d0c>;</span>
<span class="token keyword" data-v-4f1e9d0c>import</span> <span class="token import" data-v-4f1e9d0c><span class="token namespace" data-v-4f1e9d0c>org<span class="token punctuation" data-v-4f1e9d0c>.</span>elasticsearch<span class="token punctuation" data-v-4f1e9d0c>.</span>client<span class="token punctuation" data-v-4f1e9d0c>.</span></span><span class="token class-name" data-v-4f1e9d0c>RestHighLevelClient</span></span><span class="token punctuation" data-v-4f1e9d0c>;</span>
<span class="token keyword" data-v-4f1e9d0c>import</span> <span class="token import" data-v-4f1e9d0c><span class="token namespace" data-v-4f1e9d0c>org<span class="token punctuation" data-v-4f1e9d0c>.</span>springframework<span class="token punctuation" data-v-4f1e9d0c>.</span>context<span class="token punctuation" data-v-4f1e9d0c>.</span>annotation<span class="token punctuation" data-v-4f1e9d0c>.</span></span><span class="token class-name" data-v-4f1e9d0c>Bean</span></span><span class="token punctuation" data-v-4f1e9d0c>;</span>
<span class="token keyword" data-v-4f1e9d0c>import</span> <span class="token import" data-v-4f1e9d0c><span class="token namespace" data-v-4f1e9d0c>org<span class="token punctuation" data-v-4f1e9d0c>.</span>springframework<span class="token punctuation" data-v-4f1e9d0c>.</span>context<span class="token punctuation" data-v-4f1e9d0c>.</span>annotation<span class="token punctuation" data-v-4f1e9d0c>.</span></span><span class="token class-name" data-v-4f1e9d0c>Configuration</span></span><span class="token punctuation" data-v-4f1e9d0c>;</span>
<span class="token keyword" data-v-4f1e9d0c>import</span> <span class="token import" data-v-4f1e9d0c><span class="token namespace" data-v-4f1e9d0c>org<span class="token punctuation" data-v-4f1e9d0c>.</span>springframework<span class="token punctuation" data-v-4f1e9d0c>.</span>data<span class="token punctuation" data-v-4f1e9d0c>.</span>elasticsearch<span class="token punctuation" data-v-4f1e9d0c>.</span>config<span class="token punctuation" data-v-4f1e9d0c>.</span></span><span class="token class-name" data-v-4f1e9d0c>AbstractElasticsearchConfiguration</span></span><span class="token punctuation" data-v-4f1e9d0c>;</span>

<span class="token comment" data-v-4f1e9d0c>/**
   * @author Young Kbt
   * @date 2021/11/17 17:25
   * @description ElasticSearch 配置类，来源官网
   */</span>
<span class="token annotation punctuation" data-v-4f1e9d0c>@Configuration</span>
<span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>class</span> <span class="token class-name" data-v-4f1e9d0c>ElasticSearchConfig</span> <span class="token keyword" data-v-4f1e9d0c>extends</span> <span class="token class-name" data-v-4f1e9d0c>AbstractElasticsearchConfiguration</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>

    <span class="token annotation punctuation" data-v-4f1e9d0c>@Override</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Bean</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token class-name" data-v-4f1e9d0c>RestHighLevelClient</span> <span class="token function" data-v-4f1e9d0c>elasticsearchClient</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>

        <span class="token keyword" data-v-4f1e9d0c>final</span> <span class="token class-name" data-v-4f1e9d0c>ClientConfiguration</span> clientConfiguration <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token class-name" data-v-4f1e9d0c>ClientConfiguration</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>builder</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span>
            <span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>connectedTo</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;localhost:9200&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span>  <span class="token comment" data-v-4f1e9d0c>// 多个地址用逗号隔开</span>
            <span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>build</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>

        <span class="token keyword" data-v-4f1e9d0c>return</span> <span class="token class-name" data-v-4f1e9d0c>RestClients</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>create</span><span class="token punctuation" data-v-4f1e9d0c>(</span>clientConfiguration<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>rest</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
<span class="token punctuation" data-v-4f1e9d0c>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>1</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>2</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>3</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>4</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>5</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>6</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>7</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>8</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>9</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>10</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>11</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>12</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>13</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>14</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>15</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>16</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>17</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>18</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>19</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>20</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>21</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>22</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>23</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>24</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>25</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>26</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>27</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>28</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>29</span><br data-v-4f1e9d0c></div></div></div> <pre class="pre-blank" data-v-2f5f1757>// Make sure to add code blocks to your code group</pre></div> <p>我这个版本使用最新模板，启动失败，会报错，只能使用原始模板，建议能用最新模板就用它，因为这是官方推荐。</p></li> <li><p>实体类</p> <p>Spring Data ES支持两种实体映射方案：</p> <ul><li>Jackson Object Mapping</li> <li>Meta Model Object Mapping</li></ul> <p>早期的版本默认使用的是 jackson 的方案，但是在 <code>4.x</code> 之后 Meta Model 就上位了，而前者已经不再被支持。所以这里使用第二种方案。我们先定义一个实体类，并通过注解来表明它跟 ES 实体之间的映射关系。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kbt<span class="token punctuation">.</span>pojo</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Id</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Document</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Field</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">FieldType</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Setting</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author Young Kbt
 * @date 2021/11/17 17:26
 * @description 商品实体类
 */</span>
<span class="token annotation punctuation">@Document</span><span class="token punctuation">(</span>indexName <span class="token operator">=</span> <span class="token string">&quot;shopping&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Setting</span><span class="token punctuation">(</span>shards <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span> replicas <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Product</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Id</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span> <span class="token comment">// 商品唯一标识</span>
    <span class="token comment">/**
     * type: 字段数据类型
     * analyzer: 分词器类型
     * index: 是否索引(默认:true)
     * Keyword: 短语,不进行分词
     */</span>
    <span class="token annotation punctuation">@Field</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;title&quot;</span><span class="token punctuation">,</span>type <span class="token operator">=</span> <span class="token class-name">FieldType<span class="token punctuation">.</span>Text</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> title<span class="token punctuation">;</span> <span class="token comment">// 商品名称</span>
    <span class="token annotation punctuation">@Field</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FieldType<span class="token punctuation">.</span>Keyword</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> category<span class="token punctuation">;</span> <span class="token comment">// 分类名称</span>
    <span class="token annotation punctuation">@Field</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FieldType<span class="token punctuation">.</span>Double</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Double</span> price<span class="token punctuation">;</span> <span class="token comment">// 商品价格</span>
    <span class="token annotation punctuation">@Field</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FieldType<span class="token punctuation">.</span>Keyword</span><span class="token punctuation">,</span> index <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> images<span class="token punctuation">;</span> <span class="token comment">// 图片地址</span>
    
    <span class="token keyword">public</span> <span class="token class-name">Product</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// set </span>
    <span class="token comment">// get </span>
    <span class="token comment">// toString</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><p>索引叫做 <code>shopping</code>。</p> <p>请加入 Set 和 Get 和 toString 方法，toString 方法是为了测试期间直接打印在控制台。</p> <blockquote><p><strong>类注解：@Document 是文档注解，@Setting 是 ES 配置注解</strong></p></blockquote> <table><thead><tr><th>注解</th> <th>Elasticsearch 映射中的格式字符串</th></tr></thead> <tbody><tr><td>indexName</td> <td>索引名称</td></tr> <tr><td>type</td> <td>索引类型</td></tr> <tr><td>shards</td> <td>分片的数量，默认为 1</td></tr> <tr><td>replicas</td> <td>副本的数量，默认为 1</td></tr> <tr><td>refreshInterval</td> <td>刷新间隔，默认为 1 s</td></tr> <tr><td>indexStoreType</td> <td>索引文件存储类型，默认为 fs</td></tr></tbody></table> <blockquote><p><strong>属性注解：@Field 用来指定属性的类型</strong></p></blockquote> <table><thead><tr><th>注解</th> <th>Elasticsearch 映射中的格式字符串</th></tr></thead> <tbody><tr><td>analyzer</td> <td>指定分词器，Es 中默认使用的标准分词器，比如我们需要指定中文 IK 分词器，可以指定值为 ik_max_word</td></tr> <tr><td>name</td> <td>字段名称，可以在 ES 文档中表示，若未设置，则使用 Java 字段名称。</td></tr> <tr><td>index</td> <td>指定该词是否需要索引，默认为 true</td></tr> <tr><td>type</td> <td>指定该属性在 ES 中的类型，其中的值是 FileType 类型的值，比如 FileType.Text 类型对应 ES 中的 text 类型</td></tr> <tr><td>store</td> <td>指定该属性内容是否存储在 ES，默认为 false</td></tr> <tr><td>fielddata</td> <td>指定该属性能否进行排序，因为 ES 中的 text 类型是不能进行排序（已经分词了）</td></tr> <tr><td>searchAnalyzer</td> <td>指定搜索使用的分词器</td></tr></tbody></table> <blockquote><p><strong>日期格式映射</strong></p></blockquote> <table><thead><tr><th>注解</th> <th>Elasticsearch 映射中的格式字符串</th></tr></thead> <tbody><tr><td>@Field(type=FieldType.Date)</td> <td>date_optional_timeepoch_millis</td></tr> <tr><td>@Field(type=FieldType.Date, format=DateFormat.basic_date)</td> <td>基本日期</td></tr> <tr><td>@Field(type=FieldType.Date, format={DateFormat.basic_date, DateFormat.basic_time})</td> <td>基本日期 || 基本时间</td></tr> <tr><td>@Field(type=FieldType.Date, pattern=&quot;dd.MM.uuuu&quot;)</td> <td>date_optional_time || epoch_millis || dd.MM.uuu</td></tr> <tr><td>@Field(type=FieldType.Date, format={}, pattern=&quot;dd.MM.uuuu&quot;)</td> <td>dd.MM.uuuu</td></tr></tbody></table></li></ul> <h3 id="封装类测试"><a href="#封装类测试" class="header-anchor">#</a> 封装类测试</h3> <p>这里先演示使用 ES 封装类进行测试，比较复杂，后面还有更加简单的<a href="#repository%E7%B1%BB%E5%8E%9F%E7%94%9F%E6%B5%8B%E8%AF%95">Repository类原生测试</a></p> <p>Spring Data Elasticsearch 中，可以使用 SearchOperations 工具执行一些更复杂的查询，这些查询操作接收一个 Query 对象封装的查询操作。</p> <p>Spring Data Elasticsearch 中的 Query 有三种：</p> <ul><li>CriteriaQuery</li> <li>StringQuery</li> <li>NativeSearchQuery</li></ul> <p>NativeSearchQuery 可以满足我们的查询，如果是字段查询或者范围查询，需要用到 CriteriaQuery。</p> <p><mark>插入数据时，如果索引不存在，自动会创建索引</mark></p> <div class="theme-code-group" data-v-2f5f1757><div class="theme-code-group__nav" data-v-2f5f1757><ul class="theme-code-group__ul" data-v-2f5f1757></ul></div> <div class="theme-code-block theme-code-block__active" data-v-4f1e9d0c><div class="language-java line-numbers-mode" data-v-4f1e9d0c><pre class="language-java" data-v-4f1e9d0c><code data-v-4f1e9d0c><span class="token keyword" data-v-4f1e9d0c>package</span> <span class="token namespace" data-v-4f1e9d0c>com<span class="token punctuation" data-v-4f1e9d0c>.</span>kbt</span><span class="token punctuation" data-v-4f1e9d0c>;</span>

<span class="token keyword" data-v-4f1e9d0c>import</span> <span class="token import" data-v-4f1e9d0c><span class="token namespace" data-v-4f1e9d0c>com<span class="token punctuation" data-v-4f1e9d0c>.</span>kbt<span class="token punctuation" data-v-4f1e9d0c>.</span>pojo<span class="token punctuation" data-v-4f1e9d0c>.</span></span><span class="token class-name" data-v-4f1e9d0c>Product</span></span><span class="token punctuation" data-v-4f1e9d0c>;</span>
<span class="token keyword" data-v-4f1e9d0c>import</span> <span class="token import" data-v-4f1e9d0c><span class="token namespace" data-v-4f1e9d0c>org<span class="token punctuation" data-v-4f1e9d0c>.</span>elasticsearch<span class="token punctuation" data-v-4f1e9d0c>.</span>index<span class="token punctuation" data-v-4f1e9d0c>.</span>query<span class="token punctuation" data-v-4f1e9d0c>.</span></span><span class="token class-name" data-v-4f1e9d0c>MatchAllQueryBuilder</span></span><span class="token punctuation" data-v-4f1e9d0c>;</span>
<span class="token keyword" data-v-4f1e9d0c>import</span> <span class="token import" data-v-4f1e9d0c><span class="token namespace" data-v-4f1e9d0c>org<span class="token punctuation" data-v-4f1e9d0c>.</span>elasticsearch<span class="token punctuation" data-v-4f1e9d0c>.</span>index<span class="token punctuation" data-v-4f1e9d0c>.</span>query<span class="token punctuation" data-v-4f1e9d0c>.</span></span><span class="token class-name" data-v-4f1e9d0c>TermQueryBuilder</span></span><span class="token punctuation" data-v-4f1e9d0c>;</span>
<span class="token keyword" data-v-4f1e9d0c>import</span> <span class="token import" data-v-4f1e9d0c><span class="token namespace" data-v-4f1e9d0c>org<span class="token punctuation" data-v-4f1e9d0c>.</span>elasticsearch<span class="token punctuation" data-v-4f1e9d0c>.</span>search<span class="token punctuation" data-v-4f1e9d0c>.</span>fetch<span class="token punctuation" data-v-4f1e9d0c>.</span>subphase<span class="token punctuation" data-v-4f1e9d0c>.</span>highlight<span class="token punctuation" data-v-4f1e9d0c>.</span></span><span class="token class-name" data-v-4f1e9d0c>HighlightBuilder</span></span><span class="token punctuation" data-v-4f1e9d0c>;</span>
<span class="token keyword" data-v-4f1e9d0c>import</span> <span class="token import" data-v-4f1e9d0c><span class="token namespace" data-v-4f1e9d0c>org<span class="token punctuation" data-v-4f1e9d0c>.</span>junit<span class="token punctuation" data-v-4f1e9d0c>.</span>jupiter<span class="token punctuation" data-v-4f1e9d0c>.</span>api<span class="token punctuation" data-v-4f1e9d0c>.</span></span><span class="token class-name" data-v-4f1e9d0c>Test</span></span><span class="token punctuation" data-v-4f1e9d0c>;</span>
<span class="token keyword" data-v-4f1e9d0c>import</span> <span class="token import" data-v-4f1e9d0c><span class="token namespace" data-v-4f1e9d0c>org<span class="token punctuation" data-v-4f1e9d0c>.</span>springframework<span class="token punctuation" data-v-4f1e9d0c>.</span>beans<span class="token punctuation" data-v-4f1e9d0c>.</span>factory<span class="token punctuation" data-v-4f1e9d0c>.</span>annotation<span class="token punctuation" data-v-4f1e9d0c>.</span></span><span class="token class-name" data-v-4f1e9d0c>Autowired</span></span><span class="token punctuation" data-v-4f1e9d0c>;</span>
<span class="token keyword" data-v-4f1e9d0c>import</span> <span class="token import" data-v-4f1e9d0c><span class="token namespace" data-v-4f1e9d0c>org<span class="token punctuation" data-v-4f1e9d0c>.</span>springframework<span class="token punctuation" data-v-4f1e9d0c>.</span>boot<span class="token punctuation" data-v-4f1e9d0c>.</span>test<span class="token punctuation" data-v-4f1e9d0c>.</span>context<span class="token punctuation" data-v-4f1e9d0c>.</span></span><span class="token class-name" data-v-4f1e9d0c>SpringBootTest</span></span><span class="token punctuation" data-v-4f1e9d0c>;</span>
<span class="token keyword" data-v-4f1e9d0c>import</span> <span class="token import" data-v-4f1e9d0c><span class="token namespace" data-v-4f1e9d0c>org<span class="token punctuation" data-v-4f1e9d0c>.</span>springframework<span class="token punctuation" data-v-4f1e9d0c>.</span>data<span class="token punctuation" data-v-4f1e9d0c>.</span>domain<span class="token punctuation" data-v-4f1e9d0c>.</span></span><span class="token class-name" data-v-4f1e9d0c>PageRequest</span></span><span class="token punctuation" data-v-4f1e9d0c>;</span>
<span class="token keyword" data-v-4f1e9d0c>import</span> <span class="token import" data-v-4f1e9d0c><span class="token namespace" data-v-4f1e9d0c>org<span class="token punctuation" data-v-4f1e9d0c>.</span>springframework<span class="token punctuation" data-v-4f1e9d0c>.</span>data<span class="token punctuation" data-v-4f1e9d0c>.</span>domain<span class="token punctuation" data-v-4f1e9d0c>.</span></span><span class="token class-name" data-v-4f1e9d0c>Sort</span></span><span class="token punctuation" data-v-4f1e9d0c>;</span>
<span class="token keyword" data-v-4f1e9d0c>import</span> <span class="token import" data-v-4f1e9d0c><span class="token namespace" data-v-4f1e9d0c>org<span class="token punctuation" data-v-4f1e9d0c>.</span>springframework<span class="token punctuation" data-v-4f1e9d0c>.</span>data<span class="token punctuation" data-v-4f1e9d0c>.</span>elasticsearch<span class="token punctuation" data-v-4f1e9d0c>.</span>core<span class="token punctuation" data-v-4f1e9d0c>.</span></span><span class="token class-name" data-v-4f1e9d0c>ElasticsearchOperations</span></span><span class="token punctuation" data-v-4f1e9d0c>;</span>
<span class="token keyword" data-v-4f1e9d0c>import</span> <span class="token import" data-v-4f1e9d0c><span class="token namespace" data-v-4f1e9d0c>org<span class="token punctuation" data-v-4f1e9d0c>.</span>springframework<span class="token punctuation" data-v-4f1e9d0c>.</span>data<span class="token punctuation" data-v-4f1e9d0c>.</span>elasticsearch<span class="token punctuation" data-v-4f1e9d0c>.</span>core<span class="token punctuation" data-v-4f1e9d0c>.</span></span><span class="token class-name" data-v-4f1e9d0c>SearchHit</span></span><span class="token punctuation" data-v-4f1e9d0c>;</span>
<span class="token keyword" data-v-4f1e9d0c>import</span> <span class="token import" data-v-4f1e9d0c><span class="token namespace" data-v-4f1e9d0c>org<span class="token punctuation" data-v-4f1e9d0c>.</span>springframework<span class="token punctuation" data-v-4f1e9d0c>.</span>data<span class="token punctuation" data-v-4f1e9d0c>.</span>elasticsearch<span class="token punctuation" data-v-4f1e9d0c>.</span>core<span class="token punctuation" data-v-4f1e9d0c>.</span></span><span class="token class-name" data-v-4f1e9d0c>SearchHits</span></span><span class="token punctuation" data-v-4f1e9d0c>;</span>
<span class="token keyword" data-v-4f1e9d0c>import</span> <span class="token import" data-v-4f1e9d0c><span class="token namespace" data-v-4f1e9d0c>org<span class="token punctuation" data-v-4f1e9d0c>.</span>springframework<span class="token punctuation" data-v-4f1e9d0c>.</span>data<span class="token punctuation" data-v-4f1e9d0c>.</span>elasticsearch<span class="token punctuation" data-v-4f1e9d0c>.</span>core<span class="token punctuation" data-v-4f1e9d0c>.</span></span><span class="token class-name" data-v-4f1e9d0c>SearchOperations</span></span><span class="token punctuation" data-v-4f1e9d0c>;</span>
<span class="token keyword" data-v-4f1e9d0c>import</span> <span class="token import" data-v-4f1e9d0c><span class="token namespace" data-v-4f1e9d0c>org<span class="token punctuation" data-v-4f1e9d0c>.</span>springframework<span class="token punctuation" data-v-4f1e9d0c>.</span>data<span class="token punctuation" data-v-4f1e9d0c>.</span>elasticsearch<span class="token punctuation" data-v-4f1e9d0c>.</span>core<span class="token punctuation" data-v-4f1e9d0c>.</span>mapping<span class="token punctuation" data-v-4f1e9d0c>.</span></span><span class="token class-name" data-v-4f1e9d0c>IndexCoordinates</span></span><span class="token punctuation" data-v-4f1e9d0c>;</span>
<span class="token keyword" data-v-4f1e9d0c>import</span> <span class="token import" data-v-4f1e9d0c><span class="token namespace" data-v-4f1e9d0c>org<span class="token punctuation" data-v-4f1e9d0c>.</span>springframework<span class="token punctuation" data-v-4f1e9d0c>.</span>data<span class="token punctuation" data-v-4f1e9d0c>.</span>elasticsearch<span class="token punctuation" data-v-4f1e9d0c>.</span>core<span class="token punctuation" data-v-4f1e9d0c>.</span>query<span class="token punctuation" data-v-4f1e9d0c>.</span></span><span class="token class-name" data-v-4f1e9d0c>IndexQuery</span></span><span class="token punctuation" data-v-4f1e9d0c>;</span>
<span class="token keyword" data-v-4f1e9d0c>import</span> <span class="token import" data-v-4f1e9d0c><span class="token namespace" data-v-4f1e9d0c>org<span class="token punctuation" data-v-4f1e9d0c>.</span>springframework<span class="token punctuation" data-v-4f1e9d0c>.</span>data<span class="token punctuation" data-v-4f1e9d0c>.</span>elasticsearch<span class="token punctuation" data-v-4f1e9d0c>.</span>core<span class="token punctuation" data-v-4f1e9d0c>.</span>query<span class="token punctuation" data-v-4f1e9d0c>.</span></span><span class="token class-name" data-v-4f1e9d0c>IndexQueryBuilder</span></span><span class="token punctuation" data-v-4f1e9d0c>;</span>
<span class="token keyword" data-v-4f1e9d0c>import</span> <span class="token import" data-v-4f1e9d0c><span class="token namespace" data-v-4f1e9d0c>org<span class="token punctuation" data-v-4f1e9d0c>.</span>springframework<span class="token punctuation" data-v-4f1e9d0c>.</span>data<span class="token punctuation" data-v-4f1e9d0c>.</span>elasticsearch<span class="token punctuation" data-v-4f1e9d0c>.</span>core<span class="token punctuation" data-v-4f1e9d0c>.</span>query<span class="token punctuation" data-v-4f1e9d0c>.</span></span><span class="token class-name" data-v-4f1e9d0c>NativeSearchQuery</span></span><span class="token punctuation" data-v-4f1e9d0c>;</span>
<span class="token keyword" data-v-4f1e9d0c>import</span> <span class="token import" data-v-4f1e9d0c><span class="token namespace" data-v-4f1e9d0c>org<span class="token punctuation" data-v-4f1e9d0c>.</span>springframework<span class="token punctuation" data-v-4f1e9d0c>.</span>data<span class="token punctuation" data-v-4f1e9d0c>.</span>elasticsearch<span class="token punctuation" data-v-4f1e9d0c>.</span>core<span class="token punctuation" data-v-4f1e9d0c>.</span>query<span class="token punctuation" data-v-4f1e9d0c>.</span></span><span class="token class-name" data-v-4f1e9d0c>NativeSearchQueryBuilder</span></span><span class="token punctuation" data-v-4f1e9d0c>;</span>

<span class="token keyword" data-v-4f1e9d0c>import</span> <span class="token import" data-v-4f1e9d0c><span class="token namespace" data-v-4f1e9d0c>java<span class="token punctuation" data-v-4f1e9d0c>.</span>util<span class="token punctuation" data-v-4f1e9d0c>.</span></span><span class="token class-name" data-v-4f1e9d0c>List</span></span><span class="token punctuation" data-v-4f1e9d0c>;</span>

<span class="token comment" data-v-4f1e9d0c>/**
 * @author Young Kbt
 * @date 2021/11/17 19:59
 * @description ES 商品测试类
 */</span>
<span class="token annotation punctuation" data-v-4f1e9d0c>@SpringBootTest</span>
<span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>class</span> <span class="token class-name" data-v-4f1e9d0c>ESProductTest</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
    
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Autowired</span>
    <span class="token keyword" data-v-4f1e9d0c>private</span> <span class="token class-name" data-v-4f1e9d0c>ElasticsearchOperations</span> esOperations<span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Autowired</span>
    <span class="token keyword" data-v-4f1e9d0c>private</span> <span class="token class-name" data-v-4f1e9d0c>SearchOperations</span> searchOperations<span class="token punctuation" data-v-4f1e9d0c>;</span>

    <span class="token comment" data-v-4f1e9d0c>/**
     * 插入数据
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>save</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token class-name" data-v-4f1e9d0c>Product</span> product <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>Product</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        product<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>setId</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token number" data-v-4f1e9d0c>1</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        product<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>setTitle</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;华为手机1&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        product<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>setCategory</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;手机&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        product<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>setPrice</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token number" data-v-4f1e9d0c>2999.0</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        product<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>setImages</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/user/avatar2.png&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// indexCoordinates 是 4.x 新增的一个参数，通过这个参数我们可以再操作ES的时候同时指定多个 index。</span>
        <span class="token class-name" data-v-4f1e9d0c>IndexCoordinates</span> indexCoordinatesFor <span class="token operator" data-v-4f1e9d0c>=</span> esOperations<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getIndexCoordinatesFor</span><span class="token punctuation" data-v-4f1e9d0c>(</span>product<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getClass</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 为索引设置数据</span>
        <span class="token class-name" data-v-4f1e9d0c>IndexQuery</span> indexQuery <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>IndexQueryBuilder</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span>
                <span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>withId</span><span class="token punctuation" data-v-4f1e9d0c>(</span>product<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getId</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>toString</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span>
                <span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>withObject</span><span class="token punctuation" data-v-4f1e9d0c>(</span>product<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>build</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 插入索引和其数据，返回索引值</span>
        <span class="token class-name" data-v-4f1e9d0c>String</span> index <span class="token operator" data-v-4f1e9d0c>=</span> esOperations<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>index</span><span class="token punctuation" data-v-4f1e9d0c>(</span>indexQuery<span class="token punctuation" data-v-4f1e9d0c>,</span> indexCoordinatesFor<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;插入的索引：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> index<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>

    <span class="token comment" data-v-4f1e9d0c>/**
     * 查询全部数据
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>queryAll</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token comment" data-v-4f1e9d0c>// 查询所有数据</span>
        <span class="token class-name" data-v-4f1e9d0c>MatchAllQueryBuilder</span> allQueryBuilder <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>MatchAllQueryBuilder</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 查询参数配置</span>
        <span class="token class-name" data-v-4f1e9d0c>NativeSearchQuery</span> searchQuery <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>NativeSearchQueryBuilder</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span>
                <span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>withQuery</span><span class="token punctuation" data-v-4f1e9d0c>(</span>allQueryBuilder<span class="token punctuation" data-v-4f1e9d0c>)</span>
                <span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>build</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchHits</span><span class="token generics" data-v-4f1e9d0c><span class="token punctuation" data-v-4f1e9d0c>&lt;</span><span class="token class-name" data-v-4f1e9d0c>Product</span><span class="token punctuation" data-v-4f1e9d0c>&gt;</span></span> searchHits <span class="token operator" data-v-4f1e9d0c>=</span> searchOperations<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>search</span><span class="token punctuation" data-v-4f1e9d0c>(</span>searchQuery<span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token class-name" data-v-4f1e9d0c>Product</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token keyword" data-v-4f1e9d0c>class</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 获取查询的结果命中总数</span>
        <span class="token keyword" data-v-4f1e9d0c>long</span> count <span class="token operator" data-v-4f1e9d0c>=</span> searchHits<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getTotalHits</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;查询的总数：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> count<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>List</span><span class="token generics" data-v-4f1e9d0c><span class="token punctuation" data-v-4f1e9d0c>&lt;</span><span class="token class-name" data-v-4f1e9d0c>SearchHit</span><span class="token punctuation" data-v-4f1e9d0c>&lt;</span><span class="token class-name" data-v-4f1e9d0c>Product</span><span class="token punctuation" data-v-4f1e9d0c>&gt;</span><span class="token punctuation" data-v-4f1e9d0c>&gt;</span></span> list <span class="token operator" data-v-4f1e9d0c>=</span> searchHits<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getSearchHits</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;查询的数据：&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 遍历查询的数据</span>
        <span class="token keyword" data-v-4f1e9d0c>for</span> <span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>SearchHit</span><span class="token generics" data-v-4f1e9d0c><span class="token punctuation" data-v-4f1e9d0c>&lt;</span><span class="token class-name" data-v-4f1e9d0c>Product</span><span class="token punctuation" data-v-4f1e9d0c>&gt;</span></span> hit <span class="token operator" data-v-4f1e9d0c>:</span> list<span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
            <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span>hit<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token punctuation" data-v-4f1e9d0c>}</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>

    <span class="token comment" data-v-4f1e9d0c>/**
     * 词条查询
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>termQuery</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token comment" data-v-4f1e9d0c>// 指定名字查询</span>
        <span class="token class-name" data-v-4f1e9d0c>TermQueryBuilder</span> termQueryBuilder <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>TermQueryBuilder</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;category&quot;</span><span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token string" data-v-4f1e9d0c>&quot;手机&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 查询参数配置</span>
        <span class="token class-name" data-v-4f1e9d0c>NativeSearchQuery</span> searchQuery <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>NativeSearchQueryBuilder</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span>
                <span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>withQuery</span><span class="token punctuation" data-v-4f1e9d0c>(</span>termQueryBuilder<span class="token punctuation" data-v-4f1e9d0c>)</span>
                <span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>build</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchHits</span><span class="token generics" data-v-4f1e9d0c><span class="token punctuation" data-v-4f1e9d0c>&lt;</span><span class="token class-name" data-v-4f1e9d0c>Product</span><span class="token punctuation" data-v-4f1e9d0c>&gt;</span></span> searchHits <span class="token operator" data-v-4f1e9d0c>=</span> searchOperations<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>search</span><span class="token punctuation" data-v-4f1e9d0c>(</span>searchQuery<span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token class-name" data-v-4f1e9d0c>Product</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token keyword" data-v-4f1e9d0c>class</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 获取查询的结果命中总数</span>
        <span class="token keyword" data-v-4f1e9d0c>long</span> count <span class="token operator" data-v-4f1e9d0c>=</span> searchHits<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getTotalHits</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;查询的总数：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> count<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>List</span><span class="token generics" data-v-4f1e9d0c><span class="token punctuation" data-v-4f1e9d0c>&lt;</span><span class="token class-name" data-v-4f1e9d0c>SearchHit</span><span class="token punctuation" data-v-4f1e9d0c>&lt;</span><span class="token class-name" data-v-4f1e9d0c>Product</span><span class="token punctuation" data-v-4f1e9d0c>&gt;</span><span class="token punctuation" data-v-4f1e9d0c>&gt;</span></span> list <span class="token operator" data-v-4f1e9d0c>=</span> searchHits<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getSearchHits</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;查询的数据：&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 遍历查询的数据</span>
        <span class="token keyword" data-v-4f1e9d0c>for</span> <span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>SearchHit</span><span class="token generics" data-v-4f1e9d0c><span class="token punctuation" data-v-4f1e9d0c>&lt;</span><span class="token class-name" data-v-4f1e9d0c>Product</span><span class="token punctuation" data-v-4f1e9d0c>&gt;</span></span> hit <span class="token operator" data-v-4f1e9d0c>:</span> list<span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
            <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span>hit<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token punctuation" data-v-4f1e9d0c>}</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>

    <span class="token comment" data-v-4f1e9d0c>/**
     * 分页排序查询
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>sortPageQuery</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token comment" data-v-4f1e9d0c>// 查询所有数据</span>
        <span class="token class-name" data-v-4f1e9d0c>MatchAllQueryBuilder</span> allQueryBuilder <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>MatchAllQueryBuilder</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>//设置排序(排序方式，正序还是倒序，排序的 id)</span>
        <span class="token class-name" data-v-4f1e9d0c>Sort</span> sort <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token class-name" data-v-4f1e9d0c>Sort</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>by</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>Sort<span class="token punctuation" data-v-4f1e9d0c>.</span>Direction</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token constant" data-v-4f1e9d0c>DESC</span><span class="token punctuation" data-v-4f1e9d0c>,</span><span class="token string" data-v-4f1e9d0c>&quot;id&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token keyword" data-v-4f1e9d0c>int</span> currentPage <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token number" data-v-4f1e9d0c>0</span><span class="token punctuation" data-v-4f1e9d0c>;</span><span class="token comment" data-v-4f1e9d0c>//当前页，第一页从 0 开始，1 表示第二页</span>
        <span class="token keyword" data-v-4f1e9d0c>int</span> pageSize <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token number" data-v-4f1e9d0c>3</span><span class="token punctuation" data-v-4f1e9d0c>;</span><span class="token comment" data-v-4f1e9d0c>//每页显示多少条</span>
        <span class="token comment" data-v-4f1e9d0c>//设置查询分页</span>
        <span class="token class-name" data-v-4f1e9d0c>PageRequest</span> pageRequest <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token class-name" data-v-4f1e9d0c>PageRequest</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>of</span><span class="token punctuation" data-v-4f1e9d0c>(</span>currentPage<span class="token punctuation" data-v-4f1e9d0c>,</span> pageSize<span class="token punctuation" data-v-4f1e9d0c>,</span>sort<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 查询参数配置</span>
        <span class="token class-name" data-v-4f1e9d0c>NativeSearchQuery</span> searchQuery <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>NativeSearchQueryBuilder</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span>
                <span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>withQuery</span><span class="token punctuation" data-v-4f1e9d0c>(</span>allQueryBuilder<span class="token punctuation" data-v-4f1e9d0c>)</span>
                <span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>withPageable</span><span class="token punctuation" data-v-4f1e9d0c>(</span>pageRequest<span class="token punctuation" data-v-4f1e9d0c>)</span>
                <span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>build</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchHits</span><span class="token generics" data-v-4f1e9d0c><span class="token punctuation" data-v-4f1e9d0c>&lt;</span><span class="token class-name" data-v-4f1e9d0c>Product</span><span class="token punctuation" data-v-4f1e9d0c>&gt;</span></span> searchHits <span class="token operator" data-v-4f1e9d0c>=</span> searchOperations<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>search</span><span class="token punctuation" data-v-4f1e9d0c>(</span>searchQuery<span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token class-name" data-v-4f1e9d0c>Product</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token keyword" data-v-4f1e9d0c>class</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>List</span><span class="token generics" data-v-4f1e9d0c><span class="token punctuation" data-v-4f1e9d0c>&lt;</span><span class="token class-name" data-v-4f1e9d0c>SearchHit</span><span class="token punctuation" data-v-4f1e9d0c>&lt;</span><span class="token class-name" data-v-4f1e9d0c>Product</span><span class="token punctuation" data-v-4f1e9d0c>&gt;</span><span class="token punctuation" data-v-4f1e9d0c>&gt;</span></span> list <span class="token operator" data-v-4f1e9d0c>=</span> searchHits<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getSearchHits</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;查询的数据：&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 遍历查询的数据</span>
        <span class="token keyword" data-v-4f1e9d0c>for</span> <span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>SearchHit</span><span class="token generics" data-v-4f1e9d0c><span class="token punctuation" data-v-4f1e9d0c>&lt;</span><span class="token class-name" data-v-4f1e9d0c>Product</span><span class="token punctuation" data-v-4f1e9d0c>&gt;</span></span> hit <span class="token operator" data-v-4f1e9d0c>:</span> list<span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
            <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span>hit<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token punctuation" data-v-4f1e9d0c>}</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>

    <span class="token comment" data-v-4f1e9d0c>/**
     * 高亮查询
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>highLightQuery</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token comment" data-v-4f1e9d0c>// 查询所有数据</span>
        <span class="token class-name" data-v-4f1e9d0c>MatchAllQueryBuilder</span> allQueryBuilder <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>MatchAllQueryBuilder</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 查询参数配置</span>
        <span class="token class-name" data-v-4f1e9d0c>NativeSearchQuery</span> searchQuery <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>NativeSearchQueryBuilder</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span>
                <span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>withQuery</span><span class="token punctuation" data-v-4f1e9d0c>(</span>allQueryBuilder<span class="token punctuation" data-v-4f1e9d0c>)</span>
                <span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>withHighlightBuilder</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>HighlightBuilder</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>field</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;price&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>preTags</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;&lt;前缀&gt;&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>postTags</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;&lt;/后缀&gt;&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span>
                <span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>build</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchHits</span><span class="token generics" data-v-4f1e9d0c><span class="token punctuation" data-v-4f1e9d0c>&lt;</span><span class="token class-name" data-v-4f1e9d0c>Product</span><span class="token punctuation" data-v-4f1e9d0c>&gt;</span></span> searchHits <span class="token operator" data-v-4f1e9d0c>=</span> searchOperations<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>search</span><span class="token punctuation" data-v-4f1e9d0c>(</span>searchQuery<span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token class-name" data-v-4f1e9d0c>Product</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token keyword" data-v-4f1e9d0c>class</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>List</span><span class="token generics" data-v-4f1e9d0c><span class="token punctuation" data-v-4f1e9d0c>&lt;</span><span class="token class-name" data-v-4f1e9d0c>SearchHit</span><span class="token punctuation" data-v-4f1e9d0c>&lt;</span><span class="token class-name" data-v-4f1e9d0c>Product</span><span class="token punctuation" data-v-4f1e9d0c>&gt;</span><span class="token punctuation" data-v-4f1e9d0c>&gt;</span></span> list <span class="token operator" data-v-4f1e9d0c>=</span> searchHits<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getSearchHits</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;查询的数据：&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 遍历查询的数据</span>
        <span class="token keyword" data-v-4f1e9d0c>for</span> <span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>SearchHit</span><span class="token generics" data-v-4f1e9d0c><span class="token punctuation" data-v-4f1e9d0c>&lt;</span><span class="token class-name" data-v-4f1e9d0c>Product</span><span class="token punctuation" data-v-4f1e9d0c>&gt;</span></span> hit <span class="token operator" data-v-4f1e9d0c>:</span> list<span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
            <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span>hit<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token punctuation" data-v-4f1e9d0c>}</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
     <span class="token comment" data-v-4f1e9d0c>/**
     * 范围查询
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>searchByPrice</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token class-name" data-v-4f1e9d0c>Criteria</span> criteria <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>Criteria</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;price&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>between</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token number" data-v-4f1e9d0c>2000.0</span><span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token number" data-v-4f1e9d0c>2500.0</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>CriteriaQuery</span> criteriaQuery <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>CriteriaQuery</span><span class="token punctuation" data-v-4f1e9d0c>(</span>criteria<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchHits</span><span class="token generics" data-v-4f1e9d0c><span class="token punctuation" data-v-4f1e9d0c>&lt;</span><span class="token class-name" data-v-4f1e9d0c>Product</span><span class="token punctuation" data-v-4f1e9d0c>&gt;</span></span> search <span class="token operator" data-v-4f1e9d0c>=</span> searchOperations<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>search</span><span class="token punctuation" data-v-4f1e9d0c>(</span>criteriaQuery<span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token class-name" data-v-4f1e9d0c>Product</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token keyword" data-v-4f1e9d0c>class</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>List</span><span class="token generics" data-v-4f1e9d0c><span class="token punctuation" data-v-4f1e9d0c>&lt;</span><span class="token class-name" data-v-4f1e9d0c>SearchHit</span><span class="token punctuation" data-v-4f1e9d0c>&lt;</span><span class="token class-name" data-v-4f1e9d0c>Product</span><span class="token punctuation" data-v-4f1e9d0c>&gt;</span><span class="token punctuation" data-v-4f1e9d0c>&gt;</span></span> searchHits <span class="token operator" data-v-4f1e9d0c>=</span> search<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getSearchHits</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token keyword" data-v-4f1e9d0c>for</span> <span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>SearchHit</span><span class="token generics" data-v-4f1e9d0c><span class="token punctuation" data-v-4f1e9d0c>&lt;</span><span class="token class-name" data-v-4f1e9d0c>Product</span><span class="token punctuation" data-v-4f1e9d0c>&gt;</span></span> searchHit <span class="token operator" data-v-4f1e9d0c>:</span> searchHits<span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
            <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span>searchHit<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token punctuation" data-v-4f1e9d0c>}</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
<span class="token punctuation" data-v-4f1e9d0c>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>1</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>2</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>3</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>4</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>5</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>6</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>7</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>8</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>9</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>10</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>11</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>12</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>13</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>14</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>15</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>16</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>17</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>18</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>19</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>20</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>21</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>22</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>23</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>24</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>25</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>26</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>27</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>28</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>29</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>30</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>31</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>32</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>33</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>34</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>35</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>36</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>37</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>38</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>39</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>40</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>41</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>42</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>43</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>44</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>45</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>46</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>47</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>48</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>49</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>50</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>51</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>52</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>53</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>54</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>55</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>56</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>57</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>58</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>59</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>60</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>61</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>62</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>63</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>64</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>65</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>66</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>67</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>68</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>69</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>70</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>71</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>72</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>73</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>74</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>75</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>76</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>77</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>78</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>79</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>80</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>81</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>82</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>83</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>84</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>85</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>86</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>87</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>88</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>89</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>90</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>91</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>92</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>93</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>94</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>95</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>96</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>97</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>98</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>99</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>100</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>101</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>102</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>103</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>104</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>105</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>106</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>107</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>108</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>109</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>110</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>111</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>112</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>113</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>114</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>115</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>116</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>117</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>118</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>119</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>120</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>121</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>122</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>123</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>124</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>125</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>126</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>127</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>128</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>129</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>130</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>131</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>132</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>133</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>134</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>135</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>136</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>137</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>138</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>139</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>140</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>141</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>142</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>143</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>144</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>145</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>146</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>147</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>148</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>149</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>150</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>151</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>152</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>153</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>154</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>155</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>156</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>157</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>158</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>159</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>160</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>161</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>162</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>163</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>164</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>165</span><br data-v-4f1e9d0c></div></div></div> <div class="theme-code-block" data-v-4f1e9d0c><div class="language-java line-numbers-mode" data-v-4f1e9d0c><pre class="language-java" data-v-4f1e9d0c><code data-v-4f1e9d0c><span class="token annotation punctuation" data-v-4f1e9d0c>@SpringBootTest</span>
<span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>class</span> <span class="token class-name" data-v-4f1e9d0c>ESProductTest</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>

    <span class="token annotation punctuation" data-v-4f1e9d0c>@Autowired</span>
    <span class="token keyword" data-v-4f1e9d0c>private</span> <span class="token class-name" data-v-4f1e9d0c>ElasticsearchOperations</span> esOperations<span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Autowired</span>
    <span class="token keyword" data-v-4f1e9d0c>private</span> <span class="token class-name" data-v-4f1e9d0c>SearchOperations</span> searchOperations<span class="token punctuation" data-v-4f1e9d0c>;</span>
     <span class="token comment" data-v-4f1e9d0c>/**
     * 插入数据
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>save</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token class-name" data-v-4f1e9d0c>Product</span> product <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>Product</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        product<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>setId</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token number" data-v-4f1e9d0c>1</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        product<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>setTitle</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;华为手机1&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        product<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>setCategory</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;手机&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        product<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>setPrice</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token number" data-v-4f1e9d0c>2999.0</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        product<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>setImages</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/user/avatar2.png&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// indexCoordinates 是 4.x 新增的一个参数，通过这个参数我们可以再操作ES的时候同时指定多个 index。</span>
        <span class="token class-name" data-v-4f1e9d0c>IndexCoordinates</span> indexCoordinatesFor <span class="token operator" data-v-4f1e9d0c>=</span> esOperations<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getIndexCoordinatesFor</span><span class="token punctuation" data-v-4f1e9d0c>(</span>product<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getClass</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 为索引设置数据</span>
        <span class="token class-name" data-v-4f1e9d0c>IndexQuery</span> indexQuery <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>IndexQueryBuilder</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span>
                <span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>withId</span><span class="token punctuation" data-v-4f1e9d0c>(</span>product<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getId</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>toString</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span>
                <span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>withObject</span><span class="token punctuation" data-v-4f1e9d0c>(</span>product<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>build</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 插入索引和其数据，返回索引值</span>
        <span class="token class-name" data-v-4f1e9d0c>String</span> index <span class="token operator" data-v-4f1e9d0c>=</span> esOperations<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>index</span><span class="token punctuation" data-v-4f1e9d0c>(</span>indexQuery<span class="token punctuation" data-v-4f1e9d0c>,</span> indexCoordinatesFor<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;插入的索引：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> index<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
<span class="token punctuation" data-v-4f1e9d0c>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>1</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>2</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>3</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>4</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>5</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>6</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>7</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>8</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>9</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>10</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>11</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>12</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>13</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>14</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>15</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>16</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>17</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>18</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>19</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>20</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>21</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>22</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>23</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>24</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>25</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>26</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>27</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>28</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>29</span><br data-v-4f1e9d0c></div></div></div> <div class="theme-code-block" data-v-4f1e9d0c><div class="language-java line-numbers-mode" data-v-4f1e9d0c><pre class="language-java" data-v-4f1e9d0c><code data-v-4f1e9d0c><span class="token annotation punctuation" data-v-4f1e9d0c>@SpringBootTest</span>
<span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>class</span> <span class="token class-name" data-v-4f1e9d0c>ESProductTest</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>

    <span class="token annotation punctuation" data-v-4f1e9d0c>@Autowired</span>
    <span class="token keyword" data-v-4f1e9d0c>private</span> <span class="token class-name" data-v-4f1e9d0c>ElasticsearchOperations</span> esOperations<span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Autowired</span>
    <span class="token keyword" data-v-4f1e9d0c>private</span> <span class="token class-name" data-v-4f1e9d0c>SearchOperations</span> searchOperations<span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token comment" data-v-4f1e9d0c>/**
     * 查询全部数据
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>queryAll</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token comment" data-v-4f1e9d0c>// 查询所有数据</span>
        <span class="token class-name" data-v-4f1e9d0c>MatchAllQueryBuilder</span> allQueryBuilder <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>MatchAllQueryBuilder</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>NativeSearchQuery</span> searchQuery <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>NativeSearchQueryBuilder</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span>
                <span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>withQuery</span><span class="token punctuation" data-v-4f1e9d0c>(</span>allQueryBuilder<span class="token punctuation" data-v-4f1e9d0c>)</span>
                <span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>build</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchHits</span><span class="token generics" data-v-4f1e9d0c><span class="token punctuation" data-v-4f1e9d0c>&lt;</span><span class="token class-name" data-v-4f1e9d0c>Product</span><span class="token punctuation" data-v-4f1e9d0c>&gt;</span></span> searchHits <span class="token operator" data-v-4f1e9d0c>=</span> searchOperations<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>search</span><span class="token punctuation" data-v-4f1e9d0c>(</span>searchQuery<span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token class-name" data-v-4f1e9d0c>Product</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token keyword" data-v-4f1e9d0c>class</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 获取查询的结果命中总数</span>
        <span class="token keyword" data-v-4f1e9d0c>long</span> count <span class="token operator" data-v-4f1e9d0c>=</span> searchHits<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getTotalHits</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;查询的总数：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> count<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>List</span><span class="token generics" data-v-4f1e9d0c><span class="token punctuation" data-v-4f1e9d0c>&lt;</span><span class="token class-name" data-v-4f1e9d0c>SearchHit</span><span class="token punctuation" data-v-4f1e9d0c>&lt;</span><span class="token class-name" data-v-4f1e9d0c>Product</span><span class="token punctuation" data-v-4f1e9d0c>&gt;</span><span class="token punctuation" data-v-4f1e9d0c>&gt;</span></span> list <span class="token operator" data-v-4f1e9d0c>=</span> searchHits<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getSearchHits</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;查询的数据：&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 遍历查询的数据</span>
        <span class="token keyword" data-v-4f1e9d0c>for</span> <span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>SearchHit</span><span class="token generics" data-v-4f1e9d0c><span class="token punctuation" data-v-4f1e9d0c>&lt;</span><span class="token class-name" data-v-4f1e9d0c>Product</span><span class="token punctuation" data-v-4f1e9d0c>&gt;</span></span> hit <span class="token operator" data-v-4f1e9d0c>:</span> list<span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
            <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span>hit<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token punctuation" data-v-4f1e9d0c>}</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
<span class="token punctuation" data-v-4f1e9d0c>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>1</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>2</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>3</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>4</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>5</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>6</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>7</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>8</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>9</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>10</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>11</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>12</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>13</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>14</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>15</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>16</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>17</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>18</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>19</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>20</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>21</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>22</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>23</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>24</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>25</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>26</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>27</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>28</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>29</span><br data-v-4f1e9d0c></div></div></div> <div class="theme-code-block" data-v-4f1e9d0c><div class="language-java line-numbers-mode" data-v-4f1e9d0c><pre class="language-java" data-v-4f1e9d0c><code data-v-4f1e9d0c><span class="token annotation punctuation" data-v-4f1e9d0c>@SpringBootTest</span>
<span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>class</span> <span class="token class-name" data-v-4f1e9d0c>ESProductTest</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>

    <span class="token annotation punctuation" data-v-4f1e9d0c>@Autowired</span>
    <span class="token keyword" data-v-4f1e9d0c>private</span> <span class="token class-name" data-v-4f1e9d0c>ElasticsearchOperations</span> esOperations<span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Autowired</span>
    <span class="token keyword" data-v-4f1e9d0c>private</span> <span class="token class-name" data-v-4f1e9d0c>SearchOperations</span> searchOperations<span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token comment" data-v-4f1e9d0c>/**
     * 词条查询
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>termQuery</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token comment" data-v-4f1e9d0c>// 指定名字查询</span>
        <span class="token class-name" data-v-4f1e9d0c>TermQueryBuilder</span> termQueryBuilder <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>TermQueryBuilder</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;category&quot;</span><span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token string" data-v-4f1e9d0c>&quot;手机&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>NativeSearchQuery</span> searchQuery <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>NativeSearchQueryBuilder</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span>
                <span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>withQuery</span><span class="token punctuation" data-v-4f1e9d0c>(</span>termQueryBuilder<span class="token punctuation" data-v-4f1e9d0c>)</span>
                <span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>build</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchHits</span><span class="token generics" data-v-4f1e9d0c><span class="token punctuation" data-v-4f1e9d0c>&lt;</span><span class="token class-name" data-v-4f1e9d0c>Product</span><span class="token punctuation" data-v-4f1e9d0c>&gt;</span></span> searchHits <span class="token operator" data-v-4f1e9d0c>=</span> searchOperations<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>search</span><span class="token punctuation" data-v-4f1e9d0c>(</span>searchQuery<span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token class-name" data-v-4f1e9d0c>Product</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token keyword" data-v-4f1e9d0c>class</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 获取查询的结果命中总数</span>
        <span class="token keyword" data-v-4f1e9d0c>long</span> count <span class="token operator" data-v-4f1e9d0c>=</span> searchHits<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getTotalHits</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;查询的总数：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> count<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>List</span><span class="token generics" data-v-4f1e9d0c><span class="token punctuation" data-v-4f1e9d0c>&lt;</span><span class="token class-name" data-v-4f1e9d0c>SearchHit</span><span class="token punctuation" data-v-4f1e9d0c>&lt;</span><span class="token class-name" data-v-4f1e9d0c>Product</span><span class="token punctuation" data-v-4f1e9d0c>&gt;</span><span class="token punctuation" data-v-4f1e9d0c>&gt;</span></span> list <span class="token operator" data-v-4f1e9d0c>=</span> searchHits<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getSearchHits</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;查询的数据：&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 遍历查询的数据</span>
        <span class="token keyword" data-v-4f1e9d0c>for</span> <span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>SearchHit</span><span class="token generics" data-v-4f1e9d0c><span class="token punctuation" data-v-4f1e9d0c>&lt;</span><span class="token class-name" data-v-4f1e9d0c>Product</span><span class="token punctuation" data-v-4f1e9d0c>&gt;</span></span> hit <span class="token operator" data-v-4f1e9d0c>:</span> list<span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
            <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span>hit<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token punctuation" data-v-4f1e9d0c>}</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
<span class="token punctuation" data-v-4f1e9d0c>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>1</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>2</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>3</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>4</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>5</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>6</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>7</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>8</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>9</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>10</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>11</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>12</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>13</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>14</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>15</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>16</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>17</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>18</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>19</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>20</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>21</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>22</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>23</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>24</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>25</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>26</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>27</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>28</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>29</span><br data-v-4f1e9d0c></div></div></div> <div class="theme-code-block" data-v-4f1e9d0c><div class="language-java line-numbers-mode" data-v-4f1e9d0c><pre class="language-java" data-v-4f1e9d0c><code data-v-4f1e9d0c><span class="token annotation punctuation" data-v-4f1e9d0c>@SpringBootTest</span>
<span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>class</span> <span class="token class-name" data-v-4f1e9d0c>ESProductTest</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>

    <span class="token annotation punctuation" data-v-4f1e9d0c>@Autowired</span>
    <span class="token keyword" data-v-4f1e9d0c>private</span> <span class="token class-name" data-v-4f1e9d0c>ElasticsearchOperations</span> esOperations<span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Autowired</span>
    <span class="token keyword" data-v-4f1e9d0c>private</span> <span class="token class-name" data-v-4f1e9d0c>SearchOperations</span> searchOperations<span class="token punctuation" data-v-4f1e9d0c>;</span>
     <span class="token comment" data-v-4f1e9d0c>/**
     * 分页排序查询
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>sortPageQuery</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token comment" data-v-4f1e9d0c>// 查询所有数据</span>
        <span class="token class-name" data-v-4f1e9d0c>MatchAllQueryBuilder</span> allQueryBuilder <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>MatchAllQueryBuilder</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>//设置排序(排序方式，正序还是倒序，排序的 id)</span>
        <span class="token class-name" data-v-4f1e9d0c>Sort</span> sort <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token class-name" data-v-4f1e9d0c>Sort</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>by</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>Sort<span class="token punctuation" data-v-4f1e9d0c>.</span>Direction</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token constant" data-v-4f1e9d0c>DESC</span><span class="token punctuation" data-v-4f1e9d0c>,</span><span class="token string" data-v-4f1e9d0c>&quot;id&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token keyword" data-v-4f1e9d0c>int</span> currentPage <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token number" data-v-4f1e9d0c>0</span><span class="token punctuation" data-v-4f1e9d0c>;</span><span class="token comment" data-v-4f1e9d0c>//当前页，第一页从 0 开始，1 表示第二页</span>
        <span class="token keyword" data-v-4f1e9d0c>int</span> pageSize <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token number" data-v-4f1e9d0c>3</span><span class="token punctuation" data-v-4f1e9d0c>;</span><span class="token comment" data-v-4f1e9d0c>//每页显示多少条</span>
        <span class="token comment" data-v-4f1e9d0c>//设置查询分页</span>
        <span class="token class-name" data-v-4f1e9d0c>PageRequest</span> pageRequest <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token class-name" data-v-4f1e9d0c>PageRequest</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>of</span><span class="token punctuation" data-v-4f1e9d0c>(</span>currentPage<span class="token punctuation" data-v-4f1e9d0c>,</span> pageSize<span class="token punctuation" data-v-4f1e9d0c>,</span>sort<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>NativeSearchQuery</span> searchQuery <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>NativeSearchQueryBuilder</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span>
                <span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>withQuery</span><span class="token punctuation" data-v-4f1e9d0c>(</span>allQueryBuilder<span class="token punctuation" data-v-4f1e9d0c>)</span>
                <span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>withPageable</span><span class="token punctuation" data-v-4f1e9d0c>(</span>pageRequest<span class="token punctuation" data-v-4f1e9d0c>)</span>
                <span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>build</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchHits</span><span class="token generics" data-v-4f1e9d0c><span class="token punctuation" data-v-4f1e9d0c>&lt;</span><span class="token class-name" data-v-4f1e9d0c>Product</span><span class="token punctuation" data-v-4f1e9d0c>&gt;</span></span> searchHits <span class="token operator" data-v-4f1e9d0c>=</span> searchOperations<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>search</span><span class="token punctuation" data-v-4f1e9d0c>(</span>searchQuery<span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token class-name" data-v-4f1e9d0c>Product</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token keyword" data-v-4f1e9d0c>class</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>List</span><span class="token generics" data-v-4f1e9d0c><span class="token punctuation" data-v-4f1e9d0c>&lt;</span><span class="token class-name" data-v-4f1e9d0c>SearchHit</span><span class="token punctuation" data-v-4f1e9d0c>&lt;</span><span class="token class-name" data-v-4f1e9d0c>Product</span><span class="token punctuation" data-v-4f1e9d0c>&gt;</span><span class="token punctuation" data-v-4f1e9d0c>&gt;</span></span> list <span class="token operator" data-v-4f1e9d0c>=</span> searchHits<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getSearchHits</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;查询的数据：&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 遍历查询的数据</span>
        <span class="token keyword" data-v-4f1e9d0c>for</span> <span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>SearchHit</span><span class="token generics" data-v-4f1e9d0c><span class="token punctuation" data-v-4f1e9d0c>&lt;</span><span class="token class-name" data-v-4f1e9d0c>Product</span><span class="token punctuation" data-v-4f1e9d0c>&gt;</span></span> hit <span class="token operator" data-v-4f1e9d0c>:</span> list<span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
            <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span>hit<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token punctuation" data-v-4f1e9d0c>}</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
<span class="token punctuation" data-v-4f1e9d0c>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>1</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>2</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>3</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>4</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>5</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>6</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>7</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>8</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>9</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>10</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>11</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>12</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>13</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>14</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>15</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>16</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>17</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>18</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>19</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>20</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>21</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>22</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>23</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>24</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>25</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>26</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>27</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>28</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>29</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>30</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>31</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>32</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>33</span><br data-v-4f1e9d0c></div></div></div> <div class="theme-code-block" data-v-4f1e9d0c><div class="language-java line-numbers-mode" data-v-4f1e9d0c><pre class="language-java" data-v-4f1e9d0c><code data-v-4f1e9d0c><span class="token annotation punctuation" data-v-4f1e9d0c>@SpringBootTest</span>
<span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>class</span> <span class="token class-name" data-v-4f1e9d0c>ESProductTest</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>

    <span class="token annotation punctuation" data-v-4f1e9d0c>@Autowired</span>
    <span class="token keyword" data-v-4f1e9d0c>private</span> <span class="token class-name" data-v-4f1e9d0c>ElasticsearchOperations</span> esOperations<span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Autowired</span>
    <span class="token keyword" data-v-4f1e9d0c>private</span> <span class="token class-name" data-v-4f1e9d0c>SearchOperations</span> searchOperations<span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token comment" data-v-4f1e9d0c>/**
     * 高亮查询
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>highLightQuery</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token comment" data-v-4f1e9d0c>// 查询所有数据</span>
        <span class="token class-name" data-v-4f1e9d0c>MatchAllQueryBuilder</span> allQueryBuilder <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>MatchAllQueryBuilder</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>NativeSearchQuery</span> searchQuery <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>NativeSearchQueryBuilder</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span>
                <span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>withQuery</span><span class="token punctuation" data-v-4f1e9d0c>(</span>allQueryBuilder<span class="token punctuation" data-v-4f1e9d0c>)</span>
                <span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>withHighlightBuilder</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>HighlightBuilder</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>field</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;price&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>preTags</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;&lt;前缀&gt;&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>postTags</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;&lt;/后缀&gt;&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span>
                <span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>build</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchHits</span><span class="token generics" data-v-4f1e9d0c><span class="token punctuation" data-v-4f1e9d0c>&lt;</span><span class="token class-name" data-v-4f1e9d0c>Product</span><span class="token punctuation" data-v-4f1e9d0c>&gt;</span></span> searchHits <span class="token operator" data-v-4f1e9d0c>=</span> searchOperations<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>search</span><span class="token punctuation" data-v-4f1e9d0c>(</span>searchQuery<span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token class-name" data-v-4f1e9d0c>Product</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token keyword" data-v-4f1e9d0c>class</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>List</span><span class="token generics" data-v-4f1e9d0c><span class="token punctuation" data-v-4f1e9d0c>&lt;</span><span class="token class-name" data-v-4f1e9d0c>SearchHit</span><span class="token punctuation" data-v-4f1e9d0c>&lt;</span><span class="token class-name" data-v-4f1e9d0c>Product</span><span class="token punctuation" data-v-4f1e9d0c>&gt;</span><span class="token punctuation" data-v-4f1e9d0c>&gt;</span></span> list <span class="token operator" data-v-4f1e9d0c>=</span> searchHits<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getSearchHits</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;查询的数据：&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 遍历查询的数据</span>
        <span class="token keyword" data-v-4f1e9d0c>for</span> <span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>SearchHit</span><span class="token generics" data-v-4f1e9d0c><span class="token punctuation" data-v-4f1e9d0c>&lt;</span><span class="token class-name" data-v-4f1e9d0c>Product</span><span class="token punctuation" data-v-4f1e9d0c>&gt;</span></span> hit <span class="token operator" data-v-4f1e9d0c>:</span> list<span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
            <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span>hit<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token punctuation" data-v-4f1e9d0c>}</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
<span class="token punctuation" data-v-4f1e9d0c>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>1</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>2</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>3</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>4</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>5</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>6</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>7</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>8</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>9</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>10</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>11</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>12</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>13</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>14</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>15</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>16</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>17</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>18</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>19</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>20</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>21</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>22</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>23</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>24</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>25</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>26</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>27</span><br data-v-4f1e9d0c></div></div></div> <div class="theme-code-block" data-v-4f1e9d0c><div class="language-java line-numbers-mode" data-v-4f1e9d0c><pre class="language-java" data-v-4f1e9d0c><code data-v-4f1e9d0c><span class="token annotation punctuation" data-v-4f1e9d0c>@SpringBootTest</span>
<span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>class</span> <span class="token class-name" data-v-4f1e9d0c>ESProductTest</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>

    <span class="token annotation punctuation" data-v-4f1e9d0c>@Autowired</span>
    <span class="token keyword" data-v-4f1e9d0c>private</span> <span class="token class-name" data-v-4f1e9d0c>ElasticsearchOperations</span> esOperations<span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Autowired</span>
    <span class="token keyword" data-v-4f1e9d0c>private</span> <span class="token class-name" data-v-4f1e9d0c>SearchOperations</span> searchOperations<span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token comment" data-v-4f1e9d0c>/**
     * 范围查询
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>searchByPrice</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token class-name" data-v-4f1e9d0c>Criteria</span> criteria <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>Criteria</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;price&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>CriteriaQuery</span> criteriaQuery <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>CriteriaQuery</span><span class="token punctuation" data-v-4f1e9d0c>(</span>criteria<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchHits</span><span class="token generics" data-v-4f1e9d0c><span class="token punctuation" data-v-4f1e9d0c>&lt;</span><span class="token class-name" data-v-4f1e9d0c>Product</span><span class="token punctuation" data-v-4f1e9d0c>&gt;</span></span> search <span class="token operator" data-v-4f1e9d0c>=</span> searchOperations<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>search</span><span class="token punctuation" data-v-4f1e9d0c>(</span>criteriaQuery<span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token class-name" data-v-4f1e9d0c>Product</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token keyword" data-v-4f1e9d0c>class</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>List</span><span class="token generics" data-v-4f1e9d0c><span class="token punctuation" data-v-4f1e9d0c>&lt;</span><span class="token class-name" data-v-4f1e9d0c>SearchHit</span><span class="token punctuation" data-v-4f1e9d0c>&lt;</span><span class="token class-name" data-v-4f1e9d0c>Product</span><span class="token punctuation" data-v-4f1e9d0c>&gt;</span><span class="token punctuation" data-v-4f1e9d0c>&gt;</span></span> searchHits <span class="token operator" data-v-4f1e9d0c>=</span> search<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getSearchHits</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token keyword" data-v-4f1e9d0c>for</span> <span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>SearchHit</span><span class="token generics" data-v-4f1e9d0c><span class="token punctuation" data-v-4f1e9d0c>&lt;</span><span class="token class-name" data-v-4f1e9d0c>Product</span><span class="token punctuation" data-v-4f1e9d0c>&gt;</span></span> searchHit <span class="token operator" data-v-4f1e9d0c>:</span> searchHits<span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
            <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span>searchHit<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token punctuation" data-v-4f1e9d0c>}</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
<span class="token punctuation" data-v-4f1e9d0c>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>1</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>2</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>3</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>4</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>5</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>6</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>7</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>8</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>9</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>10</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>11</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>12</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>13</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>14</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>15</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>16</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>17</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>18</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>19</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>20</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>21</span><br data-v-4f1e9d0c></div></div></div> <div class="theme-code-block" data-v-4f1e9d0c><div class="language-java line-numbers-mode" data-v-4f1e9d0c><pre class="language-java" data-v-4f1e9d0c><code data-v-4f1e9d0c><span class="token annotation punctuation" data-v-4f1e9d0c>@SpringBootTest</span>
<span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>class</span> <span class="token class-name" data-v-4f1e9d0c>ESProductTest</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>

    <span class="token annotation punctuation" data-v-4f1e9d0c>@Autowired</span>
    <span class="token keyword" data-v-4f1e9d0c>private</span> <span class="token class-name" data-v-4f1e9d0c>ElasticsearchOperations</span> esOperations<span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Autowired</span>
    <span class="token keyword" data-v-4f1e9d0c>private</span> <span class="token class-name" data-v-4f1e9d0c>SearchOperations</span> searchOperations<span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token comment" data-v-4f1e9d0c>/**
     * 范围查询
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>searchByPrice</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token class-name" data-v-4f1e9d0c>Criteria</span> criteria <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>Criteria</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;price&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>between</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token number" data-v-4f1e9d0c>2000.0</span><span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token number" data-v-4f1e9d0c>2500.0</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>CriteriaQuery</span> criteriaQuery <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>CriteriaQuery</span><span class="token punctuation" data-v-4f1e9d0c>(</span>criteria<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchHits</span><span class="token generics" data-v-4f1e9d0c><span class="token punctuation" data-v-4f1e9d0c>&lt;</span><span class="token class-name" data-v-4f1e9d0c>Product</span><span class="token punctuation" data-v-4f1e9d0c>&gt;</span></span> search <span class="token operator" data-v-4f1e9d0c>=</span> searchOperations<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>search</span><span class="token punctuation" data-v-4f1e9d0c>(</span>criteriaQuery<span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token class-name" data-v-4f1e9d0c>Product</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token keyword" data-v-4f1e9d0c>class</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>List</span><span class="token generics" data-v-4f1e9d0c><span class="token punctuation" data-v-4f1e9d0c>&lt;</span><span class="token class-name" data-v-4f1e9d0c>SearchHit</span><span class="token punctuation" data-v-4f1e9d0c>&lt;</span><span class="token class-name" data-v-4f1e9d0c>Product</span><span class="token punctuation" data-v-4f1e9d0c>&gt;</span><span class="token punctuation" data-v-4f1e9d0c>&gt;</span></span> searchHits <span class="token operator" data-v-4f1e9d0c>=</span> search<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getSearchHits</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token keyword" data-v-4f1e9d0c>for</span> <span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>SearchHit</span><span class="token generics" data-v-4f1e9d0c><span class="token punctuation" data-v-4f1e9d0c>&lt;</span><span class="token class-name" data-v-4f1e9d0c>Product</span><span class="token punctuation" data-v-4f1e9d0c>&gt;</span></span> searchHit <span class="token operator" data-v-4f1e9d0c>:</span> searchHits<span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
            <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span>searchHit<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token punctuation" data-v-4f1e9d0c>}</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
<span class="token punctuation" data-v-4f1e9d0c>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>1</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>2</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>3</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>4</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>5</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>6</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>7</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>8</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>9</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>10</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>11</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>12</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>13</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>14</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>15</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>16</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>17</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>18</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>19</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>20</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>21</span><br data-v-4f1e9d0c></div></div></div> <pre class="pre-blank" data-v-2f5f1757>// Make sure to add code blocks to your code group</pre></div> <p>由代码可以看出：</p> <ul><li><code>NativeSearchQueryBuilder</code> 类可以处理很多东西，包括查询、分页、高亮、排序等，它拥有丰富的 <code>withXxx</code> 方法，基本满足关于 ES 的操作</li> <li>如果是范围查询，需要用到 <code>Criteria</code> 类进行范围设置，当然该类也可以直接查询某个字段，不带范围的查询就是字段查询</li></ul> <p>解释：</p> <ul><li><p><code>ElasticsearchOperations</code> 是 Spring Data ES 操作 ES 的一个接口，在 4.x 的版本它的默认实现类是 <code>ElasticsearchRestTemplate</code>，你也可以直接使用 <code>ElasticsearchRestTemplate</code> 替换掉 <code>ElasticsearchOperations</code>，因为接口和其实现类都一样，使用接口可以实现多态</p></li> <li><p><code>ElasticsearchOperations</code> 继承 <code>SearchOperations</code>，<code>SearchOperations</code> 内的方法趋向于搜索，<code>ElasticsearchOperations</code> 因为继承，所以拥有一些 <code>SearchOperations</code> 的搜索方法，自身也有一些索引的操作方法。这里我分开使用</p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/ElasticSearch/20211130172857.png" alt="image-20211118200444755"></p></li></ul> <p>番外：</p> <ul><li>ElasticsearchRestTemplate 是 Spring-Data-Elasticsearch 项目中的一个类，和其他 Spring 项目中的 Template 类似</li> <li>选择 ElasticsearchRestTemplate 代替了原来的 ElasticsearchTemplate，原因是 ElasticsearchTemplate 基于 TransportClient，TransportClient 即将在 8.x 以后的版本中移除</li> <li>ElasticsearchRestTemplate 基于 RestHighLevelClient 客户端的。需要自定义配置类，继承 AbstractElasticsearchConfiguration，并实现 elasticsearchClient() 抽象方法，创建 RestHighLevelClient 对象</li></ul> <h3 id="repository类原生测试"><a href="#repository类原生测试" class="header-anchor">#</a> Repository类原生测试</h3> <p>用过 Spring Data 的人都知道，它里面有个核心的概念叫 <code>Repository</code>。</p> <p>Repository 接口是 Spring Data 的一个核心接口，它不提供任何方法，开发者需要在自己定义的接口中声明需要的方法</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Repository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> ID <span class="token keyword">extends</span> <span class="token class-name">Serializable</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Spring Data 可以让我们只定义接口，只要遵循 Spring Data 的规范，就无需写实现类。Repository 有几个常用的子接口：</p> <ul><li>CrudRepository： 继承 Repository，实现了一组 CRUD 相关的方法</li> <li>PagingAndSortingRepository： 继承 CrudRepository，实现了一组分页排序相关的方法</li> <li>JpaRepository： 继承 PagingAndSortingRepository，实现一组 JPA 规范相关的方法</li></ul> <p>ElasticSearch 也有一个 <code>Repository</code> 接口：<code>ElasticsearchRepository</code>，该接口已经内置一些基本的增删改查方法，我们只需要自定义一个类，继承它，就可以使用方法了，当然，它只能进行一些简单的操作，复杂的操作需要自定义实现，也不难，因为官网提供了规范模板。</p> <p>创建一个类继承 <code>ElasticsearchRepository</code> 接口</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kbt<span class="token punctuation">.</span>repository</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>kbt<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">Product</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>repository<span class="token punctuation">.</span></span><span class="token class-name">ElasticsearchRepository</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author Young Kbt
 * @date 2021/11/17 18:49
 * @description 基础 ES 封装类，自带很多方法
 * Product：索引的实体类
 * Integer：主键 ID 类型
 */</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ProductRepository</span> <span class="token keyword">extends</span> <span class="token class-name">ElasticsearchRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">,</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>该接口是一个泛型，第一个参数是索引的实体类，第二个参数是主键 Id 的类型，用过 mybatis-plus 应该非常熟悉接下来的操作。</p> <p>测试代码：</p> <div class="theme-code-group" data-v-2f5f1757><div class="theme-code-group__nav" data-v-2f5f1757><ul class="theme-code-group__ul" data-v-2f5f1757></ul></div> <div class="theme-code-block theme-code-block__active" data-v-4f1e9d0c><div class="language-java line-numbers-mode" data-v-4f1e9d0c><pre class="language-java" data-v-4f1e9d0c><code data-v-4f1e9d0c><span class="token keyword" data-v-4f1e9d0c>package</span> <span class="token namespace" data-v-4f1e9d0c>com<span class="token punctuation" data-v-4f1e9d0c>.</span>kbt</span><span class="token punctuation" data-v-4f1e9d0c>;</span>

<span class="token keyword" data-v-4f1e9d0c>import</span> <span class="token import" data-v-4f1e9d0c><span class="token namespace" data-v-4f1e9d0c>com<span class="token punctuation" data-v-4f1e9d0c>.</span>kbt<span class="token punctuation" data-v-4f1e9d0c>.</span>repository<span class="token punctuation" data-v-4f1e9d0c>.</span></span><span class="token class-name" data-v-4f1e9d0c>ProductRepository</span></span><span class="token punctuation" data-v-4f1e9d0c>;</span>
<span class="token keyword" data-v-4f1e9d0c>import</span> <span class="token import" data-v-4f1e9d0c><span class="token namespace" data-v-4f1e9d0c>com<span class="token punctuation" data-v-4f1e9d0c>.</span>kbt<span class="token punctuation" data-v-4f1e9d0c>.</span>pojo<span class="token punctuation" data-v-4f1e9d0c>.</span></span><span class="token class-name" data-v-4f1e9d0c>Product</span></span><span class="token punctuation" data-v-4f1e9d0c>;</span>
<span class="token keyword" data-v-4f1e9d0c>import</span> <span class="token import" data-v-4f1e9d0c><span class="token namespace" data-v-4f1e9d0c>org<span class="token punctuation" data-v-4f1e9d0c>.</span>junit<span class="token punctuation" data-v-4f1e9d0c>.</span>jupiter<span class="token punctuation" data-v-4f1e9d0c>.</span>api<span class="token punctuation" data-v-4f1e9d0c>.</span></span><span class="token class-name" data-v-4f1e9d0c>Test</span></span><span class="token punctuation" data-v-4f1e9d0c>;</span>
<span class="token keyword" data-v-4f1e9d0c>import</span> <span class="token import" data-v-4f1e9d0c><span class="token namespace" data-v-4f1e9d0c>org<span class="token punctuation" data-v-4f1e9d0c>.</span>springframework<span class="token punctuation" data-v-4f1e9d0c>.</span>beans<span class="token punctuation" data-v-4f1e9d0c>.</span>factory<span class="token punctuation" data-v-4f1e9d0c>.</span>annotation<span class="token punctuation" data-v-4f1e9d0c>.</span></span><span class="token class-name" data-v-4f1e9d0c>Autowired</span></span><span class="token punctuation" data-v-4f1e9d0c>;</span>
<span class="token keyword" data-v-4f1e9d0c>import</span> <span class="token import" data-v-4f1e9d0c><span class="token namespace" data-v-4f1e9d0c>org<span class="token punctuation" data-v-4f1e9d0c>.</span>springframework<span class="token punctuation" data-v-4f1e9d0c>.</span>boot<span class="token punctuation" data-v-4f1e9d0c>.</span>test<span class="token punctuation" data-v-4f1e9d0c>.</span>context<span class="token punctuation" data-v-4f1e9d0c>.</span></span><span class="token class-name" data-v-4f1e9d0c>SpringBootTest</span></span><span class="token punctuation" data-v-4f1e9d0c>;</span>
<span class="token keyword" data-v-4f1e9d0c>import</span> <span class="token import" data-v-4f1e9d0c><span class="token namespace" data-v-4f1e9d0c>org<span class="token punctuation" data-v-4f1e9d0c>.</span>springframework<span class="token punctuation" data-v-4f1e9d0c>.</span>data<span class="token punctuation" data-v-4f1e9d0c>.</span>domain<span class="token punctuation" data-v-4f1e9d0c>.</span></span><span class="token class-name" data-v-4f1e9d0c>Page</span></span><span class="token punctuation" data-v-4f1e9d0c>;</span>
<span class="token keyword" data-v-4f1e9d0c>import</span> <span class="token import" data-v-4f1e9d0c><span class="token namespace" data-v-4f1e9d0c>org<span class="token punctuation" data-v-4f1e9d0c>.</span>springframework<span class="token punctuation" data-v-4f1e9d0c>.</span>data<span class="token punctuation" data-v-4f1e9d0c>.</span>domain<span class="token punctuation" data-v-4f1e9d0c>.</span></span><span class="token class-name" data-v-4f1e9d0c>PageRequest</span></span><span class="token punctuation" data-v-4f1e9d0c>;</span>
<span class="token keyword" data-v-4f1e9d0c>import</span> <span class="token import" data-v-4f1e9d0c><span class="token namespace" data-v-4f1e9d0c>org<span class="token punctuation" data-v-4f1e9d0c>.</span>springframework<span class="token punctuation" data-v-4f1e9d0c>.</span>data<span class="token punctuation" data-v-4f1e9d0c>.</span>domain<span class="token punctuation" data-v-4f1e9d0c>.</span></span><span class="token class-name" data-v-4f1e9d0c>Sort</span></span><span class="token punctuation" data-v-4f1e9d0c>;</span>

<span class="token keyword" data-v-4f1e9d0c>import</span> <span class="token import" data-v-4f1e9d0c><span class="token namespace" data-v-4f1e9d0c>java<span class="token punctuation" data-v-4f1e9d0c>.</span>util<span class="token punctuation" data-v-4f1e9d0c>.</span></span><span class="token class-name" data-v-4f1e9d0c>ArrayList</span></span><span class="token punctuation" data-v-4f1e9d0c>;</span>
<span class="token keyword" data-v-4f1e9d0c>import</span> <span class="token import" data-v-4f1e9d0c><span class="token namespace" data-v-4f1e9d0c>java<span class="token punctuation" data-v-4f1e9d0c>.</span>util<span class="token punctuation" data-v-4f1e9d0c>.</span></span><span class="token class-name" data-v-4f1e9d0c>List</span></span><span class="token punctuation" data-v-4f1e9d0c>;</span>

<span class="token comment" data-v-4f1e9d0c>/**
 * @author Young Kbt
 * @date 2021/11/17 18:51
 * @description ES Repository 测试类
 */</span>
<span class="token annotation punctuation" data-v-4f1e9d0c>@SpringBootTest</span>
<span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>class</span> <span class="token class-name" data-v-4f1e9d0c>ESProductRepositoryTest</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>

    <span class="token annotation punctuation" data-v-4f1e9d0c>@Autowired</span>
    <span class="token keyword" data-v-4f1e9d0c>private</span> <span class="token class-name" data-v-4f1e9d0c>ProductRepository</span> productRepository<span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token comment" data-v-4f1e9d0c>/**
     * 新增
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>save</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token class-name" data-v-4f1e9d0c>Product</span> product <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>Product</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        product<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>setId</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token number" data-v-4f1e9d0c>1</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        product<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>setTitle</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;华为手机&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        product<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>setCategory</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;手机&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        product<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>setPrice</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token number" data-v-4f1e9d0c>2999.0</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        product<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>setImages</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/user/avatar2.png&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        productRepository<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>save</span><span class="token punctuation" data-v-4f1e9d0c>(</span>product<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>

    <span class="token comment" data-v-4f1e9d0c>/**
     * 修改
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>update</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token class-name" data-v-4f1e9d0c>Product</span> product <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>Product</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        product<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>setId</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token number" data-v-4f1e9d0c>1</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        product<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>setTitle</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;小米 2 手机&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        product<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>setCategory</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;手机&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        product<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>setPrice</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token number" data-v-4f1e9d0c>9999.0</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        product<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>setImages</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/user/avatar2.png&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        productRepository<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>save</span><span class="token punctuation" data-v-4f1e9d0c>(</span>product<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>

    <span class="token comment" data-v-4f1e9d0c>/**
     * 根据 id 查询
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>findById</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token class-name" data-v-4f1e9d0c>Product</span> product <span class="token operator" data-v-4f1e9d0c>=</span> productRepository<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>findById</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token number" data-v-4f1e9d0c>1</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>get</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span>product<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>

    <span class="token comment" data-v-4f1e9d0c>/**
     * 查询所有
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>findAll</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token class-name" data-v-4f1e9d0c>Iterable</span><span class="token generics" data-v-4f1e9d0c><span class="token punctuation" data-v-4f1e9d0c>&lt;</span><span class="token class-name" data-v-4f1e9d0c>Product</span><span class="token punctuation" data-v-4f1e9d0c>&gt;</span></span> products <span class="token operator" data-v-4f1e9d0c>=</span> productRepository<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>findAll</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token keyword" data-v-4f1e9d0c>for</span> <span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>Product</span> product <span class="token operator" data-v-4f1e9d0c>:</span> products<span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
            <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span>product<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token punctuation" data-v-4f1e9d0c>}</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>

    <span class="token comment" data-v-4f1e9d0c>/**
     * 删除
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>delete</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token class-name" data-v-4f1e9d0c>Product</span> product <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>Product</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        product<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>setId</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token number" data-v-4f1e9d0c>1</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        productRepository<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>delete</span><span class="token punctuation" data-v-4f1e9d0c>(</span>product<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
    <span class="token comment" data-v-4f1e9d0c>/**
     * 批量新增
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>saveAll</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token class-name" data-v-4f1e9d0c>List</span><span class="token generics" data-v-4f1e9d0c><span class="token punctuation" data-v-4f1e9d0c>&lt;</span><span class="token class-name" data-v-4f1e9d0c>Product</span><span class="token punctuation" data-v-4f1e9d0c>&gt;</span></span> productList <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>ArrayList</span><span class="token generics" data-v-4f1e9d0c><span class="token punctuation" data-v-4f1e9d0c>&lt;</span><span class="token punctuation" data-v-4f1e9d0c>&gt;</span></span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token keyword" data-v-4f1e9d0c>for</span> <span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token keyword" data-v-4f1e9d0c>int</span> i <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token number" data-v-4f1e9d0c>0</span><span class="token punctuation" data-v-4f1e9d0c>;</span> i <span class="token operator" data-v-4f1e9d0c>&lt;</span> <span class="token number" data-v-4f1e9d0c>10</span><span class="token punctuation" data-v-4f1e9d0c>;</span> i<span class="token operator" data-v-4f1e9d0c>++</span><span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
            <span class="token class-name" data-v-4f1e9d0c>Product</span> product <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>Product</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
            product<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>setId</span><span class="token punctuation" data-v-4f1e9d0c>(</span>i<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
            product<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>setTitle</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;[&quot;</span><span class="token operator" data-v-4f1e9d0c>+</span>i<span class="token operator" data-v-4f1e9d0c>+</span><span class="token string" data-v-4f1e9d0c>&quot;]小米手机&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
            product<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>setCategory</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;手机&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
            product<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>setPrice</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token number" data-v-4f1e9d0c>1999.0</span><span class="token operator" data-v-4f1e9d0c>+</span>i<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
            product<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>setImages</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;http://www.youngkbt/xm.jpg&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
            productList<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>add</span><span class="token punctuation" data-v-4f1e9d0c>(</span>product<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token punctuation" data-v-4f1e9d0c>}</span>
        productRepository<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>saveAll</span><span class="token punctuation" data-v-4f1e9d0c>(</span>productList<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
    
    <span class="token comment" data-v-4f1e9d0c>/**
     * 分页查询
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>findByPageable</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token comment" data-v-4f1e9d0c>//设置排序(排序方式，正序还是倒序，排序的 id)</span>
        <span class="token class-name" data-v-4f1e9d0c>Sort</span> sort <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token class-name" data-v-4f1e9d0c>Sort</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>by</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>Sort<span class="token punctuation" data-v-4f1e9d0c>.</span>Direction</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token constant" data-v-4f1e9d0c>DESC</span><span class="token punctuation" data-v-4f1e9d0c>,</span><span class="token string" data-v-4f1e9d0c>&quot;id&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token keyword" data-v-4f1e9d0c>int</span> currentPage <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token number" data-v-4f1e9d0c>0</span><span class="token punctuation" data-v-4f1e9d0c>;</span>  <span class="token comment" data-v-4f1e9d0c>//当前页，第一页从 0 开始，1 表示第二页</span>
        <span class="token keyword" data-v-4f1e9d0c>int</span> pageSize <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token number" data-v-4f1e9d0c>5</span><span class="token punctuation" data-v-4f1e9d0c>;</span>  <span class="token comment" data-v-4f1e9d0c>//每页显示多少条</span>
        <span class="token comment" data-v-4f1e9d0c>//设置查询分页</span>
        <span class="token class-name" data-v-4f1e9d0c>PageRequest</span> pageRequest <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token class-name" data-v-4f1e9d0c>PageRequest</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>of</span><span class="token punctuation" data-v-4f1e9d0c>(</span>currentPage<span class="token punctuation" data-v-4f1e9d0c>,</span> pageSize<span class="token punctuation" data-v-4f1e9d0c>,</span>sort<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>//分页查询</span>
        <span class="token class-name" data-v-4f1e9d0c>Page</span><span class="token generics" data-v-4f1e9d0c><span class="token punctuation" data-v-4f1e9d0c>&lt;</span><span class="token class-name" data-v-4f1e9d0c>Product</span><span class="token punctuation" data-v-4f1e9d0c>&gt;</span></span> productPage <span class="token operator" data-v-4f1e9d0c>=</span> productRepository<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>findAll</span><span class="token punctuation" data-v-4f1e9d0c>(</span>pageRequest<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token keyword" data-v-4f1e9d0c>for</span> <span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>Product</span> <span class="token class-name" data-v-4f1e9d0c>Product</span> <span class="token operator" data-v-4f1e9d0c>:</span> productPage<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getContent</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
            <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>Product</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token punctuation" data-v-4f1e9d0c>}</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
<span class="token punctuation" data-v-4f1e9d0c>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>1</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>2</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>3</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>4</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>5</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>6</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>7</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>8</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>9</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>10</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>11</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>12</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>13</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>14</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>15</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>16</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>17</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>18</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>19</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>20</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>21</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>22</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>23</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>24</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>25</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>26</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>27</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>28</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>29</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>30</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>31</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>32</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>33</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>34</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>35</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>36</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>37</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>38</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>39</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>40</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>41</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>42</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>43</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>44</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>45</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>46</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>47</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>48</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>49</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>50</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>51</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>52</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>53</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>54</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>55</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>56</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>57</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>58</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>59</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>60</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>61</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>62</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>63</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>64</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>65</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>66</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>67</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>68</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>69</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>70</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>71</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>72</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>73</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>74</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>75</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>76</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>77</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>78</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>79</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>80</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>81</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>82</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>83</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>84</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>85</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>86</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>87</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>88</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>89</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>90</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>91</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>92</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>93</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>94</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>95</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>96</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>97</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>98</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>99</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>100</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>101</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>102</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>103</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>104</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>105</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>106</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>107</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>108</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>109</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>110</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>111</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>112</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>113</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>114</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>115</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>116</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>117</span><br data-v-4f1e9d0c></div></div></div> <div class="theme-code-block" data-v-4f1e9d0c><div class="language-java line-numbers-mode" data-v-4f1e9d0c><pre class="language-java" data-v-4f1e9d0c><code data-v-4f1e9d0c><span class="token annotation punctuation" data-v-4f1e9d0c>@SpringBootTest</span>
<span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>class</span> <span class="token class-name" data-v-4f1e9d0c>ESProductRepositoryTest</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>

    <span class="token annotation punctuation" data-v-4f1e9d0c>@Autowired</span>
    <span class="token keyword" data-v-4f1e9d0c>private</span> <span class="token class-name" data-v-4f1e9d0c>ProductRepository</span> productRepository<span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token comment" data-v-4f1e9d0c>/**
     * 新增数据
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>save</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token class-name" data-v-4f1e9d0c>Product</span> product <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>Product</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        product<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>setId</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token number" data-v-4f1e9d0c>1</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        product<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>setTitle</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;华为手机&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        product<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>setCategory</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;手机&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        product<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>setPrice</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token number" data-v-4f1e9d0c>2999.0</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        product<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>setImages</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/user/avatar2.png&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        productRepository<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>save</span><span class="token punctuation" data-v-4f1e9d0c>(</span>product<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
<span class="token punctuation" data-v-4f1e9d0c>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>1</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>2</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>3</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>4</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>5</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>6</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>7</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>8</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>9</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>10</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>11</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>12</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>13</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>14</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>15</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>16</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>17</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>18</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>19</span><br data-v-4f1e9d0c></div></div></div> <div class="theme-code-block" data-v-4f1e9d0c><div class="language-java line-numbers-mode" data-v-4f1e9d0c><pre class="language-java" data-v-4f1e9d0c><code data-v-4f1e9d0c><span class="token annotation punctuation" data-v-4f1e9d0c>@SpringBootTest</span>
<span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>class</span> <span class="token class-name" data-v-4f1e9d0c>ESProductRepositoryTest</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>

    <span class="token annotation punctuation" data-v-4f1e9d0c>@Autowired</span>
    <span class="token keyword" data-v-4f1e9d0c>private</span> <span class="token class-name" data-v-4f1e9d0c>ProductRepository</span> productRepository<span class="token punctuation" data-v-4f1e9d0c>;</span>
     <span class="token comment" data-v-4f1e9d0c>/**
     * 修改数据
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>update</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token class-name" data-v-4f1e9d0c>Product</span> product <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>Product</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        product<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>setId</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token number" data-v-4f1e9d0c>1</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        product<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>setTitle</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;小米 2 手机&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        product<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>setCategory</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;手机&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        product<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>setPrice</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token number" data-v-4f1e9d0c>9999.0</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        product<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>setImages</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/user/avatar2.png&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        productRepository<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>save</span><span class="token punctuation" data-v-4f1e9d0c>(</span>product<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
<span class="token punctuation" data-v-4f1e9d0c>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>1</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>2</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>3</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>4</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>5</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>6</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>7</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>8</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>9</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>10</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>11</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>12</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>13</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>14</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>15</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>16</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>17</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>18</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>19</span><br data-v-4f1e9d0c></div></div></div> <div class="theme-code-block" data-v-4f1e9d0c><div class="language-java line-numbers-mode" data-v-4f1e9d0c><pre class="language-java" data-v-4f1e9d0c><code data-v-4f1e9d0c><span class="token annotation punctuation" data-v-4f1e9d0c>@SpringBootTest</span>
<span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>class</span> <span class="token class-name" data-v-4f1e9d0c>ESProductRepositoryTest</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>

    <span class="token annotation punctuation" data-v-4f1e9d0c>@Autowired</span>
    <span class="token keyword" data-v-4f1e9d0c>private</span> <span class="token class-name" data-v-4f1e9d0c>ProductRepository</span> productRepository<span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token comment" data-v-4f1e9d0c>/**
     * 根据 id 查询数据
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>findById</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token class-name" data-v-4f1e9d0c>Product</span> product <span class="token operator" data-v-4f1e9d0c>=</span> productRepository<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>findById</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token number" data-v-4f1e9d0c>1</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>get</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span>product<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
<span class="token punctuation" data-v-4f1e9d0c>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>1</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>2</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>3</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>4</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>5</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>6</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>7</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>8</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>9</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>10</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>11</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>12</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>13</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>14</span><br data-v-4f1e9d0c></div></div></div> <div class="theme-code-block" data-v-4f1e9d0c><div class="language-java line-numbers-mode" data-v-4f1e9d0c><pre class="language-java" data-v-4f1e9d0c><code data-v-4f1e9d0c><span class="token annotation punctuation" data-v-4f1e9d0c>@SpringBootTest</span>
<span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>class</span> <span class="token class-name" data-v-4f1e9d0c>ESProductRepositoryTest</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>

    <span class="token annotation punctuation" data-v-4f1e9d0c>@Autowired</span>
    <span class="token keyword" data-v-4f1e9d0c>private</span> <span class="token class-name" data-v-4f1e9d0c>ProductRepository</span> productRepository<span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token comment" data-v-4f1e9d0c>/**
     * 查询所有数据
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>findAll</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token class-name" data-v-4f1e9d0c>Iterable</span><span class="token generics" data-v-4f1e9d0c><span class="token punctuation" data-v-4f1e9d0c>&lt;</span><span class="token class-name" data-v-4f1e9d0c>Product</span><span class="token punctuation" data-v-4f1e9d0c>&gt;</span></span> products <span class="token operator" data-v-4f1e9d0c>=</span> productRepository<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>findAll</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token keyword" data-v-4f1e9d0c>for</span> <span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>Product</span> product <span class="token operator" data-v-4f1e9d0c>:</span> products<span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
            <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span>product<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token punctuation" data-v-4f1e9d0c>}</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
<span class="token punctuation" data-v-4f1e9d0c>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>1</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>2</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>3</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>4</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>5</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>6</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>7</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>8</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>9</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>10</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>11</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>12</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>13</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>14</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>15</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>16</span><br data-v-4f1e9d0c></div></div></div> <div class="theme-code-block" data-v-4f1e9d0c><div class="language-java line-numbers-mode" data-v-4f1e9d0c><pre class="language-java" data-v-4f1e9d0c><code data-v-4f1e9d0c><span class="token annotation punctuation" data-v-4f1e9d0c>@SpringBootTest</span>
<span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>class</span> <span class="token class-name" data-v-4f1e9d0c>ESProductRepositoryTest</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>

    <span class="token annotation punctuation" data-v-4f1e9d0c>@Autowired</span>
    <span class="token keyword" data-v-4f1e9d0c>private</span> <span class="token class-name" data-v-4f1e9d0c>ProductRepository</span> productRepository<span class="token punctuation" data-v-4f1e9d0c>;</span>
   <span class="token comment" data-v-4f1e9d0c>/**
     * 删除数据
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>delete</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token class-name" data-v-4f1e9d0c>Product</span> product <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>Product</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        product<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>setId</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token number" data-v-4f1e9d0c>1</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        productRepository<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>delete</span><span class="token punctuation" data-v-4f1e9d0c>(</span>product<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
<span class="token punctuation" data-v-4f1e9d0c>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>1</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>2</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>3</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>4</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>5</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>6</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>7</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>8</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>9</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>10</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>11</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>12</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>13</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>14</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>15</span><br data-v-4f1e9d0c></div></div></div> <div class="theme-code-block" data-v-4f1e9d0c><div class="language-java line-numbers-mode" data-v-4f1e9d0c><pre class="language-java" data-v-4f1e9d0c><code data-v-4f1e9d0c><span class="token annotation punctuation" data-v-4f1e9d0c>@SpringBootTest</span>
<span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>class</span> <span class="token class-name" data-v-4f1e9d0c>ESProductRepositoryTest</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>

    <span class="token annotation punctuation" data-v-4f1e9d0c>@Autowired</span>
    <span class="token keyword" data-v-4f1e9d0c>private</span> <span class="token class-name" data-v-4f1e9d0c>ProductRepository</span> productRepository<span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token comment" data-v-4f1e9d0c>/**
     * 批量新增数据
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>saveAll</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token class-name" data-v-4f1e9d0c>List</span><span class="token generics" data-v-4f1e9d0c><span class="token punctuation" data-v-4f1e9d0c>&lt;</span><span class="token class-name" data-v-4f1e9d0c>Product</span><span class="token punctuation" data-v-4f1e9d0c>&gt;</span></span> productList <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>ArrayList</span><span class="token generics" data-v-4f1e9d0c><span class="token punctuation" data-v-4f1e9d0c>&lt;</span><span class="token punctuation" data-v-4f1e9d0c>&gt;</span></span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token keyword" data-v-4f1e9d0c>for</span> <span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token keyword" data-v-4f1e9d0c>int</span> i <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token number" data-v-4f1e9d0c>0</span><span class="token punctuation" data-v-4f1e9d0c>;</span> i <span class="token operator" data-v-4f1e9d0c>&lt;</span> <span class="token number" data-v-4f1e9d0c>10</span><span class="token punctuation" data-v-4f1e9d0c>;</span> i<span class="token operator" data-v-4f1e9d0c>++</span><span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
            <span class="token class-name" data-v-4f1e9d0c>Product</span> product <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>Product</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
            product<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>setId</span><span class="token punctuation" data-v-4f1e9d0c>(</span>i<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
            product<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>setTitle</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;[&quot;</span><span class="token operator" data-v-4f1e9d0c>+</span>i<span class="token operator" data-v-4f1e9d0c>+</span><span class="token string" data-v-4f1e9d0c>&quot;]小米手机&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
            product<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>setCategory</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;手机&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
            product<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>setPrice</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token number" data-v-4f1e9d0c>1999.0</span><span class="token operator" data-v-4f1e9d0c>+</span>i<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
            product<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>setImages</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;http://www.youngkbt/xm.jpg&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
            productList<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>add</span><span class="token punctuation" data-v-4f1e9d0c>(</span>product<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token punctuation" data-v-4f1e9d0c>}</span>
        productRepository<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>saveAll</span><span class="token punctuation" data-v-4f1e9d0c>(</span>productList<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
<span class="token punctuation" data-v-4f1e9d0c>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>1</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>2</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>3</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>4</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>5</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>6</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>7</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>8</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>9</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>10</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>11</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>12</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>13</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>14</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>15</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>16</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>17</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>18</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>19</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>20</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>21</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>22</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>23</span><br data-v-4f1e9d0c></div></div></div> <div class="theme-code-block" data-v-4f1e9d0c><div class="language-java line-numbers-mode" data-v-4f1e9d0c><pre class="language-java" data-v-4f1e9d0c><code data-v-4f1e9d0c><span class="token annotation punctuation" data-v-4f1e9d0c>@SpringBootTest</span>
<span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>class</span> <span class="token class-name" data-v-4f1e9d0c>ESProductRepositoryTest</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>

    <span class="token annotation punctuation" data-v-4f1e9d0c>@Autowired</span>
    <span class="token keyword" data-v-4f1e9d0c>private</span> <span class="token class-name" data-v-4f1e9d0c>ProductRepository</span> productRepository<span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token comment" data-v-4f1e9d0c>/**
     * 分页查询数据
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>findByPageable</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token comment" data-v-4f1e9d0c>//设置排序(排序方式，正序还是倒序，排序的 id)</span>
        <span class="token class-name" data-v-4f1e9d0c>Sort</span> sort <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token class-name" data-v-4f1e9d0c>Sort</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>by</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>Sort<span class="token punctuation" data-v-4f1e9d0c>.</span>Direction</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token constant" data-v-4f1e9d0c>DESC</span><span class="token punctuation" data-v-4f1e9d0c>,</span><span class="token string" data-v-4f1e9d0c>&quot;id&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token keyword" data-v-4f1e9d0c>int</span> currentPage <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token number" data-v-4f1e9d0c>0</span><span class="token punctuation" data-v-4f1e9d0c>;</span>  <span class="token comment" data-v-4f1e9d0c>//当前页，第一页从 0 开始，1 表示第二页</span>
        <span class="token keyword" data-v-4f1e9d0c>int</span> pageSize <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token number" data-v-4f1e9d0c>5</span><span class="token punctuation" data-v-4f1e9d0c>;</span>  <span class="token comment" data-v-4f1e9d0c>//每页显示多少条</span>
        <span class="token comment" data-v-4f1e9d0c>//设置查询分页</span>
        <span class="token class-name" data-v-4f1e9d0c>PageRequest</span> pageRequest <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token class-name" data-v-4f1e9d0c>PageRequest</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>of</span><span class="token punctuation" data-v-4f1e9d0c>(</span>currentPage<span class="token punctuation" data-v-4f1e9d0c>,</span> pageSize<span class="token punctuation" data-v-4f1e9d0c>,</span>sort<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>//分页查询</span>
        <span class="token class-name" data-v-4f1e9d0c>Page</span><span class="token generics" data-v-4f1e9d0c><span class="token punctuation" data-v-4f1e9d0c>&lt;</span><span class="token class-name" data-v-4f1e9d0c>Product</span><span class="token punctuation" data-v-4f1e9d0c>&gt;</span></span> productPage <span class="token operator" data-v-4f1e9d0c>=</span> productRepository<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>findAll</span><span class="token punctuation" data-v-4f1e9d0c>(</span>pageRequest<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token keyword" data-v-4f1e9d0c>for</span> <span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>Product</span> <span class="token class-name" data-v-4f1e9d0c>Product</span> <span class="token operator" data-v-4f1e9d0c>:</span> productPage<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getContent</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
            <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>Product</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token punctuation" data-v-4f1e9d0c>}</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
<span class="token punctuation" data-v-4f1e9d0c>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>1</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>2</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>3</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>4</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>5</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>6</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>7</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>8</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>9</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>10</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>11</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>12</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>13</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>14</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>15</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>16</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>17</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>18</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>19</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>20</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>21</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>22</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>23</span><br data-v-4f1e9d0c></div></div></div> <pre class="pre-blank" data-v-2f5f1757>// Make sure to add code blocks to your code group</pre></div> <h3 id="repository类自定义测试"><a href="#repository类自定义测试" class="header-anchor">#</a> Repository类自定义测试</h3> <p>Spring Data 的 Repository 接口提供了一种声明式的数据操作规范，无序编写任何代码，只需遵循 Spring Data 的方法定义规范即可完成数据的操作。</p> <p>ES 的 Repository 只有基本的增删改查操作，没有聚合查询，所以需要使用官方提供的自定义方法。并且官方有命名规范</p> <p>自定义数据操作方法需要遵循 Repository 规范，示例如下：</p> <table><thead><tr><th>关键词</th> <th>方法名</th> <th>Elasticsearch 查询字符串</th></tr></thead> <tbody><tr><td>And</td> <td>findByNameAndPrice</td> <td>{ &quot;query&quot; : { &quot;bool&quot; : { &quot;must&quot; : [ { &quot;query_string&quot; : { &quot;query&quot; : &quot;?&quot;, &quot;fields&quot; : [ &quot;name&quot; ] } }, { &quot;query_string&quot; : { &quot;query&quot; : &quot;?&quot;, &quot;fields&quot; : [ &quot;price&quot; ] } } ] } }}</td></tr> <tr><td>Or</td> <td>findByNameOrPrice</td> <td>{ &quot;query&quot; : { &quot;bool&quot; : { &quot;should&quot; : [ { &quot;query_string&quot; : { &quot;query&quot; : &quot;?&quot;, &quot;fields&quot; : [ &quot;name&quot; ] } }, { &quot;query_string&quot; : { &quot;query&quot; : &quot;?&quot;, &quot;fields&quot; : [ &quot;price&quot; ] } } ] } }}</td></tr> <tr><td>Is</td> <td>findByName</td> <td>{ &quot;query&quot; : { &quot;bool&quot; : { &quot;must&quot; : [ { &quot;query_string&quot; : { &quot;query&quot; : &quot;?&quot;, &quot;fields&quot; : [ &quot;name&quot; ] } } ] } }}</td></tr> <tr><td>Not</td> <td>findByNameNot</td> <td>{ &quot;query&quot; : { &quot;bool&quot; : { &quot;must_not&quot; : [ { &quot;query_string&quot; : { &quot;query&quot; : &quot;?&quot;, &quot;fields&quot; : [ &quot;name&quot; ] } } ] } }}</td></tr> <tr><td>Between</td> <td>findByPriceBetween</td> <td>{ &quot;query&quot; : { &quot;bool&quot; : { &quot;must&quot; : [ {&quot;range&quot; : {&quot;price&quot; : {&quot;from&quot; : ?, &quot;to&quot; : ?, &quot;include_lower&quot; : true, &quot;include_upper&quot; : true } } } ] } }}</td></tr> <tr><td>LessThan</td> <td>findByPriceLessThan</td> <td>{ &quot;query&quot; : { &quot;bool&quot; : { &quot;must&quot; : [ {&quot;range&quot; : {&quot;price&quot; : {&quot;from&quot; : null, &quot;to&quot; : ?, &quot;include_lower&quot; : true, &quot;include_upper&quot; : false } } } ] } }}</td></tr> <tr><td>LessThanEqual</td> <td>findByPriceLessThanEqual</td> <td>{ &quot;query&quot; : { &quot;bool&quot; : { &quot;must&quot; : [ {&quot;range&quot; : {&quot;price&quot; : {&quot;from&quot; : null, &quot;to&quot; : ?, &quot;include_lower&quot; : true, &quot;include_upper&quot; : true } } } ] } }}</td></tr> <tr><td>GreaterThan</td> <td>findByPriceGreaterThan</td> <td>{ &quot;query&quot; : { &quot;bool&quot; : { &quot;must&quot; : [ {&quot;range&quot; : {&quot;price&quot; : {&quot;from&quot; : ?, &quot;to&quot; : null, &quot;include_lower&quot; : false, &quot;include_upper&quot; : true } } } ] } }}</td></tr> <tr><td>GreaterThanEqual</td> <td>findByPriceGreaterThan</td> <td>{ &quot;query&quot; : { &quot;bool&quot; : { &quot;must&quot; : [ {&quot;range&quot; : {&quot;price&quot; : {&quot;from&quot; : ?, &quot;to&quot; : null, &quot;include_lower&quot; : true, &quot;include_upper&quot; : true } } } ] } }}</td></tr> <tr><td>Before</td> <td>findByPriceBefore</td> <td>{ &quot;query&quot; : { &quot;bool&quot; : { &quot;must&quot; : [ {&quot;range&quot; : {&quot;price&quot; : {&quot;from&quot; : null, &quot;to&quot; : ?, &quot;include_lower&quot; : true, &quot;include_upper&quot; : true } } } ] } }}</td></tr> <tr><td>After</td> <td>findByPriceAfter</td> <td>{ &quot;query&quot; : { &quot;bool&quot; : { &quot;must&quot; : [ {&quot;range&quot; : {&quot;price&quot; : {&quot;from&quot; : ?, &quot;to&quot; : null, &quot;include_lower&quot; : true, &quot;include_upper&quot; : true } } } ] } }}</td></tr> <tr><td>Like</td> <td>findByNameLike</td> <td>{ &quot;query&quot; : { &quot;bool&quot; : { &quot;must&quot; : [ { &quot;query_string&quot; : { &quot;query&quot; : &quot;?*&quot;, &quot;fields&quot; : [ &quot;name&quot; ] }, &quot;analyze_wildcard&quot;: true } ] } }}</td></tr> <tr><td>StartingWith</td> <td>findByNameStartingWith</td> <td>{ &quot;query&quot; : { &quot;bool&quot; : { &quot;must&quot; : [ { &quot;query_string&quot; : { &quot;query&quot; : &quot;?*&quot;, &quot;fields&quot; : [ &quot;name&quot; ] }, &quot;analyze_wildcard&quot;: true } ] } }}</td></tr> <tr><td>EndingWith</td> <td>findByNameEndingWith</td> <td>{ &quot;query&quot; : { &quot;bool&quot; : { &quot;must&quot; : [ { &quot;query_string&quot; : { &quot;query&quot; : &quot;*?&quot;, &quot;fields&quot; : [ &quot;name&quot; ] }, &quot;analyze_wildcard&quot;: true } ] } }}</td></tr> <tr><td>Contains/Containing</td> <td>findByNameContaining</td> <td>{ &quot;query&quot; : { &quot;bool&quot; : { &quot;must&quot; : [ { &quot;query_string&quot; : { &quot;query&quot; : &quot;<em>?</em>&quot;, &quot;fields&quot; : [ &quot;name&quot; ] }, &quot;analyze_wildcard&quot;: true } ] } }}</td></tr> <tr><td>In</td> <td>findByNameIn(Collectionnames)</td> <td>{ &quot;query&quot; : { &quot;bool&quot; : { &quot;must&quot; : [ {&quot;bool&quot; : {&quot;must&quot; : [ {&quot;terms&quot; : {&quot;name&quot; : [&quot;?&quot;,&quot;?&quot;]}} ] } } ] } }}</td></tr> <tr><td>NotIn</td> <td>findByNameNotIn(Collectionnames)</td> <td>{ &quot;query&quot; : { &quot;bool&quot; : { &quot;must&quot; : [ {&quot;bool&quot; : {&quot;must_not&quot; : [ {&quot;terms&quot; : {&quot;name&quot; : [&quot;?&quot;,&quot;?&quot;]}} ] } } ] } }}</td></tr> <tr><td>Near</td> <td>findByStoreNear</td> <td>Not Supported Yet !（不支持了）</td></tr> <tr><td>True</td> <td>findByAvailableTrue</td> <td>{ &quot;query&quot; : { &quot;bool&quot; : { &quot;must&quot; : [ { &quot;query_string&quot; : { &quot;query&quot; : &quot;true&quot;, &quot;fields&quot; : [ &quot;available&quot; ] } } ] } }}</td></tr> <tr><td>False</td> <td>findByAvailableFalse</td> <td>{ &quot;query&quot; : { &quot;bool&quot; : { &quot;must&quot; : [ { &quot;query_string&quot; : { &quot;query&quot; : &quot;false&quot;, &quot;fields&quot; : [ &quot;available&quot; ] } } ] } }}</td></tr> <tr><td>OrderBy</td> <td>findByAvailableTrueOrderByNameDesc</td> <td>{ &quot;query&quot; : { &quot;bool&quot; : { &quot;must&quot; : [ { &quot;query_string&quot; : { &quot;query&quot; : &quot;true&quot;, &quot;fields&quot; : [ &quot;available&quot; ] } } ] } }, &quot;sort&quot;:[{&quot;name&quot;:{&quot;order&quot;:&quot;desc&quot;}}] }</td></tr></tbody></table> <p>看不懂什么意思吗？下面来看看示例，然后回头看表格就明白了。</p> <blockquote><p><strong>需求 1：不想通过 id 查询 数据，想通过其他字段如 category 查询数据</strong></p></blockquote> <blockquote><p><strong>需求2：既想查询商品分类名 category，又想查询商品价格 price 的数据</strong></p></blockquote> <p>首先在自定义的 <code>Repository</code> 类代码按照规范写代码：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ProductRepository</span> <span class="token keyword">extends</span> <span class="token class-name">ElasticsearchRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">,</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token comment">// 需求 1</span>
   <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">&gt;</span></span> <span class="token function">findProductByCategory</span><span class="token punctuation">(</span><span class="token class-name">String</span> category<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">// 需求 2</span>
   <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">&gt;</span></span> <span class="token function">findProductByCategoryAndPrice</span><span class="token punctuation">(</span><span class="token class-name">String</span> category<span class="token punctuation">,</span> <span class="token class-name">Double</span> price<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>可以看出根据规范，有 findXxxByXxx、findXxxByXxxAndXxx、findXxxByXxxOrXxx等格式，其实用 Ideal 工具，输入 find，它就会弹出很多的提示信息。</p> <div class="custom-block note"><p class="custom-block-title">笔记</p> <p>只需要写接口方法，不需要写这些方法实现，因为 ES 已经写好了，只不过没有放在 <code>ElasticsearchRepository</code> 接口，只需要我们自定义写出来。</p> <div class="custom-block right"><p>2021-11-17 @Young Kbt</p></div></div> <p>测试类：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kbt</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>kbt<span class="token punctuation">.</span>repository<span class="token punctuation">.</span></span><span class="token class-name">ProductRepository</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>kbt<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">Product</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">SpringBootTest</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author Young Kbt
 * @date 2021/11/17 19:07
 * @description ES 自定义 Repository 测试类
 */</span>
<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ESSearchTest</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">ProductRepository</span> productRepository<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 通过某个字段查询数据
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">docQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">&gt;</span></span> productList <span class="token operator">=</span> productRepository<span class="token punctuation">.</span><span class="token function">findProductByCategory</span><span class="token punctuation">(</span><span class="token string">&quot;手机&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Product</span> product <span class="token operator">:</span> productList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>product<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/**
     * term 查询
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">termQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">&gt;</span></span> productList <span class="token operator">=</span> productRepository<span class="token punctuation">.</span><span class="token function">findProductByCategoryAndPrice</span><span class="token punctuation">(</span><span class="token string">&quot;手机&quot;</span><span class="token punctuation">,</span> <span class="token number">2004.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Product</span> p <span class="token operator">:</span> productList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><h3 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h3> <p>封装类的逻辑更趋向于原生 API，需要过硬的逻辑步骤去完成 ES 操作。</p> <p>Repository 类完全依赖框架，简单的代码就可以实现丰富的操作，但是没有过多的逻辑，容易变成 CURD 工程师，即根本不知道内部的逻辑和原理。</p> <h3 id="案例分析"><a href="#案例分析" class="header-anchor">#</a> 案例分析</h3> <blockquote><p>DDL</p></blockquote> <p>按照如下的 DDL 语句编写代码：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>GET /office/_search
<span class="token punctuation">{</span>
  <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;bool&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;must&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token property">&quot;match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;skuTitle&quot;</span><span class="token operator">:</span> <span class="token string">&quot;华为&quot;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token property">&quot;filter&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token property">&quot;term&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;catalogId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;120&quot;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token property">&quot;terms&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;branchId&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
              <span class="token string">&quot;120&quot;</span><span class="token punctuation">,</span>
              <span class="token string">&quot;112&quot;</span>
            <span class="token punctuation">]</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token property">&quot;nested&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;attrs&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token property">&quot;bool&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;must&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                  <span class="token punctuation">{</span>
                    <span class="token property">&quot;term&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                      <span class="token property">&quot;attrs.attrId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;15&quot;</span>
                    <span class="token punctuation">}</span>
                  <span class="token punctuation">}</span><span class="token punctuation">,</span>
                  <span class="token punctuation">{</span>
                    <span class="token property">&quot;terms&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                      <span class="token property">&quot;attrs.attrValue&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                        <span class="token string">&quot;华为&quot;</span><span class="token punctuation">,</span>
                        <span class="token string">&quot;海思&quot;</span>
                      <span class="token punctuation">]</span>
                    <span class="token punctuation">}</span>
                  <span class="token punctuation">}</span>
                <span class="token punctuation">]</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token property">&quot;term&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;hasStock&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0&quot;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token property">&quot;range&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;skiPrice&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token property">&quot;gte&quot;</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
              <span class="token property">&quot;lte&quot;</span><span class="token operator">:</span> <span class="token number">20</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;aggs&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;brand_agg&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;terms&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;field&quot;</span><span class="token operator">:</span> <span class="token string">&quot;brandId&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;size&quot;</span><span class="token operator">:</span> <span class="token number">10</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;aggs&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;brand_name_agg&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;terms&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;field&quot;</span><span class="token operator">:</span> <span class="token string">&quot;brandName&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;size&quot;</span><span class="token operator">:</span> <span class="token number">10</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;brand_img_agg&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;terms&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;field&quot;</span><span class="token operator">:</span> <span class="token string">&quot;brandImg&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;size&quot;</span><span class="token operator">:</span> <span class="token number">10</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;catalog_agg&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;terms&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;field&quot;</span><span class="token operator">:</span> <span class="token string">&quot;catalogId&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;size&quot;</span><span class="token operator">:</span> <span class="token number">10</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;aggs&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;catalog_name_agg&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;terms&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;field&quot;</span><span class="token operator">:</span> <span class="token string">&quot;catalogName&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;size&quot;</span><span class="token operator">:</span> <span class="token number">10</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;attr_agg&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;nested&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;attrs&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;aggs&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;attr_id_agg&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;terms&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;field&quot;</span><span class="token operator">:</span> <span class="token string">&quot;attrs.attr_id&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;size&quot;</span><span class="token operator">:</span> <span class="token number">10</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token property">&quot;aggs&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;attr_name_agg&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token property">&quot;terms&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;field&quot;</span><span class="token operator">:</span> <span class="token string">&quot;attrs.attrName&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;size&quot;</span><span class="token operator">:</span> <span class="token number">10</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">&quot;attr_value_agg&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token property">&quot;terms&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;field&quot;</span><span class="token operator">:</span> <span class="token string">&quot;attrs.attrValue&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;size&quot;</span><span class="token operator">:</span> <span class="token number">10</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;sort&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;age&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;order&quot;</span><span class="token operator">:</span> <span class="token string">&quot;desc&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;highlight&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;pre_tags&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&lt;b style='color: red'&gt;&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;post_tags&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&lt;/b&gt;&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;fields&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;skuTitle&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;from&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">&quot;size&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br></div></div><p>Java 代码：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">search</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">NativeSearchQueryBuilder</span> nativeSearchQueryBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NativeSearchQueryBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/**
     * 查询
     */</span>
    <span class="token class-name">BoolQueryBuilder</span> boolQueryBuilder <span class="token operator">=</span> <span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">boolQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    boolQueryBuilder<span class="token punctuation">.</span><span class="token function">must</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">matchQuery</span><span class="token punctuation">(</span><span class="token string">&quot;skuTitle&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;华为&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    boolQueryBuilder<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">termQuery</span><span class="token punctuation">(</span><span class="token string">&quot;catalogId&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;120&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    boolQueryBuilder<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">termsQuery</span><span class="token punctuation">(</span><span class="token string">&quot;brandId&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;120&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;112&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// nest 查询</span>
    <span class="token class-name">BoolQueryBuilder</span> nestBoolQuery <span class="token operator">=</span> <span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">boolQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    nestBoolQuery<span class="token punctuation">.</span><span class="token function">must</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">termQuery</span><span class="token punctuation">(</span><span class="token string">&quot;attrs.attrId&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;18&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    nestBoolQuery<span class="token punctuation">.</span><span class="token function">must</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">termsQuery</span><span class="token punctuation">(</span><span class="token string">&quot;attrs.attrValue&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;华为&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;海思&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    boolQueryBuilder<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">nestedQuery</span><span class="token punctuation">(</span><span class="token string">&quot;attr&quot;</span><span class="token punctuation">,</span> nestBoolQuery<span class="token punctuation">,</span> <span class="token class-name">ScoreMode<span class="token punctuation">.</span>None</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    boolQueryBuilder<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">termQuery</span><span class="token punctuation">(</span><span class="token string">&quot;hashStock&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    boolQueryBuilder<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">rangeQuery</span><span class="token punctuation">(</span><span class="token string">&quot;skuPrice&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">gte</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lt</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    nativeSearchQueryBuilder<span class="token punctuation">.</span><span class="token function">withQuery</span><span class="token punctuation">(</span>boolQueryBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/**
     * 排序、分页、高亮
     */</span>
    nativeSearchQueryBuilder<span class="token punctuation">.</span><span class="token function">withSorts</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FieldSortBuilder</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">order</span><span class="token punctuation">(</span><span class="token class-name">SortOrder</span><span class="token punctuation">.</span><span class="token constant">DESC</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    nativeSearchQueryBuilder<span class="token punctuation">.</span><span class="token function">withPageable</span><span class="token punctuation">(</span><span class="token class-name">PageRequest</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    nativeSearchQueryBuilder<span class="token punctuation">.</span><span class="token function">withHighlightBuilder</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HighlightBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;skuTitle&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">preTags</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;b style='color: red'&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">postTags</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;/b&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/**
     * 聚合
     */</span>
    <span class="token class-name">TermsAggregationBuilder</span> brandAgg <span class="token operator">=</span> <span class="token class-name">AggregationBuilders</span><span class="token punctuation">.</span><span class="token function">terms</span><span class="token punctuation">(</span><span class="token string">&quot;brand_agg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;brandId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">TermsAggregationBuilder</span> brandName <span class="token operator">=</span> <span class="token class-name">AggregationBuilders</span><span class="token punctuation">.</span><span class="token function">terms</span><span class="token punctuation">(</span><span class="token string">&quot;brand_name_agg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;brandName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token number">1010</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">TermsAggregationBuilder</span> brandImg <span class="token operator">=</span> <span class="token class-name">AggregationBuilders</span><span class="token punctuation">.</span><span class="token function">terms</span><span class="token punctuation">(</span><span class="token string">&quot;brand_img_agg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;brandImg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// brandAgg 子聚合</span>
    brandAgg<span class="token punctuation">.</span><span class="token function">subAggregation</span><span class="token punctuation">(</span>brandName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subAggregation</span><span class="token punctuation">(</span>brandImg<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">TermsAggregationBuilder</span> catalogId <span class="token operator">=</span> <span class="token class-name">AggregationBuilders</span><span class="token punctuation">.</span><span class="token function">terms</span><span class="token punctuation">(</span><span class="token string">&quot;catalog_agg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;catalogId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">TermsAggregationBuilder</span> catalogName <span class="token operator">=</span> <span class="token class-name">AggregationBuilders</span><span class="token punctuation">.</span><span class="token function">terms</span><span class="token punctuation">(</span><span class="token string">&quot;brand_name_agg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;catalogName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    catalogId<span class="token punctuation">.</span><span class="token function">subAggregation</span><span class="token punctuation">(</span>catalogName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// nest 聚合</span>
    <span class="token class-name">NestedAggregationBuilder</span> nestedAgg <span class="token operator">=</span> <span class="token class-name">AggregationBuilders</span><span class="token punctuation">.</span><span class="token function">nested</span><span class="token punctuation">(</span><span class="token string">&quot;attr_agg&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;attrs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">TermsAggregationBuilder</span> attrId <span class="token operator">=</span> <span class="token class-name">AggregationBuilders</span><span class="token punctuation">.</span><span class="token function">terms</span><span class="token punctuation">(</span><span class="token string">&quot;attr_id_agg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;attrs.attrId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">TermsAggregationBuilder</span> attrName <span class="token operator">=</span> <span class="token class-name">AggregationBuilders</span><span class="token punctuation">.</span><span class="token function">terms</span><span class="token punctuation">(</span><span class="token string">&quot;attr_name_agg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;attrs.attrName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">TermsAggregationBuilder</span> attrValue <span class="token operator">=</span> <span class="token class-name">AggregationBuilders</span><span class="token punctuation">.</span><span class="token function">terms</span><span class="token punctuation">(</span><span class="token string">&quot;attr_value_agg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;attrs.attrValue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    attrId<span class="token punctuation">.</span><span class="token function">subAggregation</span><span class="token punctuation">(</span>attrName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subAggregation</span><span class="token punctuation">(</span>attrValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
    nestedAgg<span class="token punctuation">.</span><span class="token function">subAggregation</span><span class="token punctuation">(</span>attrId<span class="token punctuation">)</span><span class="token punctuation">;</span>

    nativeSearchQueryBuilder<span class="token punctuation">.</span><span class="token function">withAggregations</span><span class="token punctuation">(</span>brandAgg<span class="token punctuation">,</span> catalogId<span class="token punctuation">,</span> nestedAgg<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">SearchHits</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Example</span><span class="token punctuation">&gt;</span></span> search <span class="token operator">=</span> elasticsearchOperations<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span>nativeSearchQueryBuilder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Example</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;search：&quot;</span> <span class="token operator">+</span> search<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SearchHit</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Example</span><span class="token punctuation">&gt;</span></span> searchHit <span class="token operator">:</span> search<span class="token punctuation">.</span><span class="token function">getSearchHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>searchHit<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br></div></div><h2 id="spring-boot框架集成"><a href="#spring-boot框架集成" class="header-anchor">#</a> Spring Boot框架集成</h2> <h3 id="spring-boot介绍"><a href="#spring-boot介绍" class="header-anchor">#</a> Spring Boot介绍</h3> <p>Spring 是一个开源框架，Spring 是于 2003 年兴起的一个轻量级的 Java 开发框架，由 Rod Johnson 在其著作《Expert One-On-One J2EE Development and Design》。Spring 是为了解决企业级应用开发的复杂性而创建的，使用 Spring 可以让简单的 JavaBean 实现之前只有 EJB 才能完成的事情。但是 Spring 不仅仅局限于服务器端开发，任何 Java 应用都能在简单性、可测试性和松耦合性等方面从 Spring 中获益。</p> <p>Spring Boot 是所有基于 Spring 开发的项目的起点。Spring Boot 的设计是为了让你尽可能快的跑起来 Spring 应用程序并且尽可能减少你的配置文件。简单来说就是 Spring Boot 其实不是什么新的框架，它默认配置了很多框架的使用方式，就像 Maven 整合了大部分的 jar 包，Spring Boot 整合了大部分的框架</p> <h3 id="springboot的特点"><a href="#springboot的特点" class="header-anchor">#</a> SpringBoot的特点</h3> <ul><li><p>为基于 Spring 的开发提供更快的入门体验</p></li> <li><p>开箱即用，没有代码生成，也无需 XML 配置。同时也可以修改默认值来满足特定的需求</p></li> <li><p>提供了一些大型项目中常见的非功能性特性，如嵌入式服务器、安全、指标，健康检测、外部配置等</p></li> <li><p>SpringBoot 不是对 Spring 功能上的增强，而是提供了一种快速使用 Spring 的方式</p></li></ul> <h3 id="data框架和boot框架集成区别"><a href="#data框架和boot框架集成区别" class="header-anchor">#</a> Data框架和Boot框架集成区别</h3> <p>其实  <a href="#spring-data%E6%A1%86%E6%9E%B6%E9%9B%86%E6%88%90">Spring Data 框架集成</a> 中，已经使用了 Spring Boot，本内容的框架集成指的是单纯将 Spring Boot和 ElasticSearch 整合，没有用到 Spring Data 框架的 Repository 以及 ElasticsearchOperations 接口。</p> <p>两个框架集成的 <strong>区别</strong> 就在于 Spring Data 对于 ES 的操作封装更加彻底，实体类可以写注解进行映射和配置索引名等，并且支持 Spring Boot。而 Spring Boot 框架集成则是将 Spring Boot 框架和 ES 的 Java API 进行集成。不懂 Java API 的可以去看 <a href="/es/java-curd/">ElasticSearch - Java操作</a></p> <p>两个框架集成的 <strong>选择</strong> 建议选择 Spring Data 框架集成，它封装的更加彻底，让你几行代码就能执行 ES 的大部分操作，当然，因为操作过于简单，它牺牲了步骤逻辑。如果想了解步骤逻辑，可以使用 Spring Boot 框架集成，虽然使用繁琐，代码步骤重复，但是操作起来和 Kibana 、 Postman 的操作逻辑更加吻合。</p> <p><strong>总结</strong>：Spring Data 框架集成操作简单，快速开发，牺牲步骤逻辑，可使用 Spring Boot 框架集成进行辅助开发，类似于 <code>Mybatis</code>；Spring Boot 框架集成操作繁琐，逻辑步骤重复，类似于<code>原生 JDBC</code>。</p> <h3 id="框架搭建-2"><a href="#框架搭建-2" class="header-anchor">#</a> 框架搭建</h3> <ul><li><p>新建一个 Maven 项目</p></li> <li><p>修改 pom 文件，增加依赖</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--ES 客户端--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.elasticsearch.client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>elasticsearch-rest-high-level-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>7.15.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.elasticsearch<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>elasticsearch<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.elasticsearch<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>elasticsearch<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>7.15.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.5.5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.5.5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.fasterxml.jackson.core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jackson-databind<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.9.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><p>ES 客户端的依赖版本要和 ES 服务器版本一致</p></li> <li><p>添加配置文件，在 resources 目录中增加 application.yml 文件</p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> es<span class="token punctuation">-</span>springboot
<span class="token key atrule">elasticsearch</span><span class="token punctuation">:</span>
  <span class="token key atrule">host-list</span><span class="token punctuation">:</span> 127.0.0.1<span class="token punctuation">:</span><span class="token number">9200</span>  <span class="token comment"># 多个节点用逗号分隔</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>ES 配置类，进行地址和端口的配置</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kbt<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpHost</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">RestClient</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">RestHighLevelClient</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Value</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>context<span class="token punctuation">.</span>properties<span class="token punctuation">.</span></span><span class="token class-name">ConfigurationProperties</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author Young Kbt
 * @date 2021/11/17 17:33
 * @description ElasticSearch 配置类
 */</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">&quot;elasticsearch&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ElasticSearchConfig</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${elasticsearch.host-list}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> hostList<span class="token punctuation">;</span>

    <span class="token comment">// 关闭数据源</span>
    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>destroyMethod <span class="token operator">=</span> <span class="token string">&quot;close&quot;</span><span class="token punctuation">)</span>
    <span class="token comment">// 遍历获取 application.yml 文件的地址端口，逗号隔开</span>
    <span class="token keyword">public</span> <span class="token class-name">RestHighLevelClient</span> <span class="token function">restHighLevelClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> split <span class="token operator">=</span> hostList<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">HttpHost</span><span class="token punctuation">[</span><span class="token punctuation">]</span> httpHostsArray <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpHost</span><span class="token punctuation">[</span>split<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> split<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> item <span class="token operator">=</span> split<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
            httpHostsArray<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpHost</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;:&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;:&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;http&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RestHighLevelClient</span><span class="token punctuation">(</span><span class="token class-name">RestClient</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span>httpHostsArray<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div></li></ul> <div class="custom-block note"><p class="custom-block-title">两个框架搭建区别</p> <p>增加 application.yml 文件和添加 ES 配置类完全可以按照 Spring Data 框架集成的进行搭建，它的 ES 地址和端口在配置类进行配置，不涉及 application.yml 文件。</p> <p>这里主要演示在 application.yml 文件添加 ES 地址和端口，然后在 ES 配置类进行遍历获取。</p> <p>两个搭建根据需求自行选择。</p> <div class="custom-block right"><p>2021-11-18 @Young Kbt</p></div></div> <ul><li><p>添加实体类，没有集成 Spring Data 框架，所以无法使用注解进行映射设置，只能在发送请求给 ES 时，进行映射设置</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * 用户名
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>
    <span class="token comment">/**
     * 年龄
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> age<span class="token punctuation">;</span>
    <span class="token comment">/**
     * 性别
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> sex<span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token keyword">int</span> age<span class="token punctuation">,</span> <span class="token class-name">String</span> sex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>username <span class="token operator">=</span> username<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>sex <span class="token operator">=</span> sex<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

	<span class="token comment">// set</span>
    <span class="token comment">// get</span>
    <span class="token comment">// toString</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>请加入 Set 和 Get 和 toString 方法，toString 方法是为了测试期间直接打印在控制台。</p></li></ul> <h3 id="连接测试"><a href="#连接测试" class="header-anchor">#</a> 连接测试</h3> <p>首先判断是否成功连接了 ES 服务器</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * @author Young Kbt
 * @date 2021/11/18 12:41
 * @description 是否连接 ES 客户端测试类
 */</span>
<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ESClientTest</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RestHighLevelClient</span> client<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testESClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>client<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>如果返回 <code>RestHighLevelClient</code> 的地址，则说明成功，如：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span>RestHighLevelClient</span><span class="token annotation punctuation">@7a904f32</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="索引测试"><a href="#索引测试" class="header-anchor">#</a> 索引测试</h3> <p>索引的 CRD 代码如下：</p> <div class="theme-code-group" data-v-2f5f1757><div class="theme-code-group__nav" data-v-2f5f1757><ul class="theme-code-group__ul" data-v-2f5f1757></ul></div> <div class="theme-code-block theme-code-block__active" data-v-4f1e9d0c><div class="language-java line-numbers-mode" data-v-4f1e9d0c><pre class="language-java" data-v-4f1e9d0c><code data-v-4f1e9d0c><span class="token annotation punctuation" data-v-4f1e9d0c>@SpringBootTest</span>
<span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>class</span> <span class="token class-name" data-v-4f1e9d0c>ESIndexTest</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Autowired</span>
    <span class="token keyword" data-v-4f1e9d0c>private</span> <span class="token class-name" data-v-4f1e9d0c>RestHighLevelClient</span> esClient<span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token comment" data-v-4f1e9d0c>/**
     * 创建索引
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>createIndex</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token keyword" data-v-4f1e9d0c>throws</span> <span class="token class-name" data-v-4f1e9d0c>IOException</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token comment" data-v-4f1e9d0c>// 创建索引的请求对象</span>
        <span class="token class-name" data-v-4f1e9d0c>CreateIndexRequest</span> request <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>CreateIndexRequest</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;user&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>CreateIndexResponse</span> response <span class="token operator" data-v-4f1e9d0c>=</span> esClient<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>indices</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>create</span><span class="token punctuation" data-v-4f1e9d0c>(</span>request<span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token class-name" data-v-4f1e9d0c>RequestOptions</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token constant" data-v-4f1e9d0c>DEFAULT</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token keyword" data-v-4f1e9d0c>boolean</span> acknowledged <span class="token operator" data-v-4f1e9d0c>=</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>isAcknowledged</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;创建索引状态：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> acknowledged<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
    <span class="token comment" data-v-4f1e9d0c>/**
     *查看索引
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>queryIndex</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token keyword" data-v-4f1e9d0c>throws</span> <span class="token class-name" data-v-4f1e9d0c>IOException</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token comment" data-v-4f1e9d0c>// 创建索引的请求对象</span>
        <span class="token class-name" data-v-4f1e9d0c>GetIndexRequest</span> request <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>GetIndexRequest</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;user&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>GetIndexResponse</span> response <span class="token operator" data-v-4f1e9d0c>=</span> esClient<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>indices</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>get</span><span class="token punctuation" data-v-4f1e9d0c>(</span>request<span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token class-name" data-v-4f1e9d0c>RequestOptions</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token constant" data-v-4f1e9d0c>DEFAULT</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 打印响应结果</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;索引别名：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getAliases</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;索引映射：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getMappings</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;索引配置：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getSettings</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
    <span class="token comment" data-v-4f1e9d0c>/**
     * 删除索引
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>deleteIndex</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token keyword" data-v-4f1e9d0c>throws</span> <span class="token class-name" data-v-4f1e9d0c>IOException</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token comment" data-v-4f1e9d0c>// 创建索引的请求对象</span>
        <span class="token class-name" data-v-4f1e9d0c>DeleteIndexRequest</span> request <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>DeleteIndexRequest</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;user&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>AcknowledgedResponse</span> response <span class="token operator" data-v-4f1e9d0c>=</span> esClient<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>indices</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>delete</span><span class="token punctuation" data-v-4f1e9d0c>(</span>request<span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token class-name" data-v-4f1e9d0c>RequestOptions</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token constant" data-v-4f1e9d0c>DEFAULT</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;删除状态：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>isAcknowledged</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
<span class="token punctuation" data-v-4f1e9d0c>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>1</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>2</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>3</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>4</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>5</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>6</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>7</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>8</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>9</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>10</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>11</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>12</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>13</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>14</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>15</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>16</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>17</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>18</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>19</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>20</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>21</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>22</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>23</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>24</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>25</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>26</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>27</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>28</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>29</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>30</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>31</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>32</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>33</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>34</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>35</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>36</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>37</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>38</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>39</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>40</span><br data-v-4f1e9d0c></div></div></div> <div class="theme-code-block" data-v-4f1e9d0c><div class="language-java line-numbers-mode" data-v-4f1e9d0c><pre class="language-java" data-v-4f1e9d0c><code data-v-4f1e9d0c><span class="token annotation punctuation" data-v-4f1e9d0c>@SpringBootTest</span>
<span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>class</span> <span class="token class-name" data-v-4f1e9d0c>ESIndexTest</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Autowired</span>
    <span class="token keyword" data-v-4f1e9d0c>private</span> <span class="token class-name" data-v-4f1e9d0c>RestHighLevelClient</span> esClient<span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token comment" data-v-4f1e9d0c>/**
     * 创建索引
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>createIndex</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token keyword" data-v-4f1e9d0c>throws</span> <span class="token class-name" data-v-4f1e9d0c>IOException</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token comment" data-v-4f1e9d0c>// 创建索引的请求对象</span>
        <span class="token class-name" data-v-4f1e9d0c>CreateIndexRequest</span> request <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>CreateIndexRequest</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;user&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>CreateIndexResponse</span> response <span class="token operator" data-v-4f1e9d0c>=</span> esClient<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>indices</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>create</span><span class="token punctuation" data-v-4f1e9d0c>(</span>request<span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token class-name" data-v-4f1e9d0c>RequestOptions</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token constant" data-v-4f1e9d0c>DEFAULT</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token keyword" data-v-4f1e9d0c>boolean</span> acknowledged <span class="token operator" data-v-4f1e9d0c>=</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>isAcknowledged</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;创建索引状态：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> acknowledged<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
<span class="token punctuation" data-v-4f1e9d0c>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>1</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>2</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>3</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>4</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>5</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>6</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>7</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>8</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>9</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>10</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>11</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>12</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>13</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>14</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>15</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>16</span><br data-v-4f1e9d0c></div></div></div> <div class="theme-code-block" data-v-4f1e9d0c><div class="language-java line-numbers-mode" data-v-4f1e9d0c><pre class="language-java" data-v-4f1e9d0c><code data-v-4f1e9d0c><span class="token annotation punctuation" data-v-4f1e9d0c>@SpringBootTest</span>
<span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>class</span> <span class="token class-name" data-v-4f1e9d0c>ESIndexTest</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Autowired</span>
    <span class="token keyword" data-v-4f1e9d0c>private</span> <span class="token class-name" data-v-4f1e9d0c>RestHighLevelClient</span> esClient<span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token comment" data-v-4f1e9d0c>/**
     *查看索引
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>queryIndex</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token keyword" data-v-4f1e9d0c>throws</span> <span class="token class-name" data-v-4f1e9d0c>IOException</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token comment" data-v-4f1e9d0c>// 创建索引的请求对象</span>
        <span class="token class-name" data-v-4f1e9d0c>GetIndexRequest</span> request <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>GetIndexRequest</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;user&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>GetIndexResponse</span> response <span class="token operator" data-v-4f1e9d0c>=</span> esClient<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>indices</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>get</span><span class="token punctuation" data-v-4f1e9d0c>(</span>request<span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token class-name" data-v-4f1e9d0c>RequestOptions</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token constant" data-v-4f1e9d0c>DEFAULT</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 打印响应结果</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;索引别名：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getAliases</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;索引映射：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getMappings</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;索引配置：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getSettings</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
<span class="token punctuation" data-v-4f1e9d0c>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>1</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>2</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>3</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>4</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>5</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>6</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>7</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>8</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>9</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>10</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>11</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>12</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>13</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>14</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>15</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>16</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>17</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>18</span><br data-v-4f1e9d0c></div></div></div> <div class="theme-code-block" data-v-4f1e9d0c><div class="language-java line-numbers-mode" data-v-4f1e9d0c><pre class="language-java" data-v-4f1e9d0c><code data-v-4f1e9d0c><span class="token annotation punctuation" data-v-4f1e9d0c>@SpringBootTest</span>
<span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>class</span> <span class="token class-name" data-v-4f1e9d0c>ESIndexTest</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Autowired</span>
    <span class="token keyword" data-v-4f1e9d0c>private</span> <span class="token class-name" data-v-4f1e9d0c>RestHighLevelClient</span> esClient<span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token comment" data-v-4f1e9d0c>/**
     * 删除索引
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>deleteIndex</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token keyword" data-v-4f1e9d0c>throws</span> <span class="token class-name" data-v-4f1e9d0c>IOException</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token comment" data-v-4f1e9d0c>// 创建索引的请求对象</span>
        <span class="token class-name" data-v-4f1e9d0c>DeleteIndexRequest</span> request <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>DeleteIndexRequest</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;user&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>AcknowledgedResponse</span> response <span class="token operator" data-v-4f1e9d0c>=</span> esClient<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>indices</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>delete</span><span class="token punctuation" data-v-4f1e9d0c>(</span>request<span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token class-name" data-v-4f1e9d0c>RequestOptions</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token constant" data-v-4f1e9d0c>DEFAULT</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;删除状态：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>isAcknowledged</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
<span class="token punctuation" data-v-4f1e9d0c>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>1</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>2</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>3</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>4</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>5</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>6</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>7</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>8</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>9</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>10</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>11</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>12</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>13</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>14</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>15</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>16</span><br data-v-4f1e9d0c></div></div></div> <pre class="pre-blank" data-v-2f5f1757>// Make sure to add code blocks to your code group</pre></div> <h3 id="文档测试"><a href="#文档测试" class="header-anchor">#</a> 文档测试</h3> <p>关于文档的 CURD 代码如下：</p> <div class="theme-code-group" data-v-2f5f1757><div class="theme-code-group__nav" data-v-2f5f1757><ul class="theme-code-group__ul" data-v-2f5f1757></ul></div> <div class="theme-code-block theme-code-block__active" data-v-4f1e9d0c><div class="language-java line-numbers-mode" data-v-4f1e9d0c><pre class="language-java" data-v-4f1e9d0c><code data-v-4f1e9d0c><span class="token annotation punctuation" data-v-4f1e9d0c>@SpringBootTest</span>
<span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>class</span> <span class="token class-name" data-v-4f1e9d0c>ESIndexTest</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
    
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Autowired</span>
    <span class="token keyword" data-v-4f1e9d0c>private</span> <span class="token class-name" data-v-4f1e9d0c>RestHighLevelClient</span> esClient<span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token comment" data-v-4f1e9d0c>/**
     * 插入文档数据
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>createDoc</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token keyword" data-v-4f1e9d0c>throws</span> <span class="token class-name" data-v-4f1e9d0c>IOException</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token class-name" data-v-4f1e9d0c>IndexRequest</span> request <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>IndexRequest</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>id</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;1&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>User</span> user <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>User</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        user<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>setUsername</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;可乐&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        user<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>setAge</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token number" data-v-4f1e9d0c>18</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        user<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>setSex</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;男&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>ObjectMapper</span> objectMapper <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>ObjectMapper</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>String</span> userJsonStr <span class="token operator" data-v-4f1e9d0c>=</span> objectMapper<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>writeValueAsString</span><span class="token punctuation" data-v-4f1e9d0c>(</span>user<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 添加文档数据，数据格式为 Json 格式</span>
        request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>source</span><span class="token punctuation" data-v-4f1e9d0c>(</span>userJsonStr<span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token class-name" data-v-4f1e9d0c>XContentType</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token constant" data-v-4f1e9d0c>JSON</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 客户端发送请求，获取响应对象</span>
        <span class="token class-name" data-v-4f1e9d0c>IndexResponse</span> response <span class="token operator" data-v-4f1e9d0c>=</span> esClient<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>index</span><span class="token punctuation" data-v-4f1e9d0c>(</span>request<span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token class-name" data-v-4f1e9d0c>RequestOptions</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token constant" data-v-4f1e9d0c>DEFAULT</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;创建的索引：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getIndex</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;创建的 id：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getId</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;创建的结果：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getResult</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
    <span class="token comment" data-v-4f1e9d0c>/**
     * 删除文档数据
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>deleteDoc</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token keyword" data-v-4f1e9d0c>throws</span> <span class="token class-name" data-v-4f1e9d0c>IOException</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token class-name" data-v-4f1e9d0c>DeleteRequest</span> request <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>DeleteRequest</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 配置修改参数</span>
        request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>index</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;user&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>id</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;1001&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 客户端发送请求，获取响应对象</span>
        <span class="token class-name" data-v-4f1e9d0c>DeleteResponse</span> response <span class="token operator" data-v-4f1e9d0c>=</span> esClient<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>delete</span><span class="token punctuation" data-v-4f1e9d0c>(</span>request<span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token class-name" data-v-4f1e9d0c>RequestOptions</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token constant" data-v-4f1e9d0c>DEFAULT</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;响应内容：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>toString</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
     <span class="token comment" data-v-4f1e9d0c>/**
     * 批量删除文档数据
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>batchDeleteDoc</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token keyword" data-v-4f1e9d0c>throws</span> <span class="token class-name" data-v-4f1e9d0c>IOException</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token class-name" data-v-4f1e9d0c>BulkRequest</span> request <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>BulkRequest</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 配置修改参数</span>
        request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>add</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>DeleteRequest</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>index</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;user&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>id</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;1001&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>add</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>DeleteRequest</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>index</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;user&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>id</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;1002&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>add</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>DeleteRequest</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>index</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;user&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>id</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;1003&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>add</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>DeleteRequest</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>index</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;user&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>id</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;1004&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>add</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>DeleteRequest</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>index</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;user&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>id</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;1005&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 客户端发送请求，获取响应对象</span>
        <span class="token class-name" data-v-4f1e9d0c>BulkResponse</span> response <span class="token operator" data-v-4f1e9d0c>=</span> esClient<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>bulk</span><span class="token punctuation" data-v-4f1e9d0c>(</span>request<span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token class-name" data-v-4f1e9d0c>RequestOptions</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token constant" data-v-4f1e9d0c>DEFAULT</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>//打印结果信息</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;响应时间:&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getTook</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
    <span class="token comment" data-v-4f1e9d0c>/**
     * 查询文档数据
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>queryDoc</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token keyword" data-v-4f1e9d0c>throws</span> <span class="token class-name" data-v-4f1e9d0c>IOException</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token comment" data-v-4f1e9d0c>// 创建请求对象</span>
        <span class="token class-name" data-v-4f1e9d0c>GetRequest</span> request <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>GetRequest</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>index</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;user&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>id</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;1001&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 客户端发送请求，获取响应对象</span>
        <span class="token class-name" data-v-4f1e9d0c>GetResponse</span> response <span class="token operator" data-v-4f1e9d0c>=</span> esClient<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>get</span><span class="token punctuation" data-v-4f1e9d0c>(</span>request<span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token class-name" data-v-4f1e9d0c>RequestOptions</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token constant" data-v-4f1e9d0c>DEFAULT</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;创建的索引：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getIndex</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;创建的 id：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getId</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;查询的结果：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getSourceAsString</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
    <span class="token comment" data-v-4f1e9d0c>/**
     * 修改文档数据
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>upadateDoc</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token keyword" data-v-4f1e9d0c>throws</span> <span class="token class-name" data-v-4f1e9d0c>IOException</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token class-name" data-v-4f1e9d0c>UpdateRequest</span> request <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>UpdateRequest</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 配置修改参数</span>
        request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>index</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;user&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>id</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;1001&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>//  设置请求体，对数据进行修改</span>
        request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>doc</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>XContentType</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token constant" data-v-4f1e9d0c>JSON</span><span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token string" data-v-4f1e9d0c>&quot;sex&quot;</span><span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token string" data-v-4f1e9d0c>&quot;男&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 客户端发送请求，获取响应对象</span>
        <span class="token class-name" data-v-4f1e9d0c>UpdateResponse</span> response <span class="token operator" data-v-4f1e9d0c>=</span> esClient<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>update</span><span class="token punctuation" data-v-4f1e9d0c>(</span>request<span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token class-name" data-v-4f1e9d0c>RequestOptions</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token constant" data-v-4f1e9d0c>DEFAULT</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;创建的索引：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getIndex</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;创建的 id：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getId</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;修改的结果：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getResult</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
<span class="token punctuation" data-v-4f1e9d0c>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>1</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>2</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>3</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>4</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>5</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>6</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>7</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>8</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>9</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>10</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>11</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>12</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>13</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>14</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>15</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>16</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>17</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>18</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>19</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>20</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>21</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>22</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>23</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>24</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>25</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>26</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>27</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>28</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>29</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>30</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>31</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>32</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>33</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>34</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>35</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>36</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>37</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>38</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>39</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>40</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>41</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>42</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>43</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>44</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>45</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>46</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>47</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>48</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>49</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>50</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>51</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>52</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>53</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>54</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>55</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>56</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>57</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>58</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>59</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>60</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>61</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>62</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>63</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>64</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>65</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>66</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>67</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>68</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>69</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>70</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>71</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>72</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>73</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>74</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>75</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>76</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>77</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>78</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>79</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>80</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>81</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>82</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>83</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>84</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>85</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>86</span><br data-v-4f1e9d0c></div></div></div> <div class="theme-code-block" data-v-4f1e9d0c><div class="language-java line-numbers-mode" data-v-4f1e9d0c><pre class="language-java" data-v-4f1e9d0c><code data-v-4f1e9d0c><span class="token annotation punctuation" data-v-4f1e9d0c>@SpringBootTest</span>
<span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>class</span> <span class="token class-name" data-v-4f1e9d0c>ESIndexTest</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
    
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Autowired</span>
    <span class="token keyword" data-v-4f1e9d0c>private</span> <span class="token class-name" data-v-4f1e9d0c>RestHighLevelClient</span> esClient<span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token comment" data-v-4f1e9d0c>/**
     * 插入文档数据
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>createDoc</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token keyword" data-v-4f1e9d0c>throws</span> <span class="token class-name" data-v-4f1e9d0c>IOException</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token class-name" data-v-4f1e9d0c>IndexRequest</span> request <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>IndexRequest</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>id</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;1&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>User</span> user <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>User</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        user<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>setUsername</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;可乐&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        user<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>setAge</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token number" data-v-4f1e9d0c>18</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        user<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>setSex</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;男&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>ObjectMapper</span> objectMapper <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>ObjectMapper</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>String</span> userJsonStr <span class="token operator" data-v-4f1e9d0c>=</span> objectMapper<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>writeValueAsString</span><span class="token punctuation" data-v-4f1e9d0c>(</span>user<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 添加文档数据，数据格式为 Json 格式</span>
        request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>source</span><span class="token punctuation" data-v-4f1e9d0c>(</span>userJsonStr<span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token class-name" data-v-4f1e9d0c>XContentType</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token constant" data-v-4f1e9d0c>JSON</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 客户端发送请求，获取响应对象</span>
        <span class="token class-name" data-v-4f1e9d0c>IndexResponse</span> response <span class="token operator" data-v-4f1e9d0c>=</span> esClient<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>index</span><span class="token punctuation" data-v-4f1e9d0c>(</span>request<span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token class-name" data-v-4f1e9d0c>RequestOptions</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token constant" data-v-4f1e9d0c>DEFAULT</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;创建的索引：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getIndex</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;创建的 id：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getId</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;创建的结果：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getResult</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
<span class="token punctuation" data-v-4f1e9d0c>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>1</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>2</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>3</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>4</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>5</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>6</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>7</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>8</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>9</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>10</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>11</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>12</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>13</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>14</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>15</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>16</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>17</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>18</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>19</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>20</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>21</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>22</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>23</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>24</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>25</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>26</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>27</span><br data-v-4f1e9d0c></div></div></div> <div class="theme-code-block" data-v-4f1e9d0c><div class="language-java line-numbers-mode" data-v-4f1e9d0c><pre class="language-java" data-v-4f1e9d0c><code data-v-4f1e9d0c><span class="token annotation punctuation" data-v-4f1e9d0c>@SpringBootTest</span>
<span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>class</span> <span class="token class-name" data-v-4f1e9d0c>ESIndexTest</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
    
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Autowired</span>
    <span class="token keyword" data-v-4f1e9d0c>private</span> <span class="token class-name" data-v-4f1e9d0c>RestHighLevelClient</span> esClient<span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token comment" data-v-4f1e9d0c>/**
     * 批量添加文档数据
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>batchCreateDoc</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token keyword" data-v-4f1e9d0c>throws</span> <span class="token class-name" data-v-4f1e9d0c>IOException</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token class-name" data-v-4f1e9d0c>BulkRequest</span> request <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>BulkRequest</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>ObjectMapper</span> objectMapper <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>ObjectMapper</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 创建数据对象</span>
        request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>add</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>IndexRequest</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>index</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;user&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>id</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;1001&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>source</span><span class="token punctuation" data-v-4f1e9d0c>(</span>objectMapper<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>writeValueAsString</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>User</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;可乐&quot;</span><span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token number" data-v-4f1e9d0c>18</span><span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token string" data-v-4f1e9d0c>&quot;男&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token class-name" data-v-4f1e9d0c>XContentType</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token constant" data-v-4f1e9d0c>JSON</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>add</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>IndexRequest</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>index</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;user&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>id</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;1002&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>source</span><span class="token punctuation" data-v-4f1e9d0c>(</span>objectMapper<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>writeValueAsString</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>User</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;冰糖&quot;</span><span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token number" data-v-4f1e9d0c>20</span><span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token string" data-v-4f1e9d0c>&quot;女&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token class-name" data-v-4f1e9d0c>XContentType</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token constant" data-v-4f1e9d0c>JSON</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>add</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>IndexRequest</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>index</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;user&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>id</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;1003&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>source</span><span class="token punctuation" data-v-4f1e9d0c>(</span>objectMapper<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>writeValueAsString</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>User</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;雪梨&quot;</span><span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token number" data-v-4f1e9d0c>22</span><span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token string" data-v-4f1e9d0c>&quot;女&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token class-name" data-v-4f1e9d0c>XContentType</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token constant" data-v-4f1e9d0c>JSON</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>add</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>IndexRequest</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>index</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;user&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>id</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;1004&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>source</span><span class="token punctuation" data-v-4f1e9d0c>(</span>objectMapper<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>writeValueAsString</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>User</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;酸橙&quot;</span><span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token number" data-v-4f1e9d0c>24</span><span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token string" data-v-4f1e9d0c>&quot;男&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token class-name" data-v-4f1e9d0c>XContentType</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token constant" data-v-4f1e9d0c>JSON</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>add</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>IndexRequest</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>index</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;user&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>id</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;1005&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>source</span><span class="token punctuation" data-v-4f1e9d0c>(</span>objectMapper<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>writeValueAsString</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>User</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;蜜桃&quot;</span><span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token number" data-v-4f1e9d0c>30</span><span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token string" data-v-4f1e9d0c>&quot;女&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token class-name" data-v-4f1e9d0c>XContentType</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token constant" data-v-4f1e9d0c>JSON</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 客户端发送请求，获取响应对象</span>
        <span class="token class-name" data-v-4f1e9d0c>BulkResponse</span> response <span class="token operator" data-v-4f1e9d0c>=</span> esClient<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>bulk</span><span class="token punctuation" data-v-4f1e9d0c>(</span>request<span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token class-name" data-v-4f1e9d0c>RequestOptions</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token constant" data-v-4f1e9d0c>DEFAULT</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;响应时间：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getTook</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;创建的内容：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> <span class="token class-name" data-v-4f1e9d0c>Arrays</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>toString</span><span class="token punctuation" data-v-4f1e9d0c>(</span>response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getItems</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
<span class="token punctuation" data-v-4f1e9d0c>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>1</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>2</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>3</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>4</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>5</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>6</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>7</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>8</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>9</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>10</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>11</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>12</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>13</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>14</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>15</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>16</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>17</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>18</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>19</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>20</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>21</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>22</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>23</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>24</span><br data-v-4f1e9d0c></div></div></div> <div class="theme-code-block" data-v-4f1e9d0c><div class="language-java line-numbers-mode" data-v-4f1e9d0c><pre class="language-java" data-v-4f1e9d0c><code data-v-4f1e9d0c><span class="token annotation punctuation" data-v-4f1e9d0c>@SpringBootTest</span>
<span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>class</span> <span class="token class-name" data-v-4f1e9d0c>ESIndexTest</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
    
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Autowired</span>
    <span class="token keyword" data-v-4f1e9d0c>private</span> <span class="token class-name" data-v-4f1e9d0c>RestHighLevelClient</span> esClient<span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token comment" data-v-4f1e9d0c>/**
     * 删除文档数据
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>deleteDoc</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token keyword" data-v-4f1e9d0c>throws</span> <span class="token class-name" data-v-4f1e9d0c>IOException</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token class-name" data-v-4f1e9d0c>DeleteRequest</span> request <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>DeleteRequest</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 配置修改参数</span>
        request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>index</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;user&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>id</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;1001&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 客户端发送请求，获取响应对象</span>
        <span class="token class-name" data-v-4f1e9d0c>DeleteResponse</span> response <span class="token operator" data-v-4f1e9d0c>=</span> esClient<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>delete</span><span class="token punctuation" data-v-4f1e9d0c>(</span>request<span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token class-name" data-v-4f1e9d0c>RequestOptions</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token constant" data-v-4f1e9d0c>DEFAULT</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;响应内容：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>toString</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
<span class="token punctuation" data-v-4f1e9d0c>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>1</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>2</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>3</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>4</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>5</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>6</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>7</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>8</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>9</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>10</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>11</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>12</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>13</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>14</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>15</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>16</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>17</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>18</span><br data-v-4f1e9d0c></div></div></div> <div class="theme-code-block" data-v-4f1e9d0c><div class="language-java line-numbers-mode" data-v-4f1e9d0c><pre class="language-java" data-v-4f1e9d0c><code data-v-4f1e9d0c><span class="token annotation punctuation" data-v-4f1e9d0c>@SpringBootTest</span>
<span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>class</span> <span class="token class-name" data-v-4f1e9d0c>ESIndexTest</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
    
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Autowired</span>
    <span class="token keyword" data-v-4f1e9d0c>private</span> <span class="token class-name" data-v-4f1e9d0c>RestHighLevelClient</span> esClient<span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token comment" data-v-4f1e9d0c>/**
     * 批量删除文档数据
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>batchDeleteDoc</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token keyword" data-v-4f1e9d0c>throws</span> <span class="token class-name" data-v-4f1e9d0c>IOException</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token class-name" data-v-4f1e9d0c>BulkRequest</span> request <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>BulkRequest</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 配置修改参数</span>
        request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>add</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>DeleteRequest</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>index</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;user&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>id</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;1001&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>add</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>DeleteRequest</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>index</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;user&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>id</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;1002&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>add</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>DeleteRequest</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>index</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;user&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>id</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;1003&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>add</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>DeleteRequest</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>index</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;user&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>id</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;1004&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>add</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>DeleteRequest</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>index</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;user&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>id</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;1005&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 客户端发送请求，获取响应对象</span>
        <span class="token class-name" data-v-4f1e9d0c>BulkResponse</span> response <span class="token operator" data-v-4f1e9d0c>=</span> esClient<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>bulk</span><span class="token punctuation" data-v-4f1e9d0c>(</span>request<span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token class-name" data-v-4f1e9d0c>RequestOptions</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token constant" data-v-4f1e9d0c>DEFAULT</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>//打印结果信息</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;响应时间:&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getTook</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
<span class="token punctuation" data-v-4f1e9d0c>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>1</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>2</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>3</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>4</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>5</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>6</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>7</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>8</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>9</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>10</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>11</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>12</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>13</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>14</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>15</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>16</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>17</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>18</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>19</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>20</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>21</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>22</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>23</span><br data-v-4f1e9d0c></div></div></div> <div class="theme-code-block" data-v-4f1e9d0c><div class="language-java line-numbers-mode" data-v-4f1e9d0c><pre class="language-java" data-v-4f1e9d0c><code data-v-4f1e9d0c><span class="token annotation punctuation" data-v-4f1e9d0c>@SpringBootTest</span>
<span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>class</span> <span class="token class-name" data-v-4f1e9d0c>ESIndexTest</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
    
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Autowired</span>
    <span class="token keyword" data-v-4f1e9d0c>private</span> <span class="token class-name" data-v-4f1e9d0c>RestHighLevelClient</span> esClient<span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token comment" data-v-4f1e9d0c>/**
     * 查询文档数据
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>queryDoc</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token keyword" data-v-4f1e9d0c>throws</span> <span class="token class-name" data-v-4f1e9d0c>IOException</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token comment" data-v-4f1e9d0c>// 创建请求对象</span>
        <span class="token class-name" data-v-4f1e9d0c>GetRequest</span> request <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>GetRequest</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>index</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;user&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>id</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;1001&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 客户端发送请求，获取响应对象</span>
        <span class="token class-name" data-v-4f1e9d0c>GetResponse</span> response <span class="token operator" data-v-4f1e9d0c>=</span> esClient<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>get</span><span class="token punctuation" data-v-4f1e9d0c>(</span>request<span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token class-name" data-v-4f1e9d0c>RequestOptions</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token constant" data-v-4f1e9d0c>DEFAULT</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;创建的索引：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getIndex</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;创建的 id：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getId</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;查询的结果：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getSourceAsString</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
<span class="token punctuation" data-v-4f1e9d0c>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>1</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>2</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>3</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>4</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>5</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>6</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>7</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>8</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>9</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>10</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>11</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>12</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>13</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>14</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>15</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>16</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>17</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>18</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>19</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>20</span><br data-v-4f1e9d0c></div></div></div> <div class="theme-code-block" data-v-4f1e9d0c><div class="language-java line-numbers-mode" data-v-4f1e9d0c><pre class="language-java" data-v-4f1e9d0c><code data-v-4f1e9d0c><span class="token annotation punctuation" data-v-4f1e9d0c>@SpringBootTest</span>
<span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>class</span> <span class="token class-name" data-v-4f1e9d0c>ESIndexTest</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
    
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Autowired</span>
    <span class="token keyword" data-v-4f1e9d0c>private</span> <span class="token class-name" data-v-4f1e9d0c>RestHighLevelClient</span> esClient<span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token comment" data-v-4f1e9d0c>/**
     * 修改文档数据
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>upadateDoc</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token keyword" data-v-4f1e9d0c>throws</span> <span class="token class-name" data-v-4f1e9d0c>IOException</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token class-name" data-v-4f1e9d0c>UpdateRequest</span> request <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>UpdateRequest</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 配置修改参数</span>
        request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>index</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;user&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>id</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;1001&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>//  设置请求体，对数据进行修改</span>
        request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>doc</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>XContentType</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token constant" data-v-4f1e9d0c>JSON</span><span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token string" data-v-4f1e9d0c>&quot;sex&quot;</span><span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token string" data-v-4f1e9d0c>&quot;男&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 客户端发送请求，获取响应对象</span>
        <span class="token class-name" data-v-4f1e9d0c>UpdateResponse</span> response <span class="token operator" data-v-4f1e9d0c>=</span> esClient<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>update</span><span class="token punctuation" data-v-4f1e9d0c>(</span>request<span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token class-name" data-v-4f1e9d0c>RequestOptions</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token constant" data-v-4f1e9d0c>DEFAULT</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;创建的索引：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getIndex</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;创建的 id：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getId</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;修改的结果：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getResult</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
<span class="token punctuation" data-v-4f1e9d0c>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>1</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>2</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>3</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>4</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>5</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>6</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>7</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>8</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>9</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>10</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>11</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>12</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>13</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>14</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>15</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>16</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>17</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>18</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>19</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>20</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>21</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>22</span><br data-v-4f1e9d0c></div></div></div> <pre class="pre-blank" data-v-2f5f1757>// Make sure to add code blocks to your code group</pre></div> <h3 id="高级查询测试"><a href="#高级查询测试" class="header-anchor">#</a> 高级查询测试</h3> <p>高级查询代码如下：</p> <div class="theme-code-group" data-v-2f5f1757><div class="theme-code-group__nav" data-v-2f5f1757><ul class="theme-code-group__ul" data-v-2f5f1757></ul></div> <div class="theme-code-block theme-code-block__active" data-v-4f1e9d0c><div class="language-java line-numbers-mode" data-v-4f1e9d0c><pre class="language-java" data-v-4f1e9d0c><code data-v-4f1e9d0c><span class="token annotation punctuation" data-v-4f1e9d0c>@SpringBootTest</span>
<span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>class</span> <span class="token class-name" data-v-4f1e9d0c>ESIndexTest</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
    
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Autowired</span>
    <span class="token keyword" data-v-4f1e9d0c>private</span> <span class="token class-name" data-v-4f1e9d0c>RestHighLevelClient</span> esClient<span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token comment" data-v-4f1e9d0c>/**
     * term 查询
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>termQuery</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token keyword" data-v-4f1e9d0c>throws</span> <span class="token class-name" data-v-4f1e9d0c>IOException</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchRequest</span> request <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>SearchRequest</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>indices</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;user&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        
        <span class="token comment" data-v-4f1e9d0c>// 构建查询的请求体</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchSourceBuilder</span> sourceBuilder <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>SearchSourceBuilder</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        sourceBuilder<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>query</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>QueryBuilders</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>termsQuery</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;age&quot;</span><span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token string" data-v-4f1e9d0c>&quot;18&quot;</span><span class="token punctuation" data-v-4f1e9d0c>,</span><span class="token string" data-v-4f1e9d0c>&quot;20&quot;</span><span class="token punctuation" data-v-4f1e9d0c>,</span><span class="token string" data-v-4f1e9d0c>&quot;22&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchResponse</span> response <span class="token operator" data-v-4f1e9d0c>=</span> esClient<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>search</span><span class="token punctuation" data-v-4f1e9d0c>(</span>request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>source</span><span class="token punctuation" data-v-4f1e9d0c>(</span>sourceBuilder<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token class-name" data-v-4f1e9d0c>RequestOptions</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token constant" data-v-4f1e9d0c>DEFAULT</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 查询匹配</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchHits</span> hits <span class="token operator" data-v-4f1e9d0c>=</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getHits</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;响应时间：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getTook</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;是否超时：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>isTimedOut</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;命中数量：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> hits<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getTotalHits</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;MaxScore：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> hits<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getMaxScore</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;详细数据：&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token keyword" data-v-4f1e9d0c>for</span> <span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>SearchHit</span> hit <span class="token operator" data-v-4f1e9d0c>:</span> hits<span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
            <span class="token comment" data-v-4f1e9d0c>// 输出每条查询的结果信息</span>
            <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span>hit<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getSourceAsString</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token punctuation" data-v-4f1e9d0c>}</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
    <span class="token comment" data-v-4f1e9d0c>/**
     * 查询所有数据
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>queryAll</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token keyword" data-v-4f1e9d0c>throws</span> <span class="token class-name" data-v-4f1e9d0c>IOException</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
		<span class="token comment" data-v-4f1e9d0c>// 创建搜索请求对象</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchRequest</span> request <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>SearchRequest</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>indices</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;user&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 构建查询的请求体</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchSourceBuilder</span> sourceBuilder <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>SearchSourceBuilder</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 查询所有数据</span>
        sourceBuilder<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>query</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>QueryBuilders</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>matchAllQuery</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchResponse</span> response <span class="token operator" data-v-4f1e9d0c>=</span> esClient<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>search</span><span class="token punctuation" data-v-4f1e9d0c>(</span>request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>source</span><span class="token punctuation" data-v-4f1e9d0c>(</span>sourceBuilder<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token class-name" data-v-4f1e9d0c>RequestOptions</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token constant" data-v-4f1e9d0c>DEFAULT</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 查询匹配</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchHits</span> hits <span class="token operator" data-v-4f1e9d0c>=</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getHits</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;响应时间：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getTook</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;是否超时：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>isTimedOut</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;命中数量：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> hits<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getTotalHits</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;MaxScore：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> hits<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getMaxScore</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;详细数据：&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token keyword" data-v-4f1e9d0c>for</span> <span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>SearchHit</span> hit <span class="token operator" data-v-4f1e9d0c>:</span> hits<span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
            <span class="token comment" data-v-4f1e9d0c>// 输出每条查询的结果信息</span>
            <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span>hit<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getSourceAsString</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token punctuation" data-v-4f1e9d0c>}</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
    <span class="token comment" data-v-4f1e9d0c>/**
     * 范围查询
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>rangeQuery</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token keyword" data-v-4f1e9d0c>throws</span> <span class="token class-name" data-v-4f1e9d0c>IOException</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
		<span class="token comment" data-v-4f1e9d0c>// 创建搜索请求对象</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchRequest</span> request <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>SearchRequest</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>indices</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;user&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 构建查询的请求体</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchSourceBuilder</span> sourceBuilder <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>SearchSourceBuilder</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>RangeQueryBuilder</span> rangeQuery <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token class-name" data-v-4f1e9d0c>QueryBuilders</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>rangeQuery</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;age&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 大于等于</span>
        rangeQuery<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>gte</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;18&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 小于等于</span>
        rangeQuery<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>lte</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;24&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        sourceBuilder<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>query</span><span class="token punctuation" data-v-4f1e9d0c>(</span>rangeQuery<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>source</span><span class="token punctuation" data-v-4f1e9d0c>(</span>sourceBuilder<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchResponse</span> response <span class="token operator" data-v-4f1e9d0c>=</span> esClient<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>search</span><span class="token punctuation" data-v-4f1e9d0c>(</span>request<span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token class-name" data-v-4f1e9d0c>RequestOptions</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token constant" data-v-4f1e9d0c>DEFAULT</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 查询匹配</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchHits</span> hits <span class="token operator" data-v-4f1e9d0c>=</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getHits</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;响应时间：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getTook</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;是否超时：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>isTimedOut</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;命中数量：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> hits<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getTotalHits</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;MaxScore：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> hits<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getMaxScore</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;详细数据：&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token keyword" data-v-4f1e9d0c>for</span> <span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>SearchHit</span> hit <span class="token operator" data-v-4f1e9d0c>:</span> hits<span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
            <span class="token comment" data-v-4f1e9d0c>// 输出每条查询的结果信息</span>
            <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span>hit<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getSourceAsString</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token punctuation" data-v-4f1e9d0c>}</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
    <span class="token comment" data-v-4f1e9d0c>/**
     * 分页查询
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>pageQuery</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token keyword" data-v-4f1e9d0c>throws</span> <span class="token class-name" data-v-4f1e9d0c>IOException</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token comment" data-v-4f1e9d0c>// 创建搜索请求对象</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchRequest</span> request <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>SearchRequest</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>indices</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;user&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 构建查询的请求体</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchSourceBuilder</span> sourceBuilder <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>SearchSourceBuilder</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        sourceBuilder<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>query</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>QueryBuilders</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>matchAllQuery</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 分页查询</span>
        <span class="token comment" data-v-4f1e9d0c>// 当前页其实索引(第一条数据的顺序号)，from</span>
        sourceBuilder<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>from</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token number" data-v-4f1e9d0c>0</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 每页显示多少条 size</span>
        sourceBuilder<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>size</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token number" data-v-4f1e9d0c>2</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchResponse</span> response <span class="token operator" data-v-4f1e9d0c>=</span> esClient<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>search</span><span class="token punctuation" data-v-4f1e9d0c>(</span>request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>source</span><span class="token punctuation" data-v-4f1e9d0c>(</span>sourceBuilder<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token class-name" data-v-4f1e9d0c>RequestOptions</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token constant" data-v-4f1e9d0c>DEFAULT</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 查询匹配</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchHits</span> hits <span class="token operator" data-v-4f1e9d0c>=</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getHits</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;响应时间：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getTook</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;是否超时：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>isTimedOut</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;命中数量：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> hits<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getTotalHits</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;MaxScore：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> hits<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getMaxScore</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;详细数据：&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token keyword" data-v-4f1e9d0c>for</span> <span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>SearchHit</span> hit <span class="token operator" data-v-4f1e9d0c>:</span> hits<span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
            <span class="token comment" data-v-4f1e9d0c>// 输出每条查询的结果信息</span>
            <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span>hit<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getSourceAsString</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token punctuation" data-v-4f1e9d0c>}</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
    <span class="token comment" data-v-4f1e9d0c>/**
     * 过滤查询
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>filterQuery</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token keyword" data-v-4f1e9d0c>throws</span> <span class="token class-name" data-v-4f1e9d0c>IOException</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token comment" data-v-4f1e9d0c>// 创建搜索请求对象</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchRequest</span> request <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>SearchRequest</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>indices</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;user&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 构建查询的请求体</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchSourceBuilder</span> sourceBuilder <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>SearchSourceBuilder</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        sourceBuilder<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>query</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>QueryBuilders</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>matchAllQuery</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>//查询字段过滤</span>
        <span class="token class-name" data-v-4f1e9d0c>String</span><span class="token punctuation" data-v-4f1e9d0c>[</span><span class="token punctuation" data-v-4f1e9d0c>]</span> excludes <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token punctuation" data-v-4f1e9d0c>{</span><span class="token punctuation" data-v-4f1e9d0c>}</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>String</span><span class="token punctuation" data-v-4f1e9d0c>[</span><span class="token punctuation" data-v-4f1e9d0c>]</span> includes <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token punctuation" data-v-4f1e9d0c>{</span><span class="token string" data-v-4f1e9d0c>&quot;username&quot;</span><span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token string" data-v-4f1e9d0c>&quot;age&quot;</span><span class="token punctuation" data-v-4f1e9d0c>}</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        sourceBuilder<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>fetchSource</span><span class="token punctuation" data-v-4f1e9d0c>(</span>includes<span class="token punctuation" data-v-4f1e9d0c>,</span> excludes<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchResponse</span> response <span class="token operator" data-v-4f1e9d0c>=</span> esClient<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>search</span><span class="token punctuation" data-v-4f1e9d0c>(</span>request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>source</span><span class="token punctuation" data-v-4f1e9d0c>(</span>sourceBuilder<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token class-name" data-v-4f1e9d0c>RequestOptions</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token constant" data-v-4f1e9d0c>DEFAULT</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 查询匹配</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchHits</span> hits <span class="token operator" data-v-4f1e9d0c>=</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getHits</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;响应时间：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getTook</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;是否超时：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>isTimedOut</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;命中数量：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> hits<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getTotalHits</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;MaxScore：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> hits<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getMaxScore</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;详细数据：&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token keyword" data-v-4f1e9d0c>for</span> <span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>SearchHit</span> hit <span class="token operator" data-v-4f1e9d0c>:</span> hits<span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
            <span class="token comment" data-v-4f1e9d0c>// 输出每条查询的结果信息</span>
            <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span>hit<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getSourceAsString</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token punctuation" data-v-4f1e9d0c>}</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
    <span class="token comment" data-v-4f1e9d0c>/**
     * Bool 查询
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>boolQuery</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token keyword" data-v-4f1e9d0c>throws</span> <span class="token class-name" data-v-4f1e9d0c>IOException</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token comment" data-v-4f1e9d0c>// 创建搜索请求对象</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchRequest</span> request <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>SearchRequest</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>indices</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;user&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 构建查询的请求体</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchSourceBuilder</span> sourceBuilder <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>SearchSourceBuilder</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>BoolQueryBuilder</span> boolQueryBuilder <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token class-name" data-v-4f1e9d0c>QueryBuilders</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>boolQuery</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 必须包含</span>
        boolQueryBuilder<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>must</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>QueryBuilders</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>matchQuery</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;age&quot;</span><span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token string" data-v-4f1e9d0c>&quot;30&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 一定不含</span>
        boolQueryBuilder<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>mustNot</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>QueryBuilders</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>matchQuery</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;username&quot;</span><span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token string" data-v-4f1e9d0c>&quot;可乐&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 可能包含</span>
        boolQueryBuilder<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>should</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>QueryBuilders</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>matchQuery</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;sex&quot;</span><span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token string" data-v-4f1e9d0c>&quot;男&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        sourceBuilder<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>query</span><span class="token punctuation" data-v-4f1e9d0c>(</span>boolQueryBuilder<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchResponse</span> response <span class="token operator" data-v-4f1e9d0c>=</span> esClient<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>search</span><span class="token punctuation" data-v-4f1e9d0c>(</span>request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>source</span><span class="token punctuation" data-v-4f1e9d0c>(</span>sourceBuilder<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token class-name" data-v-4f1e9d0c>RequestOptions</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token constant" data-v-4f1e9d0c>DEFAULT</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 查询匹配</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchHits</span> hits <span class="token operator" data-v-4f1e9d0c>=</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getHits</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;响应时间：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getTook</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;是否超时：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>isTimedOut</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;命中数量：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> hits<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getTotalHits</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;MaxScore：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> hits<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getMaxScore</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;详细数据：&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token keyword" data-v-4f1e9d0c>for</span> <span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>SearchHit</span> hit <span class="token operator" data-v-4f1e9d0c>:</span> hits<span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
            <span class="token comment" data-v-4f1e9d0c>// 输出每条查询的结果信息</span>
            <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span>hit<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getSourceAsString</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token punctuation" data-v-4f1e9d0c>}</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
    <span class="token comment" data-v-4f1e9d0c>/**
     * 模糊查询
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>fuzzyQuery</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token keyword" data-v-4f1e9d0c>throws</span> <span class="token class-name" data-v-4f1e9d0c>IOException</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token comment" data-v-4f1e9d0c>// 创建搜索请求对象</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchRequest</span> request <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>SearchRequest</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>indices</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;user&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 构建查询的请求体</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchSourceBuilder</span> sourceBuilder <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>SearchSourceBuilder</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        sourceBuilder<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>query</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>QueryBuilders</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>fuzzyQuery</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;age&quot;</span><span class="token punctuation" data-v-4f1e9d0c>,</span><span class="token number" data-v-4f1e9d0c>2</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>fuzziness</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>Fuzziness</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token constant" data-v-4f1e9d0c>ONE</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchResponse</span> response <span class="token operator" data-v-4f1e9d0c>=</span> esClient<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>search</span><span class="token punctuation" data-v-4f1e9d0c>(</span>request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>source</span><span class="token punctuation" data-v-4f1e9d0c>(</span>sourceBuilder<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token class-name" data-v-4f1e9d0c>RequestOptions</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token constant" data-v-4f1e9d0c>DEFAULT</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 查询匹配</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchHits</span> hits <span class="token operator" data-v-4f1e9d0c>=</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getHits</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;响应时间：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getTook</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;是否超时：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>isTimedOut</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;命中数量：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> hits<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getTotalHits</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;MaxScore：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> hits<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getMaxScore</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;详细数据：&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token keyword" data-v-4f1e9d0c>for</span> <span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>SearchHit</span> hit <span class="token operator" data-v-4f1e9d0c>:</span> hits<span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
            <span class="token comment" data-v-4f1e9d0c>// 输出每条查询的结果信息</span>
            <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span>hit<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getSourceAsString</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token punctuation" data-v-4f1e9d0c>}</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
    <span class="token comment" data-v-4f1e9d0c>/**
     * 高亮查询
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>heightQuery</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token keyword" data-v-4f1e9d0c>throws</span> <span class="token class-name" data-v-4f1e9d0c>IOException</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
 		<span class="token comment" data-v-4f1e9d0c>// 高亮查询</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchRequest</span> request <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>SearchRequest</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>indices</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;user&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 2.创建查询请求体构建器</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchSourceBuilder</span> sourceBuilder <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>SearchSourceBuilder</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 构建查询方式：高亮查询</span>
        sourceBuilder<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>query</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>QueryBuilders</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>termsQuery</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;age&quot;</span><span class="token punctuation" data-v-4f1e9d0c>,</span><span class="token string" data-v-4f1e9d0c>&quot;18&quot;</span><span class="token punctuation" data-v-4f1e9d0c>,</span><span class="token string" data-v-4f1e9d0c>&quot;20&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 构建高亮字段</span>
        <span class="token class-name" data-v-4f1e9d0c>HighlightBuilder</span> highlightBuilder <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>HighlightBuilder</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        highlightBuilder<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>preTags</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;&lt;font color='red'&gt;&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span><span class="token comment" data-v-4f1e9d0c>// 设置标签前缀</span>
        highlightBuilder<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>postTags</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;&lt;/font&gt;&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span><span class="token comment" data-v-4f1e9d0c>// 设置标签后缀</span>
        highlightBuilder<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>field</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;age&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span><span class="token comment" data-v-4f1e9d0c>// 设置高亮字段</span>
        <span class="token comment" data-v-4f1e9d0c>//设置高亮构建对象</span>
        sourceBuilder<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>highlighter</span><span class="token punctuation" data-v-4f1e9d0c>(</span>highlightBuilder<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 3.客户端发送请求，获取响应对象</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchResponse</span> response <span class="token operator" data-v-4f1e9d0c>=</span> esClient<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>search</span><span class="token punctuation" data-v-4f1e9d0c>(</span>request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>source</span><span class="token punctuation" data-v-4f1e9d0c>(</span>sourceBuilder<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token class-name" data-v-4f1e9d0c>RequestOptions</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token constant" data-v-4f1e9d0c>DEFAULT</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>//4.打印响应结果</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchHits</span> hits <span class="token operator" data-v-4f1e9d0c>=</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getHits</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;响应时间：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getTook</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;是否超时：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>isTimedOut</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;命中数量：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> hits<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getTotalHits</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;MaxScore：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> hits<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getMaxScore</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;详细数据：&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token keyword" data-v-4f1e9d0c>for</span> <span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>SearchHit</span> hit <span class="token operator" data-v-4f1e9d0c>:</span> hits<span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
            <span class="token class-name" data-v-4f1e9d0c>String</span> sourceAsString <span class="token operator" data-v-4f1e9d0c>=</span> hit<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getSourceAsString</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
            <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span>sourceAsString<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
            <span class="token comment" data-v-4f1e9d0c>// 打印高亮结果</span>
            <span class="token class-name" data-v-4f1e9d0c>Map</span><span class="token generics" data-v-4f1e9d0c><span class="token punctuation" data-v-4f1e9d0c>&lt;</span><span class="token class-name" data-v-4f1e9d0c>String</span><span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token class-name" data-v-4f1e9d0c>HighlightField</span><span class="token punctuation" data-v-4f1e9d0c>&gt;</span></span> highlightFields <span class="token operator" data-v-4f1e9d0c>=</span> hit<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getHighlightFields</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
            <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span>highlightFields<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token punctuation" data-v-4f1e9d0c>}</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
     <span class="token comment" data-v-4f1e9d0c>/**
     * 排序查询
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>sortQuery</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token keyword" data-v-4f1e9d0c>throws</span> <span class="token class-name" data-v-4f1e9d0c>IOException</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token comment" data-v-4f1e9d0c>// 创建搜索请求对象</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchRequest</span> request <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>SearchRequest</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>indices</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;user&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 构建查询的请求体</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchSourceBuilder</span> sourceBuilder <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>SearchSourceBuilder</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        sourceBuilder<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>query</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>QueryBuilders</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>matchAllQuery</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 排序</span>
        sourceBuilder<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>sort</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;age&quot;</span><span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token class-name" data-v-4f1e9d0c>SortOrder</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token constant" data-v-4f1e9d0c>ASC</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchResponse</span> response <span class="token operator" data-v-4f1e9d0c>=</span> esClient<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>search</span><span class="token punctuation" data-v-4f1e9d0c>(</span>request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>source</span><span class="token punctuation" data-v-4f1e9d0c>(</span>sourceBuilder<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token class-name" data-v-4f1e9d0c>RequestOptions</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token constant" data-v-4f1e9d0c>DEFAULT</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 查询匹配</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchHits</span> hits <span class="token operator" data-v-4f1e9d0c>=</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getHits</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;响应时间：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getTook</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;是否超时：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>isTimedOut</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;命中数量：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> hits<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getTotalHits</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;MaxScore：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> hits<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getMaxScore</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;详细数据：&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token keyword" data-v-4f1e9d0c>for</span> <span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>SearchHit</span> hit <span class="token operator" data-v-4f1e9d0c>:</span> hits<span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token comment" data-v-4f1e9d0c>// 输出每条查询的结果信息</span>
            <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span>hit<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getSourceAsString</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token punctuation" data-v-4f1e9d0c>}</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
     <span class="token comment" data-v-4f1e9d0c>/**
     * 聚合查询
     * 最大年龄
     * 高亮查询
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>arrgQuery1</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token keyword" data-v-4f1e9d0c>throws</span> <span class="token class-name" data-v-4f1e9d0c>IOException</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token comment" data-v-4f1e9d0c>// 最大年龄</span>
        <span class="token comment" data-v-4f1e9d0c>// 高亮查询</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchRequest</span> request <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>SearchRequest</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>indices</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;user&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchSourceBuilder</span> sourceBuilder <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>SearchSourceBuilder</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        sourceBuilder<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>aggregation</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>AggregationBuilders</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>max</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;maxAge&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>field</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;age&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 3.客户端发送请求，获取响应对象</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchResponse</span> response <span class="token operator" data-v-4f1e9d0c>=</span> esClient<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>search</span><span class="token punctuation" data-v-4f1e9d0c>(</span>request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>source</span><span class="token punctuation" data-v-4f1e9d0c>(</span>sourceBuilder<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token class-name" data-v-4f1e9d0c>RequestOptions</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token constant" data-v-4f1e9d0c>DEFAULT</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 4.打印响应结果</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span>response<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
    <span class="token comment" data-v-4f1e9d0c>/**
     * 聚合查询
     * 分组统计
     * 高亮查询
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>arrgQuery2</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token keyword" data-v-4f1e9d0c>throws</span> <span class="token class-name" data-v-4f1e9d0c>IOException</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token comment" data-v-4f1e9d0c>// 分组统计</span>
        <span class="token comment" data-v-4f1e9d0c>// 高亮查询</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchRequest</span> request <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>SearchRequest</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>indices</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;user&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchSourceBuilder</span> sourceBuilder <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>SearchSourceBuilder</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        sourceBuilder<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>aggregation</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>AggregationBuilders</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>terms</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;ageGroupby&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>field</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;age&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 3.客户端发送请求，获取响应对象</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchResponse</span> response <span class="token operator" data-v-4f1e9d0c>=</span> esClient<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>search</span><span class="token punctuation" data-v-4f1e9d0c>(</span>request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>source</span><span class="token punctuation" data-v-4f1e9d0c>(</span>sourceBuilder<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token class-name" data-v-4f1e9d0c>RequestOptions</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token constant" data-v-4f1e9d0c>DEFAULT</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 4.打印响应结果</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchHits</span> hits <span class="token operator" data-v-4f1e9d0c>=</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getHits</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span>response<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
<span class="token punctuation" data-v-4f1e9d0c>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>1</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>2</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>3</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>4</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>5</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>6</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>7</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>8</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>9</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>10</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>11</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>12</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>13</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>14</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>15</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>16</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>17</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>18</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>19</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>20</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>21</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>22</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>23</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>24</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>25</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>26</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>27</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>28</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>29</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>30</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>31</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>32</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>33</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>34</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>35</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>36</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>37</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>38</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>39</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>40</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>41</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>42</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>43</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>44</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>45</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>46</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>47</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>48</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>49</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>50</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>51</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>52</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>53</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>54</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>55</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>56</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>57</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>58</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>59</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>60</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>61</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>62</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>63</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>64</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>65</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>66</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>67</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>68</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>69</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>70</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>71</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>72</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>73</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>74</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>75</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>76</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>77</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>78</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>79</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>80</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>81</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>82</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>83</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>84</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>85</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>86</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>87</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>88</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>89</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>90</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>91</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>92</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>93</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>94</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>95</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>96</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>97</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>98</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>99</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>100</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>101</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>102</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>103</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>104</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>105</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>106</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>107</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>108</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>109</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>110</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>111</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>112</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>113</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>114</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>115</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>116</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>117</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>118</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>119</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>120</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>121</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>122</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>123</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>124</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>125</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>126</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>127</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>128</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>129</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>130</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>131</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>132</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>133</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>134</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>135</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>136</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>137</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>138</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>139</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>140</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>141</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>142</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>143</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>144</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>145</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>146</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>147</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>148</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>149</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>150</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>151</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>152</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>153</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>154</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>155</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>156</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>157</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>158</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>159</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>160</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>161</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>162</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>163</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>164</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>165</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>166</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>167</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>168</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>169</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>170</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>171</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>172</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>173</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>174</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>175</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>176</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>177</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>178</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>179</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>180</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>181</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>182</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>183</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>184</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>185</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>186</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>187</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>188</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>189</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>190</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>191</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>192</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>193</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>194</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>195</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>196</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>197</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>198</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>199</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>200</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>201</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>202</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>203</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>204</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>205</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>206</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>207</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>208</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>209</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>210</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>211</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>212</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>213</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>214</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>215</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>216</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>217</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>218</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>219</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>220</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>221</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>222</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>223</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>224</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>225</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>226</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>227</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>228</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>229</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>230</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>231</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>232</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>233</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>234</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>235</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>236</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>237</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>238</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>239</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>240</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>241</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>242</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>243</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>244</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>245</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>246</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>247</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>248</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>249</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>250</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>251</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>252</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>253</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>254</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>255</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>256</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>257</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>258</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>259</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>260</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>261</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>262</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>263</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>264</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>265</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>266</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>267</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>268</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>269</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>270</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>271</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>272</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>273</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>274</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>275</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>276</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>277</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>278</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>279</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>280</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>281</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>282</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>283</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>284</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>285</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>286</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>287</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>288</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>289</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>290</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>291</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>292</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>293</span><br data-v-4f1e9d0c></div></div></div> <div class="theme-code-block" data-v-4f1e9d0c><div class="language-java line-numbers-mode" data-v-4f1e9d0c><pre class="language-java" data-v-4f1e9d0c><code data-v-4f1e9d0c><span class="token annotation punctuation" data-v-4f1e9d0c>@SpringBootTest</span>
<span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>class</span> <span class="token class-name" data-v-4f1e9d0c>ESIndexTest</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
    
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Autowired</span>
    <span class="token keyword" data-v-4f1e9d0c>private</span> <span class="token class-name" data-v-4f1e9d0c>RestHighLevelClient</span> esClient<span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token comment" data-v-4f1e9d0c>/**
     * term 查询
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>termQuery</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token keyword" data-v-4f1e9d0c>throws</span> <span class="token class-name" data-v-4f1e9d0c>IOException</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchRequest</span> request <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>SearchRequest</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>indices</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;user&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        
        <span class="token comment" data-v-4f1e9d0c>// 构建查询的请求体</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchSourceBuilder</span> sourceBuilder <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>SearchSourceBuilder</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        sourceBuilder<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>query</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>QueryBuilders</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>termsQuery</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;age&quot;</span><span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token string" data-v-4f1e9d0c>&quot;18&quot;</span><span class="token punctuation" data-v-4f1e9d0c>,</span><span class="token string" data-v-4f1e9d0c>&quot;20&quot;</span><span class="token punctuation" data-v-4f1e9d0c>,</span><span class="token string" data-v-4f1e9d0c>&quot;22&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchResponse</span> response <span class="token operator" data-v-4f1e9d0c>=</span> esClient<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>search</span><span class="token punctuation" data-v-4f1e9d0c>(</span>request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>source</span><span class="token punctuation" data-v-4f1e9d0c>(</span>sourceBuilder<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token class-name" data-v-4f1e9d0c>RequestOptions</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token constant" data-v-4f1e9d0c>DEFAULT</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 查询匹配</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchHits</span> hits <span class="token operator" data-v-4f1e9d0c>=</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getHits</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;响应时间：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getTook</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;是否超时：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>isTimedOut</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;命中数量：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> hits<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getTotalHits</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;MaxScore：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> hits<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getMaxScore</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;详细数据：&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token keyword" data-v-4f1e9d0c>for</span> <span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>SearchHit</span> hit <span class="token operator" data-v-4f1e9d0c>:</span> hits<span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
            <span class="token comment" data-v-4f1e9d0c>// 输出每条查询的结果信息</span>
            <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span>hit<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getSourceAsString</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token punctuation" data-v-4f1e9d0c>}</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
<span class="token punctuation" data-v-4f1e9d0c>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>1</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>2</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>3</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>4</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>5</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>6</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>7</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>8</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>9</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>10</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>11</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>12</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>13</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>14</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>15</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>16</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>17</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>18</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>19</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>20</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>21</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>22</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>23</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>24</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>25</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>26</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>27</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>28</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>29</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>30</span><br data-v-4f1e9d0c></div></div></div> <div class="theme-code-block" data-v-4f1e9d0c><div class="language-java line-numbers-mode" data-v-4f1e9d0c><pre class="language-java" data-v-4f1e9d0c><code data-v-4f1e9d0c><span class="token annotation punctuation" data-v-4f1e9d0c>@SpringBootTest</span>
<span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>class</span> <span class="token class-name" data-v-4f1e9d0c>ESIndexTest</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
    
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Autowired</span>
    <span class="token keyword" data-v-4f1e9d0c>private</span> <span class="token class-name" data-v-4f1e9d0c>RestHighLevelClient</span> esClient<span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token comment" data-v-4f1e9d0c>/**
     * 查询所有数据
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>queryAll</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token keyword" data-v-4f1e9d0c>throws</span> <span class="token class-name" data-v-4f1e9d0c>IOException</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
		<span class="token comment" data-v-4f1e9d0c>// 创建搜索请求对象</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchRequest</span> request <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>SearchRequest</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>indices</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;user&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 构建查询的请求体</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchSourceBuilder</span> sourceBuilder <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>SearchSourceBuilder</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 查询所有数据</span>
        sourceBuilder<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>query</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>QueryBuilders</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>matchAllQuery</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchResponse</span> response <span class="token operator" data-v-4f1e9d0c>=</span> esClient<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>search</span><span class="token punctuation" data-v-4f1e9d0c>(</span>request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>source</span><span class="token punctuation" data-v-4f1e9d0c>(</span>sourceBuilder<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token class-name" data-v-4f1e9d0c>RequestOptions</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token constant" data-v-4f1e9d0c>DEFAULT</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 查询匹配</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchHits</span> hits <span class="token operator" data-v-4f1e9d0c>=</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getHits</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;响应时间：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getTook</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;是否超时：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>isTimedOut</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;命中数量：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> hits<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getTotalHits</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;MaxScore：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> hits<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getMaxScore</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;详细数据：&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token keyword" data-v-4f1e9d0c>for</span> <span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>SearchHit</span> hit <span class="token operator" data-v-4f1e9d0c>:</span> hits<span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
            <span class="token comment" data-v-4f1e9d0c>// 输出每条查询的结果信息</span>
            <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span>hit<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getSourceAsString</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token punctuation" data-v-4f1e9d0c>}</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
<span class="token punctuation" data-v-4f1e9d0c>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>1</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>2</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>3</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>4</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>5</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>6</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>7</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>8</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>9</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>10</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>11</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>12</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>13</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>14</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>15</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>16</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>17</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>18</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>19</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>20</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>21</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>22</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>23</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>24</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>25</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>26</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>27</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>28</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>29</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>30</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>31</span><br data-v-4f1e9d0c></div></div></div> <div class="theme-code-block" data-v-4f1e9d0c><div class="language-java line-numbers-mode" data-v-4f1e9d0c><pre class="language-java" data-v-4f1e9d0c><code data-v-4f1e9d0c><span class="token annotation punctuation" data-v-4f1e9d0c>@SpringBootTest</span>
<span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>class</span> <span class="token class-name" data-v-4f1e9d0c>ESIndexTest</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
    
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Autowired</span>
    <span class="token keyword" data-v-4f1e9d0c>private</span> <span class="token class-name" data-v-4f1e9d0c>RestHighLevelClient</span> esClient<span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token comment" data-v-4f1e9d0c>/**
     * 范围查询
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>rangeQuery</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token keyword" data-v-4f1e9d0c>throws</span> <span class="token class-name" data-v-4f1e9d0c>IOException</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
		<span class="token comment" data-v-4f1e9d0c>// 创建搜索请求对象</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchRequest</span> request <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>SearchRequest</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>indices</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;user&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 构建查询的请求体</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchSourceBuilder</span> sourceBuilder <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>SearchSourceBuilder</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>RangeQueryBuilder</span> rangeQuery <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token class-name" data-v-4f1e9d0c>QueryBuilders</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>rangeQuery</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;age&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 大于等于</span>
        rangeQuery<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>gte</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;18&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 小于等于</span>
        rangeQuery<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>lte</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;24&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        sourceBuilder<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>query</span><span class="token punctuation" data-v-4f1e9d0c>(</span>rangeQuery<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>source</span><span class="token punctuation" data-v-4f1e9d0c>(</span>sourceBuilder<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchResponse</span> response <span class="token operator" data-v-4f1e9d0c>=</span> esClient<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>search</span><span class="token punctuation" data-v-4f1e9d0c>(</span>request<span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token class-name" data-v-4f1e9d0c>RequestOptions</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token constant" data-v-4f1e9d0c>DEFAULT</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 查询匹配</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchHits</span> hits <span class="token operator" data-v-4f1e9d0c>=</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getHits</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;响应时间：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getTook</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;是否超时：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>isTimedOut</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;命中数量：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> hits<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getTotalHits</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;MaxScore：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> hits<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getMaxScore</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;详细数据：&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token keyword" data-v-4f1e9d0c>for</span> <span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>SearchHit</span> hit <span class="token operator" data-v-4f1e9d0c>:</span> hits<span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
            <span class="token comment" data-v-4f1e9d0c>// 输出每条查询的结果信息</span>
            <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span>hit<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getSourceAsString</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token punctuation" data-v-4f1e9d0c>}</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
<span class="token punctuation" data-v-4f1e9d0c>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>1</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>2</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>3</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>4</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>5</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>6</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>7</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>8</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>9</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>10</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>11</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>12</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>13</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>14</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>15</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>16</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>17</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>18</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>19</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>20</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>21</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>22</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>23</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>24</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>25</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>26</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>27</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>28</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>29</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>30</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>31</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>32</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>33</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>34</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>35</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>36</span><br data-v-4f1e9d0c></div></div></div> <div class="theme-code-block" data-v-4f1e9d0c><div class="language-java line-numbers-mode" data-v-4f1e9d0c><pre class="language-java" data-v-4f1e9d0c><code data-v-4f1e9d0c><span class="token annotation punctuation" data-v-4f1e9d0c>@SpringBootTest</span>
<span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>class</span> <span class="token class-name" data-v-4f1e9d0c>ESIndexTest</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
    
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Autowired</span>
    <span class="token keyword" data-v-4f1e9d0c>private</span> <span class="token class-name" data-v-4f1e9d0c>RestHighLevelClient</span> esClient<span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token comment" data-v-4f1e9d0c>/**
     * 分页查询
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>pageQuery</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token keyword" data-v-4f1e9d0c>throws</span> <span class="token class-name" data-v-4f1e9d0c>IOException</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token comment" data-v-4f1e9d0c>// 创建搜索请求对象</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchRequest</span> request <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>SearchRequest</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>indices</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;user&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 构建查询的请求体</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchSourceBuilder</span> sourceBuilder <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>SearchSourceBuilder</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        sourceBuilder<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>query</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>QueryBuilders</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>matchAllQuery</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 分页查询</span>
        <span class="token comment" data-v-4f1e9d0c>// 当前页其实索引(第一条数据的顺序号)，from</span>
        sourceBuilder<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>from</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token number" data-v-4f1e9d0c>0</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 每页显示多少条 size</span>
        sourceBuilder<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>size</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token number" data-v-4f1e9d0c>2</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchResponse</span> response <span class="token operator" data-v-4f1e9d0c>=</span> esClient<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>search</span><span class="token punctuation" data-v-4f1e9d0c>(</span>request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>source</span><span class="token punctuation" data-v-4f1e9d0c>(</span>sourceBuilder<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token class-name" data-v-4f1e9d0c>RequestOptions</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token constant" data-v-4f1e9d0c>DEFAULT</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 查询匹配</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchHits</span> hits <span class="token operator" data-v-4f1e9d0c>=</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getHits</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;响应时间：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getTook</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;是否超时：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>isTimedOut</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;命中数量：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> hits<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getTotalHits</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;MaxScore：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> hits<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getMaxScore</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;详细数据：&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token keyword" data-v-4f1e9d0c>for</span> <span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>SearchHit</span> hit <span class="token operator" data-v-4f1e9d0c>:</span> hits<span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
            <span class="token comment" data-v-4f1e9d0c>// 输出每条查询的结果信息</span>
            <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span>hit<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getSourceAsString</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token punctuation" data-v-4f1e9d0c>}</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
<span class="token punctuation" data-v-4f1e9d0c>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>1</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>2</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>3</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>4</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>5</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>6</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>7</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>8</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>9</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>10</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>11</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>12</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>13</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>14</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>15</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>16</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>17</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>18</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>19</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>20</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>21</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>22</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>23</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>24</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>25</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>26</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>27</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>28</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>29</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>30</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>31</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>32</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>33</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>34</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>35</span><br data-v-4f1e9d0c></div></div></div> <div class="theme-code-block" data-v-4f1e9d0c><div class="language-java line-numbers-mode" data-v-4f1e9d0c><pre class="language-java" data-v-4f1e9d0c><code data-v-4f1e9d0c><span class="token annotation punctuation" data-v-4f1e9d0c>@SpringBootTest</span>
<span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>class</span> <span class="token class-name" data-v-4f1e9d0c>ESIndexTest</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
    
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Autowired</span>
    <span class="token keyword" data-v-4f1e9d0c>private</span> <span class="token class-name" data-v-4f1e9d0c>RestHighLevelClient</span> esClient<span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token comment" data-v-4f1e9d0c>/**
     * 过滤查询
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>filterQuery</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token keyword" data-v-4f1e9d0c>throws</span> <span class="token class-name" data-v-4f1e9d0c>IOException</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token comment" data-v-4f1e9d0c>// 创建搜索请求对象</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchRequest</span> request <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>SearchRequest</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>indices</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;user&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 构建查询的请求体</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchSourceBuilder</span> sourceBuilder <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>SearchSourceBuilder</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        sourceBuilder<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>query</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>QueryBuilders</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>matchAllQuery</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>//查询字段过滤</span>
        <span class="token class-name" data-v-4f1e9d0c>String</span><span class="token punctuation" data-v-4f1e9d0c>[</span><span class="token punctuation" data-v-4f1e9d0c>]</span> excludes <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token punctuation" data-v-4f1e9d0c>{</span><span class="token punctuation" data-v-4f1e9d0c>}</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>String</span><span class="token punctuation" data-v-4f1e9d0c>[</span><span class="token punctuation" data-v-4f1e9d0c>]</span> includes <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token punctuation" data-v-4f1e9d0c>{</span><span class="token string" data-v-4f1e9d0c>&quot;username&quot;</span><span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token string" data-v-4f1e9d0c>&quot;age&quot;</span><span class="token punctuation" data-v-4f1e9d0c>}</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        sourceBuilder<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>fetchSource</span><span class="token punctuation" data-v-4f1e9d0c>(</span>includes<span class="token punctuation" data-v-4f1e9d0c>,</span> excludes<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchResponse</span> response <span class="token operator" data-v-4f1e9d0c>=</span> esClient<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>search</span><span class="token punctuation" data-v-4f1e9d0c>(</span>request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>source</span><span class="token punctuation" data-v-4f1e9d0c>(</span>sourceBuilder<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token class-name" data-v-4f1e9d0c>RequestOptions</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token constant" data-v-4f1e9d0c>DEFAULT</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 查询匹配</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchHits</span> hits <span class="token operator" data-v-4f1e9d0c>=</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getHits</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;响应时间：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getTook</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;是否超时：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>isTimedOut</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;命中数量：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> hits<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getTotalHits</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;MaxScore：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> hits<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getMaxScore</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;详细数据：&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token keyword" data-v-4f1e9d0c>for</span> <span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>SearchHit</span> hit <span class="token operator" data-v-4f1e9d0c>:</span> hits<span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
            <span class="token comment" data-v-4f1e9d0c>// 输出每条查询的结果信息</span>
            <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span>hit<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getSourceAsString</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token punctuation" data-v-4f1e9d0c>}</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
<span class="token punctuation" data-v-4f1e9d0c>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>1</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>2</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>3</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>4</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>5</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>6</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>7</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>8</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>9</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>10</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>11</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>12</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>13</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>14</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>15</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>16</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>17</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>18</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>19</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>20</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>21</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>22</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>23</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>24</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>25</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>26</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>27</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>28</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>29</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>30</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>31</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>32</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>33</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>34</span><br data-v-4f1e9d0c></div></div></div> <div class="theme-code-block" data-v-4f1e9d0c><div class="language-java line-numbers-mode" data-v-4f1e9d0c><pre class="language-java" data-v-4f1e9d0c><code data-v-4f1e9d0c><span class="token annotation punctuation" data-v-4f1e9d0c>@SpringBootTest</span>
<span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>class</span> <span class="token class-name" data-v-4f1e9d0c>ESIndexTest</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
    
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Autowired</span>
    <span class="token keyword" data-v-4f1e9d0c>private</span> <span class="token class-name" data-v-4f1e9d0c>RestHighLevelClient</span> esClient<span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token comment" data-v-4f1e9d0c>/**
     * Bool 查询
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>boolQuery</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token keyword" data-v-4f1e9d0c>throws</span> <span class="token class-name" data-v-4f1e9d0c>IOException</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token comment" data-v-4f1e9d0c>// 创建搜索请求对象</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchRequest</span> request <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>SearchRequest</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>indices</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;user&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 构建查询的请求体</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchSourceBuilder</span> sourceBuilder <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>SearchSourceBuilder</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>BoolQueryBuilder</span> boolQueryBuilder <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token class-name" data-v-4f1e9d0c>QueryBuilders</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>boolQuery</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 必须包含</span>
        boolQueryBuilder<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>must</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>QueryBuilders</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>matchQuery</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;age&quot;</span><span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token string" data-v-4f1e9d0c>&quot;30&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 一定不含</span>
        boolQueryBuilder<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>mustNot</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>QueryBuilders</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>matchQuery</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;username&quot;</span><span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token string" data-v-4f1e9d0c>&quot;可乐&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 可能包含</span>
        boolQueryBuilder<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>should</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>QueryBuilders</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>matchQuery</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;sex&quot;</span><span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token string" data-v-4f1e9d0c>&quot;男&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        sourceBuilder<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>query</span><span class="token punctuation" data-v-4f1e9d0c>(</span>boolQueryBuilder<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchResponse</span> response <span class="token operator" data-v-4f1e9d0c>=</span> esClient<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>search</span><span class="token punctuation" data-v-4f1e9d0c>(</span>request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>source</span><span class="token punctuation" data-v-4f1e9d0c>(</span>sourceBuilder<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token class-name" data-v-4f1e9d0c>RequestOptions</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token constant" data-v-4f1e9d0c>DEFAULT</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 查询匹配</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchHits</span> hits <span class="token operator" data-v-4f1e9d0c>=</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getHits</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;响应时间：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getTook</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;是否超时：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>isTimedOut</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;命中数量：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> hits<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getTotalHits</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;MaxScore：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> hits<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getMaxScore</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;详细数据：&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token keyword" data-v-4f1e9d0c>for</span> <span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>SearchHit</span> hit <span class="token operator" data-v-4f1e9d0c>:</span> hits<span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
            <span class="token comment" data-v-4f1e9d0c>// 输出每条查询的结果信息</span>
            <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span>hit<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getSourceAsString</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token punctuation" data-v-4f1e9d0c>}</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
<span class="token punctuation" data-v-4f1e9d0c>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>1</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>2</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>3</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>4</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>5</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>6</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>7</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>8</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>9</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>10</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>11</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>12</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>13</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>14</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>15</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>16</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>17</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>18</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>19</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>20</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>21</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>22</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>23</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>24</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>25</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>26</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>27</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>28</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>29</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>30</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>31</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>32</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>33</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>34</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>35</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>36</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>37</span><br data-v-4f1e9d0c></div></div></div> <div class="theme-code-block" data-v-4f1e9d0c><div class="language-java line-numbers-mode" data-v-4f1e9d0c><pre class="language-java" data-v-4f1e9d0c><code data-v-4f1e9d0c><span class="token annotation punctuation" data-v-4f1e9d0c>@SpringBootTest</span>
<span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>class</span> <span class="token class-name" data-v-4f1e9d0c>ESIndexTest</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
    
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Autowired</span>
    <span class="token keyword" data-v-4f1e9d0c>private</span> <span class="token class-name" data-v-4f1e9d0c>RestHighLevelClient</span> esClient<span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token comment" data-v-4f1e9d0c>/**
     * 模糊查询
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>fuzzyQuery</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token keyword" data-v-4f1e9d0c>throws</span> <span class="token class-name" data-v-4f1e9d0c>IOException</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token comment" data-v-4f1e9d0c>// 创建搜索请求对象</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchRequest</span> request <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>SearchRequest</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>indices</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;user&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 构建查询的请求体</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchSourceBuilder</span> sourceBuilder <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>SearchSourceBuilder</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        sourceBuilder<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>query</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>QueryBuilders</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>fuzzyQuery</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;age&quot;</span><span class="token punctuation" data-v-4f1e9d0c>,</span><span class="token number" data-v-4f1e9d0c>2</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>fuzziness</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>Fuzziness</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token constant" data-v-4f1e9d0c>ONE</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchResponse</span> response <span class="token operator" data-v-4f1e9d0c>=</span> esClient<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>search</span><span class="token punctuation" data-v-4f1e9d0c>(</span>request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>source</span><span class="token punctuation" data-v-4f1e9d0c>(</span>sourceBuilder<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token class-name" data-v-4f1e9d0c>RequestOptions</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token constant" data-v-4f1e9d0c>DEFAULT</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 查询匹配</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchHits</span> hits <span class="token operator" data-v-4f1e9d0c>=</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getHits</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;响应时间：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getTook</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;是否超时：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>isTimedOut</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;命中数量：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> hits<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getTotalHits</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;MaxScore：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> hits<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getMaxScore</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;详细数据：&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token keyword" data-v-4f1e9d0c>for</span> <span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>SearchHit</span> hit <span class="token operator" data-v-4f1e9d0c>:</span> hits<span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
            <span class="token comment" data-v-4f1e9d0c>// 输出每条查询的结果信息</span>
            <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span>hit<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getSourceAsString</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token punctuation" data-v-4f1e9d0c>}</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
<span class="token punctuation" data-v-4f1e9d0c>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>1</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>2</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>3</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>4</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>5</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>6</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>7</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>8</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>9</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>10</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>11</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>12</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>13</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>14</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>15</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>16</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>17</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>18</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>19</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>20</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>21</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>22</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>23</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>24</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>25</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>26</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>27</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>28</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>29</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>30</span><br data-v-4f1e9d0c></div></div></div> <div class="theme-code-block" data-v-4f1e9d0c><div class="language-java line-numbers-mode" data-v-4f1e9d0c><pre class="language-java" data-v-4f1e9d0c><code data-v-4f1e9d0c><span class="token annotation punctuation" data-v-4f1e9d0c>@SpringBootTest</span>
<span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>class</span> <span class="token class-name" data-v-4f1e9d0c>ESIndexTest</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
    
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Autowired</span>
    <span class="token keyword" data-v-4f1e9d0c>private</span> <span class="token class-name" data-v-4f1e9d0c>RestHighLevelClient</span> esClient<span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token comment" data-v-4f1e9d0c>/**
     * 高亮查询
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>heightQuery</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token keyword" data-v-4f1e9d0c>throws</span> <span class="token class-name" data-v-4f1e9d0c>IOException</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
 		<span class="token comment" data-v-4f1e9d0c>// 高亮查询</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchRequest</span> request <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>SearchRequest</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>indices</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;user&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 2.创建查询请求体构建器</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchSourceBuilder</span> sourceBuilder <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>SearchSourceBuilder</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 构建查询方式：高亮查询</span>
        sourceBuilder<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>query</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>QueryBuilders</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>termsQuery</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;age&quot;</span><span class="token punctuation" data-v-4f1e9d0c>,</span><span class="token string" data-v-4f1e9d0c>&quot;18&quot;</span><span class="token punctuation" data-v-4f1e9d0c>,</span><span class="token string" data-v-4f1e9d0c>&quot;20&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 构建高亮字段</span>
        <span class="token class-name" data-v-4f1e9d0c>HighlightBuilder</span> highlightBuilder <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>HighlightBuilder</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        highlightBuilder<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>preTags</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;&lt;font color='red'&gt;&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span><span class="token comment" data-v-4f1e9d0c>// 设置标签前缀</span>
        highlightBuilder<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>postTags</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;&lt;/font&gt;&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span><span class="token comment" data-v-4f1e9d0c>// 设置标签后缀</span>
        highlightBuilder<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>field</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;age&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span><span class="token comment" data-v-4f1e9d0c>// 设置高亮字段</span>
        <span class="token comment" data-v-4f1e9d0c>//设置高亮构建对象</span>
        sourceBuilder<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>highlighter</span><span class="token punctuation" data-v-4f1e9d0c>(</span>highlightBuilder<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 3.客户端发送请求，获取响应对象</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchResponse</span> response <span class="token operator" data-v-4f1e9d0c>=</span> esClient<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>search</span><span class="token punctuation" data-v-4f1e9d0c>(</span>request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>source</span><span class="token punctuation" data-v-4f1e9d0c>(</span>sourceBuilder<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token class-name" data-v-4f1e9d0c>RequestOptions</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token constant" data-v-4f1e9d0c>DEFAULT</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>//4.打印响应结果</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchHits</span> hits <span class="token operator" data-v-4f1e9d0c>=</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getHits</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;响应时间：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getTook</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;是否超时：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>isTimedOut</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;命中数量：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> hits<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getTotalHits</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;MaxScore：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> hits<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getMaxScore</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;详细数据：&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token keyword" data-v-4f1e9d0c>for</span> <span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>SearchHit</span> hit <span class="token operator" data-v-4f1e9d0c>:</span> hits<span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
            <span class="token class-name" data-v-4f1e9d0c>String</span> sourceAsString <span class="token operator" data-v-4f1e9d0c>=</span> hit<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getSourceAsString</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
            <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span>sourceAsString<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
            <span class="token comment" data-v-4f1e9d0c>// 打印高亮结果</span>
            <span class="token class-name" data-v-4f1e9d0c>Map</span><span class="token generics" data-v-4f1e9d0c><span class="token punctuation" data-v-4f1e9d0c>&lt;</span><span class="token class-name" data-v-4f1e9d0c>String</span><span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token class-name" data-v-4f1e9d0c>HighlightField</span><span class="token punctuation" data-v-4f1e9d0c>&gt;</span></span> highlightFields <span class="token operator" data-v-4f1e9d0c>=</span> hit<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getHighlightFields</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
            <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span>highlightFields<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token punctuation" data-v-4f1e9d0c>}</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
<span class="token punctuation" data-v-4f1e9d0c>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>1</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>2</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>3</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>4</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>5</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>6</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>7</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>8</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>9</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>10</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>11</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>12</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>13</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>14</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>15</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>16</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>17</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>18</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>19</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>20</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>21</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>22</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>23</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>24</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>25</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>26</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>27</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>28</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>29</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>30</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>31</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>32</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>33</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>34</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>35</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>36</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>37</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>38</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>39</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>40</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>41</span><br data-v-4f1e9d0c></div></div></div> <div class="theme-code-block" data-v-4f1e9d0c><div class="language-java line-numbers-mode" data-v-4f1e9d0c><pre class="language-java" data-v-4f1e9d0c><code data-v-4f1e9d0c><span class="token annotation punctuation" data-v-4f1e9d0c>@SpringBootTest</span>
<span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>class</span> <span class="token class-name" data-v-4f1e9d0c>ESIndexTest</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
    
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Autowired</span>
    <span class="token keyword" data-v-4f1e9d0c>private</span> <span class="token class-name" data-v-4f1e9d0c>RestHighLevelClient</span> esClient<span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token comment" data-v-4f1e9d0c>/**
     * 排序查询
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>sortQuery</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token keyword" data-v-4f1e9d0c>throws</span> <span class="token class-name" data-v-4f1e9d0c>IOException</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token comment" data-v-4f1e9d0c>// 创建搜索请求对象</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchRequest</span> request <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>SearchRequest</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>indices</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;user&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 构建查询的请求体</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchSourceBuilder</span> sourceBuilder <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>SearchSourceBuilder</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        sourceBuilder<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>query</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>QueryBuilders</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>matchAllQuery</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 排序</span>
        sourceBuilder<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>sort</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;age&quot;</span><span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token class-name" data-v-4f1e9d0c>SortOrder</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token constant" data-v-4f1e9d0c>ASC</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchResponse</span> response <span class="token operator" data-v-4f1e9d0c>=</span> esClient<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>search</span><span class="token punctuation" data-v-4f1e9d0c>(</span>request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>source</span><span class="token punctuation" data-v-4f1e9d0c>(</span>sourceBuilder<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token class-name" data-v-4f1e9d0c>RequestOptions</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token constant" data-v-4f1e9d0c>DEFAULT</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 查询匹配</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchHits</span> hits <span class="token operator" data-v-4f1e9d0c>=</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getHits</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;响应时间：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getTook</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;是否超时：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>isTimedOut</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;命中数量：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> hits<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getTotalHits</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;MaxScore：&quot;</span> <span class="token operator" data-v-4f1e9d0c>+</span> hits<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getMaxScore</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;详细数据：&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token keyword" data-v-4f1e9d0c>for</span> <span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>SearchHit</span> hit <span class="token operator" data-v-4f1e9d0c>:</span> hits<span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token comment" data-v-4f1e9d0c>// 输出每条查询的结果信息</span>
            <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span>hit<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getSourceAsString</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token punctuation" data-v-4f1e9d0c>}</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
<span class="token punctuation" data-v-4f1e9d0c>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>1</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>2</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>3</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>4</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>5</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>6</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>7</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>8</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>9</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>10</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>11</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>12</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>13</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>14</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>15</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>16</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>17</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>18</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>19</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>20</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>21</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>22</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>23</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>24</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>25</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>26</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>27</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>28</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>29</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>30</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>31</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>32</span><br data-v-4f1e9d0c></div></div></div> <div class="theme-code-block" data-v-4f1e9d0c><div class="language-java line-numbers-mode" data-v-4f1e9d0c><pre class="language-java" data-v-4f1e9d0c><code data-v-4f1e9d0c><span class="token annotation punctuation" data-v-4f1e9d0c>@SpringBootTest</span>
<span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>class</span> <span class="token class-name" data-v-4f1e9d0c>ESIndexTest</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
    
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Autowired</span>
    <span class="token keyword" data-v-4f1e9d0c>private</span> <span class="token class-name" data-v-4f1e9d0c>RestHighLevelClient</span> esClient<span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token comment" data-v-4f1e9d0c>/**
     * 聚合查询
     * 最大年龄
     * 高亮查询
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>arrgQuery1</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token keyword" data-v-4f1e9d0c>throws</span> <span class="token class-name" data-v-4f1e9d0c>IOException</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token comment" data-v-4f1e9d0c>// 最大年龄</span>
        <span class="token comment" data-v-4f1e9d0c>// 高亮查询</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchRequest</span> request <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>SearchRequest</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>indices</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;user&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchSourceBuilder</span> sourceBuilder <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>SearchSourceBuilder</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        sourceBuilder<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>aggregation</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>AggregationBuilders</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>max</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;maxAge&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>field</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;age&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 3.客户端发送请求，获取响应对象</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchResponse</span> response <span class="token operator" data-v-4f1e9d0c>=</span> esClient<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>search</span><span class="token punctuation" data-v-4f1e9d0c>(</span>request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>source</span><span class="token punctuation" data-v-4f1e9d0c>(</span>sourceBuilder<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token class-name" data-v-4f1e9d0c>RequestOptions</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token constant" data-v-4f1e9d0c>DEFAULT</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 4.打印响应结果</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span>response<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
    
    <span class="token comment" data-v-4f1e9d0c>/**
     * 聚合查询
     * 分组统计
     * 高亮查询
     */</span>
    <span class="token annotation punctuation" data-v-4f1e9d0c>@Test</span>
    <span class="token keyword" data-v-4f1e9d0c>public</span> <span class="token keyword" data-v-4f1e9d0c>void</span> <span class="token function" data-v-4f1e9d0c>arrgQuery2</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span> <span class="token keyword" data-v-4f1e9d0c>throws</span> <span class="token class-name" data-v-4f1e9d0c>IOException</span> <span class="token punctuation" data-v-4f1e9d0c>{</span>
        <span class="token comment" data-v-4f1e9d0c>// 分组统计</span>
        <span class="token comment" data-v-4f1e9d0c>// 高亮查询</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchRequest</span> request <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>SearchRequest</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>indices</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;user&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchSourceBuilder</span> sourceBuilder <span class="token operator" data-v-4f1e9d0c>=</span> <span class="token keyword" data-v-4f1e9d0c>new</span> <span class="token class-name" data-v-4f1e9d0c>SearchSourceBuilder</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        sourceBuilder<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>aggregation</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token class-name" data-v-4f1e9d0c>AggregationBuilders</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>terms</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;ageGroupby&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>field</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token string" data-v-4f1e9d0c>&quot;age&quot;</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 3.客户端发送请求，获取响应对象</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchResponse</span> response <span class="token operator" data-v-4f1e9d0c>=</span> esClient<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>search</span><span class="token punctuation" data-v-4f1e9d0c>(</span>request<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>source</span><span class="token punctuation" data-v-4f1e9d0c>(</span>sourceBuilder<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>,</span> <span class="token class-name" data-v-4f1e9d0c>RequestOptions</span><span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token constant" data-v-4f1e9d0c>DEFAULT</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token comment" data-v-4f1e9d0c>// 4.打印响应结果</span>
        <span class="token class-name" data-v-4f1e9d0c>SearchHits</span> hits <span class="token operator" data-v-4f1e9d0c>=</span> response<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>getHits</span><span class="token punctuation" data-v-4f1e9d0c>(</span><span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
        <span class="token class-name" data-v-4f1e9d0c>System</span><span class="token punctuation" data-v-4f1e9d0c>.</span>out<span class="token punctuation" data-v-4f1e9d0c>.</span><span class="token function" data-v-4f1e9d0c>println</span><span class="token punctuation" data-v-4f1e9d0c>(</span>response<span class="token punctuation" data-v-4f1e9d0c>)</span><span class="token punctuation" data-v-4f1e9d0c>;</span>
    <span class="token punctuation" data-v-4f1e9d0c>}</span>
<span class="token punctuation" data-v-4f1e9d0c>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>1</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>2</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>3</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>4</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>5</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>6</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>7</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>8</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>9</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>10</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>11</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>12</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>13</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>14</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>15</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>16</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>17</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>18</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>19</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>20</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>21</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>22</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>23</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>24</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>25</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>26</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>27</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>28</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>29</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>30</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>31</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>32</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>33</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>34</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>35</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>36</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>37</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>38</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>39</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>40</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>41</span><br data-v-4f1e9d0c><span class="line-number" data-v-4f1e9d0c>42</span><br data-v-4f1e9d0c></div></div></div> <pre class="pre-blank" data-v-2f5f1757>// Make sure to add code blocks to your code group</pre></div> <h2 id="spark-streaming框架集成"><a href="#spark-streaming框架集成" class="header-anchor">#</a> Spark Streaming框架集成</h2> <h3 id="spark-streaming框架介绍"><a href="#spark-streaming框架介绍" class="header-anchor">#</a> Spark Streaming框架介绍</h3> <p>Spark Streaming 是 Spark core API 的扩展，支持实时数据流的处理，并且具有可扩展，高吞吐量，容错的特点。数据可以从许多来源获取，如 Kafka，Flume，Kinesis 或 TCP sockets，并且可以使用复杂的算法进行处理，这些算法使用诸如 map，reduce，join 和 window 等高级函数表示。最后，处理后的数据可以推送到文件系统，数据库等。实际上，您可以将 Spark 的机器学习和图形处理算法应用于数据流。</p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/ElasticSearch/20211118011932.png" alt="image-20211118011930702"></p> <h3 id="框架搭建-3"><a href="#框架搭建-3" class="header-anchor">#</a> 框架搭建</h3> <ul><li><p>创建一个 Maven 项目</p></li> <li><p>修改 pom 文件，增加依赖</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.spark<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spark-core_2.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.spark<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spark-streaming_2.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.elasticsearch<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>elasticsearch<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>7.15.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- elasticsearch 的客户端 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.elasticsearch.client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>elasticsearch-rest-high-level-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>7.15.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- elasticsearch 依赖 2.x 的 log4j --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.logging.log4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>log4j-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.8.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.logging.log4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>log4j-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.8.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- &lt;dependency&gt;--&gt;</span>
        <span class="token comment">&lt;!-- &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;--&gt;</span>
        <span class="token comment">&lt;!-- &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt;--&gt;</span>
        <span class="token comment">&lt;!-- &lt;version&gt;2.11.1&lt;/version&gt;--&gt;</span>
        <span class="token comment">&lt;!-- &lt;/dependency&gt;--&gt;</span>
        <span class="token comment">&lt;!-- &amp;lt;!&amp;ndash; junit 单元测试 &amp;ndash;&amp;gt;--&gt;</span>
        <span class="token comment">&lt;!-- &lt;dependency&gt;--&gt;</span>
        <span class="token comment">&lt;!-- &lt;groupId&gt;junit&lt;/groupId&gt;--&gt;</span>
        <span class="token comment">&lt;!-- &lt;artifactId&gt;junit&lt;/artifactId&gt;--&gt;</span>
        <span class="token comment">&lt;!-- &lt;version&gt;4.12&lt;/version&gt;--&gt;</span>
    <span class="token comment">&lt;!-- &lt;/dependency&gt;--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div></li></ul> <h3 id="功能实现"><a href="#功能实现" class="header-anchor">#</a> 功能实现</h3> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span>HttpHost
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span></span>SparkConf
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>dstream<span class="token punctuation">.</span></span>ReceiverInputDStream
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span></span><span class="token punctuation">{</span>Seconds<span class="token punctuation">,</span> StreamingContext<span class="token punctuation">}</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>action<span class="token punctuation">.</span>index<span class="token punctuation">.</span></span>IndexRequest
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>client<span class="token punctuation">.</span>indices<span class="token punctuation">.</span></span>CreateIndexRequest
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token punctuation">{</span>RequestOptions<span class="token punctuation">,</span> RestClient<span class="token punctuation">,</span> 
                                 RestHighLevelClient<span class="token punctuation">}</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>common<span class="token punctuation">.</span>xcontent<span class="token punctuation">.</span></span>XContentType
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>Date
<span class="token keyword">object</span> SparkStreamingESTest <span class="token punctuation">{</span>
    <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token keyword">val</span> sparkConf <span class="token operator">=</span> <span class="token keyword">new</span> 
        SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setMaster<span class="token punctuation">(</span><span class="token string">&quot;local[*]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setAppName<span class="token punctuation">(</span><span class="token string">&quot;ESTest&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">val</span> ssc <span class="token operator">=</span> <span class="token keyword">new</span> StreamingContext<span class="token punctuation">(</span>sparkConf<span class="token punctuation">,</span> Seconds<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">val</span> ds<span class="token operator">:</span> ReceiverInputDStream<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span> <span class="token operator">=</span> ssc<span class="token punctuation">.</span>socketTextStream<span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span> <span class="token number">9999</span><span class="token punctuation">)</span>
        ds<span class="token punctuation">.</span>foreachRDD<span class="token punctuation">(</span>
            rdd <span class="token keyword">=&gt;</span> <span class="token punctuation">{</span>
                println<span class="token punctuation">(</span><span class="token string">&quot;*************** &quot;</span> <span class="token operator">+</span> <span class="token keyword">new</span> Date<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                rdd<span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>
                    data <span class="token keyword">=&gt;</span> <span class="token punctuation">{</span>
                        <span class="token keyword">val</span> client <span class="token operator">=</span> <span class="token keyword">new</span> RestHighLevelClient<span class="token punctuation">(</span>
                            RestClient<span class="token punctuation">.</span>builder<span class="token punctuation">(</span><span class="token keyword">new</span> HttpHost<span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span> <span class="token number">9200</span><span class="token punctuation">,</span> <span class="token string">&quot;http&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token comment">// 新增文档 - 请求对象</span>
                        <span class="token keyword">val</span> request <span class="token operator">=</span> <span class="token keyword">new</span> IndexRequest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token comment">// 设置索引及唯一性标识</span>
                        <span class="token keyword">val</span> ss <span class="token operator">=</span> data<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span>
                        println<span class="token punctuation">(</span><span class="token string">&quot;ss = &quot;</span> <span class="token operator">+</span> ss<span class="token punctuation">.</span>mkString<span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        request<span class="token punctuation">.</span>index<span class="token punctuation">(</span><span class="token string">&quot;sparkstreaming&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>id<span class="token punctuation">(</span>ss<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">val</span> productJson <span class="token operator">=</span> <span class="token string-interpolation"><span class="token id function">s</span><span class="token string">&quot;&quot;&quot; | { &quot;data&quot;:&quot;</span><span class="token interpolation"><span class="token punctuation">${</span><span class="token expression">ss<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string">&quot; } |&quot;&quot;&quot;</span></span><span class="token punctuation">.</span>stripMargin<span class="token punctuation">;</span>
                        <span class="token comment">// 添加文档数据，数据格式为 JSON 格式</span>
                        request<span class="token punctuation">.</span>source<span class="token punctuation">(</span>productJson<span class="token punctuation">,</span>XContentType<span class="token punctuation">.</span>JSON<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token comment">// 客户端发送请求，获取响应对象</span>
                        <span class="token keyword">val</span> response <span class="token operator">=</span> client<span class="token punctuation">.</span>index<span class="token punctuation">(</span>request<span class="token punctuation">,</span> RequestOptions<span class="token punctuation">.</span>DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span>println<span class="token punctuation">(</span><span class="token string">&quot;_index:&quot;</span> <span class="token operator">+</span> response<span class="token punctuation">.</span>getIndex<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span>println<span class="token punctuation">(</span><span class="token string">&quot;_id:&quot;</span> <span class="token operator">+</span> response<span class="token punctuation">.</span>getId<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span>println<span class="token punctuation">(</span><span class="token string">&quot;_result:&quot;</span> <span class="token operator">+</span> response<span class="token punctuation">.</span>getResult<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        client<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">)</span>
        ssc<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
        ssc<span class="token punctuation">.</span>awaitTermination<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br></div></div><h2 id="flink框架集成"><a href="#flink框架集成" class="header-anchor">#</a> Flink框架集成</h2> <h3 id="flink框架介绍"><a href="#flink框架介绍" class="header-anchor">#</a> Flink框架介绍</h3> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/ElasticSearch/20211118012417.png" alt="image-20211118012416374"></p> <p>Apache Spark 是一种基于内存的快速、通用、可扩展的大数据分析计算引擎。</p> <p>Apache Spark 掀开了内存计算的先河，以内存作为赌注，赢得了内存计算的飞速发展。但是在其火热的同时，开发人员发现，在 Spark 中，计算框架普遍存在的缺点和不足依然没有完全解决，而这些问题随着 5G 时代的来临以及决策者对实时数据分析结果的迫切需要而凸显的更加明显：</p> <ul><li>数据精准一次性处理（Exactly-Once）</li> <li>乱序数据，迟到数据</li> <li>低延迟，高吞吐，准确性</li> <li>容错性</li></ul> <p>Apache Flink 是一个框架和分布式处理引擎，用于对无界和有界数据流进行有状态计算。在 Spark 火热的同时，也默默地发展自己，并尝试着解决其他计算框架的问题。</p> <p>慢慢地，随着这些问题的解决，Flink 慢慢被绝大数程序员所熟知并进行大力推广，阿里公司在 2015 年改进 Flink，并创建了内部分支 Blink，目前服务于阿里集团内部搜索、推荐、广告和蚂蚁等大量核心实时业务。</p> <h3 id="框架搭建-4"><a href="#框架搭建-4" class="header-anchor">#</a> 框架搭建</h3> <ul><li><p>创建一个 Maven 项目</p></li> <li><p>修改 pom 文件，增加相关依赖</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.flink<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>flink-scala_2.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.12.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.flink<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>flink-streaming-scala_2.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.12.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.flink<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>flink-clients_2.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.12.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.flink<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>flink-connector-elasticsearch7_2.11<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.12.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- jackson --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.fasterxml.jackson.core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jackson-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.11.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div></li></ul> <h3 id="功能实现-2"><a href="#功能实现-2" class="header-anchor">#</a> 功能实现</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>api<span class="token punctuation">.</span>common<span class="token punctuation">.</span>functions<span class="token punctuation">.</span></span><span class="token class-name">RuntimeContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>api<span class="token punctuation">.</span>datastream<span class="token punctuation">.</span></span><span class="token class-name">DataStreamSource</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>api<span class="token punctuation">.</span>environment<span class="token punctuation">.</span></span><span class="token class-name">StreamExecutionEnvironment</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> 
<span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>connectors<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span></span><span class="token class-name">ElasticsearchSinkFunctio</span>
n<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>connectors<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span></span><span class="token class-name">RequestIndexer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> 
<span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>connectors<span class="token punctuation">.</span>elasticsearch7<span class="token punctuation">.</span></span><span class="token class-name">ElasticsearchSink</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpHost</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>action<span class="token punctuation">.</span>index<span class="token punctuation">.</span></span><span class="token class-name">IndexRequest</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">Requests</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span></span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FlinkElasticsearchSinkTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">StreamExecutionEnvironment</span> env <span class="token operator">=</span> 
        <span class="token class-name">StreamExecutionEnvironment</span><span class="token punctuation">.</span><span class="token function">getExecutionEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">DataStreamSource</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> source <span class="token operator">=</span> env<span class="token punctuation">.</span><span class="token function">socketTextStream</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span> 
                                                               <span class="token number">9999</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HttpHost</span><span class="token punctuation">&gt;</span></span> httpHosts <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        httpHosts<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HttpHost</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span> <span class="token number">9200</span><span class="token punctuation">,</span> <span class="token string">&quot;http&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//httpHosts.add(new HttpHost(&quot;10.2.3.1&quot;, 9200, &quot;http&quot;));</span>
        <span class="token comment">// use a ElasticsearchSink.Builder to create an ElasticsearchSink</span>
        <span class="token class-name">ElasticsearchSink<span class="token punctuation">.</span>Builder</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> esSinkBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ElasticsearchSink<span class="token punctuation">.</span>Builder</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>httpHosts<span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token class-name">ElasticsearchSinkFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">public</span> <span class="token class-name">IndexRequest</span> <span class="token function">createIndexRequest</span><span class="token punctuation">(</span><span class="token class-name">String</span> element<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> json <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    json<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span> element<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> <span class="token class-name">Requests</span><span class="token punctuation">.</span><span class="token function">indexRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span><span class="token string">&quot;my-index&quot;</span><span class="token punctuation">)</span>
                    <span class="token comment">//.type(&quot;my-type&quot;)</span>
                    <span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token class-name">String</span> element<span class="token punctuation">,</span> <span class="token class-name">RuntimeContext</span> ctx<span class="token punctuation">,</span> <span class="token class-name">RequestIndexer</span> indexer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    indexer<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">createIndexRequest</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// configuration for the bulk requests; this instructs the sink to emit after </span>
        every element<span class="token punctuation">,</span> otherwise they would be buffered esSinkBuilder<span class="token punctuation">.</span><span class="token function">setBulkFlushMaxActions</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// provide a RestClientFactory for custom configuration on the internally created REST client</span>
        <span class="token comment">// esSinkBuilder.setRestClientFactory(</span>
            <span class="token comment">// restClientBuilder -&gt; {</span>
                <span class="token comment">// restClientBuilder.setDefaultHeaders(...)</span>
                <span class="token comment">// restClientBuilder.setMaxRetryTimeoutMillis(...)</span>
                <span class="token comment">// restClientBuilder.setPathPrefix(...)</span>
                <span class="token comment">// restClientBuilder.setHttpClientConfigCallback(...)</span>
        	<span class="token comment">// }</span>
        <span class="token comment">// );</span>
        source<span class="token punctuation">.</span><span class="token function">addSink</span><span class="token punctuation">(</span>esSinkBuilder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        env<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token string">&quot;flink-es&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br></div></div></div></div> <!----> <div class="page-edit"><div class="edit-link"><a href="https://github.com/Kele-Bingtang/pure-blog/edit/master/docs/20.数据库/15.搜索数据库 - ElasticSearch/12. ElasticSearch - 多框架集成.md" target="_blank" rel="noopener noreferrer">编辑此页</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="tags"><a href="/tags/?tag=%E6%90%9C%E7%B4%A2%E6%95%B0%E6%8D%AE%E5%BA%93" title="标签">#搜索数据库</a></div> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">2023/10/23, 18:58:52</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/es/java-curd/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">ElasticSearch - Java操作</div></a> <a href="/es/cluster/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">ElasticSearch - 搭建集群</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/es/java-curd/" class="prev">ElasticSearch - Java操作</a></span> <span class="next"><a href="/es/cluster/">ElasticSearch - 搭建集群</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/ep/magic-change/"><div>
            技术随笔 - Element Plus 修改包名
            <span class="title-tag">
              原创
            </span></div></a> <span class="date">11-02</span></dt></dl><dl><dd>02</dd> <dt><a href="/reactor/extensibility/"><div>
            Reactor - 扩展性
            <!----></div></a> <span class="date">11-02</span></dt></dl><dl><dd>03</dd> <dt><a href="/reactor/best-practices/"><div>
            Reactor - 最佳实践
            <!----></div></a> <span class="date">11-02</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="https://github.com/kele-bingtang" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://gitee.com/kele-bingtang" title="Gitee" target="_blank" class="iconfont icon-gitee"></a><a href="https://www.youngkbt.cn" title="网站首页" target="_blank" class="iconfont icon-rss"></a><a href="http://wpa.qq.com/msgrd?v=3&amp;uin=28761025&amp;site=qq&amp;menu=yes" title="QQ" target="_blank" class="iconfont icon-QQ"></a><a href="https://www.youngkbt.cn/?contact=true" title="联系我" target="_blank" class="iconfont icon-youjian"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2021-2024
    <span>Young Kbt  | blog<br> <a href="http://beian.miit.gov.cn/" target="_blank">桂ICP备2021009994号</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><div></div><div></div><!----></div></div>
    <script src="/assets/js/app.7d9f7e76.js" defer></script><script src="/assets/js/2.7b39a60a.js" defer></script><script src="/assets/js/170.85b5600d.js" defer></script><script src="/assets/js/7.e563704e.js" defer></script><script src="/assets/js/4.e30b0885.js" defer></script>
  </body>
</html>
