<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JVM - 字节码指令集与解析 | Young Kbt blog</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_3114978_qe0b39no76.css">
    <script>var _hmt = _hmt || [];
          (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?14366b81d7983944862ae088864b209e"; 
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
          })();
          </script>
    <meta name="description" content="Young Kbt个人博客, VuePress搭建, 使用了 Vdoing 主题, 学习Java, Web, 框架, 微服务, 工具, 前端等相关知识, 记录生活和技术路程, 同时分享编程技巧。">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <meta name="keywords" content="Young Kbt个人博客, VuePress搭建, 学习Java、Web、框架、微服务、工具、前端等相关知识, 记录生活和技术路程。">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.b07bbc3a.css" as="style"><link rel="preload" href="/assets/js/app.7d9f7e76.js" as="script"><link rel="preload" href="/assets/js/2.7b39a60a.js" as="script"><link rel="preload" href="/assets/js/120.2fca89dd.js" as="script"><link rel="preload" href="/assets/js/7.e563704e.js" as="script"><link rel="preload" href="/assets/js/4.e30b0885.js" as="script"><link rel="prefetch" href="/assets/js/10.b6825257.js"><link rel="prefetch" href="/assets/js/100.d103d95b.js"><link rel="prefetch" href="/assets/js/101.ae6e3c8f.js"><link rel="prefetch" href="/assets/js/102.526b5644.js"><link rel="prefetch" href="/assets/js/103.68abd23e.js"><link rel="prefetch" href="/assets/js/104.bd57d04b.js"><link rel="prefetch" href="/assets/js/105.0642aac9.js"><link rel="prefetch" href="/assets/js/106.6b8f9f08.js"><link rel="prefetch" href="/assets/js/107.cc7e19b8.js"><link rel="prefetch" href="/assets/js/108.c4525208.js"><link rel="prefetch" href="/assets/js/109.0b1c7898.js"><link rel="prefetch" href="/assets/js/11.b5afe39f.js"><link rel="prefetch" href="/assets/js/110.8afa0063.js"><link rel="prefetch" href="/assets/js/111.28d673dc.js"><link rel="prefetch" href="/assets/js/112.66d9bd11.js"><link rel="prefetch" href="/assets/js/113.433669e6.js"><link rel="prefetch" href="/assets/js/114.e1cc4ff7.js"><link rel="prefetch" href="/assets/js/115.debd1417.js"><link rel="prefetch" href="/assets/js/116.f8015493.js"><link rel="prefetch" href="/assets/js/117.0ca04914.js"><link rel="prefetch" href="/assets/js/118.92cef09d.js"><link rel="prefetch" href="/assets/js/119.58db364e.js"><link rel="prefetch" href="/assets/js/12.0dcf3b8d.js"><link rel="prefetch" href="/assets/js/121.682beb68.js"><link rel="prefetch" href="/assets/js/122.16c4338c.js"><link rel="prefetch" href="/assets/js/123.4bcb5658.js"><link rel="prefetch" href="/assets/js/124.f0812337.js"><link rel="prefetch" href="/assets/js/125.9547ffac.js"><link rel="prefetch" href="/assets/js/126.260b028e.js"><link rel="prefetch" href="/assets/js/127.35c305f1.js"><link rel="prefetch" href="/assets/js/128.51518491.js"><link rel="prefetch" href="/assets/js/129.4abce5b6.js"><link rel="prefetch" href="/assets/js/13.1917ed59.js"><link rel="prefetch" href="/assets/js/130.30b94ef1.js"><link rel="prefetch" href="/assets/js/131.043ebb9a.js"><link rel="prefetch" href="/assets/js/132.600a69b3.js"><link rel="prefetch" href="/assets/js/133.93f00f2b.js"><link rel="prefetch" href="/assets/js/134.6e0b6076.js"><link rel="prefetch" href="/assets/js/135.b48e1b10.js"><link rel="prefetch" href="/assets/js/136.a4467daa.js"><link rel="prefetch" href="/assets/js/137.defb23b7.js"><link rel="prefetch" href="/assets/js/138.a26227ea.js"><link rel="prefetch" href="/assets/js/139.5961a7f4.js"><link rel="prefetch" href="/assets/js/14.ce95fd70.js"><link rel="prefetch" href="/assets/js/140.5903e789.js"><link rel="prefetch" href="/assets/js/141.d255f04e.js"><link rel="prefetch" href="/assets/js/142.465e7162.js"><link rel="prefetch" href="/assets/js/143.50d0f8f7.js"><link rel="prefetch" href="/assets/js/144.340337d2.js"><link rel="prefetch" href="/assets/js/145.36c59bff.js"><link rel="prefetch" href="/assets/js/146.73100c57.js"><link rel="prefetch" href="/assets/js/147.e331cefd.js"><link rel="prefetch" href="/assets/js/148.87ae373b.js"><link rel="prefetch" href="/assets/js/149.f22b1782.js"><link rel="prefetch" href="/assets/js/15.9e02ccda.js"><link rel="prefetch" href="/assets/js/150.b4592a09.js"><link rel="prefetch" href="/assets/js/151.4f3d1dda.js"><link rel="prefetch" href="/assets/js/152.d8b4915b.js"><link rel="prefetch" href="/assets/js/153.2924288b.js"><link rel="prefetch" href="/assets/js/154.581cf5cf.js"><link rel="prefetch" href="/assets/js/155.6005dd53.js"><link rel="prefetch" href="/assets/js/156.4a9ed2cb.js"><link rel="prefetch" href="/assets/js/157.602dddd3.js"><link rel="prefetch" href="/assets/js/158.708e482f.js"><link rel="prefetch" href="/assets/js/159.425755c1.js"><link rel="prefetch" href="/assets/js/16.df720a5d.js"><link rel="prefetch" href="/assets/js/160.be1c227e.js"><link rel="prefetch" href="/assets/js/161.1f895b84.js"><link rel="prefetch" href="/assets/js/162.9ef108c5.js"><link rel="prefetch" href="/assets/js/163.dc1dd396.js"><link rel="prefetch" href="/assets/js/164.0df8355a.js"><link rel="prefetch" href="/assets/js/165.050ac25b.js"><link rel="prefetch" href="/assets/js/166.f7587509.js"><link rel="prefetch" href="/assets/js/167.8c7cfc7b.js"><link rel="prefetch" href="/assets/js/168.b50375d4.js"><link rel="prefetch" href="/assets/js/169.2d4bb241.js"><link rel="prefetch" href="/assets/js/17.1fd9e299.js"><link rel="prefetch" href="/assets/js/170.85b5600d.js"><link rel="prefetch" href="/assets/js/171.f138cd88.js"><link rel="prefetch" href="/assets/js/172.0ad47eee.js"><link rel="prefetch" href="/assets/js/173.2a5faa99.js"><link rel="prefetch" href="/assets/js/174.3324ae57.js"><link rel="prefetch" href="/assets/js/175.61bf147f.js"><link rel="prefetch" href="/assets/js/176.80292c8b.js"><link rel="prefetch" href="/assets/js/177.7999417a.js"><link rel="prefetch" href="/assets/js/178.e32debc3.js"><link rel="prefetch" href="/assets/js/179.f9463959.js"><link rel="prefetch" href="/assets/js/18.c42f17a3.js"><link rel="prefetch" href="/assets/js/180.09ef873d.js"><link rel="prefetch" href="/assets/js/181.d610926e.js"><link rel="prefetch" href="/assets/js/182.2e3e68ec.js"><link rel="prefetch" href="/assets/js/183.0e9b7309.js"><link rel="prefetch" href="/assets/js/184.ac5346d7.js"><link rel="prefetch" href="/assets/js/185.d21bcd1b.js"><link rel="prefetch" href="/assets/js/186.28ccb3ee.js"><link rel="prefetch" href="/assets/js/187.bcbcd0f4.js"><link rel="prefetch" href="/assets/js/188.de487e32.js"><link rel="prefetch" href="/assets/js/189.169cf767.js"><link rel="prefetch" href="/assets/js/19.3582dff6.js"><link rel="prefetch" href="/assets/js/190.7e6bf93c.js"><link rel="prefetch" href="/assets/js/191.0f5e1658.js"><link rel="prefetch" href="/assets/js/192.a32dbf35.js"><link rel="prefetch" href="/assets/js/193.a593fe1d.js"><link rel="prefetch" href="/assets/js/194.719cc463.js"><link rel="prefetch" href="/assets/js/195.1259e47a.js"><link rel="prefetch" href="/assets/js/196.a99da1c7.js"><link rel="prefetch" href="/assets/js/197.b0b21515.js"><link rel="prefetch" href="/assets/js/198.aa1ba0d6.js"><link rel="prefetch" href="/assets/js/199.6ed1691e.js"><link rel="prefetch" href="/assets/js/20.6c0cb91f.js"><link rel="prefetch" href="/assets/js/200.ba92f02f.js"><link rel="prefetch" href="/assets/js/201.11f54a16.js"><link rel="prefetch" href="/assets/js/202.58cd694b.js"><link rel="prefetch" href="/assets/js/203.2211b234.js"><link rel="prefetch" href="/assets/js/204.c547f4fe.js"><link rel="prefetch" href="/assets/js/205.50ab5161.js"><link rel="prefetch" href="/assets/js/206.1ce5b3a2.js"><link rel="prefetch" href="/assets/js/207.179f9bd4.js"><link rel="prefetch" href="/assets/js/208.aff15d57.js"><link rel="prefetch" href="/assets/js/209.7aacec3f.js"><link rel="prefetch" href="/assets/js/21.778fd061.js"><link rel="prefetch" href="/assets/js/210.b0da74e3.js"><link rel="prefetch" href="/assets/js/211.e34a57d1.js"><link rel="prefetch" href="/assets/js/212.1c389f99.js"><link rel="prefetch" href="/assets/js/213.4968ec40.js"><link rel="prefetch" href="/assets/js/214.96cd7dc1.js"><link rel="prefetch" href="/assets/js/215.2294f023.js"><link rel="prefetch" href="/assets/js/216.94b79bd7.js"><link rel="prefetch" href="/assets/js/217.66873941.js"><link rel="prefetch" href="/assets/js/218.46127ee9.js"><link rel="prefetch" href="/assets/js/219.8d56ef2a.js"><link rel="prefetch" href="/assets/js/22.089d9f58.js"><link rel="prefetch" href="/assets/js/220.88c5d45c.js"><link rel="prefetch" href="/assets/js/221.00faba44.js"><link rel="prefetch" href="/assets/js/222.eeb2a5f0.js"><link rel="prefetch" href="/assets/js/223.b9fc4f54.js"><link rel="prefetch" href="/assets/js/224.ac5a667f.js"><link rel="prefetch" href="/assets/js/225.4cc60a26.js"><link rel="prefetch" href="/assets/js/226.dffd6bb9.js"><link rel="prefetch" href="/assets/js/227.2a359dae.js"><link rel="prefetch" href="/assets/js/228.bf1438fd.js"><link rel="prefetch" href="/assets/js/229.dec18b07.js"><link rel="prefetch" href="/assets/js/23.93a4e46a.js"><link rel="prefetch" href="/assets/js/230.548f31e7.js"><link rel="prefetch" href="/assets/js/231.1c78b57d.js"><link rel="prefetch" href="/assets/js/232.3b857fb1.js"><link rel="prefetch" href="/assets/js/233.911b81f2.js"><link rel="prefetch" href="/assets/js/234.be86b8fe.js"><link rel="prefetch" href="/assets/js/235.cc8ea54a.js"><link rel="prefetch" href="/assets/js/236.b7bb40cd.js"><link rel="prefetch" href="/assets/js/237.2642218d.js"><link rel="prefetch" href="/assets/js/238.cfaf71b5.js"><link rel="prefetch" href="/assets/js/239.1034bf3d.js"><link rel="prefetch" href="/assets/js/24.c4395ec9.js"><link rel="prefetch" href="/assets/js/240.955ca6a3.js"><link rel="prefetch" href="/assets/js/241.6564b15e.js"><link rel="prefetch" href="/assets/js/242.1d1a8251.js"><link rel="prefetch" href="/assets/js/243.4765c501.js"><link rel="prefetch" href="/assets/js/244.c6274062.js"><link rel="prefetch" href="/assets/js/245.21362c48.js"><link rel="prefetch" href="/assets/js/246.462c1742.js"><link rel="prefetch" href="/assets/js/247.7ae3a9d0.js"><link rel="prefetch" href="/assets/js/248.d73ad74c.js"><link rel="prefetch" href="/assets/js/249.c2456396.js"><link rel="prefetch" href="/assets/js/25.5096818d.js"><link rel="prefetch" href="/assets/js/250.e8f1dc24.js"><link rel="prefetch" href="/assets/js/251.a33207d0.js"><link rel="prefetch" href="/assets/js/252.2f3c133d.js"><link rel="prefetch" href="/assets/js/253.2d6c1fb3.js"><link rel="prefetch" href="/assets/js/254.c4dde29b.js"><link rel="prefetch" href="/assets/js/255.9adfbab0.js"><link rel="prefetch" href="/assets/js/256.91139fda.js"><link rel="prefetch" href="/assets/js/257.b86b15e3.js"><link rel="prefetch" href="/assets/js/258.56cffe32.js"><link rel="prefetch" href="/assets/js/259.4dd27ce8.js"><link rel="prefetch" href="/assets/js/26.8043e201.js"><link rel="prefetch" href="/assets/js/260.37db56f7.js"><link rel="prefetch" href="/assets/js/261.26e412ed.js"><link rel="prefetch" href="/assets/js/262.64f081b2.js"><link rel="prefetch" href="/assets/js/263.d9fa3de2.js"><link rel="prefetch" href="/assets/js/264.2b7fb8fc.js"><link rel="prefetch" href="/assets/js/265.be87c3e1.js"><link rel="prefetch" href="/assets/js/266.17216d4f.js"><link rel="prefetch" href="/assets/js/267.3f13de5d.js"><link rel="prefetch" href="/assets/js/268.2ecc1c61.js"><link rel="prefetch" href="/assets/js/269.b2313ca5.js"><link rel="prefetch" href="/assets/js/27.7722643a.js"><link rel="prefetch" href="/assets/js/270.21277a28.js"><link rel="prefetch" href="/assets/js/271.3fb4b191.js"><link rel="prefetch" href="/assets/js/272.f8308978.js"><link rel="prefetch" href="/assets/js/273.de07e8f8.js"><link rel="prefetch" href="/assets/js/274.efadd2d2.js"><link rel="prefetch" href="/assets/js/275.a67b32c1.js"><link rel="prefetch" href="/assets/js/276.01c2f99a.js"><link rel="prefetch" href="/assets/js/277.a1e4c17a.js"><link rel="prefetch" href="/assets/js/278.3597dad7.js"><link rel="prefetch" href="/assets/js/279.39eb5fe6.js"><link rel="prefetch" href="/assets/js/28.950fd757.js"><link rel="prefetch" href="/assets/js/280.6ff96471.js"><link rel="prefetch" href="/assets/js/281.103fe69f.js"><link rel="prefetch" href="/assets/js/282.be71da36.js"><link rel="prefetch" href="/assets/js/283.de64f17d.js"><link rel="prefetch" href="/assets/js/284.9eb0b8fc.js"><link rel="prefetch" href="/assets/js/285.761859fc.js"><link rel="prefetch" href="/assets/js/286.346ccdc2.js"><link rel="prefetch" href="/assets/js/287.22ddf0f9.js"><link rel="prefetch" href="/assets/js/288.69b02cc4.js"><link rel="prefetch" href="/assets/js/289.1fc91664.js"><link rel="prefetch" href="/assets/js/29.e3efef75.js"><link rel="prefetch" href="/assets/js/290.09b43cdf.js"><link rel="prefetch" href="/assets/js/291.670c597a.js"><link rel="prefetch" href="/assets/js/292.3c8be194.js"><link rel="prefetch" href="/assets/js/293.ce187eca.js"><link rel="prefetch" href="/assets/js/294.a91e3d30.js"><link rel="prefetch" href="/assets/js/295.08100fa2.js"><link rel="prefetch" href="/assets/js/296.160bc832.js"><link rel="prefetch" href="/assets/js/297.4274595e.js"><link rel="prefetch" href="/assets/js/298.2f39a31a.js"><link rel="prefetch" href="/assets/js/299.5762f2da.js"><link rel="prefetch" href="/assets/js/3.78b8ad1e.js"><link rel="prefetch" href="/assets/js/30.b7735995.js"><link rel="prefetch" href="/assets/js/300.f39b59cc.js"><link rel="prefetch" href="/assets/js/301.9174b188.js"><link rel="prefetch" href="/assets/js/302.c0199c18.js"><link rel="prefetch" href="/assets/js/303.36446fe4.js"><link rel="prefetch" href="/assets/js/304.28526293.js"><link rel="prefetch" href="/assets/js/305.8c961411.js"><link rel="prefetch" href="/assets/js/306.35e14e4d.js"><link rel="prefetch" href="/assets/js/307.90595fb1.js"><link rel="prefetch" href="/assets/js/308.07ba8434.js"><link rel="prefetch" href="/assets/js/309.f1118e35.js"><link rel="prefetch" href="/assets/js/31.9e4bb835.js"><link rel="prefetch" href="/assets/js/310.8f818ee1.js"><link rel="prefetch" href="/assets/js/311.daf5fc45.js"><link rel="prefetch" href="/assets/js/312.6f5b159a.js"><link rel="prefetch" href="/assets/js/313.2d5139a9.js"><link rel="prefetch" href="/assets/js/314.b3df01a2.js"><link rel="prefetch" href="/assets/js/315.d1a08dc7.js"><link rel="prefetch" href="/assets/js/316.43c3f8bc.js"><link rel="prefetch" href="/assets/js/317.30abc7e4.js"><link rel="prefetch" href="/assets/js/318.52698790.js"><link rel="prefetch" href="/assets/js/319.b646604d.js"><link rel="prefetch" href="/assets/js/32.803ad8dc.js"><link rel="prefetch" href="/assets/js/320.cef634e4.js"><link rel="prefetch" href="/assets/js/321.ab001cc2.js"><link rel="prefetch" href="/assets/js/322.afe55670.js"><link rel="prefetch" href="/assets/js/323.c663a8ec.js"><link rel="prefetch" href="/assets/js/324.3f8d5693.js"><link rel="prefetch" href="/assets/js/325.6ed9477b.js"><link rel="prefetch" href="/assets/js/326.60c465cd.js"><link rel="prefetch" href="/assets/js/327.bec7ea7a.js"><link rel="prefetch" href="/assets/js/328.3ef962e2.js"><link rel="prefetch" href="/assets/js/329.d6ccccab.js"><link rel="prefetch" href="/assets/js/33.0b3cff33.js"><link rel="prefetch" href="/assets/js/330.a1076e53.js"><link rel="prefetch" href="/assets/js/331.76598413.js"><link rel="prefetch" href="/assets/js/332.9e7f848a.js"><link rel="prefetch" href="/assets/js/333.6a6d7f3d.js"><link rel="prefetch" href="/assets/js/334.eff8c014.js"><link rel="prefetch" href="/assets/js/335.c8e1c83e.js"><link rel="prefetch" href="/assets/js/336.930669ce.js"><link rel="prefetch" href="/assets/js/337.b1feba3b.js"><link rel="prefetch" href="/assets/js/338.7dfa3e68.js"><link rel="prefetch" href="/assets/js/339.ae11034f.js"><link rel="prefetch" href="/assets/js/34.d0ee60c4.js"><link rel="prefetch" href="/assets/js/340.e2dfab8c.js"><link rel="prefetch" href="/assets/js/341.859b1112.js"><link rel="prefetch" href="/assets/js/342.a585d93c.js"><link rel="prefetch" href="/assets/js/343.f1d73e84.js"><link rel="prefetch" href="/assets/js/344.f875fd3c.js"><link rel="prefetch" href="/assets/js/345.9e174120.js"><link rel="prefetch" href="/assets/js/346.0248797e.js"><link rel="prefetch" href="/assets/js/347.6e2b880e.js"><link rel="prefetch" href="/assets/js/348.60468a87.js"><link rel="prefetch" href="/assets/js/349.88f9db3f.js"><link rel="prefetch" href="/assets/js/35.d885736b.js"><link rel="prefetch" href="/assets/js/350.c630111b.js"><link rel="prefetch" href="/assets/js/351.64adf51f.js"><link rel="prefetch" href="/assets/js/352.09555b5f.js"><link rel="prefetch" href="/assets/js/353.b912a2d5.js"><link rel="prefetch" href="/assets/js/354.fa20079b.js"><link rel="prefetch" href="/assets/js/355.926705f1.js"><link rel="prefetch" href="/assets/js/356.fad4ff0b.js"><link rel="prefetch" href="/assets/js/357.7cc580d8.js"><link rel="prefetch" href="/assets/js/358.f9719f2b.js"><link rel="prefetch" href="/assets/js/359.b69f7a3a.js"><link rel="prefetch" href="/assets/js/36.d32e0c7d.js"><link rel="prefetch" href="/assets/js/360.801d8b40.js"><link rel="prefetch" href="/assets/js/361.90d6e346.js"><link rel="prefetch" href="/assets/js/362.1e7346ac.js"><link rel="prefetch" href="/assets/js/363.f22c9fca.js"><link rel="prefetch" href="/assets/js/364.76d34c40.js"><link rel="prefetch" href="/assets/js/365.b65d2767.js"><link rel="prefetch" href="/assets/js/366.cf03d70a.js"><link rel="prefetch" href="/assets/js/367.b4bbe0db.js"><link rel="prefetch" href="/assets/js/368.914d5412.js"><link rel="prefetch" href="/assets/js/369.9b099efe.js"><link rel="prefetch" href="/assets/js/37.371090d1.js"><link rel="prefetch" href="/assets/js/370.c672552d.js"><link rel="prefetch" href="/assets/js/371.87f1821b.js"><link rel="prefetch" href="/assets/js/372.82e4be2e.js"><link rel="prefetch" href="/assets/js/373.96de1573.js"><link rel="prefetch" href="/assets/js/374.4117ae1c.js"><link rel="prefetch" href="/assets/js/375.0f48d5fe.js"><link rel="prefetch" href="/assets/js/376.11ea841a.js"><link rel="prefetch" href="/assets/js/377.e57737a0.js"><link rel="prefetch" href="/assets/js/378.4f1aa4e6.js"><link rel="prefetch" href="/assets/js/379.27799a36.js"><link rel="prefetch" href="/assets/js/38.27e886c4.js"><link rel="prefetch" href="/assets/js/380.c282bf16.js"><link rel="prefetch" href="/assets/js/381.b251870b.js"><link rel="prefetch" href="/assets/js/382.9b8d594e.js"><link rel="prefetch" href="/assets/js/383.edba6d00.js"><link rel="prefetch" href="/assets/js/384.38792a61.js"><link rel="prefetch" href="/assets/js/385.4f858cda.js"><link rel="prefetch" href="/assets/js/386.43b3e7f0.js"><link rel="prefetch" href="/assets/js/387.1e8b1bca.js"><link rel="prefetch" href="/assets/js/388.ad777b0c.js"><link rel="prefetch" href="/assets/js/389.d2778c85.js"><link rel="prefetch" href="/assets/js/39.2bea46e1.js"><link rel="prefetch" href="/assets/js/390.0b41b23f.js"><link rel="prefetch" href="/assets/js/391.e2aa3c31.js"><link rel="prefetch" href="/assets/js/392.08d66674.js"><link rel="prefetch" href="/assets/js/393.236c62b4.js"><link rel="prefetch" href="/assets/js/394.b3bbe6f3.js"><link rel="prefetch" href="/assets/js/395.99c2faf4.js"><link rel="prefetch" href="/assets/js/396.1f04605f.js"><link rel="prefetch" href="/assets/js/397.d3efe3ae.js"><link rel="prefetch" href="/assets/js/398.8a8f0f35.js"><link rel="prefetch" href="/assets/js/399.0c6be981.js"><link rel="prefetch" href="/assets/js/40.5069f7b9.js"><link rel="prefetch" href="/assets/js/400.48318902.js"><link rel="prefetch" href="/assets/js/401.4f281702.js"><link rel="prefetch" href="/assets/js/402.34991da3.js"><link rel="prefetch" href="/assets/js/403.25ec58aa.js"><link rel="prefetch" href="/assets/js/404.aa65a935.js"><link rel="prefetch" href="/assets/js/405.e7310d84.js"><link rel="prefetch" href="/assets/js/406.bc12db33.js"><link rel="prefetch" href="/assets/js/407.510a85fa.js"><link rel="prefetch" href="/assets/js/408.6a2d37f6.js"><link rel="prefetch" href="/assets/js/409.5b6a91ab.js"><link rel="prefetch" href="/assets/js/41.7acd4c1f.js"><link rel="prefetch" href="/assets/js/410.77f74daa.js"><link rel="prefetch" href="/assets/js/411.54eee144.js"><link rel="prefetch" href="/assets/js/412.6bac9eec.js"><link rel="prefetch" href="/assets/js/413.b0e33d0a.js"><link rel="prefetch" href="/assets/js/414.f977b5a9.js"><link rel="prefetch" href="/assets/js/415.b659834b.js"><link rel="prefetch" href="/assets/js/416.813b3fb9.js"><link rel="prefetch" href="/assets/js/417.ffea8a95.js"><link rel="prefetch" href="/assets/js/418.2e6c92d6.js"><link rel="prefetch" href="/assets/js/419.5633feac.js"><link rel="prefetch" href="/assets/js/42.74167a2e.js"><link rel="prefetch" href="/assets/js/420.198a4653.js"><link rel="prefetch" href="/assets/js/421.725b1d3a.js"><link rel="prefetch" href="/assets/js/422.f2bec49d.js"><link rel="prefetch" href="/assets/js/423.bd79c37c.js"><link rel="prefetch" href="/assets/js/424.d2b68f60.js"><link rel="prefetch" href="/assets/js/425.175fcc17.js"><link rel="prefetch" href="/assets/js/426.2f105da2.js"><link rel="prefetch" href="/assets/js/427.944e11a1.js"><link rel="prefetch" href="/assets/js/428.b0022fe6.js"><link rel="prefetch" href="/assets/js/429.5aaba160.js"><link rel="prefetch" href="/assets/js/43.a08f2844.js"><link rel="prefetch" href="/assets/js/430.2c115268.js"><link rel="prefetch" href="/assets/js/431.a13146d3.js"><link rel="prefetch" href="/assets/js/432.61e43e71.js"><link rel="prefetch" href="/assets/js/433.6fa7a555.js"><link rel="prefetch" href="/assets/js/434.b41278cd.js"><link rel="prefetch" href="/assets/js/435.aece757b.js"><link rel="prefetch" href="/assets/js/436.bb18daae.js"><link rel="prefetch" href="/assets/js/437.2f6a7e4e.js"><link rel="prefetch" href="/assets/js/438.509027e7.js"><link rel="prefetch" href="/assets/js/439.aef490af.js"><link rel="prefetch" href="/assets/js/44.fcbaa8b5.js"><link rel="prefetch" href="/assets/js/440.c3de28dd.js"><link rel="prefetch" href="/assets/js/441.c17b32f0.js"><link rel="prefetch" href="/assets/js/442.618ac531.js"><link rel="prefetch" href="/assets/js/443.3e6e6a25.js"><link rel="prefetch" href="/assets/js/444.0345d904.js"><link rel="prefetch" href="/assets/js/445.745909d0.js"><link rel="prefetch" href="/assets/js/446.3bb6d732.js"><link rel="prefetch" href="/assets/js/447.8a754244.js"><link rel="prefetch" href="/assets/js/448.d5bf5584.js"><link rel="prefetch" href="/assets/js/449.86eb5144.js"><link rel="prefetch" href="/assets/js/45.5446ff28.js"><link rel="prefetch" href="/assets/js/450.45dc7bae.js"><link rel="prefetch" href="/assets/js/451.2476df07.js"><link rel="prefetch" href="/assets/js/452.12b20843.js"><link rel="prefetch" href="/assets/js/453.b1f7c6ad.js"><link rel="prefetch" href="/assets/js/454.d0c69556.js"><link rel="prefetch" href="/assets/js/455.ec29b2df.js"><link rel="prefetch" href="/assets/js/456.dc86754b.js"><link rel="prefetch" href="/assets/js/457.d0f6a91b.js"><link rel="prefetch" href="/assets/js/458.b8336337.js"><link rel="prefetch" href="/assets/js/459.fb6637be.js"><link rel="prefetch" href="/assets/js/46.943c0d34.js"><link rel="prefetch" href="/assets/js/460.f3944a29.js"><link rel="prefetch" href="/assets/js/461.3d55326f.js"><link rel="prefetch" href="/assets/js/462.e6d87054.js"><link rel="prefetch" href="/assets/js/463.50afd2e7.js"><link rel="prefetch" href="/assets/js/464.d5c3c482.js"><link rel="prefetch" href="/assets/js/465.3c3c48dc.js"><link rel="prefetch" href="/assets/js/466.6a20609e.js"><link rel="prefetch" href="/assets/js/467.63d72787.js"><link rel="prefetch" href="/assets/js/468.8febc3fb.js"><link rel="prefetch" href="/assets/js/469.82fb6804.js"><link rel="prefetch" href="/assets/js/47.76ace16f.js"><link rel="prefetch" href="/assets/js/470.b83e6f93.js"><link rel="prefetch" href="/assets/js/471.c8611e3c.js"><link rel="prefetch" href="/assets/js/472.daa5a5b3.js"><link rel="prefetch" href="/assets/js/473.5f330161.js"><link rel="prefetch" href="/assets/js/474.0f55f5ff.js"><link rel="prefetch" href="/assets/js/475.8a436343.js"><link rel="prefetch" href="/assets/js/476.d43a0802.js"><link rel="prefetch" href="/assets/js/477.b5eb95e6.js"><link rel="prefetch" href="/assets/js/478.6bc64bc5.js"><link rel="prefetch" href="/assets/js/479.64d16a91.js"><link rel="prefetch" href="/assets/js/48.739263d5.js"><link rel="prefetch" href="/assets/js/480.4599cdd7.js"><link rel="prefetch" href="/assets/js/49.65437a65.js"><link rel="prefetch" href="/assets/js/5.f15c72b7.js"><link rel="prefetch" href="/assets/js/50.d2ee3f55.js"><link rel="prefetch" href="/assets/js/51.311d5ade.js"><link rel="prefetch" href="/assets/js/52.bfdc8e9f.js"><link rel="prefetch" href="/assets/js/53.5359ac8b.js"><link rel="prefetch" href="/assets/js/54.f8010d21.js"><link rel="prefetch" href="/assets/js/55.fe595a55.js"><link rel="prefetch" href="/assets/js/56.c0f0c3a8.js"><link rel="prefetch" href="/assets/js/57.136294b7.js"><link rel="prefetch" href="/assets/js/58.7f208b82.js"><link rel="prefetch" href="/assets/js/59.fdbd0d41.js"><link rel="prefetch" href="/assets/js/6.f2722aef.js"><link rel="prefetch" href="/assets/js/60.8c0d65fe.js"><link rel="prefetch" href="/assets/js/61.7d48bcd3.js"><link rel="prefetch" href="/assets/js/62.d724e4aa.js"><link rel="prefetch" href="/assets/js/63.c2559e67.js"><link rel="prefetch" href="/assets/js/64.649291bd.js"><link rel="prefetch" href="/assets/js/65.0f6c617f.js"><link rel="prefetch" href="/assets/js/66.672f4c77.js"><link rel="prefetch" href="/assets/js/67.f3a71885.js"><link rel="prefetch" href="/assets/js/68.e3d4937d.js"><link rel="prefetch" href="/assets/js/69.6fb7bc4d.js"><link rel="prefetch" href="/assets/js/70.dd124372.js"><link rel="prefetch" href="/assets/js/71.4a756005.js"><link rel="prefetch" href="/assets/js/72.c2b6894c.js"><link rel="prefetch" href="/assets/js/73.5a1916b7.js"><link rel="prefetch" href="/assets/js/74.8eb238c0.js"><link rel="prefetch" href="/assets/js/75.9aaf8408.js"><link rel="prefetch" href="/assets/js/76.80203376.js"><link rel="prefetch" href="/assets/js/77.f3f8794f.js"><link rel="prefetch" href="/assets/js/78.0090e20b.js"><link rel="prefetch" href="/assets/js/79.e6f4b2b0.js"><link rel="prefetch" href="/assets/js/8.49e45d52.js"><link rel="prefetch" href="/assets/js/80.aa562b5f.js"><link rel="prefetch" href="/assets/js/81.de8f199b.js"><link rel="prefetch" href="/assets/js/82.b78e5955.js"><link rel="prefetch" href="/assets/js/83.d7c0e01e.js"><link rel="prefetch" href="/assets/js/84.1ddbe7a4.js"><link rel="prefetch" href="/assets/js/85.9fe8d47e.js"><link rel="prefetch" href="/assets/js/86.f795b7ab.js"><link rel="prefetch" href="/assets/js/87.effa924a.js"><link rel="prefetch" href="/assets/js/88.d9854d1e.js"><link rel="prefetch" href="/assets/js/89.b7d54d15.js"><link rel="prefetch" href="/assets/js/9.9578969c.js"><link rel="prefetch" href="/assets/js/90.b17ee25c.js"><link rel="prefetch" href="/assets/js/91.c5c7c6e3.js"><link rel="prefetch" href="/assets/js/92.72d4d2ea.js"><link rel="prefetch" href="/assets/js/93.fadf96ec.js"><link rel="prefetch" href="/assets/js/94.53efcdf4.js"><link rel="prefetch" href="/assets/js/95.2928f167.js"><link rel="prefetch" href="/assets/js/96.62918d30.js"><link rel="prefetch" href="/assets/js/97.3bb50446.js"><link rel="prefetch" href="/assets/js/98.12e7a055.js"><link rel="prefetch" href="/assets/js/99.3daa2010.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b07bbc3a.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/index/logo.png" alt="Young Kbt blog" class="logo"> <span class="site-name can-hide">Young Kbt blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><a href="/java/" class="link-title router-link-active">Java</a> <span class="title" style="display:none;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>java基础</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java/se/" class="nav-link">Java基础</a></li><li class="dropdown-subitem"><a href="/java/collection/" class="nav-link">Java集合</a></li><li class="dropdown-subitem"><a href="/java/se/reflect/" class="nav-link">Java反射</a></li><li class="dropdown-subitem"><a href="/java/juc/" class="nav-link">JavaJUC</a></li><li class="dropdown-subitem"><a href="/java/jvm/" class="nav-link router-link-active">JavaJVM</a></li></ul></li><li class="dropdown-item"><h4>Java容器</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/javaweb/concept/" class="nav-link">JavaWeb</a></li></ul></li><li class="dropdown-item"><h4>Java版本新特性</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java/new-features/" class="nav-link">Java新特性</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><a href="/database/" class="link-title">数据库</a> <span class="title" style="display:none;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>SQL 数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/mysql/" class="nav-link">MySQL</a></li><li class="dropdown-subitem"><a href="/oracle/" class="nav-link">Oracle</a></li></ul></li><li class="dropdown-item"><h4>NoSQL 数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/redis/" class="nav-link">Redis</a></li><li class="dropdown-subitem"><a href="/es/" class="nav-link">ElasticSearch</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><a href="/frames/" class="link-title">框架</a> <span class="title" style="display:none;">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/mybatis/" class="nav-link">MyBatis</a></li><li class="dropdown-subitem"><a href="/mybatis-plus/" class="nav-link">MyBatis-Plus</a></li></ul></li><li class="dropdown-item"><h4>消息中间件</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/activemq/" class="nav-link">ActiveMQ</a></li><li class="dropdown-subitem"><a href="/rabbitmq/" class="nav-link">RabbitMQ</a></li><li class="dropdown-subitem"><a href="/rocketmq/" class="nav-link">RocketMQ</a></li><li class="dropdown-subitem"><a href="/kafka/" class="nav-link">Kafka</a></li></ul></li><li class="dropdown-item"><h4>进阶服务</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/nginx/" class="nav-link">Nginx</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Spring生态" class="dropdown-title"><a href="/spring-ecology/" class="link-title">Spring生态</a> <span class="title" style="display:none;">Spring生态</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/spring/" class="nav-link">Spring</a></li><li class="dropdown-item"><!----> <a href="/spring-boot/" class="nav-link">Spring Boot</a></li><li class="dropdown-item"><!----> <a href="/spring-security/" class="nav-link">Spring Security</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发" class="dropdown-title"><a href="/dev-guide/" class="link-title">开发</a> <span class="title" style="display:none;">开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/design-pattern/" class="nav-link">设计模式</a></li><li class="dropdown-item"><!----> <a href="/algorithm/" class="nav-link">算法</a></li><li class="dropdown-item"><!----> <a href="/knowledge/" class="nav-link">知识</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><a href="/tool/" class="link-title">工具</a> <span class="title" style="display:none;">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>管理</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/maven/" class="nav-link">Maven</a></li><li class="dropdown-subitem"><a href="/git/" class="nav-link">Git</a></li></ul></li><li class="dropdown-item"><h4>部署</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/linux/" class="nav-link">Linux</a></li><li class="dropdown-subitem"><a href="/docker/" class="nav-link">Docker</a></li><li class="dropdown-subitem"><a href="/jenkins/" class="nav-link">Jenkins</a></li><li class="dropdown-subitem"><a href="/kubernetes/" class="nav-link">Kubernetes</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/front/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>进阶</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/typescript/" class="nav-link">TypeScript</a></li></ul></li><li class="dropdown-item"><h4>框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/react/" class="nav-link">React</a></li><li class="dropdown-subitem"><a href="/vue2/" class="nav-link">Vue2</a></li><li class="dropdown-subitem"><a href="/vue3/" class="nav-link">Vue3</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><!----> <span class="title" style="display:;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/whells-use/" class="nav-link">轮子工具</a></li><li class="dropdown-item"><!----> <a href="/projects/" class="nav-link">项目工程</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>本站</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-subitem"><a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-subitem"><a href="/archives/" class="nav-link">归档</a></li></ul></li><li class="dropdown-item"><h4>我的</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/whell/web/" class="nav-link">收藏</a></li><li class="dropdown-subitem"><a href="/about/website/introduce/" class="nav-link">关于</a></li><li class="dropdown-subitem"><a href="https://vue2-admin.youngkbt.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Vue2-Admin
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://vue3-admin.youngkbt.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Vue3-Admin（完善）
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div> <a href="https://github.com/Kele-Bingtang/pure-blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/user/avatar2.png"> <div class="blogger-info"><h3>Shp Liu</h3> <span>朝圣的使徒，正在走向编程的至高殿堂！</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><a href="/java/" class="link-title router-link-active">Java</a> <span class="title" style="display:none;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>java基础</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java/se/" class="nav-link">Java基础</a></li><li class="dropdown-subitem"><a href="/java/collection/" class="nav-link">Java集合</a></li><li class="dropdown-subitem"><a href="/java/se/reflect/" class="nav-link">Java反射</a></li><li class="dropdown-subitem"><a href="/java/juc/" class="nav-link">JavaJUC</a></li><li class="dropdown-subitem"><a href="/java/jvm/" class="nav-link router-link-active">JavaJVM</a></li></ul></li><li class="dropdown-item"><h4>Java容器</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/javaweb/concept/" class="nav-link">JavaWeb</a></li></ul></li><li class="dropdown-item"><h4>Java版本新特性</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java/new-features/" class="nav-link">Java新特性</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><a href="/database/" class="link-title">数据库</a> <span class="title" style="display:none;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>SQL 数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/mysql/" class="nav-link">MySQL</a></li><li class="dropdown-subitem"><a href="/oracle/" class="nav-link">Oracle</a></li></ul></li><li class="dropdown-item"><h4>NoSQL 数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/redis/" class="nav-link">Redis</a></li><li class="dropdown-subitem"><a href="/es/" class="nav-link">ElasticSearch</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><a href="/frames/" class="link-title">框架</a> <span class="title" style="display:none;">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/mybatis/" class="nav-link">MyBatis</a></li><li class="dropdown-subitem"><a href="/mybatis-plus/" class="nav-link">MyBatis-Plus</a></li></ul></li><li class="dropdown-item"><h4>消息中间件</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/activemq/" class="nav-link">ActiveMQ</a></li><li class="dropdown-subitem"><a href="/rabbitmq/" class="nav-link">RabbitMQ</a></li><li class="dropdown-subitem"><a href="/rocketmq/" class="nav-link">RocketMQ</a></li><li class="dropdown-subitem"><a href="/kafka/" class="nav-link">Kafka</a></li></ul></li><li class="dropdown-item"><h4>进阶服务</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/nginx/" class="nav-link">Nginx</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Spring生态" class="dropdown-title"><a href="/spring-ecology/" class="link-title">Spring生态</a> <span class="title" style="display:none;">Spring生态</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/spring/" class="nav-link">Spring</a></li><li class="dropdown-item"><!----> <a href="/spring-boot/" class="nav-link">Spring Boot</a></li><li class="dropdown-item"><!----> <a href="/spring-security/" class="nav-link">Spring Security</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发" class="dropdown-title"><a href="/dev-guide/" class="link-title">开发</a> <span class="title" style="display:none;">开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/design-pattern/" class="nav-link">设计模式</a></li><li class="dropdown-item"><!----> <a href="/algorithm/" class="nav-link">算法</a></li><li class="dropdown-item"><!----> <a href="/knowledge/" class="nav-link">知识</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><a href="/tool/" class="link-title">工具</a> <span class="title" style="display:none;">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>管理</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/maven/" class="nav-link">Maven</a></li><li class="dropdown-subitem"><a href="/git/" class="nav-link">Git</a></li></ul></li><li class="dropdown-item"><h4>部署</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/linux/" class="nav-link">Linux</a></li><li class="dropdown-subitem"><a href="/docker/" class="nav-link">Docker</a></li><li class="dropdown-subitem"><a href="/jenkins/" class="nav-link">Jenkins</a></li><li class="dropdown-subitem"><a href="/kubernetes/" class="nav-link">Kubernetes</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/front/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>进阶</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/typescript/" class="nav-link">TypeScript</a></li></ul></li><li class="dropdown-item"><h4>框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/react/" class="nav-link">React</a></li><li class="dropdown-subitem"><a href="/vue2/" class="nav-link">Vue2</a></li><li class="dropdown-subitem"><a href="/vue3/" class="nav-link">Vue3</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><!----> <span class="title" style="display:;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/whells-use/" class="nav-link">轮子工具</a></li><li class="dropdown-item"><!----> <a href="/projects/" class="nav-link">项目工程</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>本站</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-subitem"><a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-subitem"><a href="/archives/" class="nav-link">归档</a></li></ul></li><li class="dropdown-item"><h4>我的</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/whell/web/" class="nav-link">收藏</a></li><li class="dropdown-subitem"><a href="/about/website/introduce/" class="nav-link">关于</a></li><li class="dropdown-subitem"><a href="https://vue2-admin.youngkbt.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Vue2-Admin
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://vue3-admin.youngkbt.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Vue3-Admin（完善）
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div> <a href="https://github.com/Kele-Bingtang/pure-blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java 基础 - SE</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java 进阶 - SE</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java 集合 - Collection</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java 并发 - JUC</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java 容器 - Web</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Java 底层 - JVM</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/java/jvm/construct/" class="sidebar-link">JVM - Java体系结构</a></li><li><a href="/java/jvm/classloader/" class="sidebar-link">JVM - 类加载子系统</a></li><li><a href="/java/jvm/runtime-data/" class="sidebar-link">JVM - 运行时数据区概述及线程</a></li><li><a href="/java/jvm/counter/" class="sidebar-link">JVM - 程序计数器</a></li><li><a href="/java/jvm/vm-stack/" class="sidebar-link">JVM - 虚拟机栈</a></li><li><a href="/java/jvm/local-interfacek/" class="sidebar-link">JVM - 本地方法接口</a></li><li><a href="/java/jvm/method-stack/" class="sidebar-link">JVM - 本地方法栈</a></li><li><a href="/java/jvm/heap/" class="sidebar-link">JVM - 堆</a></li><li><a href="/java/jvm/method-area/" class="sidebar-link">JVM - 方法区</a></li><li><a href="/java/jvm/layout-position/" class="sidebar-link">JVM - 对象实例化内存布局与访问定位</a></li><li><a href="/java/jvm/direct-memory/" class="sidebar-link">JVM - 直接内存</a></li><li><a href="/java/jvm/execution-engine/" class="sidebar-link">JVM - 执行引擎</a></li><li><a href="/java/jvm/stringtable/" class="sidebar-link">JVM - StringTable字符串常量池</a></li><li><a href="/java/jvm/garbage-collection-overview/" class="sidebar-link">JVM - 垃圾回收概述</a></li><li><a href="/java/jvm/garbage-collection-algorithms/" class="sidebar-link">JVM - 垃圾回收相关算法</a></li><li><a href="/java/jvm/garbage-collection-concepts/" class="sidebar-link">JVM - 垃圾回收相关概念</a></li><li><a href="/java/jvm/garbage-collection/" class="sidebar-link">JVM - 垃圾回收器</a></li><li><a href="/java/jvm/class-file-structure/" class="sidebar-link">JVM - Class文件结构</a></li><li><a href="/java/jvm/bytecode/" aria-current="page" class="active sidebar-link">JVM - 字节码指令集与解析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/java/jvm/bytecode/#概述" class="sidebar-link">概述</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/java/jvm/bytecode/#执行模型" class="sidebar-link">执行模型</a></li><li class="sidebar-sub-header level3"><a href="/java/jvm/bytecode/#字节码与数据类型" class="sidebar-link">字节码与数据类型</a></li><li class="sidebar-sub-header level3"><a href="/java/jvm/bytecode/#指令分类" class="sidebar-link">指令分类</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/java/jvm/bytecode/#加载与存储指令" class="sidebar-link">加载与存储指令</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/java/jvm/bytecode/#再谈操作数栈与局部变量表" class="sidebar-link">再谈操作数栈与局部变量表</a></li><li class="sidebar-sub-header level3"><a href="/java/jvm/bytecode/#局部变量压栈指令" class="sidebar-link">局部变量压栈指令</a></li><li class="sidebar-sub-header level3"><a href="/java/jvm/bytecode/#常量入栈指令" class="sidebar-link">常量入栈指令</a></li><li class="sidebar-sub-header level3"><a href="/java/jvm/bytecode/#出栈装入局部变量表指令" class="sidebar-link">出栈装入局部变量表指令</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/java/jvm/bytecode/#算术指令" class="sidebar-link">算术指令</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/java/jvm/bytecode/#所有算数指令" class="sidebar-link">所有算数指令</a></li><li class="sidebar-sub-header level3"><a href="/java/jvm/bytecode/#比较指令的说明" class="sidebar-link">比较指令的说明</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/java/jvm/bytecode/#类型转换指令" class="sidebar-link">类型转换指令</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/java/jvm/bytecode/#类型转换指令集" class="sidebar-link">类型转换指令集</a></li><li class="sidebar-sub-header level3"><a href="/java/jvm/bytecode/#宽化类型转换" class="sidebar-link">宽化类型转换</a></li><li class="sidebar-sub-header level3"><a href="/java/jvm/bytecode/#窄化类型转换" class="sidebar-link">窄化类型转换</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/java/jvm/bytecode/#对象的创建与访问指令" class="sidebar-link">对象的创建与访问指令</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/java/jvm/bytecode/#创建指令" class="sidebar-link">创建指令</a></li><li class="sidebar-sub-header level3"><a href="/java/jvm/bytecode/#字段访问指令" class="sidebar-link">字段访问指令</a></li><li class="sidebar-sub-header level3"><a href="/java/jvm/bytecode/#数组操作指令" class="sidebar-link">数组操作指令</a></li><li class="sidebar-sub-header level3"><a href="/java/jvm/bytecode/#类型检查指令" class="sidebar-link">类型检查指令</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/java/jvm/bytecode/#方法调用与返回指令" class="sidebar-link">方法调用与返回指令</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/java/jvm/bytecode/#方法调用指令" class="sidebar-link">方法调用指令</a></li><li class="sidebar-sub-header level3"><a href="/java/jvm/bytecode/#方法返回指令" class="sidebar-link">方法返回指令</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/java/jvm/bytecode/#操作数栈管理指令" class="sidebar-link">操作数栈管理指令</a></li><li class="sidebar-sub-header level2"><a href="/java/jvm/bytecode/#控制转移指令" class="sidebar-link">控制转移指令</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/java/jvm/bytecode/#比较指令" class="sidebar-link">比较指令</a></li><li class="sidebar-sub-header level3"><a href="/java/jvm/bytecode/#条件跳转指令" class="sidebar-link">条件跳转指令</a></li><li class="sidebar-sub-header level3"><a href="/java/jvm/bytecode/#比较条件跳转指令" class="sidebar-link">比较条件跳转指令</a></li><li class="sidebar-sub-header level3"><a href="/java/jvm/bytecode/#多条件分支跳转" class="sidebar-link">多条件分支跳转</a></li><li class="sidebar-sub-header level3"><a href="/java/jvm/bytecode/#无条件跳转" class="sidebar-link">无条件跳转</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/java/jvm/bytecode/#异常处理指令" class="sidebar-link">异常处理指令</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/java/jvm/bytecode/#抛出异常指令" class="sidebar-link">抛出异常指令</a></li><li class="sidebar-sub-header level3"><a href="/java/jvm/bytecode/#异常处理与异常表" class="sidebar-link">异常处理与异常表</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/java/jvm/bytecode/#同步控制指令" class="sidebar-link">同步控制指令</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/java/jvm/bytecode/#方法级的同步" class="sidebar-link">方法级的同步</a></li><li class="sidebar-sub-header level3"><a href="/java/jvm/bytecode/#方法内指定指令序列的同步" class="sidebar-link">方法内指定指令序列的同步</a></li></ul></li></ul></li><li><a href="/java/jvm/class-loading-process/" class="sidebar-link">JVM - 类的加载过程详解</a></li><li><a href="/java/jvm/on-class-loader/" class="sidebar-link">JVM - 再谈类的加载器</a></li><li><a href="/java/jvm/tuning-overview/" class="sidebar-link">JVM - 调优概述</a></li><li><a href="/java/jvm/monitoring-diagnostic-command/" class="sidebar-link">JVM - 监控及诊断工具命令行</a></li><li><a href="/java/jvm/monitoring-diagnostic-tools/" class="sidebar-link">JVM - 监控及诊断工具GUI</a></li><li><a href="/java/jvm/runtime-parameters/" class="sidebar-link">JVM - 运行时参数</a></li><li><a href="/java/jvm/analyze-gclogs/" class="sidebar-link">JVM - 分析GC日志</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java 版本 - 新特性</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/categories/?category=Java" title="分类" data-v-06225672>Java</a></li><li data-v-06225672><a href="/categories/?category=Java%20%E5%BA%95%E5%B1%82%20-%20JVM" title="分类" data-v-06225672>Java 底层 - JVM</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://www.youngkbt.cn" target="_blank" title="作者" class="beLink" data-v-06225672>Young Kbt </a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2022-01-28</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">JVM - 字节码指令集与解析<!----></h1> <!----> <div class="theme-vdoing-content content__default"><p></p><div class="table-of-contents"><ul><li><a href="#概述">概述</a><ul><li><a href="#执行模型">执行模型</a></li><li><a href="#字节码与数据类型">字节码与数据类型</a></li><li><a href="#指令分类">指令分类</a></li></ul></li><li><a href="#加载与存储指令">加载与存储指令</a><ul><li><a href="#再谈操作数栈与局部变量表">再谈操作数栈与局部变量表</a></li><li><a href="#局部变量压栈指令">局部变量压栈指令</a></li><li><a href="#常量入栈指令">常量入栈指令</a></li><li><a href="#出栈装入局部变量表指令">出栈装入局部变量表指令</a></li></ul></li><li><a href="#算术指令">算术指令</a><ul><li><a href="#所有算数指令">所有算数指令</a></li><li><a href="#比较指令的说明">比较指令的说明</a></li></ul></li><li><a href="#类型转换指令">类型转换指令</a><ul><li><a href="#类型转换指令集">类型转换指令集</a></li><li><a href="#宽化类型转换">宽化类型转换</a></li><li><a href="#窄化类型转换">窄化类型转换</a></li></ul></li><li><a href="#对象的创建与访问指令">对象的创建与访问指令</a><ul><li><a href="#创建指令">创建指令</a></li><li><a href="#字段访问指令">字段访问指令</a></li><li><a href="#数组操作指令">数组操作指令</a></li><li><a href="#类型检查指令">类型检查指令</a></li></ul></li><li><a href="#方法调用与返回指令">方法调用与返回指令</a><ul><li><a href="#方法调用指令">方法调用指令</a></li><li><a href="#方法返回指令">方法返回指令</a></li></ul></li><li><a href="#操作数栈管理指令">操作数栈管理指令</a></li><li><a href="#控制转移指令">控制转移指令</a><ul><li><a href="#比较指令">比较指令</a></li><li><a href="#条件跳转指令">条件跳转指令</a></li><li><a href="#比较条件跳转指令">比较条件跳转指令</a></li><li><a href="#多条件分支跳转">多条件分支跳转</a></li><li><a href="#无条件跳转">无条件跳转</a></li></ul></li><li><a href="#异常处理指令">异常处理指令</a><ul><li><a href="#抛出异常指令">抛出异常指令</a></li><li><a href="#异常处理与异常表">异常处理与异常表</a></li></ul></li><li><a href="#同步控制指令">同步控制指令</a><ul><li><a href="#方法级的同步">方法级的同步</a></li><li><a href="#方法内指定指令序列的同步">方法内指定指令序列的同步</a></li></ul></li></ul></div><p></p> <h2 id="概述"><a href="#概述" class="header-anchor">#</a> 概述</h2> <p>官方文档：<code>https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-6.html</code></p> <ul><li>Java 字节码对于虚拟机，就好像汇编语言对于计算机，属于基本执行命令</li> <li>Java 虚拟机的指令由一个字节长度的、代表着某种特定操作含义的数字(称为 <strong>操作码，Opcode</strong>)以及跟随其后的零至多个代表此操作所需参数(称为 <strong>操作数，Operands</strong>)而构成，由于 <strong>Java 虚拟机采用面向操作数栈而不是寄存器的结构</strong>，所以大多数的指令都不包含操作数，只有一个操作码</li> <li>由于限制了 Java 虚拟机操作码的长度为一个字节(即 0 ~ 255)，这意味着指令集的操作码总数不可能超过 256 条</li> <li>熟悉虚拟机的指令对于动态字节码生成、反编译 Class 文件、 Class 文件修补都有着非常重要的价值。因此，阅读字节码作为了解 Java 虚拟机的基础技能，需要熟练掌握常见指令</li></ul> <h3 id="执行模型"><a href="#执行模型" class="header-anchor">#</a> 执行模型</h3> <p>如果不考虑异常处理的话，那么 Java 虚拟机的解释器可以使用下面这个伪代码当做最基本的执行模型来理解</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">do</span> <span class="token punctuation">{</span>
    自动计算 <span class="token constant">PC</span> 寄存器的值加 <span class="token number">1</span><span class="token punctuation">;</span>
    根据 <span class="token constant">PC</span> 寄存器的指示位置，从字节码流中取出操作码<span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>字节码存在操作数<span class="token punctuation">)</span> 从字节码流中取出操作数<span class="token punctuation">;</span>
    执行操作码所定义的操作<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">while</span><span class="token punctuation">(</span>字节码长度 <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="字节码与数据类型"><a href="#字节码与数据类型" class="header-anchor">#</a> 字节码与数据类型</h3> <p>在 Java 虚拟机的指令集中，大多数的指令都包含了其操作所对应的数据类型信息。例如，iload 指令用于从局部变量表中加载 int 类型的数据到操作数栈中，而 fload 指令加载的则是 float 类型的数据。</p> <p>对于大部分与数据类型相关的字节码指令，<strong>它们的操作码助记符中都有特殊的字符来表明专门为哪种数据类型服务</strong>：</p> <ul><li>i 代表对 int 类型的数据操作</li> <li>l 代表 long</li> <li>s 代表 short</li> <li>b 代表 byte</li> <li>c 代表 char</li> <li>f 代表 float</li> <li>d 代表 double</li></ul> <p>也有一些指令的助记符中 <strong>没有明确地指明操作类型的字母</strong>，如 arraylength 指令，它没有代表数据类型的特殊字符，但操作数永远只能是一个数组类型的对象。</p> <p>还有另一些指令，如无条件跳转指令 goto 则是与 <strong>数据类型无关的</strong>。</p> <p>大部分的指令都没有支持整数类型 byte、char 和 short，甚至没有任何指令支持 boolean 类型。编译器会在编译器或运行期将 byte 和short 类型的数据带符号扩展(Sign-Extend)为相应的 int 类型数据，将 boolean 和 char 类型数据零位扩展（Zero-Extend）为相应的 int 类型数据。与之类似，在处理 boolean、byte、short 和 char 类型的数组时，也会转换为使用对应的 init 类型的字节码指令来处理。因此，大多数对于 boolean、byte、short 和 char 类型数据的操作，实际上都是使用相应的 int 类型作为运算类型。</p> <h3 id="指令分类"><a href="#指令分类" class="header-anchor">#</a> 指令分类</h3> <p>由于完全介绍和学习这些指令需要花费大量时间，为了让大家能够更快地熟悉和了解这些基本指令，这里将 JVM 中的字节码指令集按用途大致分成 9 类：</p> <ul><li>加载与存储指令</li> <li>算术指令</li> <li>类型转换指令</li> <li>对象的创建与访问指令</li> <li>方法调用与返回指令</li> <li>操作数栈管理指令</li> <li>比较控制指令</li> <li>异常处理指令</li> <li>同步控制指令</li></ul> <p>在做值相关操作时：</p> <ul><li>一个指令，可以从局部变量表、常量池、堆中对象、方法调用、系统调用等中取得数据，这些数据(可能是值，可能是对象的引用)被压入操作数栈</li> <li>一个指令，也可以从操作数栈中取出一到多个值（pop 多次），完成赋值、加减乘除、方法传参、系统调用等操作</li></ul> <h2 id="加载与存储指令"><a href="#加载与存储指令" class="header-anchor">#</a> 加载与存储指令</h2> <blockquote><p>作用</p></blockquote> <p>加载和存储指令用于将数据从栈帧的局部变量表和操作数栈之间来回传递</p> <blockquote><p>常用指令</p></blockquote> <ul><li><p>局部变量压栈指令：将一个局部变量加载到操作数栈：<code>xload</code>、<code>xload_&lt;n&gt;</code>（其中 x 为 i、l、f、d、a，n 为 0 到 3），<code>xaload</code>、<code>xaload&lt;n&gt;</code>（其 x 为 i、l、f、d、a、b、c、s，n 为 0 到 3）</p></li> <li><p>常量入栈指令：将一个常量加载到操作数栈：<code>bipush</code>、<code>sipush</code>、<code>ldc</code>、<code>ldc_w</code>、<code>ldc2_w</code>、<code>aconst_null</code>、<code>iconst_m1</code>、<code>iconst_&lt;i&gt;</code>、<code>iconst_&lt;l&gt;</code>、<code>fconst_&lt;f&gt;</code>、<code>dconst_&lt;d&gt;</code></p></li> <li><p>出栈装入局部变量表指令：将一个数值从操作数栈存储到局部变量表：<code>xstore</code>、<code>xstore_&lt;n&gt;</code>（其中 x 为 i、l、f、d、a，n 为 0 到 3）， <code>xastore</code>（其中 x 为 i、l、f、d、a、b、c、s）</p></li> <li><p>扩充局部变量表的访问索引的指令：<code>wide</code></p></li></ul> <p>上面所列举的指令助记符中，有一部分是以尖括号结尾的（例如 <code>iload_&lt;n&gt;</code>）。这些指令助记符实际上代表了一组指令(例如 <code>iload_&lt;n&gt;</code> 代表了 <code>iload_0、iload_1、iload_2</code> 和 <code>iload_3</code> 这几个指令)。这几组指令都是某个带有一个操作数的通用指令（例如 <code>iload</code>）的特殊形式，<strong>对于这若干组特殊指令来说，它们表面上没有操作数，不需要进行取操作数的动作，但操作数都隐含在指令中</strong>。</p> <p>除此之外，它们的语义与原生的通用指令完全一致（例如 <code>iload_0</code> 的语义与操作数为0时的 <code>iload</code> 指令语义完全一致）。在尖括号之间的字母指定了指令隐含操作数的数据类型，<code>&lt;n&gt;</code> 代表非负的整数，<code>&lt;i&gt;</code> 代表是 int 类型数据，<code>&lt;l&gt;</code> 代表 long 类型，<code>&lt;f&gt;</code> 代表 float 类型，<code>&lt;d&gt;</code> 代表 double 类型。</p> <p>操作 byte、char、short 和 boolean 类型数据时，经常用 int 类型的指令来表示。</p> <h3 id="再谈操作数栈与局部变量表"><a href="#再谈操作数栈与局部变量表" class="header-anchor">#</a> 再谈操作数栈与局部变量表</h3> <blockquote><p><strong>操作数栈(Operand Stacks)</strong></p></blockquote> <p>我们知道，Java 字节码是 Java 虚拟机所使用的指令集。因此，它与 Java 虚拟机基于栈的计算模型是密不可分的。</p> <p>在解释执行过程中，每当为 Java 方法分配栈帧时，Java 虚拟机往往需要开辟一块额外的空间作为 <strong>操作数栈，来存放计算的操作数以及返回结果</strong>。</p> <p>具体来说便是：执行每一条指令之前，Java 虚拟机要求该指令的操作数已被压入操作数栈中。在执行指令时，Java 虚拟机会将该指令所需的操作数弹出，并且将指令的结果重新压入栈中。</p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Java/20220128162023.png" alt="image-20220128162015352"></p> <p>以加法指令 iadd 为例。假设在执行该指令之前，栈顶的两个元素分别为 int 值 1 和 int 值 2，那么 iadd 指令将弹出这两个 int，并将求得的和 int 值为 3 压入栈中。</p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Java/20220128162101.png" alt="image-20220128162059964"></p> <p>由于 iadd 指令只消耗栈顶的两个元素，因此，对于离栈顶距离为 2 的元素，即图中的问号，iadd 指令并不关心它是否存在，更加不会对其进行修改。</p> <blockquote><p><strong>局部变量表(Local Variables)</strong></p></blockquote> <p>Java 方法栈帧的另外一个重要组成部分则是局部变量区，<strong>字节码程序可以将计算的结果缓存在局部变量区之中</strong>。</p> <p>实际上，Java 虚拟机将局部变量区 <strong>当成一个数组</strong>，依次存放 this 指针(仅非静态方法)，所传入的参数，以及字节码中的局部变量。</p> <p>和操作数栈一样，long 类型以及 double 类型的值将占据两个单元，其余类型仅占据一个单元。</p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Java/20220128162327.png" alt="image-20220128162326060"></p> <p>举例：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token keyword">long</span> l<span class="token punctuation">,</span> <span class="token keyword">float</span> f<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token punctuation">{</span>
    <span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token string">&quot;Hello, World&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Java/20220128162358.png" alt="image-20220128162357637"></p> <p>在栈帧中，与性能调优关系最为密切的部分就是局部变量表。局部变量表中的变量也是重要的垃圾回收根节点，只要被局部变量表中直接或间接引用的对象都不会被回收。</p> <p>在方法执行时，虚拟机使用局部变量表完成方法的传递。</p> <h3 id="局部变量压栈指令"><a href="#局部变量压栈指令" class="header-anchor">#</a> 局部变量压栈指令</h3> <blockquote><p>局部变量压栈常用指令集</p></blockquote> <table><thead><tr><th>xload_n</th> <th>xload_0</th> <th>xload_1</th> <th>xload_2</th> <th>xload_3</th></tr></thead> <tbody><tr><td>iload_n</td> <td>iload_0</td> <td>iload_1</td> <td>iload_2</td> <td>iload_3</td></tr> <tr><td>lload_n</td> <td>lload_0</td> <td>lload_1</td> <td>lload_2</td> <td>lload_3</td></tr> <tr><td>fload_n</td> <td>fload_0</td> <td>fload_1</td> <td>fload_2</td> <td>fload_3</td></tr> <tr><td>dload_n</td> <td>dload_0</td> <td>dload_1</td> <td>dload_2</td> <td>dload_3</td></tr> <tr><td>aload_n</td> <td>aload_0</td> <td>aload_1</td> <td>aload_2</td> <td>aload_3</td></tr></tbody></table> <blockquote><p>局部变量压栈指令剖析</p></blockquote> <p>局部变量压栈指令将给定的局部变量表中的数据压入操作数栈。</p> <p>这类指令大体可以分为：</p> <ul><li><code>xload_&lt;n&gt;</code>（x 为 i、l、f、d、a，n 为 0 到 3）</li> <li><code>xload</code>（x 为 i、l、f、d、a）</li></ul> <p>说明：在这里，x 的取值表示数据类型。</p> <p>指令 <code>xload_n</code> 表示将第 <code>n</code> 个局部变量压入操作数栈，比如 <code>iload_1</code>、<code>fload_0</code>、<code>aload_0</code> 等指令。其中 <code>aload_n</code> 表示将一个对象引用压栈。</p> <p>指令 <code>xload</code> 通过指定参数的形式，把局部变量压入操作数栈，当使用这个命令时，表示局部变量的数量可能超过了 4 个，比如指令 <code>iload</code>、<code>fload</code> 等。</p> <p>代码示例：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token keyword">int</span> num<span class="token punctuation">,</span> <span class="token class-name">Object</span> obj<span class="token punctuation">,</span> <span class="token keyword">long</span> count<span class="token punctuation">,</span> <span class="token keyword">boolean</span> flag<span class="token punctuation">,</span> <span class="token keyword">short</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>分析图：</p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Java/20220128163127.png" alt="image-20220128163125850"></p> <h3 id="常量入栈指令"><a href="#常量入栈指令" class="header-anchor">#</a> 常量入栈指令</h3> <blockquote><p>常量入栈常用指令集</p></blockquote> <table><thead><tr><th style="text-align:center;">xconst_n</th> <th>范围</th> <th>xconst_null</th> <th style="text-align:center;">xconst_m1</th> <th style="text-align:center;">xconst_0</th> <th style="text-align:center;">xconst_1</th> <th style="text-align:center;">xconst_2</th> <th style="text-align:center;">xconst_3</th> <th style="text-align:center;">xconst_4</th> <th style="text-align:center;">xconst_5</th></tr></thead> <tbody><tr><td style="text-align:center;">iconst_n</td> <td>[-1, 5]</td> <td></td> <td style="text-align:center;">iconst_m1</td> <td style="text-align:center;">iconst_0</td> <td style="text-align:center;">iconst_1</td> <td style="text-align:center;">iconst_2</td> <td style="text-align:center;">iconst_3</td> <td style="text-align:center;">iconst_4</td> <td style="text-align:center;">iconst_5</td></tr> <tr><td style="text-align:center;">lconst_n</td> <td>0, 1</td> <td></td> <td style="text-align:center;"></td> <td style="text-align:center;">lconst_0</td> <td style="text-align:center;">lconst_1</td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">fconst_n</td> <td>0, 1, 2</td> <td></td> <td style="text-align:center;"></td> <td style="text-align:center;">fconst_0</td> <td style="text-align:center;">fconst_1</td> <td style="text-align:center;">fconst_2</td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">dconst_n</td> <td>0, 1</td> <td></td> <td style="text-align:center;"></td> <td style="text-align:center;">dconst_0</td> <td style="text-align:center;">dconst_1</td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">aconst_n</td> <td>null, String literal, Class literal</td> <td>aconst_null</td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">bipush</td> <td>一个字节，2^8^，[-2^7^, 2^7^ - 1]，即[-128, 127]</td> <td></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">sipush</td> <td>两个字节，2^16^，[-2^15^, 2^15^ - 1]，即[-32768, 32767]</td> <td></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">ldc</td> <td>四个字节，2^32^，[-2^31^, 2^31^ - 1]</td> <td></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">ldc_w</td> <td>宽索引</td> <td></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">ldc2_w</td> <td>宽索引，long 或 double</td> <td></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td></tr></tbody></table> <blockquote><p>常量入栈指令剖析</p></blockquote> <p>常量入栈指令的功能是将常数压入操作数栈，根据数据类型和入栈内容的不同，又可以分为 const 系列、push 系列和 ldc 指令。</p> <p><strong>指令 const 系列</strong>：用于对特定的常量入栈，入栈的常量隐含在指令本身里。指令有：<code>iconst_&lt;i&gt;</code>（i 从 -1 到 5）、<code>lconst_&lt;l&gt;</code>（1 从 0 到 1）、<code>fconst_&lt;f&gt;</code>（f 从 0 到 2）、<code>dconst_&lt;d&gt;</code>（d 从 0 到 1）、<code>aconst_null</code>。</p> <p>比如：</p> <ul><li>iconst_m1 将 -1 压入操作数栈</li> <li>iconst_x（x 为 0 到 5）将 x 压入栈</li> <li>lconst_0、lconst_1 分别将长整数 0 和 1 压入栈</li> <li>fconst_0、fconst_1、fconst_2 分别将浮点数 0、1、2 压入栈</li> <li>dconst_0 和 dconst_1 分别将 double 型 0 和 1 压入栈</li> <li>aconst_null 将 null 压入操作数栈</li></ul> <p>从指令的命名上不难找出规律，指令助记符的第一个字符总是喜欢表示数据类型，i 表示整数，l 表示长整型，f 表示浮点数，d 表示双精度浮点，习惯上用 a 表示对象引用。如果指令隐含操作的参数，会以下划线形式给出。</p> <p><strong>指令 push 系列</strong>：主要包括 bipush 和 sipush，它们的区别在于接受数据类型的不同，bipush 接收 8 位整数作为参数，sipush 接收 16 位整数，它们都将参数压入栈。</p> <p><strong>指令 ldc 系列</strong>：如果以上指令都不能满足需求，那么可以使用万能的 ldc 指令，它可以接收一个 8 位的参数，该参数指向常量池中的 int、float 或者 String 的索引，将指定的内容压入堆栈。</p> <p>类似的还有 ldc_w，它接收两个 8 位参数，能支持的索引范围大于 ldc。</p> <p>如果要压入的元素是 long 或者 double 类型的，则使用 ldc2_w 指令，使用方式都是类似的。</p> <p>代码示例 1：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">pushConstLdc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> c <span class="token operator">=</span> <span class="token number">127</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> d <span class="token operator">=</span> <span class="token number">128</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> e <span class="token operator">=</span> <span class="token number">32767</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> f <span class="token operator">=</span> <span class="token number">32768</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>分析图：</p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Java/20220128164354.png" alt="image-20220128164353879"></p> <p>代码示例 2：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">constLdc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> a1 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> a2 <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> b1 <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> b2 <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> c1 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> c2 <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token class-name">Date</span> d <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>分析图</p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Java/20220128164741.png" alt="image-20220128164739853"></p> <p>总结如下：</p> <table><tbody><tr><th>类型</th> <th>常数指令</th> <th>范围</th></tr> <tr><td rowspan="4">int(boolean,byte,char,short)</td> <td>iconst</td> <td>[-1, 5]</td></tr> <tr><td>bipush</td> <td>[-128, 127]</td></tr> <tr><td>sipush</td> <td>[-32768, 32767]</td></tr> <tr><td>ldc</td> <td>any int value</td></tr> <tr><td rowspan="2">long</td> <td>lconst</td> <td>0, 1</td></tr> <tr><td>ldc</td> <td>any long value</td></tr> <tr><td rowspan="2">float</td> <td>fconst</td> <td>0, 1, 2</td></tr> <tr><td>ldc</td> <td>any float value</td></tr> <tr><td rowspan="2">double</td> <td>dconst</td> <td>0, 1</td></tr> <tr><td>ldc</td> <td>any double value</td></tr> <tr><td rowspan="2">reference</td> <td>aconst</td> <td>null</td></tr> <tr><td>ldc</td> <td>String literal, Class literal</td></tr></tbody></table> <h3 id="出栈装入局部变量表指令"><a href="#出栈装入局部变量表指令" class="header-anchor">#</a> 出栈装入局部变量表指令</h3> <blockquote><p>出栈装入局部变量表常用指令集</p></blockquote> <table><thead><tr><th style="text-align:center;">xstore_n</th> <th style="text-align:center;">xstore_0</th> <th style="text-align:center;">xstore_1</th> <th style="text-align:center;">xstore_2</th> <th style="text-align:center;">xstore_3</th></tr></thead> <tbody><tr><td style="text-align:center;">istore_n</td> <td style="text-align:center;">istore_0</td> <td style="text-align:center;">istore_1</td> <td style="text-align:center;">istore_2</td> <td style="text-align:center;">istore_3</td></tr> <tr><td style="text-align:center;">lstore_n</td> <td style="text-align:center;">lstore_0</td> <td style="text-align:center;">lstore_1</td> <td style="text-align:center;">lstore_2</td> <td style="text-align:center;">lstore_3</td></tr> <tr><td style="text-align:center;">fstore_n</td> <td style="text-align:center;">fstore_0</td> <td style="text-align:center;">fstore_1</td> <td style="text-align:center;">fstore_2</td> <td style="text-align:center;">fstore_3</td></tr> <tr><td style="text-align:center;">dstore_n</td> <td style="text-align:center;">dstore_0</td> <td style="text-align:center;">dstore_1</td> <td style="text-align:center;">dstore_2</td> <td style="text-align:center;">dstore_3</td></tr> <tr><td style="text-align:center;">astore_n</td> <td style="text-align:center;">astore_0</td> <td style="text-align:center;">astore_1</td> <td style="text-align:center;">astore_2</td> <td style="text-align:center;">astore_3</td></tr></tbody></table> <blockquote><p>出栈装入局部变量表指令剖析</p></blockquote> <p>出栈装入局部变量表指令用于将操作数栈中栈顶元素弹出后，装入局部变量表的指定位置，用于给局部变量赋值。</p> <p>这类指令主要以 store 的形式存在，比如 xstore（x 为 i、l、f、d、a）、xstore_n（x 为 i、l、f、d、a，n为 0 至 3）和 pasture（x 为 i、l、f、d、a、b、c、s）。</p> <ul><li>其中，指令 istore_n 将从操作数栈中弹出一个整数，并把它赋值给局部变量 n（n 对应局部变量表的索引）</li> <li>指令 xstore 由于没有隐含参数信息，故需要提供一个 byte 类型的参数类指定目标局部变量表的位置</li> <li>xastore 则专门针对数组操作，以 iastore 为例，它用于给一个 int 数组的给定索引赋值。在 iastore 执行前，操作数栈顶需要以此准备 3 个元素：值、索引、数组引用，iastore 会弹出这 3 个值，并将值赋给数组中指定索引的位置</li></ul> <p>一般说来，类似像 store 这样的命令需要带一个参数，用来指明将弹出的元素放在局部变量表的第几个位置。但是，为了尽可能压缩指令大小，使用专门的 istore_1 指令表示将弹出的元素放置在局部变量表第 1 个位置。类似的还有 istore_0、istore_2、istore_3，它们分别表示从操作数栈顶弹出一个元素，存放在局部变量表第 0、2、3 个位置。</p> <p>由于局部变量表前几个位置总是非常常用，因此这种做法虽然增加了指令数量，但是可以大大压缩生成的字节码的体积。如果局部变量表很大，需要存储的槽位大于 3，那么可以使用 istore 指令，外加一个参数，用来表示需要存放的槽位位置。</p> <p>代码示例：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">store</span><span class="token punctuation">(</span><span class="token keyword">int</span> k<span class="token punctuation">,</span> <span class="token keyword">double</span> d<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> m <span class="token operator">=</span> k <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword">long</span> l <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">&quot;kele&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">float</span> f <span class="token operator">=</span> <span class="token number">10.0F</span><span class="token punctuation">;</span>
    d <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>分析图：</p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Java/20220128165743.png" alt="image-20220128165742859"></p> <h2 id="算术指令"><a href="#算术指令" class="header-anchor">#</a> 算术指令</h2> <blockquote><p><strong>作用</strong></p></blockquote> <p>算术指令用于对两个操作数栈上的值进行某种特定运算，并把结果重新压入操作数栈。</p> <blockquote><p><strong>分类</strong></p></blockquote> <p>大体上算术指令可以分为两种：对<strong>整型数据</strong>进行运算的指令与对<strong>浮点型类型数据</strong>进行运算的指令。</p> <blockquote><p><strong>byte、short、char 和 boolean 类型说明</strong></p></blockquote> <p>在每一大类中，都有针对 Java 虚拟机具体数据类型的专用算术指令。但没有直接支持 byte、short、char 和 boolean 类型的算术指令，对于这些数据的运算，都使用 int 类型的指令来处理。此外，在处理 boolean、byte、short 和 char 类型的数组时，也会转换为使用对应的 int 类型的字节码指令来处理。</p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Java/20220128170721.png" alt="image-20220128170720568"></p> <blockquote><p><strong>运算时的溢出</strong></p></blockquote> <p>数据运算可能会导致溢出，例如两个很大的正整数相加，结果可能是一个负数。其实 Java 虚拟机规范并无明确规定过整型数据溢出的具体结果，仅规定了在处理整型数据时，只有除法指令以及求余指令中当出现除数为 0 时会导致虚拟机抛出异常 <code>ArithmeticException</code>。</p> <blockquote><p><strong>运算模式</strong></p></blockquote> <p>向最接近数舍入模式：JVM 要求在进行浮点数计算时，所有的运算结果都必须舍入到适当的精度，非精确结果必须舍入为可被表示的最接近的精确值，如果有两种可表示的形式与该值一样接近，将优先选择最低有效位为零的。</p> <p>向零舍入模式：将浮点数转换为整数时，采用该模式，该模式将在目标数值类型中选择一个最接近但是不大于原值的数字作为最精确的舍入结果。</p> <blockquote><p><strong>NaN 值使用</strong></p></blockquote> <p>当一个操作产生溢出时，将会使用有符号的无穷大表示，如果某个操作结果没有明确的数学定义的话，将会使用 NaN 值来表示。而且所有使用 NaN 值作为操作数的算术操作，结果都会返回 NaN。</p> <p>代码示例：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token keyword">double</span> j <span class="token operator">=</span> i <span class="token operator">/</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Infinity</span>
    
    <span class="token keyword">double</span> d1 <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
    <span class="token keyword">double</span> d2 <span class="token operator">=</span> d1 <span class="token operator">/</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// NaN</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>输出结果：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Infinity</span>
<span class="token class-name">NaN</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="所有算数指令"><a href="#所有算数指令" class="header-anchor">#</a> 所有算数指令</h3> <table><tbody><tr><th colspan="2">算数指令</th> <th>int(boolean,byte,char,short)</th> <th>long</th> <th>float</th> <th>double</th></tr> <tr><td colspan="2">加法指令</td> <td>iadd</td> <td>ladd</td> <td>fadd</td> <td>dadd</td></tr> <tr><td colspan="2">减法指令</td> <td>isub</td> <td>lsub</td> <td>fsub</td> <td>dsub</td></tr> <tr><td colspan="2">乘法指令</td> <td>imul</td> <td>lmul</td> <td>fmul</td> <td>dmul</td></tr> <tr><td colspan="2">除法指令</td> <td>idiv</td> <td>ldiv</td> <td>fdiv</td> <td>ddiv</td></tr> <tr><td colspan="2">求余指令</td> <td>irem</td> <td>lrem</td> <td>frem</td> <td>drem</td></tr> <tr><td colspan="2">取反指令</td> <td>ineg</td> <td>lneg</td> <td>fneg</td> <td>dneg</td></tr> <tr><td colspan="2">自增指令</td> <td>iinc</td> <td></td> <td></td> <td></td></tr> <tr><td rowspan="4">位运算指令</td> <td>按位或指令</td> <td>ior</td> <td>lor</td> <td></td> <td></td></tr> <tr><td>按位或指令</td> <td>ior</td> <td>lor</td> <td></td> <td></td></tr> <tr><td>按位与指令</td> <td>iand</td> <td>land</td> <td></td> <td></td></tr> <tr><td>按位异或指令</td> <td>ixor</td> <td>lxor</td> <td></td> <td></td></tr> <tr><td colspan="2">比较指令</td> <td></td> <td>lcmp</td> <td>fcmpg / fcmpl</td> <td>dcmpg / dcmpl</td></tr></tbody></table> <p>所有算术指令包括：</p> <ul><li><p>加法指令：iadd、ladd、fadd、dadd</p></li> <li><p>减法指令：isub、lsub、fsub、dsub</p></li> <li><p>乘法指令：imul、lmul、fmul、dmul</p></li> <li><p>除法指令：idiv、ldiv、fdiv、ddiv</p></li> <li><p>求余指令：irem、lrem、frem、drem（remainder：余数）</p></li> <li><p>取反指令：ineg、lneg、fneg、dneg（negation：取反）</p></li> <li><p>自增指令：iinc</p></li> <li><p>位运算指令，又可分为：</p></li> <li><ul><li>位移指令：ishl、ishr、iushr、lshl、lshr、lushr
<ul><li>按位或指令：ior、lor</li> <li>按位与指令：iand、land</li> <li>按位异或指令：ixor、lxor</li></ul></li></ul></li> <li><p>比较指令：dcmpg、dcmlp、fcmpg、fcmpl、lcmp</p></li></ul> <blockquote><p>代码示例 1：取反指令</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">float</span> i <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token keyword">float</span> j <span class="token operator">=</span> <span class="token operator">-</span>i<span class="token punctuation">;</span>
    i <span class="token operator">=</span> <span class="token operator">-</span>j<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>分析图：</p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Java/20220128171800.png" alt="image-20220128171758178"></p> <blockquote><p>代码示例 2：加法指令</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">float</span> i <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
    i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">10</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>分析图：</p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Java/20220128172509.png" alt="image-20220128172508897"></p> <blockquote><p>代码示例 3：自增指令</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">float</span> i <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
    i <span class="token operator">+=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>分析图：</p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Java/20220128172439.png" alt="image-20220128172438814"></p> <p>对比例子 3 可知道，例子 4 的效率略高于例子 3。</p> <blockquote><p>代码示例 4：加法和乘法指令</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">80</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> c <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span> <span class="token operator">*</span> c<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>分析图：</p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Java/20220128172644.png" alt="image-20220128172643930"></p> <blockquote><p>代码示例 5：加法、减法、位运算指令</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">,</span> <span class="token keyword">int</span> j<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>i <span class="token operator">+</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token operator">~</span><span class="token punctuation">(</span>j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>分析图：</p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Java/20220128172821.png" alt="image-20220128172818210"></p> <blockquote><p>代码示例 6：加法、减法、乘法指令</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">3</span> <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>字节码指令对应的图示：</p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Java/20220128173230.png" alt="image-20220128173229321"></p> <blockquote><p>代码示例 7：加法指令</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">byte</span> i <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> k <span class="token operator">=</span> i <span class="token operator">+</span> j<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>字节码指令对应的图示：</p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Java/20220128173427.png" alt="image-20220128173425995"></p> <blockquote><p>代码示例 8：除法、加法指令</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">,</span> <span class="token keyword">int</span> j<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">500</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> y <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> a <span class="token operator">=</span> x <span class="token operator">/</span> y<span class="token punctuation">;</span>
	<span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span>
	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>字节码指令对应的图示在 <a href="/java/jvm/method-area/#方法区使用举例">JVM - 方法区</a>。</p> <blockquote><p>代码示例 9：自增指令</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">,</span> <span class="token keyword">int</span> j<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> a <span class="token operator">=</span> i<span class="token operator">++</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token operator">++</span>j<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>分析图：</p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Java/20220128174209.png" alt="image-20220128174208402"></p> <p>可以看出，<code>i++</code> 是先将 a 加入局部变量表后再把前面的 i 加 1，而 <code>++i</code> 则是先将 j 加 1，再把 b 加入局部变量表。</p> <blockquote><p>代码示例 10：自增指令</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">,</span> <span class="token keyword">int</span> j<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
	i <span class="token operator">=</span> i<span class="token operator">++</span><span class="token punctuation">;</span>
	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 10</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>分析图：</p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Java/20220128175109.png" alt="image-20220128175106972"></p> <h3 id="比较指令的说明"><a href="#比较指令的说明" class="header-anchor">#</a> 比较指令的说明</h3> <ul><li><p>比较指令的作用是比较栈顶两个元素的大小，并将比较结果入栈</p></li> <li><p>比较指令有：dcmpg、dcmpl、fcmpg、fcmpl、lcmp</p> <ul><li>与前面讲解的指令类似，首字符 d 表示 double 类型，f 表示 float，l 表示 long</li></ul></li> <li><p>对于 double 和 float 类型的数字，由于 NaN 的存在，各有两个版本的比较指令，以 float 为例，有 fcmpg 和 fcmpl 两个指令，它们的区别在于在数字比较时，若遇到 NaN 值，处理结果不同</p></li> <li><p>指令 dcmpl 和 dcmpg 也是类似的，根据其命名可以推测其含义，在此不再赘述</p></li> <li><p>指令 lcmp 针对 long 型整数，由于 long 型整数没有 NaN 值，故无需准备两套指令</p></li></ul> <blockquote><p>举例</p></blockquote> <p>指令 fcmpg 和 fcmpl 都从栈中弹出两个操作数，并将它们做比较，设栈顶的元素为 v2， 栈顶顺位第2位元素为 v1，若 v1 = v2，则压入 0；若 v1 &gt;  v2 则压入 1；若 v1 &lt; v2 则压入 -1。</p> <p>两个指令的不同之处在于，如果遇到 NaN 值，fcmpg 会压入 1，而 fcmpl 会压入 -1。</p> <p>数值类型的数据才可以谈大小，boolean、引用数据类型不能比较大小。</p> <h2 id="类型转换指令"><a href="#类型转换指令" class="header-anchor">#</a> 类型转换指令</h2> <p>类型转换指令说明：</p> <ul><li>类型转换指令可以将两种不同的数值类型进行相互转换</li> <li>这些转换操作一般用于实现用户代码中的 <strong>显式类型转换操作</strong>，或者用来处理 <strong>字节码指令集中数据类型相关指令</strong> 无法与 <strong>数据类型</strong> 一一对应的问题</li></ul> <h3 id="类型转换指令集"><a href="#类型转换指令集" class="header-anchor">#</a> 类型转换指令集</h3> <table><thead><tr><th style="text-align:center;"></th> <th style="text-align:center;"><strong>byte</strong></th> <th style="text-align:center;"><strong>char</strong></th> <th style="text-align:center;"><strong>short</strong></th> <th style="text-align:center;"><strong>int</strong></th> <th style="text-align:center;"><strong>long</strong></th> <th style="text-align:center;"><strong>float</strong></th> <th style="text-align:center;"><strong>double</strong></th></tr></thead> <tbody><tr><td style="text-align:center;"><strong>int</strong></td> <td style="text-align:center;">i2b</td> <td style="text-align:center;">i2c</td> <td style="text-align:center;">i2s</td> <td style="text-align:center;">○</td> <td style="text-align:center;">i2l</td> <td style="text-align:center;">i2f</td> <td style="text-align:center;">i2d</td></tr> <tr><td style="text-align:center;"><strong>long</strong></td> <td style="text-align:center;">l2i i2b</td> <td style="text-align:center;">l2i i2c</td> <td style="text-align:center;">l2i i2s</td> <td style="text-align:center;">l2i</td> <td style="text-align:center;">○</td> <td style="text-align:center;">l2f</td> <td style="text-align:center;">l2d</td></tr> <tr><td style="text-align:center;"><strong>float</strong></td> <td style="text-align:center;">f2i i2b</td> <td style="text-align:center;">f2i i2c</td> <td style="text-align:center;">f2i i2s</td> <td style="text-align:center;">f2i</td> <td style="text-align:center;">f2l</td> <td style="text-align:center;">○</td> <td style="text-align:center;">f2d</td></tr> <tr><td style="text-align:center;"><strong>double</strong></td> <td style="text-align:center;">d2i i2b</td> <td style="text-align:center;">d2i i2c</td> <td style="text-align:center;">d2i i2s</td> <td style="text-align:center;">d2i</td> <td style="text-align:center;">d2l</td> <td style="text-align:center;">d2f</td> <td style="text-align:center;">○</td></tr></tbody></table> <h3 id="宽化类型转换"><a href="#宽化类型转换" class="header-anchor">#</a> 宽化类型转换</h3> <p><strong>宽化类型转换( Widening Numeric Conversions)</strong>，也称向上类型转换。</p> <blockquote><p>转换规则</p></blockquote> <p>Java 虚拟机直接支持以下数值的宽化类型转换(Widening Numeric Conversion，小范围类型向大范围类型的安全转换)。也就是说，并不需要指令执行，包括：</p> <ul><li><p>从 int 类型到 long、float 或者 double 类型，对应的指令为：i2l、i2f、i2d</p></li> <li><p>从 long 类型到 float、double 类型。对应的指令为：l2f、l2d</p></li> <li><p>从 flaot 类型到 double 类型。对应的指令为：f2d</p></li></ul> <p>简化为：int --&gt; long --&gt; float --&gt; double</p> <p>代码示例：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">upCast1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token keyword">long</span> l <span class="token operator">=</span> i<span class="token punctuation">;</span>
    <span class="token keyword">float</span> f <span class="token operator">=</span> i<span class="token punctuation">;</span>
    <span class="token keyword">double</span> d <span class="token operator">=</span> i<span class="token punctuation">;</span>
    
    <span class="token keyword">float</span> f1 <span class="token operator">=</span> l<span class="token punctuation">;</span>
    <span class="token keyword">double</span> d1 <span class="token operator">=</span> l<span class="token punctuation">;</span>
    <span class="token keyword">double</span> d2 <span class="token operator">=</span> f1<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>分析图：</p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Java/20220128175838.png" alt="image-20220128175837267"></p> <blockquote><p>精度损失问题</p></blockquote> <p>宽化类型转换是不会因为超过目标类型最大值而丢失信息的，例如，从 int 转换到 long，或者从 int 转换到 double，<strong>都不会丢失任何信息</strong>，转换前后的值是精确相等的。</p> <p>从 int、long 类型数值转换到 float，或者 long 类型树脂转换到 double 时，<strong>将可能发生丢失精度</strong>，可能丢失掉几个最低有效位上的值，转换后的浮点数值是根据 IEEE754 最接近舍入模式所得到的正确整数数值。尽管宽化类型转换实际上是可能发生精度丢失的，但是这种转换永远不会导致 Java 虚拟机抛出运行时异常。</p> <blockquote><p>补充说明</p></blockquote> <p><strong>从 byte、char 和 short 类型到 int 类型的宽化类型转换实际上是不存在的</strong>，对于 byte 类型转换为 int，虚拟机并没有做实质性的转化处理，知识简单地通过操作数栈交换了两个数据。而 byte 转为 long 时，使用的是 i2l，可以看到在内部 byte 在这里已经等同于 int 类型处理，类似的还有 short 类型，这种处理方式有两个特点：</p> <ul><li>一方面可以减少实际的数据类型，如果为 short 和 byte 都准备一套指令，那么指令的数量就会大增，而 <strong>虚拟机目前的设计上，只愿意使用一个字节表示指令，因此指令总数不能超过 256 个，为了节省指令资源，将 short 和 byte 当作 int 处理也是情理之中</strong></li> <li>另一方面，由于局部变量表中的槽位固定为32位，无论是 byte 或者 short 存入局部变量表，都会占用32位空间。从这个角度来说，也没有必要特意区分这几种数据类型</li></ul> <blockquote><p>代码示例 1</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">upCast2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">123123123</span><span class="token punctuation">;</span>
    <span class="token keyword">float</span> f <span class="token operator">=</span> i<span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">long</span> l <span class="token operator">=</span> <span class="token number">123123123123L</span><span class="token punctuation">;</span>
    l <span class="token operator">=</span> <span class="token number">123123123123123123L</span><span class="token punctuation">;</span>
    <span class="token keyword">double</span> d <span class="token operator">=</span> l<span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>输出的结果可以看到精度发生损失：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token number">1.2312312E8</span>
<span class="token number">1.2312312312312312E17</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><blockquote><p>代码示例 2</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">upCast3</span><span class="token punctuation">(</span><span class="token keyword">byte</span> b， <span class="token keyword">short</span> s<span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">int</span> i <span class="token operator">=</span> b<span class="token punctuation">;</span>
    i <span class="token operator">=</span> s<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>上面的代码从不会发生宽化类型转换，我们可以从字节码看出，没有 i2b、i2s。</p> <h3 id="窄化类型转换"><a href="#窄化类型转换" class="header-anchor">#</a> 窄化类型转换</h3> <p><strong>窄化类型转换( Narrowing Numeric Conversion)</strong>，也称向下类型转换、强制类型转换。</p> <blockquote><p>转换规则</p></blockquote> <p>Java 虚拟机也直接支持以下窄化类型转换：</p> <ul><li>从 int 类型至 byte、short 或者 char 类型。对应的指令有：i2b、i2c、i2s</li> <li>从 long 类型到 int 类型。对应的指令有：l2i</li> <li>从 float 类型到 int 或者 long 类型。对应的指令有：f2i、f2l</li> <li>从 double 类型到 int、long 或者 float 类型。对应的指令有：d2i、d2l、d2f</li></ul> <p>代码示例：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">downCast1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token keyword">byte</span> b <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span>i<span class="token punctuation">;</span>
    <span class="token keyword">short</span> s <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">)</span>i<span class="token punctuation">;</span>
    <span class="token keyword">char</span> c <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span>i<span class="token punctuation">;</span>
    
    <span class="token keyword">long</span> l <span class="token operator">=</span> <span class="token number">10L</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> i1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>l<span class="token punctuation">;</span>
    <span class="token keyword">byte</span> b1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span>l<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>分析图：</p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Java/20220128181828.png" alt="image-20220128181827277"></p> <p>由字节码分析，我们知道 float 转为 byte 时，先将 float 转为 int，再转为 byte，走了 2 次转换。</p> <p>double 转为 byte 同理，先转为 int ，再转为 byte。</p> <blockquote><p>精度损失问题</p></blockquote> <p>窄化类型转换可能会导致转换结果具备不同的正负号、不同的数量级，因此，转换过程很可能会导致数值丢失精度。</p> <p>尽管数据类型窄化转换可能会发生上限溢出、下限溢出和精度丢失等情况，但是 Java 虚拟机规范中明确规定数值类型的窄化转换指令永远不可能导致虚拟机抛出运行时异常。</p> <p>代码示例：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">downCast2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">128</span><span class="token punctuation">;</span>
    <span class="token keyword">byte</span> b <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span>i<span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// -128</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>输出的到结果发生了精度损失：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token operator">-</span><span class="token number">128</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>补充说明</p></blockquote> <p>当一个浮点值窄化转换为整数类型 T（T 限于 int 或 long 类型之一）的时候，将遵循以下转换规则：</p> <ul><li><p>如果浮点值是 NaN，那转换结果就是 int 或 long 类型的 0</p></li> <li><p>如果浮点值不是无穷大的话，浮点值使用 IEEE754 的向零舍入模式取整，获得整数值 v，如果 v 在目标类型 T（int 或 long）的表示范围之内，那转换结果就是 v。否则，将根据 v 的符号，转换为 T 所能表示的最大或者最小正数</p></li></ul> <p>当一个 double 类型窄化转换为 float 类型时，将遵循以下转换规则：</p> <ul><li><p>通过向最接近数舍入模式舍入一个可以使用 float 类型表示的数字。最后结果根据下面这 3 条规则判断：</p></li> <li><p>如果转换结果的绝对值太小而无法使用 float 来表示，将返回 float 类型的正或负零</p></li> <li><p>如果转换结果的绝对值太大而无法使用 float 来表示，将返回 float 类型的正或负无穷大</p></li> <li><p>对于 double 类型的 NaN 值将按规定转换为 float 类型的 NaN 值</p></li></ul> <p>代码示例：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">downCast3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">double</span> d1 <span class="token operator">=</span> <span class="token class-name">Double<span class="token punctuation">.</span>NaN</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>d1<span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>d1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// NaN</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0</span>
    
    <span class="token keyword">double</span> d2 <span class="token operator">=</span> <span class="token class-name">Double</span><span class="token punctuation">.</span><span class="token constant">POSITIVE_INFINTY</span><span class="token punctuation">;</span> <span class="token comment">// 正无穷大</span>
    <span class="token keyword">long</span> l <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>d2<span class="token punctuation">;</span>
    <span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>d2<span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 9223372036854775807</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token constant">MAX_VALUE</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 9223372036854775807</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2147483647</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token constant">MAX_VALUE</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2147483647</span>
    
    <span class="token keyword">float</span> f1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>d1<span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>f1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Infinity</span>
    
    <span class="token keyword">float</span> f2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>d2<span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>f2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// NaN</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>输出结果：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">NaN</span>
<span class="token number">0</span>
<span class="token number">9223372036854775807</span>
<span class="token number">9223372036854775807</span>
<span class="token number">2147483647</span>
<span class="token number">2147483647</span>
<span class="token class-name">Infinity</span>
<span class="token class-name">NaN</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="对象的创建与访问指令"><a href="#对象的创建与访问指令" class="header-anchor">#</a> 对象的创建与访问指令</h2> <p>Java 是面向对象的程序设计语言，虚拟机平台从字节码层面就对面向对象做了深层次的支持。有一系列指令专门用于对象操作，可进一步细分为创建指令、字段访问指令、数组操作指令和类型检查指令。</p> <h3 id="创建指令"><a href="#创建指令" class="header-anchor">#</a> 创建指令</h3> <table><thead><tr><th style="text-align:left;">创建指令</th> <th style="text-align:left;">含义</th></tr></thead> <tbody><tr><td style="text-align:left;">new</td> <td style="text-align:left;">创建类实例</td></tr> <tr><td style="text-align:left;">newarray</td> <td style="text-align:left;">创建基本类型数组</td></tr> <tr><td style="text-align:left;">anewarray</td> <td style="text-align:left;">创建引用类型数组</td></tr> <tr><td style="text-align:left;">multilanewarra</td> <td style="text-align:left;">创建多维数组</td></tr></tbody></table> <p>虽然类实例和数组都是对象，但 Java 虚拟机对类实例和数组的创建与操作使用了不同的字节码指令。</p> <blockquote><p>创建类实例的指令</p></blockquote> <ul><li><p>创建类实例的指令：new</p></li> <li><p>它接收一个操作数，为指向常量池的索引，表示要创建的类型，执行完成后，将对象的引用压入栈</p></li></ul> <blockquote><p>创建数组的指令</p></blockquote> <p>创建数组的指令：<code>newarray</code>、<code>anewarray</code>、<code>multianewarray</code></p> <ul><li>newarray：创建基本类型数组</li> <li>anewarray：创建引用类型数组</li> <li>multianewarray：创建多维数组</li></ul> <p>上述创建指令可以用于创建对象或者数组，由于对象和数组在 Java 中的广泛使用，这些指令的使用频率也很高。</p> <blockquote><p>代码示例 1：创建类实例的指令</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Object</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;kele&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>分析图：</p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Java/20220128201243.png" alt="image-20220128201241600"></p> <p>如图出现重复地址的原因在于 dup 复制指令，多复制一份，用于存到局部变量表，另外一个则用于出栈。</p> <blockquote><p>代码示例 2：创建数组的指令</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">newArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> intArray <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> objectArray <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> mintArray <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> strArray <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>分析图：</p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Java/20220128202122.png" alt="image-20220128202121270"></p> <p>22 的 anewarray 是因为创建的还是一维数组，因为没有给低维赋值长度，所以只是长度为 10 的一维数组。</p> <h3 id="字段访问指令"><a href="#字段访问指令" class="header-anchor">#</a> 字段访问指令</h3> <table><thead><tr><th style="text-align:left;">字段访问指令</th> <th style="text-align:left;">含义</th></tr></thead> <tbody><tr><td style="text-align:left;">getstatic、putstatic</td> <td style="text-align:left;">访问类字段（static字段，或者称为类变量）的指令</td></tr> <tr><td style="text-align:left;">getfield、 putfield</td> <td style="text-align:left;">访问类实例字段（非static字段，或者称为实例变量）的指令</td></tr></tbody></table> <p>对象创建后，就可以通过对象访问指令获取对象实例或数组实例中的字段或者数组元素。</p> <ul><li>访问类字段（static 字段，或者称为类变量）的指令：<code>getstatic</code>（入栈）、<code>putstatic</code>（出栈）</li> <li>访问类实例字段（非 static 字段，或者称为实例变量）的指令：<code>getfield</code>（入栈）、<code>putfield</code>（出栈）</li></ul> <blockquote><p>代码示例 1：getstatic 指令</p></blockquote> <p>以 getstatic 指令为例，它含有一个操作数，为指向常量池的 Fieldref 索引，它的作用就是获取 Fieldref 指定的对象或者值，并将其压入操作数栈</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>对应的字节码指令：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token number">0</span> getstatic #<span class="token number">8</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">&gt;</span>
<span class="token number">3</span> ldc #<span class="token number">9</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Hello</span><span class="token punctuation">&gt;</span></span>
<span class="token number">5</span> invokevirtual #<span class="token number">10</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>io<span class="token operator">/</span><span class="token class-name">PrintStream</span><span class="token punctuation">.</span>println<span class="token operator">&gt;</span>
<span class="token number">8</span> <span class="token keyword">return</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>图示：</p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Java/20220128203129.png" alt="image-20220128203128185"></p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Java/20220128203212.png" alt="image-20220128203211116"></p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Java/20220128203324.png" alt="image-20220128203323615"></p> <blockquote><p>代码示例 2：getfield、putfield 指令</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setOrderId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Order</span> order <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Order</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        order<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token number">1001</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>order<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Order</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;ORDER&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>order<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Order</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> id<span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>分析图：</p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Java/20220128204053.png" alt="image-20220128204052369"></p> <h3 id="数组操作指令"><a href="#数组操作指令" class="header-anchor">#</a> 数组操作指令</h3> <p>数组操作指令主要有：xastore 和 xaload 指令。具体为：</p> <ul><li>把一个数组元素加载到操作数栈的指令：<code>baload</code>、<code>caload</code>、<code>saload</code>、<code>iaload</code>、<code>laload</code>、<code>faload</code>、<code>daload</code>、<code>aaload</code></li> <li>将一个操作数栈的值存储到数组元素中的指令：<code>bastore</code>、<code>castore</code>、<code>sastore</code>、<code>iastore</code>、<code>lastore</code>、<code>fastore</code>、<code>dastore</code>、<code>aastore</code></li></ul> <p><code>xaload</code> 依旧是入栈。</p> <p><code>xastore</code> 不是存放到局部变量表，而是存放到数组里。</p> <table><thead><tr><th>数组类型</th> <th>加载指令</th> <th>存储指令</th></tr></thead> <tbody><tr><td>byte（boolean）</td> <td>baload</td> <td>bastore</td></tr> <tr><td>char</td> <td>caload</td> <td>castore</td></tr> <tr><td>short</td> <td>saload</td> <td>sastore</td></tr> <tr><td>long</td> <td>iaload</td> <td>laload</td></tr> <tr><td>float</td> <td>faload</td> <td>fastore</td></tr> <tr><td>double</td> <td>daload</td> <td>dastore</td></tr> <tr><td>reference</td> <td>aaload</td> <td>aastore</td></tr></tbody></table> <p>取数组长度的指令：<code>arraylength</code>。该指令弹出栈顶的数组元素，获取数组的长度，将长度压入栈。</p> <p>说明：</p> <ul><li>指令 xaload 表示将数组的元素压栈，比如 saload、caload 分别表示压入 short 数组和 char 数组。指令 xaload 在执行时，要求操作数中栈顶元素为数组索引 i，栈顶顺位第2个元素为数组引用 a，该指令会弹出栈顶这两个元素，并将 a[i] 重新压入堆栈</li> <li>xastore 则专门针对数组操作，以 iastore 为例，它用于给一个 int 数组的给定索引赋值。在 iastore 执行前，操作数栈顶需要以此准备 3 个元素：值、索引、数组引用，iastore 会弹出这 3 个值，并将值赋给数组中指定索引的位置</li></ul> <blockquote><p>代码示例 1：数组操作指令</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> intArray <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    intArray<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>intArray<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>分析图：</p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Java/20220128205500.png" alt="image-20220128205459761"></p> <blockquote><p>代码示例 2：数组长度的指令</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">arrLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token keyword">double</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">double</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>分析图：</p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Java/20220128205738.png" alt="image-20220128205736822"></p> <h3 id="类型检查指令"><a href="#类型检查指令" class="header-anchor">#</a> 类型检查指令</h3> <p>检查类实例或数组类型的指令：<code>instanceof</code>、<code>checkcast</code></p> <ul><li>指令 <code>checkcast</code> 用于检查类型强制转换是否可以进行。如果可以进行，那么 <code>checkcast</code> 指令不会改变操作数栈，否则它会抛出 <code>ClassCastException</code> 异常</li> <li>指令 <code>instanceof</code> 用来判断给定对象是否是某一个类的实例，它会将判断结果压入操作数栈</li></ul> <table><thead><tr><th>类型检查指令</th> <th>含义</th></tr></thead> <tbody><tr><td>instanceof</td> <td>检查类型强制转换是否可以进行</td></tr> <tr><td>checkcast</td> <td>判断给定对象是否是某一个类的实例</td></tr></tbody></table> <blockquote><p>代码示例：</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">checkCast</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token keyword">instanceof</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> obj<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>分析图：</p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Java/20220128210059.png" alt="image-20220128210057657"></p> <h2 id="方法调用与返回指令"><a href="#方法调用与返回指令" class="header-anchor">#</a> 方法调用与返回指令</h2> <h3 id="方法调用指令"><a href="#方法调用指令" class="header-anchor">#</a> 方法调用指令</h3> <p>方法调用指令：<code>invokevirtual</code>、<code>invokeinterface</code>、<code>invokespecial</code>、<code>invokestatic</code>、<code>invokedynamic</code></p> <p>以下 5 条指令用于方法调用：</p> <ul><li><code>invokevirtual</code> 指令用于调用对象的实例方法，根据对象的实际类型进行分派（虚方法分派），支持多态。这也是 Java 语言中 <strong>最常见的方法分派方式</strong></li> <li><code>invokeinterface</code> 指令用于 <strong>调用接口方法</strong>，它会在运行时搜索由特定对象所实现的这个接口方法，并找出适合的方法进行调用</li> <li><code>invokespecial</code> 指令用于调用一些需要特殊处理的实例方法，包括 <strong>实例初始化方法（构造器）、私有方法和父类方法</strong>。这些方法都是 <strong>静态类型绑定</strong> 的，不会在调用时进行动态派发</li> <li><code>invokestatic</code> 指令用于调用命名 <strong>类中的类方法（static 方法）</strong>。这是 <strong>静态绑定</strong> 的</li> <li><code>invokedynamic</code> 调用动态绑定的方法，这个是 JDK 1.7 后新加入的指令。用于在运行时动态解析出调用点限定符所引用的方法，并执行该方法。前面4条调用指令的分派逻辑都固化在 Java 虚拟机内部，而 <code>invokedynamic</code> 指令的分派逻辑是由用户所设定的引导方法决定的</li></ul> <table><thead><tr><th>方法调用指令</th> <th>含义</th></tr></thead> <tbody><tr><td>invokevirtual</td> <td>调用对象的实例方法</td></tr> <tr><td>invokeinterface</td> <td>调用接口方法</td></tr> <tr><td>invokespecial</td> <td>调用一些需要特殊处理的实例方法，包括实例初始化方法（构造器）、私有方法和父类方法</td></tr> <tr><td>invokestatic</td> <td>调用命名类中的类方法（static方法）</td></tr> <tr><td>invokedynamic</td> <td>调用动态绑定的方法</td></tr></tbody></table> <blockquote><p>代码示例 1：invokespecial</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 方法调用指令：invokespecial：静态分派</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">invoke1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 情况 1：类实例构造器方法：&lt;init&gt;()</span>
    <span class="token class-name">Date</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Thread</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 情况 2：父类的方法</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 情况 3：私有方法</span>
    <span class="token function">methodPrivate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">methodPrivate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>分析图：</p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Java/20220128211310.png" alt="image-20220128211309643"></p> <blockquote><p>代码示例 2：invokestatic</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 方法调用指令：invokestatic：静态分派</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">invoke2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">methodStatic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">methodStatic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Java/20220128211220.png" alt="image-20220128211219606"></p> <blockquote><p>代码示例 3：invokeinterface</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 方法调用指令：invokeinterface</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">invoke3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">Thread</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span><span class="token punctuation">)</span>t1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Comparable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> com <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    com<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>分析图：</p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Java/20220128211713.png" alt="image-20220128211712074"></p> <blockquote><p>代码示例 4：invokeVirtual</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 方法调用指令：invokeVirtual：动态分派</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">invoke4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Thread</span> t1 <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    t1<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>分析图：</p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Java/20220128211537.png" alt="image-20220128211536609"></p> <blockquote><p>代码示例 5：在接口里定义 static 和 default 方法，分别属于什么？</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">InterfaceMethodTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">AA</span> aa <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        aa<span class="token punctuation">.</span><span class="token function">method2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 属于 invokeinterface</span>

        <span class="token constant">AA</span><span class="token punctuation">.</span><span class="token function">method1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 属于 invokestatic</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token keyword">interface</span> <span class="token class-name">AA</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">method1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">default</span> <span class="token keyword">void</span> <span class="token function">method2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">BB</span> <span class="token keyword">implements</span> <span class="token class-name">AA</span><span class="token punctuation">{</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>分析图：</p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Java/20220128211838.png" alt="image-20220128211837507"></p> <h3 id="方法返回指令"><a href="#方法返回指令" class="header-anchor">#</a> 方法返回指令</h3> <p>方法调用结束前，需要进行返回。方法返回指令 <strong>根据返回值的类型进行区分</strong>。</p> <ul><li>包括 <code>ireturn</code>（当返回值是 boolean、byte、char、short 和 int 类型时使用）、<code>lreturn</code>、<code>freturn</code>、<code>dreturn</code> 和 <code>areturn</code></li> <li>另外还有一条 <code>return</code> 指令供声明为 void 的方法、实例初始化方法以及类和接口的类初始化方法使用</li></ul> <table><thead><tr><th>返回类型</th> <th>返回指令</th></tr></thead> <tbody><tr><td>void</td> <td>return</td></tr> <tr><td>int（boolean、byte、char、short）</td> <td>ireturn</td></tr> <tr><td>long</td> <td>lreturn</td></tr> <tr><td>float</td> <td>freutrn</td></tr> <tr><td>double</td> <td>dreturn</td></tr> <tr><td>reference</td> <td>Return</td></tr></tbody></table> <p>通过 <code>ireturn</code> 指令，将当前函数操作数栈的顶层元素弹出，并将这个元素压入调用者函数的操作数栈中（因为调用者非常关心函数的返回值），所有在当前函数操作数栈中的其他元素都会被丢弃。</p> <p>如果当前返回的是 synchronized 方法，那么还会执行一个隐含的 <code>monitorexit</code> 指令，退出临界区。</p> <p>最后，会丢弃当前方法的整个帧，恢复调用者的帧，并将控制权转交给调用者。</p> <p>代码示例（指令已经写在代码的注释里）：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">returnInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">500</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> i<span class="token punctuation">;</span>  <span class="token comment">// ireturn</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">returnDouble</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">0.0</span><span class="token punctuation">;</span> <span class="token comment">// dreturn</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">returnString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;hello,world&quot;</span><span class="token punctuation">;</span> <span class="token comment">// areturn</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">returnArr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// areturn</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">float</span> <span class="token function">returnFloat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> i<span class="token punctuation">;</span> <span class="token comment">// freturn</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">byte</span> <span class="token function">returnByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// ireturn</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">methodReturn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token function">returnByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// return</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h2 id="操作数栈管理指令"><a href="#操作数栈管理指令" class="header-anchor">#</a> 操作数栈管理指令</h2> <p>如同操作一个普通数据结构中的堆栈那样，JVM 提供的操作数栈管理指令，可以用于直接操作操作数栈的指令。</p> <p>这类指令包括如下内容：</p> <ul><li>将一个或两个元素从栈顶弹出，并且直接废弃：<code>pop</code>、<code>pop2</code></li> <li>复制栈顶一个或两个数值并将复制值或双份的复制值重新压入栈顶：<code>dup</code>、<code>dup2</code>、<code>dup_x1</code>、<code>dup2_x1</code>、<code>dup_x2</code>、<code>dup2_x2</code></li> <li>将栈最顶端的两个 Slot 数值位置交换：swap。Java 虚拟机没有提供交换两个 64 位数据类型（long、double）数值的指令</li> <li>指令 nop 是一个非常特殊的指令，它的字节码为 0x00。和汇编语言中的 nop 一样，它表示什么都不做，这条指令一般可用于调试、占位等</li></ul> <p>这些指令属于通用型，对栈的压入或者弹出无需知名数据类型。</p> <p>说明：</p> <ul><li><p>不带 _x 的指令是复制栈顶数据并压入栈顶。包括两个指令，<code>dup</code> 和 <code>dup2</code>，dup 的系数代表要复制的 Slot 个数</p> <p>dup 开头的指令用于复制 1 个 Slot 的数据。例如 1 个 int 或 1 个 <code>reference</code> 类型数据。</p> <p>dup2 开头的指令用于复制 2 个 Slot 的数据。例如 1 个 long，或 2 个 int，或 1 个 int 加 1 个 float 类型数据。</p></li> <li><p>带 _x 的指令是复制栈顶数据并插入栈顶以下的某个位置。共有 4 个指令，<code>dup_x1</code>、<code>dup2_x1</code>、<code>dup_x2</code>、<code>dup2_x2</code>。对于带 _x 的复制插入指令，只要将指令的 dup 和 x 的系数相加，结果即为需要插入的位置。因此：</p> <ul><li><p>dup_x1 插入位置：1+1=2，即栈顶 2 个 Slot 下面</p></li> <li><p>dup_x2 插入位置：1+2=3，即栈顶 3 个 Slot 下面</p></li> <li><p>dup2_x1 插入位置：2+1=3，即栈顶 3 个 Slot 下面</p></li> <li><p>dup2_x2 插入位置：2+2=4，即栈顶 4 个 Slot 下面</p></li></ul></li> <li><p>pop：将栈顶的 1 个 Slot 数值出栈。例如 1 个 short 类型数值</p></li> <li><p>pop2：将栈顶的 2 个 Slot 数值出栈。例如 1 个 double 类型数值，或者 2 个 int 类型数值</p></li></ul> <blockquote><p>代码示例 1：pop 指令</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">Object</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    obj<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>分析图：</p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Java/20220128213924.png" alt="image-20220128213923699"></p> <p>看图我们知道，直接调用 <code>obj.toString</code> 没有赋值，则产生 pop，踢出栈，如果是上传注释的 <code>String info = obj.toString</code>，则不是 pop，而是 <code>astore_2</code>。</p> <blockquote><p>代码示例 2：pop2 指令</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>分析图：</p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Java/20220128214149.png" alt="image-20220128214148750"></p> <blockquote><p>代码示例 3：pop2 指令</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">nextIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> index<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">long</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>分析图：</p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Java/20220128214737.png" alt="image-20220128214736649"></p> <p>所以最终输出的还是 0，即对应图中第二个操作数栈的 <code>idnex:0</code>。</p> <h2 id="控制转移指令"><a href="#控制转移指令" class="header-anchor">#</a> 控制转移指令</h2> <p>程序流程离不开条件控制，为了支持条件跳转，虚拟机提供了大量字节码指令，大体上可以分为比较指令、条件跳转指令、比较条件跳转指令、多条件分支跳转指令、无条件跳转指令等。</p> <h3 id="比较指令"><a href="#比较指令" class="header-anchor">#</a> 比较指令</h3> <p>比较指令的作用是比较占栈顶两个元素的大小，并将比较结果入栈。比较指令有：<code>dcmpg</code>（g 比大）、<code>dcmpl</code>（l 比小）、<code>fcmpg</code>、<code>fcmpl</code>、<code>lcmp</code>。与前面讲解的指令类似，首字符 d 表示 double 类型，f 表示 float,l 表示 long。</p> <p>对于 double 和 float 类型的数字，由于 NaN 的存在，各有两个版本的比较指令。以 float 为例，有 <code>fcmpg</code> 和 <code>fcmpl</code> 两个指令，它们的区别在于在数字比较时，若遇到 NaN 值，处理结果不同。</p> <p>指令 <code>dcmpl</code> 和 <code>dcmpg</code> 也是类似的，根据其命名可以推测其含义，在此不再赘述。</p> <p><strong>数值类型的数据，才可以谈大小；boolean、引用数据类型不能比较大小。</strong></p> <blockquote><p>举例</p></blockquote> <p>指令 <code>fcmp</code> 和 <code>fcmpl</code> 都从中弹出两个操作数，并将它们做比较，设栈顶的元素为 v2，顶顺位第 2 位的元素为 v1：若 <code>v1 = v2</code>，则压入 0；若 <code>v1 &gt; v2</code>，则压入 1；若 <code>v1 &lt; v2</code>，则压入 -1。</p> <p>两个指令的不同之处在于，如果遇到 NaN 值， <code>fcmpg</code> 会压入 1,而 <code>fcmpl</code> 会压入 -1。</p> <h3 id="条件跳转指令"><a href="#条件跳转指令" class="header-anchor">#</a> 条件跳转指令</h3> <p>条件跳转指令通常和比较指令结合使用。在条件跳转指令执行前，一般可以先用比较指令进行栈顶元素的准备，然后进行条件跳转。</p> <p>条件跳转指令有：<code>ifeq</code>、<code>iflt</code>、<code>ifle</code>、<code>ifne</code>、<code>ifgt</code>、<code>ifge</code>、<code>ifnull</code>、<code>ifnonnull</code>。这些指令都接收两个字节的操作数，用于计算跳转的位置(16 位符号整数作为当前位置的 offset)。</p> <p>它们的统一含义为：<strong>弹出栈顶元素，测试它是否满足某一条件，如果满足条件，则跳转到给定位置</strong>。</p> <p>具体说明：</p> <table><thead><tr><th>指令</th> <th>作用</th></tr></thead> <tbody><tr><td>ifeq</td> <td>当栈顶 int 类型数值等于 0 时跳转</td></tr> <tr><td>ifne</td> <td>当栈顶 int 类型数值不等于 0 时跳转</td></tr> <tr><td>iflt</td> <td>当栈顶 int 类型数值小于 0 时跳转</td></tr> <tr><td>ifle</td> <td>当栈顶 int 类型数值小于等于 0 时跳转</td></tr> <tr><td>ifgt</td> <td>当栈顶 int 类型数值大于 0 时跳转</td></tr> <tr><td>ifge</td> <td>当栈顶 int 类型数值大于等于 0 时跳转</td></tr> <tr><td>ifnull</td> <td>为 null 时跳转</td></tr> <tr><td>ifnonnull</td> <td>不为 null 时跳转</td></tr></tbody></table> <p>注意：</p> <p>与前面运算规则一致。</p> <ul><li>对于 boolean、byte、char、short 类型的条件分支比较操作，都是使用 int 类型的比较指令完成</li> <li>对于 long、float、double 类型的条件分支比较操作，则会先执行相应类型的比较运算指令，运算指令会返回一个整型值到操作数栈中，随后再执行 int 类型的条件分支比较操作来完成整个分支跳转</li> <li>由于各类型的比较最终都会转为 int 类型的比较操作，所以 Java 虚拟机提供的 int 类型的条件分支指令是最为丰富和强大的</li></ul> <blockquote><p>代码示例 1：ifeq 指令</p></blockquote> <p>因为图片容易丢失，下面的字节码都以代码块形式出现。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">compare1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>a <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        a <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>字节码：</p> <div class="language-java line-numbers-mode"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br></div><pre class="language-java"><code> <span class="token number">0</span> iconst_0
 <span class="token number">1</span> istore_1
 <span class="token number">2</span> iload_1
 <span class="token number">3</span> ifeq <span class="token number">12</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">9</span><span class="token punctuation">)</span>
 <span class="token number">6</span> bipush <span class="token number">10</span>
 <span class="token number">8</span> istore_1
 <span class="token number">9</span> <span class="token keyword">goto</span> <span class="token number">15</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">6</span><span class="token punctuation">)</span>
<span class="token number">12</span> bipush <span class="token number">20</span>
<span class="token number">14</span> istore_1
<span class="token number">15</span> <span class="token keyword">return</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>可以看出：<code>ifeq</code> 不相等后，跳转到 8 行（代码块行数），赋值为 20，然后下一步是执行第 7 行 goto 到 10 行，结束运行。</p> <blockquote><p>代码示例 2：ifnonnull 指令</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">compareNull</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>str <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>字节码：</p> <div class="language-java line-numbers-mode"><div class="highlight-lines"><br><div class="highlighted"> </div><br><br><br><br><br></div><pre class="language-java"><code><span class="token number">0</span> aload_1
<span class="token number">1</span> ifnonnull <span class="token number">6</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">5</span><span class="token punctuation">)</span>
<span class="token number">4</span> iconst_1
<span class="token number">5</span> ireturn
<span class="token number">6</span> iconst_0
<span class="token number">7</span> ireturn
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>如果 str 为 null，则不跳转，往下走。否则直接跳转到第 6 行（里面的数字）。</p> <blockquote><p>代码示例 3：ifge 指令</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">compare2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">float</span> f1 <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span>
    <span class="token keyword">float</span> f2 <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>f1 <span class="token operator">&lt;</span> f2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>字节码：</p> <div class="language-java line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br></div><pre class="language-java"><code> <span class="token number">0</span> ldc #<span class="token number">2</span> <span class="token generics"><span class="token punctuation">&lt;</span>9<span class="token punctuation">.</span>0<span class="token punctuation">&gt;</span></span>
 <span class="token number">2</span> fstore_1
 <span class="token number">3</span> ldc #<span class="token number">3</span> <span class="token generics"><span class="token punctuation">&lt;</span>10<span class="token punctuation">.</span>0<span class="token punctuation">&gt;</span></span>
 <span class="token number">5</span> fstore_2
 <span class="token number">6</span> getstatic #<span class="token number">4</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">System</span><span class="token punctuation">.</span>out <span class="token operator">:</span> <span class="token class-name">Ljava</span><span class="token operator">/</span>io<span class="token operator">/</span><span class="token class-name">PrintStream</span><span class="token punctuation">;</span><span class="token operator">&gt;</span>
 <span class="token number">9</span> fload_1
<span class="token number">10</span> fload_2
<span class="token number">11</span> fcmpg
<span class="token number">12</span> ifge <span class="token number">19</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">7</span><span class="token punctuation">)</span>
<span class="token number">15</span> iconst_1
<span class="token number">16</span> <span class="token keyword">goto</span> <span class="token number">20</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">)</span>
<span class="token number">19</span> iconst_0
<span class="token number">20</span> invokevirtual #<span class="token number">5</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>io<span class="token operator">/</span><span class="token class-name">PrintStream</span><span class="token punctuation">.</span>println <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token class-name">Z</span><span class="token punctuation">)</span><span class="token class-name">V</span><span class="token operator">&gt;</span>
<span class="token number">23</span> <span class="token keyword">return</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><code>fcmpg</code> 比较后得到 -1，并且 <code>ifge</code> 比较 -1 小于 0，则不跳转， 10 行（代码块行数）赋值为 1，最后 goto 出去，所以最终输出为 true。</p> <p>为什么不是 1？</p> <p>看 13 行代码，因为 PrintStream 类的 (Z)V&gt; 是输出 boolean 类型，1 对应 true。</p> <blockquote><p>代码示例 4：ifle 指令</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">compare3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> i1 <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token keyword">long</span> l1 <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i1 <span class="token operator">&gt;</span> l1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>字节码：</p> <div class="language-java line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br></div><pre class="language-java"><code> <span class="token number">0</span> bipush <span class="token number">10</span>
 <span class="token number">2</span> istore_1
 <span class="token number">3</span> ldc2_w #<span class="token number">6</span> <span class="token generics"><span class="token punctuation">&lt;</span>20<span class="token punctuation">&gt;</span></span>
 <span class="token number">6</span> lstore_2
 <span class="token number">7</span> getstatic #<span class="token number">4</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">System</span><span class="token punctuation">.</span>out <span class="token operator">:</span> <span class="token class-name">Ljava</span><span class="token operator">/</span>io<span class="token operator">/</span><span class="token class-name">PrintStream</span><span class="token punctuation">;</span><span class="token operator">&gt;</span>
<span class="token number">10</span> iload_1
<span class="token number">11</span> i2l
<span class="token number">12</span> lload_2
<span class="token number">13</span> lcmp
<span class="token number">14</span> ifle <span class="token number">21</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">7</span><span class="token punctuation">)</span>
<span class="token number">17</span> iconst_1
<span class="token number">18</span> <span class="token keyword">goto</span> <span class="token number">22</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">)</span>
<span class="token number">21</span> iconst_0
<span class="token number">22</span> invokevirtual #<span class="token number">5</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>io<span class="token operator">/</span><span class="token class-name">PrintStream</span><span class="token punctuation">.</span>println <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token class-name">Z</span><span class="token punctuation">)</span><span class="token class-name">V</span><span class="token operator">&gt;</span>
<span class="token number">25</span> <span class="token keyword">return</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>i1 通过第 7 行的 <code>i21</code> 转为 long 类型才能进行比较。</p> <p>通过 lcmp 指令得出的是 -1，则 ifle 指令判断小于等于 0 跳转到 13 行，得到 0，所以通过 goto 跳出，最终输出 false（0 对应 false）。</p> <blockquote><p>代码示例 5：ifle 指令</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">compare4</span><span class="token punctuation">(</span><span class="token keyword">double</span> d<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>d <span class="token operator">&gt;</span> <span class="token number">50.0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>字节码：</p> <div class="language-java line-numbers-mode"><div class="highlight-lines"><br><br><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br></div><pre class="language-java"><code> <span class="token number">0</span> dload_1
 <span class="token number">1</span> ldc2_w #<span class="token number">8</span> <span class="token generics"><span class="token punctuation">&lt;</span>50<span class="token punctuation">.</span>0<span class="token punctuation">&gt;</span></span>
 <span class="token number">4</span> dcmpl
 <span class="token number">5</span> ifle <span class="token number">10</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">5</span><span class="token punctuation">)</span>
 <span class="token number">8</span> iconst_1
 <span class="token number">9</span> ireturn
<span class="token number">10</span> iconst_m1
<span class="token number">11</span> ireturn
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><code>dcmpl</code> 判断 d 是否小于 50.0，小于则压入 1，否则 0。</p> <p><code>ifle</code> 判断压入的值是否小于等于 0，如果是则跳转到第 7 行。得到 -1（m1），反之得到第 5 行的 1。</p> <h3 id="比较条件跳转指令"><a href="#比较条件跳转指令" class="header-anchor">#</a> 比较条件跳转指令</h3> <p>比较条件跳转指令类似于比较指令和条件跳转指令的结合体，它将比较和跳转两个步骤合二为一。</p> <p>这类指令有：<code>if_icmped</code>、<code>if_icmpne</code>、<code>if_icmplt</code>、<code>if_icmpgt</code>、<code>if_icmple</code>、<code>if_icmpge</code>、<code>if_acmped</code> 和 <code>if_acmpne</code>。</p> <p>其中指令助记符加上 &quot;if_&quot; 后，以字符 &quot;i&quot; 开头的指令针对 int 型整数操作(也包括 short 和 byte 类型)，以字符 &quot;a&quot; 开头的指令表示对象引用的比较。</p> <p>具体说明：</p> <table><thead><tr><th>指令</th> <th>作用</th></tr></thead> <tbody><tr><td>if_icmpeq</td> <td>比较栈顶两 int 型数值大小，当前者等于后者时跳转</td></tr> <tr><td>if_icmpne</td> <td>比较栈顶两 int 型数值大小，当前者不等于后者时跳转</td></tr> <tr><td>if_icmplt</td> <td>比较栈顶两 int 型数值大小，当前者小于后者时跳转</td></tr> <tr><td>if_icmple</td> <td>比较栈顶两 int 型数值大小，当前者小于等于后者时跳转</td></tr> <tr><td>if_icmpgt</td> <td>比较栈顶两 int 型数值大小，当前者大于后者时跳转</td></tr> <tr><td>if_icmpge</td> <td>比较栈顶两 int 型数值大小，当前者大于等于后者时跳转</td></tr> <tr><td>if_acmpeq</td> <td>比较栈顶两引用类型数值，当结果相等时跳转</td></tr> <tr><td>if_acmpne</td> <td>比较栈顶两引用类型数值，当结果不相等时跳转</td></tr></tbody></table> <p>这些指令都接收两个字节的操作数作为参数，用于计算跳转的位置。同时在执行指令时，栈顶需要准备两个元素进行比较。指令执行完成后，栈顶的这两个元素被清空，且没有任何数据入栈。<strong>如果预设条件成立，则执行跳转，否则，继续执行下一条语句</strong>。</p> <blockquote><p>代码示例 1：if_icmple 指令</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">ifCompare1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i <span class="token operator">&gt;</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>字节码：</p> <div class="language-java line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br></div><pre class="language-java"><code> <span class="token number">0</span> bipush <span class="token number">10</span>
 <span class="token number">2</span> istore_1
 <span class="token number">3</span> bipush <span class="token number">20</span>
 <span class="token number">5</span> istore_2
 <span class="token number">6</span> getstatic #<span class="token number">4</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">System</span><span class="token punctuation">.</span>out <span class="token operator">:</span> <span class="token class-name">Ljava</span><span class="token operator">/</span>io<span class="token operator">/</span><span class="token class-name">PrintStream</span><span class="token punctuation">;</span><span class="token operator">&gt;</span>
 <span class="token number">9</span> iload_1
<span class="token number">10</span> iload_2
<span class="token number">11</span> if_icmple <span class="token number">18</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">7</span><span class="token punctuation">)</span>
<span class="token number">14</span> iconst_1
<span class="token number">15</span> <span class="token keyword">goto</span> <span class="token number">19</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">)</span>
<span class="token number">18</span> iconst_0
<span class="token number">19</span> invokevirtual #<span class="token number">5</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>io<span class="token operator">/</span><span class="token class-name">PrintStream</span><span class="token punctuation">.</span>println <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token class-name">Z</span><span class="token punctuation">)</span><span class="token class-name">V</span><span class="token operator">&gt;</span>
<span class="token number">22</span> <span class="token keyword">return</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><code>if_icmple</code> 判断 i 小于等于 j 为 true，则跳转第 11 行，得到 0，最后输出 false。</p> <blockquote><p>代码示例 2：if_icmple 指令</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">ifCompare2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">short</span> s1 <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span>
    <span class="token keyword">byte</span> b1 <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1 <span class="token operator">&gt;</span> b1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>字节码：</p> <div class="language-java line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br></div><pre class="language-java"><code> <span class="token number">0</span> bipush <span class="token number">9</span>
 <span class="token number">2</span> istore_1
 <span class="token number">3</span> bipush <span class="token number">10</span>
 <span class="token number">5</span> istore_2
 <span class="token number">6</span> getstatic #<span class="token number">4</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">System</span><span class="token punctuation">.</span>out <span class="token operator">:</span> <span class="token class-name">Ljava</span><span class="token operator">/</span>io<span class="token operator">/</span><span class="token class-name">PrintStream</span><span class="token punctuation">;</span><span class="token operator">&gt;</span>
 <span class="token number">9</span> iload_1
<span class="token number">10</span> iload_2
<span class="token number">11</span> if_icmple <span class="token number">18</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">7</span><span class="token punctuation">)</span>
<span class="token number">14</span> iconst_1
<span class="token number">15</span> <span class="token keyword">goto</span> <span class="token number">19</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">)</span>
<span class="token number">18</span> iconst_0
<span class="token number">19</span> invokevirtual #<span class="token number">5</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>io<span class="token operator">/</span><span class="token class-name">PrintStream</span><span class="token punctuation">.</span>println <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token class-name">Z</span><span class="token punctuation">)</span><span class="token class-name">V</span><span class="token operator">&gt;</span>
<span class="token number">22</span> <span class="token keyword">return</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><code>if_icmple</code> 判断 s1 小于等于 b1 为 true，则跳转第 11 行，得到 0，最后输出 false。</p> <p>和代码示例 1 的区别就是 short 和 byte 类型自动转为 int 类型。</p> <blockquote><p>代码示例 3：if_acmpne、if_acmpeq 指令</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">ifCompare3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Object</span> obj1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Object</span> obj2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>obj1 <span class="token operator">==</span> obj2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>obj1 <span class="token operator">!=</span> obj2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>字节码：</p> <div class="language-java line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br></div><pre class="language-java"><code> <span class="token number">0</span> <span class="token keyword">new</span> #<span class="token number">10</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">Object</span><span class="token operator">&gt;</span>
 <span class="token number">3</span> dup
 <span class="token number">4</span> invokespecial #<span class="token number">1</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token generics"><span class="token punctuation">&lt;</span>init<span class="token punctuation">&gt;</span></span> <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name">V</span><span class="token operator">&gt;</span>
 <span class="token number">7</span> astore_1
 <span class="token number">8</span> <span class="token keyword">new</span> #<span class="token number">10</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">Object</span><span class="token operator">&gt;</span>
<span class="token number">11</span> dup
<span class="token number">12</span> invokespecial #<span class="token number">1</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token generics"><span class="token punctuation">&lt;</span>init<span class="token punctuation">&gt;</span></span> <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name">V</span><span class="token operator">&gt;</span>
<span class="token number">15</span> astore_2
<span class="token number">16</span> getstatic #<span class="token number">4</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">System</span><span class="token punctuation">.</span>out <span class="token operator">:</span> <span class="token class-name">Ljava</span><span class="token operator">/</span>io<span class="token operator">/</span><span class="token class-name">PrintStream</span><span class="token punctuation">;</span><span class="token operator">&gt;</span>
<span class="token number">19</span> aload_1
<span class="token number">20</span> aload_2
<span class="token number">21</span> if_acmpne <span class="token number">28</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">7</span><span class="token punctuation">)</span>
<span class="token number">24</span> iconst_1
<span class="token number">25</span> <span class="token keyword">goto</span> <span class="token number">29</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">)</span>
<span class="token number">28</span> iconst_0
<span class="token number">29</span> invokevirtual #<span class="token number">5</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>io<span class="token operator">/</span><span class="token class-name">PrintStream</span><span class="token punctuation">.</span>println <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token class-name">Z</span><span class="token punctuation">)</span><span class="token class-name">V</span><span class="token operator">&gt;</span>
<span class="token number">32</span> getstatic #<span class="token number">4</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">System</span><span class="token punctuation">.</span>out <span class="token operator">:</span> <span class="token class-name">Ljava</span><span class="token operator">/</span>io<span class="token operator">/</span><span class="token class-name">PrintStream</span><span class="token punctuation">;</span><span class="token operator">&gt;</span>
<span class="token number">35</span> aload_1
<span class="token number">36</span> aload_2
<span class="token number">37</span> if_acmpeq <span class="token number">44</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">7</span><span class="token punctuation">)</span>
<span class="token number">40</span> iconst_1
<span class="token number">41</span> <span class="token keyword">goto</span> <span class="token number">45</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">)</span>
<span class="token number">44</span> iconst_0
<span class="token number">45</span> invokevirtual #<span class="token number">5</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>io<span class="token operator">/</span><span class="token class-name">PrintStream</span><span class="token punctuation">.</span>println <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token class-name">Z</span><span class="token punctuation">)</span><span class="token class-name">V</span><span class="token operator">&gt;</span>
<span class="token number">48</span> <span class="token keyword">return</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p><code>if_acmpne</code> 指令当结果不相等时跳转 15 行，得到 0，输出 false。</p> <p><code>if_acmpeq</code> 指令当结果不相等时不跳转，进入 21 行，得到 1，输出 true。</p> <h3 id="多条件分支跳转"><a href="#多条件分支跳转" class="header-anchor">#</a> 多条件分支跳转</h3> <p>多条件分支跳转指令是专为 switch-case 语句设计的，主要有 <code>tableswitch</code> 和 <code>lookupswitch</code>。</p> <table><thead><tr><th>指令名称</th> <th>描述</th></tr></thead> <tbody><tr><td>tableswitch</td> <td>用于 switch 条件跳转，case 值连续</td></tr> <tr><td>lookupswitch</td> <td>用于 switch 条件跳转，case 值不连续</td></tr></tbody></table> <p>从助记符上看，两者都是 switch 语句的实现，它们的区别：</p> <ul><li><code>tableswitch</code> 要求 <strong>多个条件分支值是连续的</strong>，它内部只存放起始值和终止值，以及若干个跳转偏移量，通过给定的操作数 index，可以立即定位到跳转偏移量位置，<strong>因此效率比较高</strong></li> <li><code>lookupswitch</code> 内部 <strong>存放着各个离散的 case-offset 对</strong>，每次执行都要搜索全部的 case-offset 对，找到匹配的 case 值，并根据对应的 offset 计算跳转地址，<strong>因此效率较低</strong></li></ul> <p>指令 <code>tableswitch</code> 的示意图如下图所示。由于 tableswitch 的 case 值是连续的，因此只需要记录最低值和最高值，以及每一项对应的 offset 偏移量，根据给定的 index 值通过简单的计算即可直接定位到 offset。</p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Java/20220128224604.png" alt="image-20220128224602854"></p> <p>指令 <code>lookupswitch</code> 处理的是离散的 case 值，但是出于效率考虑，将 case-offset 对按照 case 值大小排序，给定 index 时，需要查找与 index 相等的 case，获得其 offset，如果找不到则跳转到 default。指令 lookupswitch 如下图所示：</p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Java/20220128224621.png" alt="image-20220128224620672"></p> <blockquote><p>代码示例 1：tableswitch 指令</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">swtich1</span><span class="token punctuation">(</span><span class="token keyword">int</span> select<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">int</span> num<span class="token punctuation">;</span>
    <span class="token keyword">switch</span><span class="token punctuation">(</span>select<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span>
            num <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span>
            num <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
            <span class="token comment">//break;</span>
        <span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span>
            num <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">default</span><span class="token operator">:</span>
            num <span class="token operator">=</span> <span class="token number">40</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>字节码：</p> <div class="language-java line-numbers-mode"><div class="highlight-lines"><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-java"><code> <span class="token number">0</span> iload_1
 <span class="token number">1</span> tableswitch <span class="token number">1</span> <span class="token keyword">to</span> <span class="token number">3</span>
	<span class="token number">1</span><span class="token operator">:</span>  <span class="token number">28</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">27</span><span class="token punctuation">)</span>
	<span class="token number">2</span><span class="token operator">:</span>  <span class="token number">34</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">33</span><span class="token punctuation">)</span>
	<span class="token number">3</span><span class="token operator">:</span>  <span class="token number">37</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">36</span><span class="token punctuation">)</span>
	<span class="token keyword">default</span><span class="token operator">:</span>  <span class="token number">43</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">42</span><span class="token punctuation">)</span>
<span class="token number">28</span> bipush <span class="token number">10</span>
<span class="token number">30</span> istore_2
<span class="token number">31</span> <span class="token keyword">goto</span> <span class="token number">46</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">15</span><span class="token punctuation">)</span>
<span class="token number">34</span> bipush <span class="token number">20</span>
<span class="token number">36</span> istore_2
<span class="token number">37</span> bipush <span class="token number">30</span>
<span class="token number">39</span> istore_2
<span class="token number">40</span> <span class="token keyword">goto</span> <span class="token number">46</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">6</span><span class="token punctuation">)</span>
<span class="token number">43</span> bipush <span class="token number">40</span>
<span class="token number">45</span> istore_2
<span class="token number">46</span> <span class="token keyword">return</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><ul><li>如果是 1，跳转到第 7 行，得到 10，通过 goto 跳到 return，结束运行</li> <li>如果是 2，跳转到第 10 行，得到 20，接着往下走，得到 30，通过 goto 跳到 return，结束运行（没有 break 的原因，break 就会产生 goto）</li> <li>如果是 3，跳转到第 12 行，得到 30，通过 goto 跳到 return，结束运行</li></ul> <blockquote><p>代码示例 2：lookupswitch 指令</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">swtich2</span><span class="token punctuation">(</span><span class="token keyword">int</span> select<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">int</span> num<span class="token punctuation">;</span>
    <span class="token keyword">switch</span><span class="token punctuation">(</span>select<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token number">100</span><span class="token operator">:</span>
            num <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">500</span><span class="token operator">:</span>
            num <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">200</span><span class="token operator">:</span>
            num <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">default</span><span class="token operator">:</span>
            num <span class="token operator">=</span> <span class="token number">40</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>字节码（<code>lookupswitch</code> 会进行排序，500 放到 200 的下面）：</p> <div class="language-java line-numbers-mode"><div class="highlight-lines"><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-java"><code> <span class="token number">0</span> iload_1
 <span class="token number">1</span> lookupswitch <span class="token number">3</span>
	<span class="token number">100</span><span class="token operator">:</span>  <span class="token number">36</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">35</span><span class="token punctuation">)</span>
	<span class="token number">200</span><span class="token operator">:</span>  <span class="token number">48</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">47</span><span class="token punctuation">)</span>
	<span class="token number">500</span><span class="token operator">:</span>  <span class="token number">42</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">41</span><span class="token punctuation">)</span>
	<span class="token keyword">default</span><span class="token operator">:</span>  <span class="token number">54</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">53</span><span class="token punctuation">)</span>
<span class="token number">36</span> bipush <span class="token number">10</span>
<span class="token number">38</span> istore_2
<span class="token number">39</span> <span class="token keyword">goto</span> <span class="token number">57</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">18</span><span class="token punctuation">)</span>
<span class="token number">42</span> bipush <span class="token number">20</span>
<span class="token number">44</span> istore_2
<span class="token number">45</span> <span class="token keyword">goto</span> <span class="token number">57</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">12</span><span class="token punctuation">)</span>
<span class="token number">48</span> bipush <span class="token number">30</span>
<span class="token number">50</span> istore_2
<span class="token number">51</span> <span class="token keyword">goto</span> <span class="token number">57</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">6</span><span class="token punctuation">)</span>
<span class="token number">54</span> bipush <span class="token number">40</span>
<span class="token number">56</span> istore_2
<span class="token number">57</span> <span class="token keyword">return</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><ul><li>如果是 100，跳转到第 7 行，得到 10，通过 goto 跳到 return，结束运行</li> <li>如果是 200，跳转到第 13 行，得到 30，通过 goto 跳到 return，结束运行</li> <li>如果是 500，跳转到第 10 行，得到 20，通过 goto 跳到 return，结束运行</li></ul> <blockquote><p>代码练习</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">swtich3</span><span class="token punctuation">(</span><span class="token class-name">String</span> season<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">switch</span><span class="token punctuation">(</span>season<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token string">&quot;SPRING&quot;</span><span class="token operator">:</span><span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token string">&quot;SUMMER&quot;</span><span class="token operator">:</span><span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token string">&quot;AUTUMN&quot;</span><span class="token operator">:</span><span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token string">&quot;WINTER&quot;</span><span class="token operator">:</span><span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>字节码：</p> <div class="language-java line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-java"><code>  <span class="token number">0</span> aload_1
  <span class="token number">1</span> astore_2
  <span class="token number">2</span> iconst_m1
  <span class="token number">3</span> istore_3
  <span class="token number">4</span> aload_2
  <span class="token number">5</span> invokevirtual #<span class="token number">11</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">.</span>hashCode <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name">I</span><span class="token operator">&gt;</span>
  <span class="token number">8</span> lookupswitch <span class="token number">4</span>
	<span class="token operator">-</span><span class="token number">1842350579</span><span class="token operator">:</span>  <span class="token number">52</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">44</span><span class="token punctuation">)</span>
	<span class="token operator">-</span><span class="token number">1837878353</span><span class="token operator">:</span>  <span class="token number">66</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">58</span><span class="token punctuation">)</span>
	<span class="token operator">-</span><span class="token number">1734407483</span><span class="token operator">:</span>  <span class="token number">94</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">86</span><span class="token punctuation">)</span>
	<span class="token number">1941980694</span><span class="token operator">:</span>  <span class="token number">80</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">72</span><span class="token punctuation">)</span>
	<span class="token keyword">default</span><span class="token operator">:</span>  <span class="token number">105</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">97</span><span class="token punctuation">)</span>
 <span class="token number">52</span> aload_2
 <span class="token number">53</span> ldc #<span class="token number">12</span> <span class="token generics"><span class="token punctuation">&lt;</span>SPRING<span class="token punctuation">&gt;</span></span>
 <span class="token number">55</span> invokevirtual #<span class="token number">13</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">.</span>equals <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">Object</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token class-name">Z</span><span class="token operator">&gt;</span>
 <span class="token number">58</span> ifeq <span class="token number">105</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">47</span><span class="token punctuation">)</span>
 <span class="token number">61</span> iconst_0
 <span class="token number">62</span> istore_3
 <span class="token number">63</span> <span class="token keyword">goto</span> <span class="token number">105</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">42</span><span class="token punctuation">)</span>
 <span class="token number">66</span> aload_2
 <span class="token number">67</span> ldc #<span class="token number">14</span> <span class="token generics"><span class="token punctuation">&lt;</span>SUMMER<span class="token punctuation">&gt;</span></span>
 <span class="token number">69</span> invokevirtual #<span class="token number">13</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">.</span>equals <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">Object</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token class-name">Z</span><span class="token operator">&gt;</span>
 <span class="token number">72</span> ifeq <span class="token number">105</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">33</span><span class="token punctuation">)</span>
 <span class="token number">75</span> iconst_1
 <span class="token number">76</span> istore_3
 <span class="token number">77</span> <span class="token keyword">goto</span> <span class="token number">105</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">28</span><span class="token punctuation">)</span>
 <span class="token number">80</span> aload_2
 <span class="token number">81</span> ldc #<span class="token number">15</span> <span class="token generics"><span class="token punctuation">&lt;</span>AUTUMN<span class="token punctuation">&gt;</span></span>
 <span class="token number">83</span> invokevirtual #<span class="token number">13</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">.</span>equals <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">Object</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token class-name">Z</span><span class="token operator">&gt;</span>
 <span class="token number">86</span> ifeq <span class="token number">105</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">19</span><span class="token punctuation">)</span>
 <span class="token number">89</span> iconst_2
 <span class="token number">90</span> istore_3
 <span class="token number">91</span> <span class="token keyword">goto</span> <span class="token number">105</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">14</span><span class="token punctuation">)</span>
 <span class="token number">94</span> aload_2
 <span class="token number">95</span> ldc #<span class="token number">16</span> <span class="token generics"><span class="token punctuation">&lt;</span>WINTER<span class="token punctuation">&gt;</span></span>
 <span class="token number">97</span> invokevirtual #<span class="token number">13</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">.</span>equals <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">Object</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token class-name">Z</span><span class="token operator">&gt;</span>
<span class="token number">100</span> ifeq <span class="token number">105</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">5</span><span class="token punctuation">)</span>
<span class="token number">103</span> iconst_3
<span class="token number">104</span> istore_3
<span class="token number">105</span> iload_3
<span class="token number">106</span> tableswitch <span class="token number">0</span> <span class="token keyword">to</span> <span class="token number">3</span>
	<span class="token number">0</span><span class="token operator">:</span>  <span class="token number">136</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">30</span><span class="token punctuation">)</span>
	<span class="token number">1</span><span class="token operator">:</span>  <span class="token number">139</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">33</span><span class="token punctuation">)</span>
	<span class="token number">2</span><span class="token operator">:</span>  <span class="token number">142</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">36</span><span class="token punctuation">)</span>
	<span class="token number">3</span><span class="token operator">:</span>  <span class="token number">145</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">39</span><span class="token punctuation">)</span>
	<span class="token keyword">default</span><span class="token operator">:</span>  <span class="token number">145</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">39</span><span class="token punctuation">)</span>
<span class="token number">136</span> <span class="token keyword">goto</span> <span class="token number">145</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">9</span><span class="token punctuation">)</span>
<span class="token number">139</span> <span class="token keyword">goto</span> <span class="token number">145</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">6</span><span class="token punctuation">)</span>
<span class="token number">142</span> <span class="token keyword">goto</span> <span class="token number">145</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token number">145</span> <span class="token keyword">return</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br></div></div><p>结合上面两个例子，加强自己的理解能力吧🤣。</p> <p>8 到 11 行的一大串数字是根据字符串解析出来的哈希值。</p> <h3 id="无条件跳转"><a href="#无条件跳转" class="header-anchor">#</a> 无条件跳转</h3> <p>目前主要的无条件跳转指令为 <code>goto</code>，指令 <code>goto</code> 接收两个字节的操作数，共同组成一个带符号的整数，<strong>用于指定指令的偏移量，指令执行的目的就是跳转到偏移量给定的位置处</strong>。</p> <p>如果指令偏移量太大，超过双字节的带符号整数的范围，则可以使用指令 <code>goto_w</code>，它和 <code>goto</code> 有相同的作用，但是它接收 4 个字节的操作数，可以表示更大的地址范围。</p> <p>指令 <code>jsr</code>、<code>jsr_w</code>、<code>ret</code> 虽然也是无条件跳转的，但主要用于 <code>try-finally</code> 语句，且已经被虚拟机逐渐废弃，故不在这里介绍这两个指令。</p> <table><thead><tr><th>指令名称</th> <th>描述</th></tr></thead> <tbody><tr><td>goto</td> <td>无条件跳转</td></tr> <tr><td>goto_w</td> <td>无条件跳转（宽索引）</td></tr> <tr><td>jsr</td> <td>跳转至指定 16 位 offset位置，并将 jsr 下一条指令地址压入栈顶</td></tr> <tr><td>jsr_w</td> <td>跳转至指定 32 位 offer 位置，并将 jsr_w 下一条指令地址压入栈顶</td></tr> <tr><td>ret</td> <td>返回至由指定的局部变量所给出的指令位置（一般与 jsr、jsr_w 联合使用）</td></tr></tbody></table> <blockquote><p>代码示例 1：goto 指令（int）</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">whileInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token string">&quot;youngkbt.cn&quot;</span><span class="token punctuation">;</span>
        i<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>字节码：</p> <div class="language-java line-numbers-mode"><div class="highlight-lines"><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br></div><pre class="language-java"><code> <span class="token number">0</span> iconst_0
 <span class="token number">1</span> istore_1
 <span class="token number">2</span> iload_1
 <span class="token number">3</span> bipush <span class="token number">100</span>
 <span class="token number">5</span> if_icmpge <span class="token number">17</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">12</span><span class="token punctuation">)</span>
 <span class="token number">8</span> ldc #<span class="token number">17</span> <span class="token generics"><span class="token punctuation">&lt;</span>youngkbt<span class="token punctuation">.</span>cn<span class="token punctuation">&gt;</span></span>
<span class="token number">10</span> astore_2
<span class="token number">11</span> iinc <span class="token number">1</span> by <span class="token number">1</span>
<span class="token number">14</span> <span class="token keyword">goto</span> <span class="token number">2</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">12</span><span class="token punctuation">)</span>
<span class="token number">17</span> <span class="token keyword">return</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>首先 i 存入局部变量表的位置 1，然后通过 <code>if_icmpge</code> 判断 i 是否大于等于 100？</p> <ul><li>如果小于 100，则不跳转，继续往下走，给 s 赋值为 <code>youngkbt.cn</code>，并存入局部变量表的位置 2 后，令局部变量表的位置 1（i）进行一次加 1，最后通过 goto 指令回到第 3 行，重新让加过 1 的 i 入栈，重新判断是否大于等于 100</li> <li>如果大于等于 100，则直接跳转到第 10 行，结束运行</li></ul> <blockquote><p>代码示例 2：goto 指令（double）</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">whileDouble</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">double</span> d <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>d <span class="token operator">&lt;</span> <span class="token number">100.1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token string">&quot;youngkbt.cn&quot;</span><span class="token punctuation">;</span>
        d<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>字节码：</p> <div class="language-java line-numbers-mode"><div class="highlight-lines"><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br></div><pre class="language-java"><code> <span class="token number">0</span> dconst_0
 <span class="token number">1</span> dstore_1
 <span class="token number">2</span> dload_1
 <span class="token number">3</span> ldc2_w #<span class="token number">18</span> <span class="token generics"><span class="token punctuation">&lt;</span>100<span class="token punctuation">.</span>1<span class="token punctuation">&gt;</span></span>
 <span class="token number">6</span> dcmpg
 <span class="token number">7</span> ifge <span class="token number">20</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">13</span><span class="token punctuation">)</span>
<span class="token number">10</span> ldc #<span class="token number">17</span> <span class="token generics"><span class="token punctuation">&lt;</span>youngkbt<span class="token punctuation">.</span>cn<span class="token punctuation">&gt;</span></span>
<span class="token number">12</span> astore_3
<span class="token number">13</span> dload_1
<span class="token number">14</span> dconst_1
<span class="token number">15</span> dadd
<span class="token number">16</span> dstore_1
<span class="token number">17</span> <span class="token keyword">goto</span> <span class="token number">2</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">15</span><span class="token punctuation">)</span>
<span class="token number">20</span> <span class="token keyword">return</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>步骤和代码示例 1 类似，试试自己练习理解。</p> <blockquote><p>代码示例 3：goto 指令（for 循环）</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">printFor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">short</span> i<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token string">&quot;youngkbt.cn&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>字节码：</p> <div class="language-java line-numbers-mode"><div class="highlight-lines"><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br></div><pre class="language-java"><code> <span class="token number">0</span> iconst_0
 <span class="token number">1</span> istore_1
 <span class="token number">2</span> iload_1
 <span class="token number">3</span> bipush <span class="token number">100</span>
 <span class="token number">5</span> if_icmpge <span class="token number">19</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">14</span><span class="token punctuation">)</span>
 <span class="token number">8</span> ldc #<span class="token number">17</span> <span class="token generics"><span class="token punctuation">&lt;</span>youngkbt<span class="token punctuation">.</span>cn<span class="token punctuation">&gt;</span></span>
<span class="token number">10</span> astore_2
<span class="token number">11</span> iload_1
<span class="token number">12</span> iconst_1
<span class="token number">13</span> iadd
<span class="token number">14</span> i2s
<span class="token number">15</span> istore_1
<span class="token number">16</span> <span class="token keyword">goto</span> <span class="token number">2</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">14</span><span class="token punctuation">)</span>
<span class="token number">19</span> <span class="token keyword">return</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>和上面两个例子同理。</p> <blockquote><p>代码练习</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 思考：如下两个方法的操作有何不同？</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">whileTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">&lt;=</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

        i<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 可以继续使用i</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">forTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>i <span class="token operator">&lt;=</span> <span class="token number">100</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
    <span class="token comment">// 不可以继续使用 i</span>
<span class="token punctuation">}</span>
<span class="token comment">// 更进一步</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doWhileTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">do</span><span class="token punctuation">{</span>
        i<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">&lt;=</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>字节码：</p> <div class="language-java line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br></div><pre class="language-java"><code><span class="token comment">// whileTest</span>
 <span class="token number">0</span> iconst_1
 <span class="token number">1</span> istore_1
 <span class="token number">2</span> iload_1
 <span class="token number">3</span> bipush <span class="token number">100</span>
 <span class="token number">5</span> if_icmpgt <span class="token number">14</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">9</span><span class="token punctuation">)</span>
 <span class="token number">8</span> iinc <span class="token number">1</span> by <span class="token number">1</span>
<span class="token number">11</span> <span class="token keyword">goto</span> <span class="token number">2</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">9</span><span class="token punctuation">)</span>
<span class="token number">14</span> <span class="token keyword">return</span>
<span class="token comment">// forTest</span>
 <span class="token number">0</span> iconst_1
 <span class="token number">1</span> istore_1
 <span class="token number">2</span> iload_1
 <span class="token number">3</span> bipush <span class="token number">100</span>
 <span class="token number">5</span> if_icmpgt <span class="token number">14</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">9</span><span class="token punctuation">)</span>
 <span class="token number">8</span> iinc <span class="token number">1</span> by <span class="token number">1</span>
<span class="token number">11</span> <span class="token keyword">goto</span> <span class="token number">2</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">9</span><span class="token punctuation">)</span>
<span class="token number">14</span> <span class="token keyword">return</span>
<span class="token comment">// doWhileTest</span>
 <span class="token number">0</span> iconst_1
 <span class="token number">1</span> istore_1
 <span class="token number">2</span> iinc <span class="token number">1</span> by <span class="token number">1</span>
 <span class="token number">5</span> iload_1
 <span class="token number">6</span> bipush <span class="token number">100</span>
 <span class="token number">8</span> if_icmple <span class="token number">2</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">)</span>
<span class="token number">11</span> <span class="token keyword">return</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h2 id="异常处理指令"><a href="#异常处理指令" class="header-anchor">#</a> 异常处理指令</h2> <h3 id="抛出异常指令"><a href="#抛出异常指令" class="header-anchor">#</a> 抛出异常指令</h3> <p><strong><code>athrow</code> 指令</strong>。</p> <p>在 Java 程序中显式抛出异常的操作（throw 语句）都是由 <code>athrow</code> 指令来实现的。</p> <p>除了使用 throw 语句显式抛出异常情况之外，<strong>JVM 规范还规定了许多运行时一场会在其它 Java 虚拟机指令检测到异常状况时自动抛出</strong>。例如，在之前介绍的整数运算时，当除数为零时，虚拟机会在 idiv 或 ldiv 指令中抛出 <code>ArithmeticException</code> 异常。</p> <p>注意：</p> <p>正常情况下，操作数栈的压入弹出都是一条条指令完成的。唯一的例外情况是 <strong>在抛异常时，Java 虚拟机会清除操作数栈上的所有内容，而后将异常实例压入调用者操作数栈上</strong>。</p> <p>异常及异常的处理：</p> <ul><li>过程一：异常对象的生成过程：<code>throw</code>（手动 / 自动），通过指令 <code>athrow</code> 处理</li> <li>过程二：异常的处理：抓抛模型 <code>try-catch-finally</code>，通过异常表处理</li></ul> <blockquote><p>代码示例 1</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">throwZero</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;参数值为0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>字节码：</p> <div class="language-java line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><div class="highlighted"> </div><br><br></div><pre class="language-java"><code> <span class="token number">0</span> iload_1
 <span class="token number">1</span> ifne <span class="token number">14</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">13</span><span class="token punctuation">)</span>
 <span class="token number">4</span> <span class="token keyword">new</span> #<span class="token number">2</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">RuntimeException</span><span class="token operator">&gt;</span>
 <span class="token number">7</span> dup
 <span class="token number">8</span> ldc #<span class="token number">3</span> <span class="token operator">&lt;</span>参数值为<span class="token number">0</span><span class="token operator">&gt;</span>
<span class="token number">10</span> invokespecial #<span class="token number">4</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">RuntimeException</span><span class="token punctuation">.</span><span class="token generics"><span class="token punctuation">&lt;</span>init<span class="token punctuation">&gt;</span></span> <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token class-name">V</span><span class="token operator">&gt;</span>
<span class="token number">13</span> athrow
<span class="token number">14</span> <span class="token keyword">return</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><code>ifne</code> 判断 i 不等于 0 跳转出去，等于 0 则往下走，new 一个异常，然后「复制一份、ldc 将字符串存入栈中，最后这两个都在第 6 行出栈」，只剩下 new 得到异常，通过 <code>athrow</code> 抛出给调用 <code>throwZero</code> 方法的方法。</p> <blockquote><p>代码示例</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">throwOne</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">,</span><span class="token class-name">IOException</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;参数值为1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>字节码：</p> <div class="language-java line-numbers-mode"><div class="highlight-lines"><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br></div><pre class="language-java"><code> <span class="token number">0</span> iload_1
 <span class="token number">1</span> iconst_1
 <span class="token number">2</span> if_icmpne <span class="token number">15</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">13</span><span class="token punctuation">)</span>
 <span class="token number">5</span> <span class="token keyword">new</span> #<span class="token number">2</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">RuntimeException</span><span class="token operator">&gt;</span>
 <span class="token number">8</span> dup
 <span class="token number">9</span> ldc #<span class="token number">5</span> <span class="token operator">&lt;</span>参数值为<span class="token number">1</span><span class="token operator">&gt;</span>
<span class="token number">11</span> invokespecial #<span class="token number">4</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">RuntimeException</span><span class="token punctuation">.</span><span class="token generics"><span class="token punctuation">&lt;</span>init<span class="token punctuation">&gt;</span></span> <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token class-name">V</span><span class="token operator">&gt;</span>
<span class="token number">14</span> athrow
<span class="token number">15</span> <span class="token keyword">return</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>解析和代码示例 1 一样，只不过 <code>if_icmpne</code> 替换了 <code>ifne</code> 指令。</p> <h3 id="异常处理与异常表"><a href="#异常处理与异常表" class="header-anchor">#</a> 异常处理与异常表</h3> <blockquote><p>异常处理</p></blockquote> <p>在 Java 虚拟机中，处理异常（catch 语句）不是由字节码指令来实现的（早期使用 jsr、ret 指令），而是 <strong>采用异常表来完成的</strong>。</p> <blockquote><p>异常表</p></blockquote> <p>如果一个方法定义了一个 <code>try-catch</code> 或者 <code>try-finally</code> 的异常处理，就会创建一个异常表。它包含了每个异常处理或者 finally 块的信息。异常表保存了每个异常处理信息。比如：</p> <ul><li>起始位置</li> <li>结束位置</li> <li>程序计数器记录的代码处理的偏移地址</li> <li>被捕获的异常类在常量池中的索引</li></ul> <p><strong>当一个异常被抛出时，JVM 会在当前的方法里寻找一个匹配的处理，如果没有找到，这个方法会强制结束并弹出当前栈帧</strong>，并且异常会重新抛给上层调用的方法(在调用方法栈帧)。如果在所有栈帧弹出前仍然没有找到合适的异常处理，这个县城将终止。如果这个异常在最后一个非守护线程里抛出，将会导致 JVM 自己终止，比如这个线程是个 main 线程。</p> <p><strong>不管什么时候抛出异常，如果异常处理最终匹配了所有异常类型，代码就会继续执行</strong>。在这种情况下， 如果方法结束后没有抛出异常，仍然执行 finally 块，在 return 前，它直接跳到 finally 块来完成目标。</p> <blockquote><p>代码示例 1</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">tryCatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">try</span><span class="token punctuation">{</span>
        <span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;d:/hello.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">FileInputStream</span> fis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">String</span> info <span class="token operator">=</span> <span class="token string">&quot;hello!&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">FileNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">RuntimeException</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>字节码（看注解）：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code> <span class="token number">0</span> <span class="token keyword">new</span> #<span class="token number">8</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>io<span class="token operator">/</span><span class="token class-name">File</span><span class="token operator">&gt;</span>    <span class="token comment">// new 一个 File 对象，将地址放入栈中</span>
 <span class="token number">3</span> dup					    <span class="token comment">// 复制一份 File 的地址放入栈中</span>
 <span class="token number">4</span> ldc #<span class="token number">9</span> <span class="token operator">&lt;</span>d<span class="token operator">:</span><span class="token operator">/</span>hello<span class="token punctuation">.</span>txt<span class="token operator">&gt;</span>    <span class="token comment">// 字符串 d:/hello.txt 地址入栈</span>
 <span class="token number">6</span> invokespecial #<span class="token number">10</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>io<span class="token operator">/</span><span class="token class-name">File</span><span class="token punctuation">.</span><span class="token generics"><span class="token punctuation">&lt;</span>init<span class="token punctuation">&gt;</span></span> <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token class-name">V</span><span class="token operator">&gt;</span> <span class="token comment">// 构调用造器后，复制的地址和字符串出栈</span>
 <span class="token number">9</span> astore_1  			    <span class="token comment">// 将 File 对象地址存入局部变量表（第一行 new 的 File 地址）</span>
<span class="token number">10</span> <span class="token keyword">new</span> #<span class="token number">11</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>io<span class="token operator">/</span><span class="token class-name">FileInputStream</span><span class="token operator">&gt;</span> <span class="token comment">// new FileInputStream 对象的地址入栈</span>
<span class="token number">13</span> dup  				    <span class="token comment">// 复制一份 FileInputStream 对象的地址入栈</span>
<span class="token number">14</span> aload_1				    <span class="token comment">// 将局部变量表的 File 地址入栈</span>
<span class="token number">15</span> invokespecial #<span class="token number">12</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>io<span class="token operator">/</span><span class="token class-name">FileInputStream</span><span class="token punctuation">.</span><span class="token generics"><span class="token punctuation">&lt;</span>init<span class="token punctuation">&gt;</span></span> <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token class-name">Ljava</span><span class="token operator">/</span>io<span class="token operator">/</span><span class="token class-name">File</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token class-name">V</span><span class="token operator">&gt;</span> <span class="token comment">// 复制的地址出栈</span>
<span class="token number">18</span> astore_2 			    <span class="token comment">// 将 FileInputStream 对象地址存入局部变量表（第 6 行）</span>
<span class="token number">19</span> ldc #<span class="token number">13</span> <span class="token operator">&lt;</span>hello<span class="token operator">!</span><span class="token operator">&gt;</span>         <span class="token comment">// 字符串 hello! 地址入栈</span>
<span class="token number">21</span> astore_3					<span class="token comment">// 字符串 hello! 地址存入局部变量表</span>
<span class="token number">22</span> <span class="token keyword">goto</span> <span class="token number">38</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">16</span><span class="token punctuation">)</span>            <span class="token comment">// 直接跳转到 return 初，结束运行</span>
    
<span class="token comment">// ************************ 异常表的处理 ********************</span>
<span class="token number">25</span> astore_1                
<span class="token number">26</span> aload_1
<span class="token number">27</span> invokevirtual #<span class="token number">15</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>io<span class="token operator">/</span><span class="token class-name">FileNotFoundException</span><span class="token punctuation">.</span>printStackTrace <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name">V</span><span class="token operator">&gt;</span>
<span class="token number">30</span> <span class="token keyword">goto</span> <span class="token number">38</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">8</span><span class="token punctuation">)</span>
<span class="token number">33</span> astore_1
<span class="token number">34</span> aload_1
<span class="token number">35</span> invokevirtual #<span class="token number">16</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">RuntimeException</span><span class="token punctuation">.</span>printStackTrace <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name">V</span><span class="token operator">&gt;</span>
<span class="token comment">// ********************************************</span>

<span class="token number">38</span> <span class="token keyword">return</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>我们可以看到执行到第 13 行后直接跳转到 return，结束运行，那么 16 行到 22 行的处理指令不执行了吗？</p> <p>这就需要到异常表，我们打开异常表，如图：</p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Java/20220128234818.png" alt="image-20220128234817333"></p> <p>看到异常表的 25 和 33 指向了字节码代码块的 16 行到 22 行，所以如果出现了异常，那么由异常表进行处理，直接跳转到对应的行数。</p> <p>另外说明：异常表的 <code>FileNotFoundException</code> 和 <code>RuntimeException</code> 异常监听的都是 0 - 22 行（字节码行数）的代码。</p> <p>这也就是为什么我们无法在字节码看出异常处理的执行，它交给异常表执行。</p> <blockquote><p><strong>代码示例 2</strong>：面试常客</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//思考：如下方法返回结果为多少？</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> str<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">finally</span><span class="token punctuation">{</span>
        str <span class="token operator">=</span> <span class="token string">&quot;kele&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// hello</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>字节码：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code> <span class="token number">0</span> ldc #<span class="token number">17</span> <span class="token generics"><span class="token punctuation">&lt;</span>hello<span class="token punctuation">&gt;</span></span>  <span class="token comment">// hello 地址入栈</span>
 <span class="token number">2</span> astore_0			<span class="token comment">// hello 存入局部变量表位置 0，并出栈</span>
 <span class="token number">3</span> aload_0			<span class="token comment">// hello 出现入栈</span>
 <span class="token number">4</span> astore_1			<span class="token comment">// hello 存入局部变量表位置 1，并出栈</span>
 <span class="token number">5</span> ldc #<span class="token number">18</span> <span class="token generics"><span class="token punctuation">&lt;</span>kele<span class="token punctuation">&gt;</span></span>   <span class="token comment">// kele 入栈</span>
 <span class="token number">7</span> astore_0			<span class="token comment">// kele 覆盖局部变量表位置 0 的 hello</span>
 <span class="token number">8</span> aload_1			<span class="token comment">// 局部变量表位置 1 的 hello 入栈</span>
 <span class="token number">9</span> areturn			<span class="token comment">// 输出 hello</span>
<span class="token comment">// ************************ 异常表的处理 ********************</span>
<span class="token number">10</span> astore_2
<span class="token number">11</span> ldc #<span class="token number">18</span> <span class="token generics"><span class="token punctuation">&lt;</span>kele<span class="token punctuation">&gt;</span></span>
<span class="token number">13</span> astore_0
<span class="token number">14</span> aload_2
<span class="token number">15</span> athrow
<span class="token comment">// ********************************************</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>通过字节码我们得出，局部变量表存有 hello 和 kele 的地址，但是最终返回的是 hello 的地址。</p> <p>第 10 行到第 14 行由异常表进行跳转执行。</p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Java/20220128235703.png" alt="image-20220128235702095"></p> <h2 id="同步控制指令"><a href="#同步控制指令" class="header-anchor">#</a> 同步控制指令</h2> <p><code>monitor</code> 指令。</p> <p>Java 虚拟机支持两种同步结构：<strong>方法级同步</strong> 和 <strong>方法内部一段指令序列的同步</strong>，这两种同步都是使用 <code>monitor</code> 来支持的。</p> <h3 id="方法级的同步"><a href="#方法级的同步" class="header-anchor">#</a> 方法级的同步</h3> <p>方法级的同步：<strong>是隐式的</strong>，即无需通过字节码指令来控制，它实现在方法调用和返回操作之中。虚拟机可以从方法常量池的方法表结构中的 <code>ACC_SYNCHRONIZED</code> 访问标志得知一个方法是否声明为同步方法。</p> <p>当调用方法时，调用指令将会检查方法的 <code>ACC_SYNCHRONIZED</code> 访问标志是否设置。</p> <ul><li>如果设置了，执行线程将先持有同步锁，然后执行方法，最后在方法完成（无论是正常完成还是非正常完成）时释放同步锁</li> <li>在方法执行期间，执行线程持有了同步锁，其它任何线程都无法再获得同一个锁</li> <li>如果一个同步方法执行期间抛出了异常，并且在方法内部无法处理此异常，那么这个同步方法所持有的锁将在异常抛到同步方法之外时自动释放</li></ul> <p>举例：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  i<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>对应字节码：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token number">0</span> aload_0
<span class="token number">1</span> dup
<span class="token number">2</span> getdield #<span class="token number">2</span> <span class="token operator">&lt;</span>com<span class="token operator">/</span>youngkbt<span class="token operator">/</span>java1<span class="token operator">/</span><span class="token class-name">SynchronizedTest</span><span class="token punctuation">.</span>i<span class="token operator">&gt;</span>
<span class="token number">5</span> iconst_1
<span class="token number">6</span> iadd
<span class="token number">7</span> putfield #<span class="token number">2</span> <span class="token operator">&lt;</span>com<span class="token operator">/</span>youngkbt<span class="token operator">/</span>java1<span class="token operator">/</span><span class="token class-name">SynchronizedTest</span><span class="token punctuation">.</span>i<span class="token operator">&gt;</span>
<span class="token number">10</span> <span class="token keyword">return</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>这段代码和普通的无同步操作的代码没有什么不同，没有使用 <code>monitorenter</code> 和 <code>monitorexit</code> 进行同步区控制。</p> <p>这是因为，对于同步方法而言，当虚拟机 <strong>通过方法的访问标识符判断是一个同步方法时，会自动在方法调用前进行加锁</strong>，当同步方法执行完毕后，不管方法是正常结束还是有异常抛出，均会由虚拟机释放这个锁。</p> <p>因此，对于同步方法而言，<code>monitorenter</code> 和 <code>monitorexit</code> 指令是隐式存在的，并未直接出现在字节码中，而是交由访问标志来判断是否同步。</p> <h3 id="方法内指定指令序列的同步"><a href="#方法内指定指令序列的同步" class="header-anchor">#</a> 方法内指定指令序列的同步</h3> <p>同步一段指令集序列：通常是由 Java 中的 synchronized 语句块来表示的。JVM 的指令集有 <code>monitorenter</code> 和 <code>monitorexit</code> 两条指令来支持 synchronized 关键字的语义。</p> <p>当一个线程进入同步代码块时，它使用 <code>monitorenter</code> 指令请求进入。如果当前对象的监视器计数器为 0，则它会被准许进入，若为 1，则判断持有当前监视器的线程是否为自己，如果是，则进入，否则进行等待，知道对象的监视器计数器为 0，才会被允许进入同步块。</p> <p>当线程退出同步块时，需要使用 <code>monitorexit</code> 声明退出。在 Java 虚拟机中，任何对象都有一个监视器与之相关联，用来判断对象是否被锁定，当监视器被持有后，对象处于锁定状态。</p> <p>指令 <code>monitorenter</code> 和 <code>monitorexit</code> 在执行时，都需要在操作数栈顶压入对象，之后 <code>monitorenter</code> 和 <code>monitorexit</code> 的锁定和释放都是针对这个对象的监视器进行的。</p> <p>下图展示了监视器如何保护临界区代码不同时被多个线程访问，只有当线程 4 离开临界区后，线程 1、2、3 才有可能进入。</p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Java/20220129000226.png" alt="image-20220129000225708"></p> <p>编译器必须确保无论方法通过何种方式完成，方法中调用过的每条 <code>monitorenter</code> 指令都必须执行其对应的 <code>monitorexit</code> 指令，而无论这个方法是正常结束还是异常结束。</p> <p>为了保证在方法异常完成时 <code>monitorenter</code> 和 <code>monitorexit</code> 指令依然可以正确配对执行，<strong>编译器会自动产生一个异常处理器，这个异常处理器声明可处理所有的异常</strong>，它的目的就是用来执行 <code>monitorexit</code> 指令。</p> <blockquote><p>代码示例</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">Object</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">subtract</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">{</span>
        i<span class="token operator">--</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>字节码：</p> <div class="language-java line-numbers-mode"><div class="highlight-lines"><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br></div><pre class="language-java"><code> <span class="token number">0</span> aload_0
 <span class="token number">1</span> getfield #<span class="token number">4</span> <span class="token operator">&lt;</span>com<span class="token operator">/</span>youngkbt<span class="token operator">/</span>java1<span class="token operator">/</span><span class="token class-name">SynchronizedTest</span><span class="token punctuation">.</span>obj <span class="token operator">:</span> <span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">Object</span><span class="token punctuation">;</span><span class="token operator">&gt;</span>
 <span class="token number">4</span> dup
 <span class="token number">5</span> astore_1
 <span class="token number">6</span> monitorenter
 <span class="token number">7</span> aload_0
 <span class="token number">8</span> dup
 <span class="token number">9</span> getfield #<span class="token number">2</span> <span class="token operator">&lt;</span>com<span class="token operator">/</span>youngkbt<span class="token operator">/</span>java1<span class="token operator">/</span><span class="token class-name">SynchronizedTest</span><span class="token punctuation">.</span>i <span class="token operator">:</span> <span class="token class-name">I</span><span class="token operator">&gt;</span>
<span class="token number">12</span> iconst_1
<span class="token number">13</span> isub
<span class="token number">14</span> putfield #<span class="token number">2</span> <span class="token operator">&lt;</span>com<span class="token operator">/</span>youngkbt<span class="token operator">/</span>java1<span class="token operator">/</span><span class="token class-name">SynchronizedTest</span><span class="token punctuation">.</span>i <span class="token operator">:</span> <span class="token class-name">I</span><span class="token operator">&gt;</span>
<span class="token number">17</span> aload_1
<span class="token number">18</span> monitorexit
<span class="token number">19</span> <span class="token keyword">goto</span> <span class="token number">27</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">8</span><span class="token punctuation">)</span>
<span class="token comment">// ************************ 异常表的处理 ********************</span>
<span class="token number">22</span> astore_2
<span class="token number">23</span> aload_1
<span class="token number">24</span> monitorexit
<span class="token number">25</span> aload_2
<span class="token number">26</span> athrow
<span class="token comment">// ********************************************</span>
<span class="token number">27</span> <span class="token keyword">return</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>第 5 行执行 <code>monitorenter</code> 指令后，监视器计数器加 1 形成锁，其他的线程无法进入，执行完代码后来带第 13 行的 <code>monitorexit</code> 指令，将监视器计数器变成 0，即释放锁，其他线程将才可以进入。</p> <p>第 18 行的 <code>monitorexit</code> 指令是针对发生异常的情况，走不到第 13 行的 <code>monitorexit</code> 而出现的，即防止出现异常却无法释放锁的 bug。</p> <p>虽然代码里没有抛出异常或者捕获异常，但是依然会有异常处理机制，如下异常表图：</p> <p><img src="https://cdn.jsdelivr.net/gh/Kele-Bingtang/static/img/Java/20220129001638.png" alt="image-20220129001636535"></p> <p>从上图我们知道，异常监听了 7 - 19 行（字节码行数）的代码，如果出现异常，则直接跳转到 22 行（字节码行数）处。</p></div></div> <!----> <div class="page-edit"><div class="edit-link"><a href="https://github.com/Kele-Bingtang/pure-blog/edit/master/docs/10.Java/20.Java 底层 - JVM/37.JVM - 字节码指令集与解析.md" target="_blank" rel="noopener noreferrer">编辑此页</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="tags"><a href="/tags/?tag=Java" title="标签">#Java</a></div> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">2024/11/03, 02:07:00</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/java/jvm/class-file-structure/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">JVM - Class文件结构</div></a> <a href="/java/jvm/class-loading-process/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">JVM - 类的加载过程详解</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/java/jvm/class-file-structure/" class="prev">JVM - Class文件结构</a></span> <span class="next"><a href="/java/jvm/class-loading-process/">JVM - 类的加载过程详解</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/ep/magic-change/"><div>
            技术随笔 - Element Plus 修改包名
            <span class="title-tag">
              原创
            </span></div></a> <span class="date">11-02</span></dt></dl><dl><dd>02</dd> <dt><a href="/reactor/extensibility/"><div>
            Reactor - 扩展性
            <!----></div></a> <span class="date">11-02</span></dt></dl><dl><dd>03</dd> <dt><a href="/reactor/best-practices/"><div>
            Reactor - 最佳实践
            <!----></div></a> <span class="date">11-02</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="https://github.com/kele-bingtang" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://gitee.com/kele-bingtang" title="Gitee" target="_blank" class="iconfont icon-gitee"></a><a href="https://www.youngkbt.cn" title="网站首页" target="_blank" class="iconfont icon-rss"></a><a href="http://wpa.qq.com/msgrd?v=3&amp;uin=28761025&amp;site=qq&amp;menu=yes" title="QQ" target="_blank" class="iconfont icon-QQ"></a><a href="https://www.youngkbt.cn/?contact=true" title="联系我" target="_blank" class="iconfont icon-youjian"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2021-2024
    <span>Young Kbt  | blog<br> <a href="http://beian.miit.gov.cn/" target="_blank">桂ICP备2021009994号</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><div></div><div></div><!----></div></div>
    <script src="/assets/js/app.7d9f7e76.js" defer></script><script src="/assets/js/2.7b39a60a.js" defer></script><script src="/assets/js/120.2fca89dd.js" defer></script><script src="/assets/js/7.e563704e.js" defer></script><script src="/assets/js/4.e30b0885.js" defer></script>
  </body>
</html>
